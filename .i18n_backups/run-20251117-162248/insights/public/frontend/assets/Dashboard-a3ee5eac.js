import{s as J,bg as ue,bh as de,C as ce,b5 as me,E as F,r as S,o as r,d as I,F as j,g as se,f as w,h as v,y as H,u as O,aI as X,D as pe,j as L,an as ae,K as t,e as x,c as k,J as G,w as D,t as re,aC as Q,I as fe,i as q,aH as ge,af as he,bi as ye,T as ve,al as be,aV as _e}from"./frappe-ui-d69b39da.js";import{u as we,_ as xe,C as Ce}from"./QueryDataSourceSelector-8ecc9714.js";import{B as ke,_ as De,a as Ie}from"./DashboardEmptyState-00d606e5.js";import{s as $e,c as Se}from"./toasts-2937f9d2.js";import{b as Le,s as ne,d as ee,a as Be}from"./index-9194c21d.js";import{w as B}from"./widgets-5dfe9af0.js";import{u as Ve}from"./useChartData-3320721f.js";import{M as qe}from"./maximize-3d779b9b.js";import{_ as Te,a as We}from"./Query-9187b102.js";import{_ as Ee}from"./Autocomplete-e91e4d1c.js";import{u as Fe}from"./queryStore-e3123969.js";import"./router-9009eafe.js";import"./index-77f7bd6f.js";import"./TanstackTable-bdba0e34.js";import"./search-34ad51bc.js";import"./chevron-down-7c5e9308.js";import"./chevron-right-abc82e4c.js";import"./colors-18b5c913.js";import"./chevron-left-c299c44c.js";import"./vue-codemirror.esm-d1d2df5a.js";import"./useDataSource-526c5b5a.js";import"./cacheStore-a53900e8.js";import"./useDataSourceTable-37863c71.js";import"./dataSourceStore-ae22034f.js";import"./dayjs-e81f6541.js";import"./calendar-1687c485.js";import"./clock-73e01da8.js";import"./chart-scatter-06f2042d.js";import"./list-filter-e596ffc3.js";import"./text-cursor-input-3636b908.js";import"./format-a2b0a407.js";import"./PageBreadcrumbs-2c73064a.js";import"./house-94cdb6cd.js";import"./ellipsis-10a30b7b.js";import"./Tabs-88c08023.js";import"./Checkbox-95c21eb1.js";import"./useDashboards-65106383.js";import"./ChartSectionEmptySvg-d77827da.js";import"./check-2c63c113.js";import"./play-63d306bd.js";import"./combine-0dbf7ac7.js";import"./bug-a1e6b610.js";import"./Popover-5414f173.js";import"./vuedraggable.umd-f13fb48a.js";import"./DatePicker-296330db.js";import"./FilterValueSelector-3cbeb5d5.js";import"./ListPicker-9a2927d2.js";import"./DraggableList-f8776dbd.js";import"./grip-vertical-c5c2fa7d.js";import"./x-3f18ad86.js";import"./square-chart-gantt-d62ce5e7.js";import"./table-2-565c43f4.js";const ie=$e();function Oe(a){const n=Re(a),e=J({doc:{doctype:"Insights Dashboard",name:void 0,owner:void 0,title:void 0,items:[]},isOwner:!1,canShare:!1,isPrivate:!1,editing:!1,loading:!1,deleting:!1,currentItem:void 0,draggingWidget:void 0,sidebar:{open:!0,position:"right"},itemLayouts:[],filterStates:{},filtersByChart:{},refreshCallbacks:[]});async function g(){e.loading=!0,await n.get.fetch(),e.doc=n.doc,e.itemLayouts=e.doc.items.map(P),e.isOwner=e.doc.owner==ie.user.email,e.canShare=e.isOwner||ie.user.is_admin,n.is_private.fetch().then(o=>e.isPrivate=o),e.loading=!1}g();async function d(){e.editing&&(e.loading=!0,e.doc.items.forEach((o,y)=>o.idx=y),e.doc.items.forEach(m),await n.setValue.submit(e.doc),await g(),e.currentItem=void 0,e.loading=!1,e.editing=!1,window.location.reload())}async function s(){e.deleting=!0,await n.delete.submit(),e.deleting=!1}function _(o){e.editing&&(e.doc.items.push(le(o)),e.itemLayouts.push(U(o)))}function m(o){const y=e.itemLayouts.find(C=>C.i===parseInt(o.item_id));o.layout=y||o.layout}function p(o){if(!e.editing)return;const y=e.doc.items.findIndex(C=>C.item_id===o.item_id);e.doc.items.splice(y,1),e.itemLayouts.splice(y,1),e.currentItem=void 0}function i(o){e.editing&&(e.currentItem=e.doc.items.find(y=>y.item_id===o),e.loadCurrentItemQuery(e.currentItem.options.query))}function b(o){return`filterState-${e.doc.name}-${o}`}async function f(o){return e.filterStates[o]||(e.filterStates[o]=await ue(b(o))),e.filterStates[o]}async function c(o,y){const C=y?{operator:y.operator,value:y.value}:void 0;Le(C,e.filterStates[o])||de(b(o),C).then(()=>{e.filterStates[o]=C,h(o)})}function h(o){e.doc.items.some(y=>{if(y.item_id===o)return(Object.keys(y.options.links)||[]).forEach($=>{l($)}),!0})}async function l(o){const y=e.doc.items.filter($=>$.item_type==="Filter").map(async $=>{var te,oe;const E=(te=$.options.links)==null?void 0:te[o];if(!E)return;const N=await f($.item_id);if(N&&((oe=N.value)!=null&&oe.value))return{label:$.options.label,column:E,value:N.value.value,operator:N.operator.value,column_type:E.type};const z=$.options.defaultOperator,Y=$.options.defaultValue;if(z!=null&&z.value&&(Y!=null&&Y.value))return{label:$.options.label,column:E,value:Y.value,operator:z.value,column_type:E.type}}),C=await Promise.all(y);e.filtersByChart[o]=C.filter(Boolean)}async function u(o){return e.filtersByChart[o]||await l(o),e.filtersByChart[o]}async function R(o,y){if(y||e.doc.items.some($=>{if($.item_id===o)return y=$.options.query,!0}),!y)throw new Error(`Query not found for item ${o}`);const C=await u(o);return n.fetch_chart_data.submit({item_id:o,query_name:y,filters:C})}function W(o){const y=e.doc.items.find(C=>C.item_id===o);Object.keys(y.options.links).forEach(C=>{Object.keys(e.queryResults).forEach($=>{$.startsWith(`${C}-`)&&(delete e.queryResults[$],R(C))})})}async function M(){await n.clear_charts_cache.submit(),await g(),e.refreshCallbacks.forEach(o=>o())}function V(o){e.refreshCallbacks.push(o)}const K=ce(function(o){!o||!e.editing||(e.doc.title=o)},500);function P(o){return{i:parseInt(o.item_id),x:o.layout.x||0,y:o.layout.y||0,w:o.layout.w||B[o.item_type].defaultWidth,h:o.layout.h||B[o.item_type].defaultHeight}}function U(o){const y=B[o.item_type].defaultWidth,C=B[o.item_type].defaultHeight,$=o.initialX,E=o.initialY;return delete o.initialX,delete o.initialY,{i:parseInt(o.item_id),x:$||0,y:E||0,w:y,h:C}}function A(o){e.doc.is_public!==o&&n.setValue.submit({is_public:o}).then(()=>{Se({title:"Dashboard access updated",variant:"success"}),e.doc.is_public=o})}function T(o){!o||!e.currentItem||(e.currentItem.query=we(o),e.currentItem.query.reload())}return Object.assign(e,{reload:g,save:d,addItem:_,removeItem:p,setCurrentItem:i,getChartResults:R,getFilterStateKey:b,getFilterState:f,setFilterState:c,refreshFilter:W,refreshChartFilters:l,edit:()=>(e.editing=!0,e.currentItem=void 0),discardChanges:()=>(e.editing=!1,g(),e.currentItem=void 0),toggleSidebar:()=>e.sidebar.open=!e.sidebar.open,setSidebarPosition:o=>e.sidebar.position=o,updateTitle:K,deleteDashboard:s,refresh:M,onRefresh:V,isChart:o=>!["Filter","Text"].includes(o.item_type),togglePublicAccess:A,loadCurrentItemQuery:T,resetOptions:o=>{o.options={query:o.options.query}}})}function Re(a){return me({doctype:"Insights Dashboard",name:a,auto:!1,whitelistedMethods:{fetch_chart_data:"fetch_chart_data",clear_charts_cache:"clear_charts_cache",is_private:"is_private"},transform(n){return n.items=n.items.map(le),n}})}function le(a){return a.options=ne(a.options,{}),a.layout=ne(a.layout,{}),a}const He={class:"flex cursor-pointer rounded bg-gray-800 p-1 shadow-sm"},Me=["onClick"],Qe={__name:"DashboardItemActions",props:{item:Object},setup(a){const n=a,e=F("dashboard"),g=F("widgetRef"),d=[{icon:"external-link",label:"Open Query",hidden:s=>s.item_type==="Filter"||s.item_type==="Text",onClick(s){s.options.query&&window.open(`/insights/query/build/${s.options.query}`,"_blank")}},{icon:"download",label:"Download",hidden:s=>s.item_type==="Filter"||s.item_type==="Text",onClick(){ee(g.value.$el,`${n.item.options.title}.png`)}},{icon:"trash",label:"Delete",onClick:s=>e.removeItem(s)}];return(s,_)=>{const m=S("FeatherIcon");return r(),I("div",He,[(r(),I(j,null,se(d,p=>w("div",{key:p.label,class:H(["px-1 py-0.5",{hidden:p.hidden&&p.hidden(a.item)}]),onClick:i=>p.onClick(a.item)},[v(m,{name:p.icon,class:"h-3.5 w-3.5 text-white"},null,8,["name"])],10,Me)),64))])}}},je={class:"dashboard-item h-full min-h-[60px] w-full p-2 [&>div:first-child]:h-full"},Pe={key:0,class:"absolute inset-0 z-[10000] flex h-full w-full items-center justify-center rounded bg-white"},Ue={class:"absolute right-3 top-3 z-[10001] flex items-center"},Ae={key:0},Ne={class:"flex items-center space-x-1 rounded-full bg-gray-100 px-2 py-1 text-sm leading-3 text-gray-600"},ze={key:1,class:"invisible group-hover:visible"},Ye={key:2,class:"invisible -mb-1 -mt-1 flex cursor-pointer rounded p-1 text-gray-600 hover:bg-gray-100 group-hover:visible"},Xe={class:"relative flex h-[40rem] w-full p-1"},Ge={class:"absolute top-0 right-0 p-2"},Ke={__name:"DashboardItem",props:{item:{type:Object,required:!0}},setup(a){const n=F("dashboard"),e=a;let g=n.isChart(e.item),d=g?O(()=>n.filtersByChart[e.item.item_id]):null,s=J({});if(g){const l=O(()=>e.item.options.query);s=Ve({resultsFetcher(){return n.getChartResults(e.item.item_id)}}),X(l,async()=>{await s.load(l.value),p()},{immediate:!0}),n.onRefresh(()=>s.load(l.value)),n.refreshChartFilters(e.item.item_id),pe(d,()=>s.load(l.value))}const _=L(null),m=L(null);ae("widgetRef",m);function p(){var u;if(!e.item.options.query||e.item.options.title||!e.item.item_type)return;e.item.options.query==((u=n.currentItem)==null?void 0:u.options.query)&&!e.item.options.title&&(e.item.options.title=n.currentItem.query.doc.title);const l=s.getGuessedChart(e.item.item_type);e.item.item_type===l.type&&(e.item.options={...e.item.options,...l.options,title:e.item.options.title})}function i(){window.open(`/insights/query/build/${e.item.options.query}`,"_blank")}const b=L(!1),f=L(null),c=L(!1);function h(){if(!f.value){$notify({variant:"error",title:"Chart container reference not found"});return}c.value=!0;const l=e.item.options.title;ee(f.value.$el,`${l}.png`).then(()=>{c.value=!1})}return(l,u)=>{var P,U,A;const R=S("LoadingIndicator"),W=S("FeatherIcon"),M=S("Tooltip"),V=S("Button"),K=S("Dialog");return r(),I("div",je,[w("div",{ref_key:"itemRef",ref:_,class:H(["group relative flex h-full rounded",{" bg-white shadow":t(n).isChart(a.item),"ring-2 ring-gray-700 ring-offset-2":a.item.item_id===((P=t(n).currentItem)==null?void 0:P.item_id),"cursor-grab":t(n).editing}]),onClick:u[3]||(u[3]=Q(T=>t(n).setCurrentItem(a.item.item_id),["prevent","stop"]))},[t(s).loading?(r(),I("div",Pe,[v(R,{class:"w-6 text-gray-300"})])):x("",!0),(r(),k(G(t(B).getComponent(a.item.item_type)),{ref_key:"widget",ref:m,class:H([t(n).editing?"pointer-events-none":""]),item_id:a.item.item_id,data:t(s).data,options:a.item.options},null,8,["class","item_id","data","options"])),w("div",Ue,[(U=t(d))!=null&&U.length?(r(),I("div",Ae,[v(M,{text:t(d).map(T=>{var Z;return T.label||((Z=T.column)==null?void 0:Z.label)}).join(", ")},{default:D(()=>[w("div",Ne,[w("span",null,re(t(d).length),1),v(W,{name:"filter",class:"h-3 w-3",onMousedown:u[0]||(u[0]=Q(()=>{},["prevent","stop"]))})])]),_:1},8,["text"])])):x("",!0),!t(n).editing&&t(g)?(r(),I("div",ze,[v(V,{variant:"ghost",onClick:u[1]||(u[1]=T=>b.value=!0)},{icon:D(()=>[v(t(qe),{class:"h-4 w-4"})]),_:1})])):x("",!0),!t(n).editing&&a.item.options.query?(r(),I("div",Ye,[v(W,{name:"external-link",class:"h-4 w-4",onClick:u[2]||(u[2]=T=>i(a.item))})])):x("",!0)])],2),t(n).editing&&_.value?(r(),k(xe,{key:0,targetElement:_.value,show:t(n).editing&&((A=t(n).currentItem)==null?void 0:A.item_id)===a.item.item_id,placement:"top-end"},{default:D(()=>[v(Qe,{item:a.item},null,8,["item"])]),_:1},8,["targetElement","show"])):x("",!0),a.item.item_type?(r(),k(K,{key:1,modelValue:b.value,"onUpdate:modelValue":u[4]||(u[4]=T=>b.value=T),options:{size:"7xl"}},{body:D(()=>[w("div",Xe,[a.item.item_type?(r(),k(G(t(B).getComponent(a.item.item_type)),{key:0,ref_key:"chartRef",ref:f,options:a.item.options,data:t(s).data},null,8,["options","data"])):x("",!0),w("div",Ge,[v(V,{variant:"outline",onClick:h,loading:c.value,icon:"download"},null,8,["loading"])])])]),_:1},8,["modelValue"])):x("",!0)])}}},Ze={__name:"DashboardMenuButton",setup(a){const n=F("dashboard"),e=L(!1),g=fe();async function d(){await n.deleteDashboard(),e.value=!1,g.push({name:"Dashboards"})}async function s(){const _=document.querySelector(".dashboard");await ee(_,`${n.doc.title}.png`)}return(_,m)=>{const p=S("Dropdown"),i=S("Dialog");return r(),I(j,null,[t(n).doc?(r(),k(p,{key:0,placement:"left",button:{icon:"more-vertical",variant:"outline"},options:[{label:"Export as PNG",variant:"outline",icon:"download",onClick:()=>s()},{label:"Delete",variant:"outline",icon:"trash-2",onClick:()=>e.value=!0}]},null,8,["options"])):x("",!0),v(i,{modelValue:e.value,"onUpdate:modelValue":m[0]||(m[0]=b=>e.value=b),dismissable:!0,options:{title:"Delete Dashboard",message:"Are you sure you want to delete this dashboard?",icon:{name:"trash",variant:"solid",theme:"red"},actions:[{label:"Cancel",variant:"outline",onClick:()=>e.value=!1},{label:"Yes",variant:"solid",theme:"red",onClick:d}]}},null,8,["modelValue","options"])],64)}}},Je={__name:"DashboardShareButton",setup(a){const n=F("dashboard"),e=L(!1);return(g,d)=>{const s=S("Badge"),_=S("Button");return r(),I(j,null,[t(n).isPrivate?(r(),k(s,{key:0,theme:"yellow"},{default:D(()=>d[2]||(d[2]=[q(" Private ")])),_:1})):x("",!0),v(_,{variant:"outline",onClick:d[0]||(d[0]=m=>e.value=!0)},{default:D(()=>d[3]||(d[3]=[q(" Share ")])),_:1}),t(n).doc?(r(),k(Te,{key:1,show:e.value,"onUpdate:show":d[1]||(d[1]=m=>e.value=m),"resource-type":t(n).doc.doctype,"resource-name":t(n).doc.name,"allow-public-access":!0,isPublic:!!t(n).doc.is_public,onTogglePublicAccess:t(n).togglePublicAccess},null,8,["show","resource-type","resource-name","isPublic","onTogglePublicAccess"])):x("",!0)],64)}}},et={class:"flex flex-shrink-0 justify-end space-x-2"},tt={__name:"DashboardNavbarButtons",setup(a){const n=F("dashboard"),e=ge(),g=e["Meta+E"];X(g,n.edit);const d=e["Meta+S"];X(d,n.save);const s=e["Meta+D"];return X(s,n.discardChanges),(_,m)=>{const p=S("Button");return r(),I("div",et,[!t(n).editing&&t(n).canShare?(r(),k(Je,{key:0})):x("",!0),t(n).editing?x("",!0):(r(),k(p,{key:1,variant:"outline",onClick:t(n).refresh},{default:D(()=>m[0]||(m[0]=[q(" Refresh ")])),_:1},8,["onClick"])),t(n).editing?(r(),k(p,{key:2,variant:"outline",onClick:t(n).discardChanges},{default:D(()=>m[1]||(m[1]=[q(" Cancel ")])),_:1},8,["onClick"])):x("",!0),t(n).editing?(r(),k(p,{key:4,variant:"solid",onClick:t(n).save,loading:t(n).loading},{default:D(()=>m[3]||(m[3]=[q(" Save ")])),_:1},8,["onClick","loading"])):(r(),k(p,{key:3,variant:"outline",onClick:t(n).edit},{default:D(()=>m[2]||(m[2]=[q(" Edit ")])),_:1},8,["onClick"])),v(Ze)])}}},ot={class:"space-y-2"},nt={class:"relative"},it={key:0,class:"flex h-[46rem] w-full flex-col justify-end p-4 text-base"},st={class:"ml-auto space-x-2 px-2"},at={__name:"DashboardQueryOption",props:["modelValue"],emits:["update:modelValue"],setup(a,{emit:n}){const e=n,g=a,d=O({get:()=>g.modelValue,set:h=>e("update:modelValue",h)}),s=Fe(),_=O(()=>s.list.map(h=>({label:h.title,value:h.name})));function m(){window.open(`/insights/query/build/${d.value}`,"_blank")}const p=L(!1),i=L(null);async function b(){i.value=await s.create({is_assisted_query:1}),p.value=!0}async function f(){await s.delete(i.value.name),p.value=!1,i.value=null}async function c(){await s.reload(),e("update:modelValue",i.value.name),p.value=!1,i.value=null}return(h,l)=>{const u=Ee,R=S("FeatherIcon"),W=S("Button"),M=S("Dialog");return r(),I(j,null,[w("div",ot,[l[2]||(l[2]=w("span",{class:"mb-2 block text-sm leading-4 text-gray-700"},"Query",-1)),w("div",nt,[v(u,{placeholder:"Select a query",options:_.value,allowCreate:!0,onCreateOption:b,modelValue:d.value,"onUpdate:modelValue":l[0]||(l[0]=V=>d.value=V==null?void 0:V.value)},null,8,["options","modelValue"]),d.value?(r(),I("div",{key:0,class:"absolute right-0 top-0 flex h-full w-8 cursor-pointer items-center justify-center rounded bg-gray-100",onClick:m},[v(R,{name:"maximize-2",class:"h-3.5 w-3.5 text-gray-600 hover:text-gray-900"})])):x("",!0)])]),v(M,{modelValue:p.value,"onUpdate:modelValue":l[1]||(l[1]=V=>p.value=V),dismissable:!1,options:{size:"2xl"}},{body:D(()=>[i.value?(r(),I("div",it,[v(We,{name:i.value.name,hideTabs:!0},null,8,["name"]),w("div",st,[v(W,{variant:"solid",theme:"red",onClick:f,loading:t(s).deleting},{default:D(()=>l[3]||(l[3]=[q(" Discard ")])),_:1},8,["loading"]),v(W,{variant:"solid",onClick:c},{default:D(()=>l[4]||(l[4]=[q(" Done ")])),_:1})])])):x("",!0)]),_:1},8,["modelValue"])],64)}}},rt={class:"grid grid-cols-3 gap-3"},lt=["onDragstart"],ut={class:"flex w-full items-center justify-center p-2 text-center"},dt={__name:"DashboardWidgetsOptions",emits:["dragChange"],setup(a,{emit:n}){const e=F("dashboard"),g=n;function d(s){g("dragChange",s),e.draggingWidget=s}return(s,_)=>(r(),I("div",rt,[(r(!0),I(j,null,se(t(B).list,m=>(r(),I("div",{key:m.type,draggable:!0,class:"cursor-grab rounded border border-gray-100 bg-gray-50 pb-2 pt-1 text-center",onDragend:_[0]||(_[0]=p=>g("dragChange",!1)),onDragstart:p=>d(m)},[w("div",ut,[(r(),k(G(t(B).getIcon(m.type)),{class:"h-6 w-6","stroke-width":1}))]),w("span",null,re(m.type),1)],40,lt))),128))]))}},ct={__name:"UseDropZone",props:{onDrop:{type:Function},showCollision:{type:Boolean,default:!1},colliderClass:{type:String,default:".collider"},ghostWidth:{type:Number,default:128},ghostHeight:{type:Number,default:48}},setup(a){const n=a,e=J({isDragging:!1,collides:!1,ghost:{x:0,y:0},minLeft:0,maxLeft:0,minTop:0,maxTop:0,ghostWidth:O(()=>n.ghostWidth),ghostHeight:O(()=>n.ghostHeight)});function g(){const f=_.value.getBoundingClientRect();e.minLeft=f.left+e.ghostWidth/2,e.minTop=f.top+e.ghostHeight/2,e.maxLeft=f.right-e.ghostWidth/2,e.maxTop=f.bottom-e.ghostHeight/2}function d(f){if(!e.isDragging)return;let c=f.clientX,h=f.clientY;c<e.minLeft?c=0:c>e.maxLeft?c=e.maxLeft-e.minLeft:c=c-e.ghostWidth/2-(e.minLeft-e.ghostWidth/2),h<e.minTop?h=0:h>e.maxTop?h=e.maxTop-e.minTop:h=h-e.ghostHeight/2-(e.minTop-e.ghostHeight/2),e.ghost.x=c,e.ghost.y=h,n.showCollision&&s()}const s=function(){requestAnimationFrame(()=>{const f=document.querySelector(".ghost-element");if(!f)return;const c=f.getBoundingClientRect(),h=Array.from(document.querySelectorAll(n.colliderClass)).some(l=>{const u=l.getBoundingClientRect();return c.left<u.right&&c.right>u.left&&c.top<u.bottom&&c.bottom>u.top});e.collides=h})},_=L(null),m=async f=>{g(),d(f),e.isDragging=!0},p=()=>e.isDragging=!1;he(()=>{g(),window.addEventListener("dragover",d),window.addEventListener("dragend",p),b()}),ye(()=>{window.removeEventListener("dragover",d),window.removeEventListener("dragend",p)});const i=f=>{e.isDragging=!1;const c=f.clientX-e.minLeft,h=f.clientY-e.minTop,l=e.collides;n.onDrop&&n.onDrop({x:c,y:h,collides:l})};ve(()=>!e.isDragging&&b());function b(){e.ghost.x=e.maxLeft-e.minLeft,e.ghost.y=0}return(f,c)=>(r(),I("div",{ref_key:"dropZone",ref:_,onDragenter:Q(m,["prevent"]),onDragover:Q(()=>{},["prevent"]),onDrop:Q(i,["prevent"])},[w("div",{class:H(["ghost-element absolute rounded bg-gray-200/60 transition-all duration-75 ease-out",[n.showCollision&&e.collides?"bg-red-200/60":""]]),style:be({opacity:e.isDragging?1:0,transform:`translate(${e.ghost.x}px, ${e.ghost.y}px)`,width:`${e.ghostWidth}px`,height:`${e.ghostHeight}px`})},null,6)],544))}},mt={class:"flex flex-shrink-0 items-center space-x-4"},pt={class:"h-full w-full overflow-y-auto p-2"},ft={class:"w-[21rem] overflow-y-auto border-l bg-white p-3 px-4 shadow-sm"},gt={key:0},ht={key:1,class:"space-y-4"},yt={class:"flex items-center text-lg font-medium text-gray-500"},vt={class:"flex space-x-2"},Co={__name:"Dashboard",props:{name:{type:String,required:!0}},setup(a){const n=a,e=Oe(n.name);ae("dashboard",e);const g=L(!1);function d(p){var f;const i=_(p);g.value=!1;const b=(f=e.draggingWidget)==null?void 0:f.type;if(b){const c=Math.floor(Math.random()*1e6);e.addItem({item_id:c,item_type:b,initialX:i.x,initialY:i.y}),e.setCurrentItem(c),e.draggingWidget=null}}const s=L(null);function _({x:p,y:i}){const b=s.value.getBoundingClientRect().width/20,f=30;return{x:Math.round(p/b),y:Math.round(i/f)}}const m=O(()=>({title:e.doc.title||n.name,subtitle:"Dashboard"}));return Be(m),(p,i)=>{const b=S("Button"),f=S("Input");return t(e).doc.name?(r(),k(ke,{key:0},_e({navbar:D(()=>[w("div",mt,[v(Ce,{class:H(["rounded-sm text-lg font-medium !text-gray-800 focus:ring-2 focus:ring-gray-700 focus:ring-offset-4",[t(e).editing?"":"cursor-default"]]),value:t(e).doc.title,disabled:!t(e).editing,onChange:i[0]||(i[0]=c=>t(e).updateTitle(c)),placeholder:"Untitled Dashboard"},null,8,["class","value","disabled"])]),v(tt)]),content:D(()=>{var c,h;return[w("div",pt,[w("div",{ref_key:"gridLayout",ref:s,class:"dashboard relative flex h-fit min-h-screen w-full flex-1 flex-col"},[t(e).editing&&g.value?(r(),k(ct,{key:0,class:"absolute left-0 top-0 z-10 h-full w-full",onDrop:d,showCollision:!0,colliderClass:".dashboard-item",ghostWidth:(((c=t(e).draggingWidget)==null?void 0:c.defaultWidth)||4)*50.8,ghostHeight:(((h=t(e).draggingWidget)==null?void 0:h.defaultHeight)||2)*30},null,8,["ghostWidth","ghostHeight"])):x("",!0),v(De,{class:H(["h-fit w-full",[t(e).editing?"mb-[20rem] ":""]]),items:t(e).doc.items,disabled:!t(e).editing,layouts:t(e).itemLayouts,"onUpdate:layouts":i[1]||(i[1]=l=>t(e).itemLayouts=l)},{item:D(({item:l})=>[(r(),k(Ke,{item:l,key:l.item_id},null,8,["item"]))]),_:1},8,["class","items","disabled","layouts"]),t(e).doc.items.length?x("",!0):(r(),k(Ie,{key:1,class:"absolute left-1/2 top-1/2 mx-auto -translate-x-1/2 -translate-y-1/2 transform"}))],512)])]}),_:2},[t(e).editing&&t(e).sidebar.open?{name:"sidebar",fn:D(()=>{var c,h,l;return[w("div",ft,[t(e).currentItem?(r(),I("div",ht,[w("div",yt,[v(b,{variant:"outline",icon:"arrow-left",onClick:i[3]||(i[3]=u=>t(e).currentItem=void 0)}),i[10]||(i[10]=w("div",{class:"ml-2 text-gray-800"},"Back",-1))]),v(f,{type:"select",label:"Widget Type",class:"w-full",options:t(B).list.map(u=>u.type),modelValue:t(e).currentItem.item_type,"onUpdate:modelValue":i[4]||(i[4]=u=>t(e).currentItem.item_type=u)},null,8,["options","modelValue"]),t(e).isChart(t(e).currentItem)?(r(),k(at,{key:0,modelValue:t(e).currentItem.options.query,"onUpdate:modelValue":[i[5]||(i[5]=u=>t(e).currentItem.options.query=u),t(e).loadCurrentItemQuery]},null,8,["modelValue","onUpdate:modelValue"])):x("",!0),t(B).getOptionComponent(t(e).currentItem.item_type)?(r(),k(G(t(B).getOptionComponent(t(e).currentItem.item_type)),{modelValue:t(e).currentItem.options,"onUpdate:modelValue":i[6]||(i[6]=u=>t(e).currentItem.options=u),columns:(c=t(e).currentItem.query)==null?void 0:c.results.columns,key:t(e).currentItem.item_id&&t(e).currentItem.item_type&&((l=(h=t(e).currentItem.query)==null?void 0:h.doc)==null?void 0:l.name)},null,8,["modelValue","columns"])):x("",!0),w("div",vt,[v(b,{iconLeft:"refresh-ccw",variant:"outline",onClick:i[7]||(i[7]=u=>t(e).resetOptions(t(e).currentItem))},{default:D(()=>i[11]||(i[11]=[q(" Reset Options ")])),_:1}),v(b,{iconLeft:"trash",variant:"outline",class:"ml-auto text-red-500",onClick:i[8]||(i[8]=u=>t(e).removeItem(t(e).currentItem))},{default:D(()=>i[12]||(i[12]=[q(" Delete Widget ")])),_:1})])])):(r(),I("div",gt,[i[9]||(i[9]=w("div",{class:"mb-3 font-semibold text-gray-800"},"Widgets",-1)),v(dt,{onDragChange:i[2]||(i[2]=u=>g.value=u)})]))])]}),key:"0"}:void 0]),1024)):x("",!0)}}};export{Co as default};
//# sourceMappingURL=Dashboard-a3ee5eac.js.map
