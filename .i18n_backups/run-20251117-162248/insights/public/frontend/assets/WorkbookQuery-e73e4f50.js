import{x as V,o as c,d as g,f as l,h as r,K as i,L as A,M as O,u as S,r as $,c as w,w as b,t as T,E as M,j as q,ad as Q,ae as ie,aE as ue,i as E,e as F,F as U,q as j,J as z,g as R,y as I,D as we,s as ke,z as $e,aH as Ve,aI as ee,G as Ce,aK as te,aM as Se,aG as qe,an as De,I as Fe}from"./frappe-ui-d69b39da.js";import{c as H,D as Te}from"./index-77f7bd6f.js";import{S as je,h as Z,f as le,D as Be,u as ce,F as W,C as Ue,i as oe,j as se,k as Me,e as Ee,l as Oe,s as Le,w as Pe}from"./main-d2d228fc.js";import{B as de}from"./combine-0dbf7ac7.js";import{_ as me,a as Qe}from"./ExpressionEditor.vue_vue_type_style_index_0_lang-9e2463ac.js";import{C as pe}from"./ContentEditable-bc84e80c.js";import{u as ve}from"./data_source-00c6028c.js";import{_ as K,a as Ne,b as ae,c as Ae,d as ne,e as Re,f as Ie}from"./DrillDown.vue_vue_type_script_setup_true_lang-3700404a.js";import{_ as Ye}from"./Autocomplete-e91e4d1c.js";import{C as L}from"./chevron-down-7c5e9308.js";import{P as N}from"./play-63d306bd.js";import{E as G}from"./ellipsis-10a30b7b.js";import{_ as X}from"./Popover-5414f173.js";import{_ as ze}from"./DatePickerControl.vue_vue_type_script_setup_true_lang-6baff6f5.js";import{C as P}from"./chevron-right-abc82e4c.js";import{_ as We}from"./ColumnFilterValueSelector.vue_vue_type_script_setup_true_lang-88f0bec7.js";import{L as He}from"./list-filter-e596ffc3.js";import{C as Ze}from"./check-2c63c113.js";import{X as Ke}from"./x-3f18ad86.js";import{P as Ge}from"./plus-3394075c.js";import{B as Xe}from"./bug-a1e6b610.js";import{c as Je,w as et}from"./dashboard-37329027.js";import"./text-cursor-input-3636b908.js";import"./vue-codemirror.esm-d1d2df5a.js";import"./vuedraggable.umd-f13fb48a.js";import"./grip-vertical-c5c2fa7d.js";import"./index-9194c21d.js";import"./toasts-2937f9d2.js";import"./calendar-1687c485.js";import"./clock-73e01da8.js";import"./search-34ad51bc.js";import"./refresh-ccw-f825866d.js";import"./tables-0e8be38f.js";import"./table-2-565c43f4.js";import"./chevron-left-c299c44c.js";import"./DataTable.vue_vue_type_script_setup_true_lang-0fc4cbd5.js";import"./IndicatorIcon-21535c9e.js";import"./refresh-cw-ef6c08ee.js";/**
 * @license lucide-vue-next v0.484.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const tt=H("square-mouse-pointer",[["path",{d:"M12.034 12.681a.498.498 0 0 1 .647-.647l9 3.5a.5.5 0 0 1-.033.943l-3.444 1.068a1 1 0 0 0-.66.66l-1.067 3.443a.5.5 0 0 1-.943.033z",key:"xwnzip"}],["path",{d:"M21 11V5a2 2 0 0 0-2-2H5a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h6",key:"14rsvq"}]]);/**
 * @license lucide-vue-next v0.484.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const lt=H("trash",[["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6",key:"4alrt4"}],["path",{d:"M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2",key:"v07s0e"}]]);/**
 * @license lucide-vue-next v0.484.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ot=H("wand-sparkles",[["path",{d:"m21.64 3.64-1.28-1.28a1.21 1.21 0 0 0-1.72 0L2.36 18.64a1.21 1.21 0 0 0 0 1.72l1.28 1.28a1.2 1.2 0 0 0 1.72 0L21.64 5.36a1.2 1.2 0 0 0 0-1.72",key:"ul74o6"}],["path",{d:"m14 7 3 3",key:"1r5n42"}],["path",{d:"M5 6v4",key:"ilb8ba"}],["path",{d:"M19 14v4",key:"blhpug"}],["path",{d:"M10 2v2",key:"7u0qdc"}],["path",{d:"M7 8H3",key:"zfb6yr"}],["path",{d:"M21 16h-4",key:"1cnmox"}],["path",{d:"M11 3H9",key:"1obp7u"}]]),st={class:"flex h-full w-full items-center justify-center bg-gray-50"},at={class:"flex flex-col space-y-4"},nt={class:"w-fit rounded bg-blue-50 p-3"},rt={class:"w-fit rounded bg-orange-50 p-3"},it={class:"w-fit rounded bg-green-50 p-3"},ut=V({__name:"WorkbookQueryEmptyState",emits:{select:y=>!0},setup(y,{emit:e}){const t=e;return(n,o)=>(c(),g("div",st,[l("div",at,[o[6]||(o[6]=l("div",{class:"text-center text-gray-500"},"Select an interface to start",-1)),l("div",{class:"flex w-full cursor-pointer items-center gap-4 rounded border border-transparent bg-white p-2 shadow-sm transition-all hover:border-gray-300",onClick:o[0]||(o[0]=a=>t("select","query-builder"))},[l("div",nt,[r(i(tt),{class:"h-5 w-5 text-blue-500/70","stroke-width":"1.5"})]),o[3]||(o[3]=l("div",{class:"flex flex-col gap-1"},[l("p",{class:"font-medium text-gray-700"},"Query Builder"),l("p",{class:"text-sm text-gray-500"},"Create queries with a visual interface")],-1))]),l("div",{class:"flex w-full cursor-pointer items-center gap-4 rounded border border-transparent bg-white p-2 shadow-sm transition-all hover:border-gray-300",onClick:o[1]||(o[1]=a=>t("select","sql-editor"))},[l("div",rt,[r(i(je),{class:"h-5 w-5 text-orange-500/70","stroke-width":"1.5"})]),o[4]||(o[4]=l("div",{class:"flex flex-col gap-1"},[l("p",{class:"font-medium text-gray-700"},"SQL Editor"),l("p",{class:"text-sm text-gray-500"},"Create queries with raw SQL")],-1))]),l("div",{class:"flex w-full cursor-pointer items-center gap-4 rounded border border-transparent bg-white p-2 shadow-sm transition-all hover:border-gray-300",onClick:o[2]||(o[2]=a=>t("select","script-editor"))},[l("div",it,[r(i(de),{class:"h-5 w-5 text-green-500/70","stroke-width":"1.5"})]),o[5]||(o[5]=l("div",{class:"flex flex-col gap-1"},[l("p",{class:"font-medium text-gray-700"},"Script Editor"),l("p",{class:"text-sm text-gray-500"},"Create queries with a python script")],-1))])])]))}}),ct={class:"flex-1 truncate"},dt={__name:"DataSourceSelector",props:A({placeholder:{type:String,default:"Data source"}},{modelValue:{},modelModifiers:{}}),emits:["update:modelValue"],setup(y){const e=O(y,"modelValue"),t=ve(),n=S(()=>t.sources.find(a=>a.name===e.value)),o=S(()=>t.sources.map(a=>({label:a.title,value:a.name})));return(a,d)=>{const _=$("Button"),v=Ye;return c(),w(v,{options:o.value,modelValue:e.value,"onUpdate:modelValue":d[0]||(d[0]=p=>e.value=(p==null?void 0:p.value)||"")},{target:b(({togglePopover:p})=>[r(_,{variant:"outline",onClick:p},{prefix:b(()=>[r(i(Te),{class:"h-3.5 w-3.5 flex-shrink-0","stroke-width":"1.5"})]),suffix:b(()=>[r(i(L),{class:"h-4 w-4 flex-shrink-0","stroke-width":"1.5"})]),default:b(()=>{var u;return[l("span",ct,T(((u=n.value)==null?void 0:u.title)||y.placeholder),1)]}),_:2},1032,["onClick"])]),_:1},8,["options","modelValue"])}}},mt={class:"flex flex-1 flex-col gap-4 overflow-hidden p-4"},pt={class:"relative flex h-[55%] w-full flex-col rounded border"},vt={class:"flex flex-shrink-0 items-center gap-1 border-b p-1"},ft={class:"flex-1 overflow-hidden"},_t={class:"flex flex-shrink-0 gap-1 border-t p-1"},xt={class:"tnum flex flex-shrink-0 items-center gap-2 text-sm text-gray-600"},yt={key:0},bt={key:1},ht={class:"relative flex w-full flex-1 flex-col overflow-hidden rounded border"},gt=V({__name:"NativeQueryEditor",setup(y){const e=M("query");e.autoExecute=!1,e.execute();const t=e.getSQLOperation(),n=q(t?t.data_source:""),o=q(t?t.raw_sql:"");function a(f=!1){if(!n.value){le({title:"Please select a data source first",variant:"error"});return}e.setSQL({raw_sql:o.value,data_source:n.value},f)}const d=q(!1);async function _(){if(!(!o.value.trim()||d.value)){d.value=!0;try{o.value=await e.formatSQL({raw_sql:o.value,data_source:n.value})}catch{le({title:"Failed to format SQL",variant:"error"})}finally{d.value=!1}}}const v=q({}),p=ve();Z(n,()=>{if(!n.value){v.value={};return}p.getSchema(n.value).then(f=>{v.value=f})},{immediate:!0});const u=S(()=>{if(!Object.keys(v.value).length)return{schema:{},tables:[]};const f={};Object.entries(v.value).forEach(([s,x])=>{f[s]=x.columns.map(h=>({label:h.label,detail:h.label}))});const m=Object.entries(v.value).map(([s,x])=>({label:s,detail:x.label}));return{schema:f,tables:m}});return(f,m)=>{const s=$("Button"),x=$("Dropdown");return c(),g("div",mt,[l("div",pt,[l("div",vt,[r(dt,{modelValue:n.value,"onUpdate:modelValue":m[0]||(m[0]=h=>n.value=h),placeholder:"Select a data source"},null,8,["modelValue"]),r(pe,{class:"flex h-7 cursor-text items-center justify-center rounded bg-white px-2 text-base text-gray-800 focus-visible:ring-1 focus-visible:ring-gray-600",modelValue:i(e).doc.title,"onUpdate:modelValue":m[1]||(m[1]=h=>i(e).doc.title=h),placeholder:"Untitled Dashboard"},null,8,["modelValue"])]),l("div",ft,[(c(),w(me,{key:u.value.tables.length,modelValue:o.value,"onUpdate:modelValue":m[2]||(m[2]=h=>o.value=h),language:"sql",schema:u.value.schema,tables:u.value.tables},null,8,["modelValue","schema","tables"]))]),l("div",_t,[r(s,{onClick:m[3]||(m[3]=h=>a(!1)),label:"Execute"},{prefix:b(()=>[r(i(N),{class:"h-3.5 w-3.5 text-gray-700","stroke-width":"1.5"})]),_:1}),r(x,{button:{icon:i(G)},options:[{label:"Force Execute",icon:i(N),onClick:()=>a(!0)},{label:"Format SQL",icon:i(ot),onClick:()=>_()}]},null,8,["button","options"])])]),Q(l("div",xt,[m[4]||(m[4]=l("div",{class:"h-2 w-2 rounded-full bg-green-500"},null,-1)),l("div",null,[i(e).result.timeTaken==-1?(c(),g("span",yt," Fetched from cache ")):(c(),g("span",bt," Fetched in "+T(i(e).result.timeTaken)+"s ",1)),l("span",null,T(i(ue)(i(e).result.lastExecutedAt).value),1)])],512),[[ie,i(e).result.executedSQL]]),l("div",ht,[r(K,{query:i(e),"enable-alerts":!0},null,8,["query"])])])}}}),wt={class:"flex h-full w-full items-center justify-center"},kt={class:"flex items-center gap-4"},$t={class:"flex flex-col items-center justify-center gap-2 rounded border border-dashed border-gray-300 p-8 text-center"},Vt={class:"rounded-full bg-orange-50 p-3"},Ct=V({__name:"QueryBuilderSourceSelector",setup(y){const e=M("query"),t=q(!0);return(n,o)=>{const a=$("Button");return c(),g(U,null,[l("div",wt,[l("div",kt,[l("div",$t,[l("div",Vt,[r(i(Be),{class:"h-5 w-5 text-orange-500/70","stroke-width":"1.5"})]),o[4]||(o[4]=l("p",{class:"font-medium"},"No Table Selected",-1)),o[5]||(o[5]=l("span",{class:"text-sm leading-4 text-gray-600"},[E(" Select a source table to start building your query. "),l("br"),E(" You can also select a query as a source. ")],-1)),r(a,{class:"mt-2",variant:"outline",onClick:o[0]||(o[0]=d=>t.value=!0)},{default:b(()=>o[3]||(o[3]=[E(" Open Selector ")])),_:1})])])]),t.value?(c(),w(Ne,{key:0,modelValue:t.value,"onUpdate:modelValue":o[1]||(o[1]=d=>t.value=d),onSelect:o[2]||(o[2]=d=>i(e).setSource(d))},null,8,["modelValue"])):F("",!0)],64)}}}),St={class:"flex w-[210px] flex-col divide-y text-base"},qt={class:"flex flex-col gap-1 pb-2"},Dt={key:0},Ft=["onClick"],Tt={class:"text-sm text-gray-600"},jt={class:"flex flex-col gap-1 py-2"},Bt={key:0,class:"flex flex-col gap-1 py-2"},Ut={class:"flex gap-2"},Mt={class:"flex-1"},Et={class:"flex-[2]"},Ot={class:""},Lt={class:"flex flex-col gap-2 pt-2"},Pt=V({__name:"ColumnFilterTypeDate",props:A({column:{}},{modelValue:{type:Object,default:()=>({operator:"=",value:[]})},modelModifiers:{}}),emits:["update:modelValue"],setup(y){const e=O(y,"modelValue"),t=q("presets");Z(t,()=>{t.value==="presets"?e.value={operator:"=",value:[]}:t.value==="relative"?e.value={operator:"within",value:["Last",1,"Day"]}:t.value==="specific"?e.value={operator:"=",value:[]}:e.value={operator:"=",value:[]}});const n=C=>C.toLocaleDateString("en-US",{month:"short",day:"numeric"}),o=n(new Date),[a,d]=[j().startOf("week").toDate(),j().endOf("week").toDate()],[_,v]=[j().startOf("month").toDate(),j().endOf("month").toDate()],[p,u]=[j().startOf("quarter").toDate(),j().endOf("quarter").toDate()],[f,m]=[j().startOf("year").toDate(),j().endOf("year").toDate()],s=ce().doc.fiscal_year_start||"04-01-1999",[x,h]=[j(s).toDate(),j(s).add(1,"year").subtract(1,"day").toDate()],B=`${n(a)} - ${n(d)}`,Y=`${n(_)} - ${n(v)}`,fe=`${n(p)} - ${n(u)}`,_e=`${n(f)} - ${n(m)}`,xe=`${n(x)} - ${n(h)}`,ye=[{label:"Today",value:"Day",description:o},{label:"This Week",value:"Week",description:B},{label:"This Month",value:"Month",description:Y},{label:"This Quarter",value:"Quarter",description:fe},{label:"This Year",value:"Year",description:_e},{label:"This FY",value:"Fiscal Year",description:xe}];function be(C){e.value={operator:"within",value:["Current",C]}}function he(C){if(!e.value||!e.value.value)return!1;const k=e.value.value;return e.value.operator==="within"&&k[1]===C}function ge(C){e.value.value=C,C[0]===C[1]?e.value.operator="=":C[0]&&!C[1]?e.value.operator=">=":!C[0]&&C[1]?e.value.operator="<=":C[0]&&C[1]?e.value.operator="between":e.value.operator="="}return(C,k)=>{const J=$("FormControl");return c(),g("div",St,[l("div",qt,[l("div",{class:"flex cursor-pointer items-center justify-between text-sm text-gray-600 hover:underline",onClick:k[0]||(k[0]=D=>t.value=t.value=="presets"?"":"presets")},[k[5]||(k[5]=l("span",null," Presets ",-1)),(c(),w(z(t.value=="presets"?i(L):i(P)),{class:"h-4 w-4","stroke-width":"1.5"}))]),t.value=="presets"?(c(),g("div",Dt,[(c(),g(U,null,R(ye,D=>l("div",{key:D.value,class:I(["-mx-1 flex cursor-pointer items-center justify-between gap-8 rounded px-1 py-1",he(D.value)?"outline outline-gray-500":"hover:bg-gray-100"]),onClick:Il=>be(D.value)},[l("span",null,T(D.label),1),l("span",Tt,T(D.description),1)],10,Ft)),64))])):F("",!0)]),l("div",null,[l("div",jt,[l("div",{class:"flex cursor-pointer items-center justify-between text-sm text-gray-600 hover:underline",onClick:k[1]||(k[1]=D=>t.value=t.value=="relative"?"":"relative")},[k[6]||(k[6]=l("span",null," Relative Dates ",-1)),(c(),w(z(t.value=="relative"?i(L):i(P)),{class:"h-4 w-4","stroke-width":"1.5"}))]),t.value=="relative"&&Array.isArray(e.value.value)?(c(),g("div",Bt,[k[7]||(k[7]=l("span",null,"In Last...",-1)),l("div",Ut,[l("div",Mt,[r(J,{type:"number",autocomplete:"off",min:1,max:100,modelValue:e.value.value[1],"onUpdate:modelValue":k[2]||(k[2]=D=>e.value.value[1]=D)},null,8,["modelValue"])]),l("div",Et,[r(J,{type:"select",autocomplete:"off",options:["Day","Week","Month","Quarter","Year"],modelValue:e.value.value[2],"onUpdate:modelValue":k[3]||(k[3]=D=>e.value.value[2]=D)},null,8,["modelValue"])])])])):F("",!0)])]),l("div",Ot,[l("div",Lt,[l("div",{class:"flex cursor-pointer items-center justify-between text-sm text-gray-600 hover:underline",onClick:k[4]||(k[4]=D=>t.value=t.value=="specific"?"":"specific")},[k[8]||(k[8]=l("span",null," Specific Dates ",-1)),(c(),w(z(t.value=="specific"?i(L):i(P)),{class:"h-4 w-4","stroke-width":"1.5"}))]),t.value=="specific"&&Array.isArray(e.value.value)?(c(),w(ze,{key:0,modelValue:e.value.value,"onUpdate:modelValue":ge},null,8,["modelValue"])):F("",!0)])])])}}}),Qt={class:"flex gap-2"},Nt={class:"mt-1 text-xs leading-4 text-gray-600"},At=V({__name:"ColumnFilterTypeNumber",props:A({column:{}},{modelValue:{type:Object,default:()=>({operator:"=",value:[0,0]})},modelModifiers:{}}),emits:["update:modelValue"],setup(y){const e=y,t=O(y,"modelValue");we(()=>t.value.value,()=>{t.value.value[0]===t.value.value[1]?t.value.operator="=":t.value.value[0]&&!t.value.value[1]?t.value.operator=">=":!t.value.value[0]&&t.value.value[1]?t.value.operator="<=":t.value.value[0]&&t.value.value[1]&&(t.value.operator="between")},{deep:!0});const n=S(()=>!t.value.value[0]&&!t.value.value[1]?"":t.value.value[0]===t.value.value[1]?`${e.column.name} is ${t.value.value[0]}`:t.value.value[0]&&!t.value.value[1]?`${e.column.name} is ${t.value.value[0]} or greater`:!t.value.value[0]&&t.value.value[1]?`${e.column.name} is ${t.value.value[1]} or less`:`${e.column.name} is between ${t.value.value[0]} and ${t.value.value[1]}`);return(o,a)=>{const d=$("FormControl");return c(),g("div",null,[l("div",Qt,[r(d,{type:"number",placeholder:"Min",label:"Min",modelValue:t.value.value[0],"onUpdate:modelValue":a[0]||(a[0]=_=>t.value.value[0]=_)},null,8,["modelValue"]),r(d,{type:"number",placeholder:"Max",label:"Max",modelValue:t.value.value[1],"onUpdate:modelValue":a[1]||(a[1]=_=>t.value.value[1]=_)},null,8,["modelValue"])]),l("p",Nt,T(n.value),1)])}}}),Rt={class:"flex flex-col gap-2"},It=V({__name:"ColumnFilterTypeText",props:A({column:{},valuesProvider:{type:Function}},{modelValue:{type:Object,default:()=>({operator:"=",value:[]})},modelModifiers:{}}),emits:["update:modelValue"],setup(y){const e=y,t=O(y,"modelValue"),n=[{label:"is",value:"="},{label:"is not",value:"!="},{label:"contains",value:"contains"},{label:"not contains",value:"not_contains"},{label:"is set",value:"is_set"},{label:"is not set",value:"is_not_set"}],o=S(()=>e.column.type==="String"),a=S(()=>["=","!="].includes(t.value.operator)),d=S(()=>["is_set","is_not_set"].includes(t.value.operator)),_=S(()=>["contains","not_contains"].includes(t.value.operator));function v(){a.value&&(t.value.value=[]),d.value&&(t.value.value=void 0),_.value&&(t.value.value="")}const p=S(()=>{if(d.value)return"";if(t.value.operator.includes("contains"))return"eg. %foo%"});return(u,f)=>{const m=$("FormControl");return c(),g("div",Rt,[r(m,{type:"select",options:n,modelValue:t.value.operator,"onUpdate:modelValue":[f[0]||(f[0]=s=>t.value.operator=s),v]},null,8,["modelValue"]),o.value&&a.value&&Array.isArray(t.value.value)?(c(),w(We,{key:0,modelValue:t.value.value,"onUpdate:modelValue":f[1]||(f[1]=s=>t.value.value=s),column:e.column,valuesProvider:e.valuesProvider},null,8,["modelValue","column","valuesProvider"])):d.value?F("",!0):(c(),w(m,{key:1,placeholder:p.value,modelValue:t.value.value,"onUpdate:modelValue":f[2]||(f[2]=s=>t.value.value=s)},null,8,["placeholder","modelValue"]))])}}}),Yt={class:"flex flex-col gap-2 px-2.5 py-2"},zt={class:"flex justify-end gap-1"},Wt=V({__name:"ColumnFilterBody",props:{column:{},valuesProvider:{type:Function},placement:{}},emits:{filter:(y,e)=>!0,close:()=>!0},setup(y,{emit:e}){const t=e,n=y,o=S(()=>W.TEXT.includes(n.column.type)),a=S(()=>W.NUMBER.includes(n.column.type)),d=S(()=>W.DATE.includes(n.column.type)),_={operator:"=",value:[]},v=ke({..._}),p=S(()=>{if(!v.operator)return!1;if(o.value&&v.operator.includes("set"))return!0;if(!v.value)return!1;if(o.value&&v.operator.includes("contains"))return v.value;const m=v.value;return a.value||d.value?m[0]||m[1]:o.value&&v.operator.includes("=")?m.length:!1});function u(m,s){if(a.value&&Array.isArray(s)){if(s=s.map(x=>isNaN(x)?x:String(x)),m==="="&&s[0]===s[1])return["=",Number(s[0])];if(m===">="&&s[0]&&!s[1])return[">=",Number(s[0])];if(m==="<="&&!s[0]&&s[1])return["<=",Number(s[1])];if(m==="between"&&s[0]&&s[1])return["between",[Number(s[0]),Number(s[1])]]}if(o.value){if(m.includes("set"))return[m,s];if(m.includes("contains"))return[m,s];if(m.includes("="))return[m==="!="?"not_in":"in",s]}if(d.value&&Array.isArray(s)){if(m==="="&&s[0]===s[1])return["=",s[0]];if(m===">="&&s[0]&&!s[1])return[">=",s[0]];if(m==="<="&&!s[0]&&s[1])return["<=",s[1]];if(m==="within")return["within",s.join(" ")];if(m==="between"&&s[0]&&s[1])return["between",[s[0],s[1]]]}}function f(){const m=u(v.operator,v.value);if(!m)throw console.error(v.operator,v.value),new Error("Invalid filter");t("filter",m[0],m[1]),Object.assign(v,{..._}),t("close")}return(m,s)=>{const x=$("Button");return c(),g("div",Yt,[a.value?(c(),w(At,{key:0,class:"w-[15rem]",column:n.column,"model-value":v,"onUpdate:modelValue":s[0]||(s[0]=h=>Object.assign(v,h))},null,8,["column","model-value"])):o.value?(c(),w(It,{key:1,class:"w-[15rem]",column:n.column,"model-value":v,"onUpdate:modelValue":s[1]||(s[1]=h=>Object.assign(v,h)),valuesProvider:n.valuesProvider},null,8,["column","model-value","valuesProvider"])):d.value?(c(),w(Pt,{key:2,column:n.column,"model-value":v,"onUpdate:modelValue":s[2]||(s[2]=h=>Object.assign(v,h))},null,8,["column","model-value"])):F("",!0),l("div",zt,[r(x,{onClick:s[3]||(s[3]=h=>t("close")),icon:"x"}),r(x,{variant:"solid",icon:"check",disabled:!p.value,onClick:s[4]||(s[4]=h=>f())},null,8,["disabled"])])])}}}),Ht={class:"flex h-7 w-full items-center gap-2 pl-2 pr-1.5 text-base"},Zt={class:"flex flex-1 items-center justify-between"},Kt=V({__name:"ColumnFilter",props:{column:{},valuesProvider:{type:Function},placement:{}},emits:{filter:(y,e)=>!0},setup(y,{emit:e}){const t=e,n=y;return(o,a)=>{const d=$("Button"),_=X;return c(),w(_,{placement:n.placement||"right-start"},{target:b(({togglePopover:v,isOpen:p})=>[$e(o.$slots,"target",{togglePopover:v,isOpen:p},()=>[r(d,{variant:"ghost",onClick:v,class:I(["w-full !justify-start",{" !bg-gray-100":p}])},{icon:b(()=>[l("div",Ht,[r(i(He),{class:"h-4 w-4 flex-shrink-0","stroke-width":"1.5"}),l("div",Zt,[a[1]||(a[1]=l("span",{class:"truncate"},"Filter",-1)),r(i(P),{class:"h-4 w-4","stroke-width":"1.5"})])])]),_:2},1032,["onClick","class"])])]),"body-main":b(({togglePopover:v,isOpen:p})=>[p?(c(),w(Wt,{key:0,column:n.column,valuesProvider:n.valuesProvider,onFilter:a[0]||(a[0]=(u,f)=>t("filter",u,f)),onClose:v},null,8,["column","valuesProvider","onClose"])):F("",!0)]),_:3},8,["placement"])}}}),Gt={class:"flex h-7 w-full items-center gap-2 pl-2 pr-1.5 text-base"},Xt=V({__name:"ColumnRemove",props:{column:{}},emits:["remove"],setup(y,{emit:e}){const t=e;return(n,o)=>{const a=$("Button");return c(),w(a,{theme:"red",variant:"ghost",onClick:o[0]||(o[0]=d=>t("remove")),class:"w-full !justify-start"},{icon:b(()=>[l("div",Gt,[r(i(lt),{class:"h-4 w-4 flex-shrink-0","stroke-width":"1.5"}),o[1]||(o[1]=l("div",{class:"flex flex-1 items-center justify-between"},[l("span",{class:"truncate"},"Remove")],-1))])]),_:1})}}}),Jt={class:"flex flex-col"},el=V({__name:"ColumnSort",props:{column:{}},emits:{sort:y=>!0},setup(y,{emit:e}){const t=e;return(n,o)=>{const a=$("Button");return c(),g("div",Jt,[r(a,{variant:"ghost",class:"w-full !justify-start","icon-left":"arrow-up",onClick:o[0]||(o[0]=d=>t("sort","asc"))},{default:b(()=>o[3]||(o[3]=[l("span",{class:"truncate"},"Ascending",-1)])),_:1}),r(a,{variant:"ghost",class:"w-full !justify-start","icon-left":"arrow-down",onClick:o[1]||(o[1]=d=>t("sort","desc"))},{default:b(()=>o[4]||(o[4]=[l("span",{class:"truncate"},"Descending",-1)])),_:1}),r(a,{variant:"ghost",class:"w-full !justify-start","icon-left":"x",onClick:o[2]||(o[2]=d=>t("sort",""))},{default:b(()=>o[5]||(o[5]=[l("span",{class:"truncate"},"Remove Sort",-1)])),_:1})])}}}),tl={key:0,class:"flex min-w-[10rem] flex-col p-1.5"},ll={class:"truncate"},re=V({__name:"ColumnTypeChange",props:{modelValue:{required:!0},modelModifiers:{}},emits:["update:modelValue"],setup(y){const e=O(y,"modelValue");function t(n,o){e.value=n,o()}return(n,o)=>{const a=$("Button"),d=X;return c(),w(d,{placement:"bottom-start"},{target:b(({togglePopover:_,isOpen:v})=>[r(a,{variant:"ghost",class:I(["rounded-none",v?"!bg-gray-100":""]),onClick:_},{icon:b(()=>[r(ae,{columnType:e.value},null,8,["columnType"])]),_:2},1032,["onClick","class"])]),"body-main":b(({togglePopover:_,isOpen:v})=>[v?(c(),g("div",tl,[(c(!0),g(U,null,R(i(Ue),p=>(c(),w(a,{key:p.value,variant:"ghost",class:"w-full !justify-start",onClick:u=>t(p.value,_)},{prefix:b(()=>[r(ae,{columnType:p.value},null,8,["columnType"])]),default:b(()=>[l("span",ll,T(p.label),1)]),_:2},1032,["onClick"]))),128))])):F("",!0)]),_:1})}}}),ol={class:"relative flex w-full flex-1 flex-col overflow-hidden rounded shadow"},sl={class:"ml-auto pl-2"},al={key:0,class:"flex min-w-[10rem] flex-col p-1"},nl={class:"flex h-full min-w-64 w-auto items-center gap-1 pl-0.5"},rl=V({__name:"QueryBuilderTable",setup(y){const e=M("query");function t(p,u){u!==p.type&&e.changeColumnType(p.name,u)}function n(p){e.removeColumn(p.name)}function o(p,u){if(!u){e.removeOrderBy(p.name);return}e.addOrderBy({column:se(p.name),direction:u})}function a(p,u,f){e.addFilterGroup({logical_operator:"And",filters:[{column:se(p.name),operator:u,value:f}]})}const d={expression:Me(""),data_type:"Auto",new_name:"new_column"},_=q(oe(d));function v(){e.addMutate(_.value),_.value=oe(d)}return(p,u)=>{const f=$("Button"),m=X;return c(),g("div",ol,[r(K,{query:i(e),"enable-column-rename":!0,"enable-alerts":!0,"enable-new-column":!0},{"header-prefix":b(({column:s})=>[r(re,{"model-value":s.type,"onUpdate:modelValue":x=>t(s,x)},null,8,["model-value","onUpdate:modelValue"])]),"header-suffix":b(({column:s})=>[l("div",sl,[r(m,{placement:"bottom-end"},{target:b(({togglePopover:x,isOpen:h})=>[r(f,{variant:"ghost",class:I(["rounded-sm",h?"!bg-gray-100":""]),onClick:x},{icon:b(()=>[r(i(G),{class:"h-4 w-4 text-gray-700"})]),_:2},1032,["onClick","class"])]),"body-main":b(({togglePopover:x,isOpen:h})=>[h?(c(),g("div",al,[r(el,{column:s,onSort:B=>(o(s,B),x())},null,8,["column","onSort"]),r(Kt,{column:s,onFilter:(B,Y)=>(a(s,B,Y),x()),valuesProvider:B=>i(e).getDistinctColumnValues(s.name,B)},null,8,["column","onFilter","valuesProvider"]),r(Xt,{column:s,onRemove:B=>(n(s),x())},null,8,["column","onRemove"])])):F("",!0)]),_:2},1024)])]),"new-column-editor":b(({toggle:s})=>[l("div",nl,[r(re,{modelValue:_.value.data_type,"onUpdate:modelValue":u[0]||(u[0]=x=>_.value.data_type=x)},null,8,["modelValue"]),r(Qe,{class:"inline-expression h-fit max-h-[10rem] text-sm flex-1",modelValue:_.value.expression.expression,"onUpdate:modelValue":u[1]||(u[1]=x=>_.value.expression.expression=x),"column-options":i(e).result.columnOptions,language:"python",placeholder:"","hide-line-numbers":!0,"multi-line":!1},null,8,["modelValue","column-options"]),r(f,{variant:"ghost",class:"flex-shrink-0",onClick:x=>(v(),s())},{icon:b(()=>[r(i(Ze),{class:"size-4 text-gray-700","stroke-width":1.5})]),_:2},1032,["onClick"]),r(f,{variant:"ghost",class:"flex-shrink-0",onClick:s},{icon:b(()=>[r(i(Ke),{class:"size-4 text-gray-700","stroke-width":1.5})]),_:2},1032,["onClick"])])]),_:1},8,["query"])])}}}),il={class:"flex flex-col px-3.5 pt-3"},ul={class:"flex flex-shrink-0 flex-col gap-2.5 border-b px-0.5 pb-3"},cl=V({__name:"QueryInfo",setup(y){const e=M("query"),t=ce();function n(o){Ee({title:o?"Enable Data Store":"Disable Data Store",message:o?"Enabling data store use the cached table data for faster queries, but may not be up-to-date. It will also allow you to combine data from multiple sources. Cached data is updated every day.":"Disabling data store will use the live connection to the database for queries. This will ensure that you are always querying the most up-to-date data but may be slower.",onSuccess(){e.doc.use_live_connection=!o}})}return(o,a)=>{const d=$("Toggle");return c(),g("div",il,[a[1]||(a[1]=l("div",{class:"mb-1 flex h-6 items-center justify-between"},[l("div",{class:"flex items-center gap-1"},[l("div",{class:"text-sm font-medium"},"Details")]),l("div")],-1)),l("div",ul,[r(ne,{label:"Query Title"},{default:b(()=>[r(Ae,{type:"text",placeholder:"Title",modelValue:i(e).doc.title,"onUpdate:modelValue":a[0]||(a[0]=_=>i(e).doc.title=_)},null,8,["modelValue"])]),_:1}),i(t).doc.enable_data_store?(c(),w(ne,{key:0,label:"Enable Data Store",class:"!w-1/2"},{default:b(()=>[r(d,{class:"mt-1",modelValue:!i(e).doc.use_live_connection,"onUpdate:modelValue":n},null,8,["modelValue"])]),_:1})):F("",!0)])])}}}),dl={class:"flex flex-1 overflow-hidden"},ml={class:"relative flex h-full flex-1 flex-col gap-3 overflow-hidden p-4"},pl={class:"relative z-[1] flex h-full w-[19rem] flex-shrink-0 flex-col overflow-y-auto bg-white"},vl=V({__name:"QueryBuilder",setup(y){const e=M("query");e.autoExecute=!0;const t=Ve(),n=t["Meta+Z"],o=t["Meta+Shift+Z"],a=ee(n,()=>e.canUndo()&&e.history.undo()),d=ee(o,()=>e.canRedo()&&e.history.redo());return Ce(()=>{e.activeOperationIdx=e.doc.operations.length-1,a(),d()}),(_,v)=>(c(),g("div",dl,[l("div",ml,[i(e).doc.operations.length?(c(),g(U,{key:1},[r(Re),r(rl)],64)):(c(),w(Ct,{key:0}))]),l("div",pl,[r(cl),r(Ie)])]))}}),fl={class:"bg-white px-4 pb-6 pt-5 sm:px-6"},_l={class:"flex items-center justify-between pb-4"},xl={class:"flex flex-col overflow-hidden"},yl={class:"relative flex max-h-[20rem] flex-col overflow-y-auto"},bl={class:"flex flex-1 flex-shrink-0"},hl=["onUpdate:modelValue"],gl={class:"flex flex-1 flex-shrink-0"},wl=["onUpdate:modelValue"],kl={class:"flex w-10 justify-end"},$l={key:0,class:"flex justify-center py-8"},Vl={class:"mt-4 flex justify-between"},Cl=V({__name:"VariablesDialog",props:{show:{type:Boolean},variables:{}},emits:["update:show","update:variables","save"],setup(y,{emit:e}){const t=e,n=y,o=S({get:()=>n.show,set:p=>t("update:show",p)}),a=S({get:()=>n.variables||[],set:p=>t("update:variables",p)});function d(){const p=[...a.value];p.push({variable_name:"",variable_value:""}),a.value=p}function _(p){const u=[...a.value];u.splice(p,1),a.value=u}function v(){const p=a.value.filter(u=>u.variable_name.trim().length>0);t("save",p)}return(p,u)=>{const f=$("Button"),m=$("Dialog");return c(),w(m,{modelValue:o.value,"onUpdate:modelValue":u[1]||(u[1]=s=>o.value=s),options:{title:"Variables",size:"lg"}},{body:b(()=>[l("div",fl,[l("div",_l,[u[2]||(u[2]=l("h3",{class:"text-2xl font-semibold leading-6 text-gray-900"},"Variables",-1)),r(f,{variant:"ghost",onClick:u[0]||(u[0]=s=>o.value=!1),icon:"x",size:"md"})]),u[7]||(u[7]=l("p",{class:"mb-5 text-p-base text-gray-600"},[E(" Variables are used to store sensitive information such as API keys and credentials. They can be referenced and combined in your script just like any other variable. For eg. "),l("br"),l("code",{class:"rounded bg-gray-100 px-1 my-1 py-0.5 text-p-sm text-gray-800"}," formatted_api_key = f'token {api_key}:{api_secret}' ")],-1)),l("div",xl,[l("div",yl,[u[4]||(u[4]=l("div",{class:"sticky top-0 flex gap-x-2 border-b bg-white py-2 text-p-sm font-medium text-gray-600"},[l("div",{class:"flex flex-1 flex-shrink-0 px-2"},"Name"),l("div",{class:"flex flex-1 flex-shrink-0 px-2"},"Value"),l("div",{class:"flex w-10"})],-1)),(c(!0),g(U,null,R(a.value,(s,x)=>(c(),g("div",{key:x,class:"flex gap-x-2 border-b border-gray-100 py-1"},[l("div",bl,[Q(l("input",{class:"w-full rounded-sm border-none bg-transparent px-2 py-2 text-base focus:bg-gray-100 focus:outline-none focus:ring-0",type:"text","onUpdate:modelValue":h=>s.variable_name=h,placeholder:"e.g. api_key"},null,8,hl),[[te,s.variable_name]])]),l("div",gl,[Q(l("input",{type:"password",class:"w-full rounded-sm border-none bg-transparent px-2 py-2 text-base focus:bg-gray-100 focus:outline-none focus:ring-0","onUpdate:modelValue":h=>s.variable_value=h,placeholder:"**********************"},null,8,wl),[[te,s.variable_value]])]),l("div",kl,[r(f,{variant:"ghost",icon:"x",size:"sm",onClick:h=>_(x)},null,8,["onClick"])])]))),128)),a.value.length===0?(c(),g("div",$l,u[3]||(u[3]=[l("span",{class:"text-p-sm text-gray-400"},"No variables added",-1)]))):F("",!0)]),l("div",Vl,[r(f,{variant:"outline",onClick:d},{prefix:b(()=>[r(i(Ge),{class:"h-4 w-4"})]),default:b(()=>[u[5]||(u[5]=E(" Add Variable "))]),_:1}),r(f,{variant:"solid",onClick:v},{default:b(()=>u[6]||(u[6]=[E(" Save Variables ")])),_:1})])])])]),_:1},8,["modelValue"])}}}),Sl={class:"flex flex-1 flex-col gap-4 overflow-hidden p-4"},ql={class:"relative flex h-[55%] w-full flex-col rounded border"},Dl={class:"flex flex-shrink-0 items-center gap-1 border-b p-1"},Fl={class:"flex flex-1 overflow-hidden"},Tl={class:"flex-1"},jl={key:0,class:"flex h-full w-[30rem] flex-shrink-0 flex-col overflow-hidden bg-gray-50 p-3"},Bl={class:"mt-2 flex w-full flex-col gap-2 overflow-y-auto font-mono"},Ul={class:"text-gray-400"},Ml={class:"text-gray-500"},El={class:"flex flex-shrink-0 gap-1 border-t p-1"},Ol={class:"tnum flex flex-shrink-0 items-center gap-2 text-sm text-gray-600"},Ll={key:0},Pl={key:1},Ql={class:"relative flex w-full flex-1 flex-col overflow-hidden rounded border"},Nl="# Write your script here",Al=V({__name:"ScriptQueryEditor",setup(y){const e=M("query");e.autoExecute=!1,e.execute();const t=e.getCodeOperation(),n=q(t?t.code:"");Z(n,()=>e.setCode({code:n.value}),{debounce:500});const o=q(!1),a=q([]);Oe("insights_script_log",u=>{u.user==Le.user.email&&(a.value=u.logs)});const d=q(!1),_=q([]);function v(){_.value=[...e.doc.variables||[]],d.value=!0}function p(u){e.updateVariables(u).then(()=>{d.value=!1}).catch(f=>{})}return(u,f)=>{const m=$("Button"),s=$("Dropdown");return c(),g(U,null,[l("div",Sl,[l("div",ql,[l("div",Dl,[r(pe,{class:"flex h-7 cursor-text items-center justify-center rounded bg-white px-2 text-base text-gray-800 focus-visible:ring-1 focus-visible:ring-gray-600",modelValue:i(e).doc.title,"onUpdate:modelValue":f[0]||(f[0]=x=>i(e).doc.title=x),placeholder:"Untitled Dashboard"},null,8,["modelValue"])]),l("div",Fl,[l("div",Tl,[r(me,{modelValue:n.value,"onUpdate:modelValue":f[1]||(f[1]=x=>n.value=x),language:"python",placeholder:Nl},null,8,["modelValue"])]),r(Se,{tag:"div",name:"slide","enter-active-class":"transition ease-out duration-200","enter-from-class":"transform translate-x-full opacity-0","enter-to-class":"transform translate-x-0 opacity-100","leave-active-class":"transition ease-in duration-200","leave-from-class":"transform translate-x-0","leave-to-class":"transform translate-x-full"},{default:b(()=>[o.value?(c(),g("div",jl,[f[4]||(f[4]=l("div",{class:"font-mono text-sm uppercase text-gray-600"},"Logs",-1)),l("div",Bl,[(c(!0),g(U,null,R(a.value,(x,h)=>(c(),g("div",{key:h,class:"flex gap-2"},[l("div",Ul,"["+T(h+1)+"]",1),l("div",Ml,T(x),1)]))),128))])])):F("",!0)]),_:1})]),l("div",El,[r(m,{onClick:i(e).execute,label:"Run"},{prefix:b(()=>[r(i(N),{class:"h-3.5 w-3.5 text-gray-700","stroke-width":"1.5"})]),_:1},8,["onClick"]),r(s,{button:{icon:i(G)},options:[{label:"Force Run",icon:i(N),onClick:()=>i(e).execute(!0)},{label:"Variables",icon:i(de),onClick:v},{label:"Logs",icon:i(Xe),onClick:()=>o.value=!o.value}]},null,8,["button","options"])])]),Q(l("div",Ol,[f[5]||(f[5]=l("div",{class:"h-2 w-2 rounded-full bg-green-500"},null,-1)),l("div",null,[i(e).result.timeTaken==-1?(c(),g("span",Ll," Fetched from cache ")):(c(),g("span",Pl," Fetched in "+T(i(e).result.timeTaken)+"s ",1)),l("span",null,T(i(ue)(i(e).result.lastExecutedAt).value),1)])],512),[[ie,i(e).result.executedSQL]]),l("div",Ql,[r(K,{query:i(e),"enable-alerts":!0},null,8,["query"])])]),r(Cl,{show:d.value,"onUpdate:show":f[2]||(f[2]=x=>d.value=x),variables:_.value,"onUpdate:variables":f[3]||(f[3]=x=>_.value=x),onSave:p},null,8,["show","variables"])],64)}}}),Rl=V({__name:"Query",props:{query_name:{}},async setup(y){let e,t;const o=Je(y.query_name);De("query",o),window.query=o,[e,t]=qe(()=>Pe(()=>o.isloaded)),await e,t();const a=S(()=>o.doc.operations.find(_=>_.type==="source"));function d(_){o&&(o.doc.is_native_query=_==="sql-editor",o.doc.is_script_query=_==="script-editor",o.doc.is_builder_query=_==="query-builder")}return(_,v)=>i(o).doc.is_builder_query||a.value?(c(),w(vl,{key:0})):i(o).doc.is_native_query?(c(),w(gt,{key:1})):i(o).doc.is_script_query?(c(),w(Al,{key:2})):(c(),w(ut,{key:3,onSelect:d}))}}),Fo=V({__name:"WorkbookQuery",props:{workbook_name:{},query_name:{}},setup(y){const e=y,t=Fe(),n=M(et);let o=q(e.query_name);const a=Number(e.query_name);return a>=0&&n.doc.queries[a]&&!n.doc.queries.find(d=>d.name===e.query_name)&&(o.value=n.doc.queries[a].name,t.replace(`/workbook/${n.doc.name}/query/${o.value}`)),(d,_)=>(c(),w(Rl,{query_name:i(o)},null,8,["query_name"]))}});export{Fo as default};
//# sourceMappingURL=WorkbookQuery-e73e4f50.js.map
