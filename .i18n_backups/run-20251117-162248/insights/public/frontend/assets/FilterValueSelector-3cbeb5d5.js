import{_ as z}from"./Autocomplete-e91e4d1c.js";import{_ as q,r as C,o as h,c as x,w as V,f as i,y as N,h as v,t as T,d as M,F as A,g as j,i as U,e as k,L as H,M as K,u as _,j as O,D as Q,K as Y,a as G,C as J,v as X}from"./frappe-ui-d69b39da.js";import{D as Z}from"./DatePicker-296330db.js";import{_ as E}from"./Popover-5414f173.js";import{_ as R}from"./Tabs-88c08023.js";import{F as $,m as F}from"./index-9194c21d.js";const ee={name:"DateRangePicker",props:["value","placeholder","formatter","readonly","inputClass"],emits:["change"],data(){const t=this.value?this.value.split(",")[0]:"",e=this.value?this.value.split(",")[1]:"";return{currentYear:null,currentMonth:null,fromDate:t,toDate:e}},created(){this.selectCurrentMonthYear()},computed:{today(){return this.getDate()},datesAsWeeks(){let t=[],e=this.dates.slice();for(;e.length;){let l=e.splice(0,7);t.push(l)}return t},dates(){if(!(this.currentYear&&this.currentMonth))return[];let t=this.currentMonth-1,e=this.currentYear,l=this.getDate(e,t,1),n=this.getDate(e,t+1,0),r=l.getDay(),s=6-n.getDay(),f=this.getDatesAfter(l,-r),p=this.getDatesAfter(n,s),g=this.getDaysInMonth(t,e),m=this.getDatesAfter(l,g-1),c=[...f,l,...m,...p];if(c.length<42){const u=this.getDatesAfter(c.at(-1),42-c.length);c=c.concat(...u)}return c},formatMonth(){return this.getDate(this.currentYear,this.currentMonth-1,1).toLocaleString("en-US",{month:"short",year:"numeric"})}},methods:{handleDateClick(t){this.fromDate&&this.toDate?(this.fromDate=this.toValue(t),this.toDate=""):this.fromDate&&!this.toDate?this.toDate=this.toValue(t):this.fromDate=this.toValue(t),this.swapDatesIfNecessary()},selectDates(){if(!this.fromDate&&!this.toDate)return this.$emit("change","");this.$emit("change",`${this.fromDate},${this.toDate}`)},swapDatesIfNecessary(){if(!this.fromDate||!this.toDate)return;let t=this.getDate(this.fromDate),e=this.getDate(this.toDate);if(t>e){let l=t;t=e,e=l}this.fromDate=this.toValue(t),this.toDate=this.toValue(e)},selectCurrentMonthYear(){let t=this.toDate?this.getDate(this.toDate):this.today;this.currentYear=t.getFullYear(),this.currentMonth=t.getMonth()+1},prevMonth(){this.changeMonth(-1)},nextMonth(){this.changeMonth(1)},changeMonth(t){this.currentMonth=this.currentMonth+t,this.currentMonth<1&&(this.currentMonth=12,this.currentYear=this.currentYear-1),this.currentMonth>12&&(this.currentMonth=1,this.currentYear=this.currentYear+1)},getDatesAfter(t,e){let l=1;e<0&&(l=-1,e=Math.abs(e));let n=[];for(;e;)t=this.getDate(t.getFullYear(),t.getMonth(),t.getDate()+l),n.push(t),e--;return l===-1?n.reverse():n},getDaysInMonth(t,e){let n=[31,28,31,30,31,30,31,31,30,31,30,31][t];return t===1&&this.isLeapYear(e)?29:n},isLeapYear(t){return t%400===0?!0:t%100===0?!1:t%4===0},toValue(t){return t?typeof t=="string"?t:(t.setHours(0,-t.getTimezoneOffset(),0,0),t.toISOString().slice(0,10)):""},getDate(...t){return new Date(...t)},isInRange(t){return!this.fromDate||!this.toDate?!1:t>=this.getDate(this.fromDate)&&t<=this.getDate(this.toDate)},formatDates(t){if(!t)return"";const e=t.split(",");return this.formatter(e[0])+" to "+this.formatter(e[1])},clearDates(){this.fromDate="",this.toDate="",this.selectDates()}}},te=["placeholder","value","onFocus"],le={class:"my-2 w-[16rem] select-none space-y-3 rounded border border-gray-50 bg-white p-3 text-base shadow"},ae={class:"flex items-center text-gray-700"},ne={class:"flex h-6 w-6 cursor-pointer items-center justify-center rounded hover:bg-gray-100"},re={class:"flex-1 text-center text-lg font-medium text-blue-500"},se={class:"flex h-6 w-6 cursor-pointer items-center justify-center rounded hover:bg-gray-100"},oe={class:"flex space-x-2"},ue={class:"mt-2 flex flex-col items-center justify-center text-base"},ie={class:"flex w-full items-center justify-center space-x-1 text-gray-600"},ce={class:"flex w-full items-center"},he=["onClick"],me={class:"mt-1 flex w-full justify-end space-x-2"};function de(t,e,l,n,r,s){const f=C("FeatherIcon"),p=C("Input"),g=C("Button"),m=E;return h(),x(m,{onOpen:s.selectCurrentMonthYear,class:"flex w-full [&>div:first-child]:w-full"},{target:V(({togglePopover:c})=>[i("input",{readonly:"",type:"text",placeholder:l.placeholder,value:l.formatter?s.formatDates(l.value):l.value,onFocus:u=>l.readonly?null:c(),class:N(["form-input block h-7 w-full cursor-pointer select-none rounded border-gray-400 text-sm  placeholder-gray-500 ",l.inputClass])},null,42,te)]),body:V(({togglePopover:c})=>[i("div",le,[i("div",ae,[i("div",ne,[v(f,{onClick:s.prevMonth,name:"chevron-left",class:"h-5 w-5"},null,8,["onClick"])]),i("div",re,T(s.formatMonth),1),i("div",se,[v(f,{onClick:s.nextMonth,name:"chevron-right",class:"h-5 w-5"},null,8,["onClick"])])]),i("div",oe,[v(p,{type:"text",modelValue:r.fromDate,"onUpdate:modelValue":e[0]||(e[0]=u=>r.fromDate=u)},null,8,["modelValue"]),v(p,{type:"text",modelValue:r.toDate,"onUpdate:modelValue":e[1]||(e[1]=u=>r.toDate=u)},null,8,["modelValue"])]),i("div",ue,[i("div",ie,[(h(),M(A,null,j(["S","M","T","W","T","F","S"],(u,b)=>i("div",{class:"flex h-[30px] w-[30px] items-center justify-center text-center",key:b},T(u),1)),64))]),(h(!0),M(A,null,j(s.datesAsWeeks,(u,b)=>(h(),M("div",{key:b},[i("div",ce,[(h(!0),M(A,null,j(u,d=>(h(),M("div",{key:s.toValue(d),class:N(["flex h-[30px] w-[30px] cursor-pointer items-center justify-center hover:bg-blue-50 hover:text-blue-500",{"text-gray-600":d.getMonth()!==r.currentMonth-1,"text-blue-500":s.toValue(d)===s.toValue(s.today),"bg-blue-50 text-blue-500":s.isInRange(d),"rounded-l-md bg-blue-100":r.fromDate&&s.toValue(d)===s.toValue(r.fromDate),"rounded-r-md bg-blue-100":r.toDate&&s.toValue(d)===s.toValue(r.toDate)}]),onClick:()=>s.handleDateClick(d)},T(d.getDate()),11,he))),128))])]))),128))]),i("div",me,[v(g,{onClick:e[2]||(e[2]=()=>s.clearDates()),disabled:!l.value},{default:V(()=>e[3]||(e[3]=[U(" Clear ")])),_:1},8,["disabled"]),v(g,{onClick:()=>s.selectDates()|c(),disabled:!r.fromDate||!r.toDate,variant:"solid"},{default:V(()=>e[4]||(e[4]=[U(" Apply ")])),_:2},1032,["onClick","disabled"])])])]),_:1},8,["onOpen"])}const fe=q(ee,[["render",de]]),pe={name:"TimespanPicker",components:{Tabs:R},emits:["update:modelValue","change"],props:["value","modelValue","placeholder"],data(){var r;const t=(this.valuePropPassed()?this.value:(r=this.modelValue)==null?void 0:r.value)||"";let[e,l,n]=t.split(" ");return e=="Current"&&(n=l),(n==null?void 0:n.at(-1))=="s"&&(n=n.slice(0,-1)),{span:e||"Last",interval:l||"1",intervalType:n||"Day"}},computed:{_value(){return this.span==="Current"?`${this.span} ${this.intervalType}`:`${this.span} ${this.interval} ${this.intervalType}`}},watch:{interval(t){t<1&&(this.interval=1)}},methods:{valuePropPassed(){return this.value!==void 0},apply(){this.valuePropPassed()?this.$emit("change",this._value):this.$emit("update:modelValue",{value:this._value,label:this._value})}}},ve=["value","placeholder","onFocus"],ge={class:"my-2 flex w-[18rem] select-none flex-col space-y-3 rounded border bg-white p-3 text-base shadow-md"},De={class:"flex space-x-2"},ye={class:"flex justify-end"};function _e(t,e,l,n,r,s){const f=R,p=C("Input"),g=C("Button"),m=E;return h(),x(m,{class:"flex w-full [&>div:first-child]:w-full"},{target:V(({togglePopover:c})=>[i("input",{readonly:"",type:"text",value:s._value,placeholder:l.placeholder,onFocus:u=>c(),class:"form-input block h-7 w-full cursor-text select-none rounded border-gray-400 text-sm placeholder-gray-500"},null,40,ve)]),body:V(({togglePopover:c})=>[i("div",ge,[v(f,{tabs:["Last","Current","Next"],modelValue:r.span,"onUpdate:modelValue":e[0]||(e[0]=u=>r.span=u)},null,8,["modelValue"]),i("div",De,[r.span!=="Current"?(h(),x(p,{key:0,type:"number",modelValue:r.interval,"onUpdate:modelValue":e[1]||(e[1]=u=>r.interval=u),class:"w-full text-sm"},null,8,["modelValue"])):k("",!0),v(p,{type:"select",modelValue:r.intervalType,"onUpdate:modelValue":e[2]||(e[2]=u=>r.intervalType=u),class:"w-full text-sm",options:["Day","Week","Month","Quarter","Year","Fiscal Year"]},null,8,["modelValue"])]),i("div",ye,[v(g,{variant:"solid",onClick:()=>{s.apply(),c()}},{default:V(()=>e[3]||(e[3]=[U(" Done ")])),_:2},1032,["onClick"])])])]),_:1})}const xe=q(pe,[["render",_e]]),be={key:0,class:"space-y-1"},ke={class:"mb-2 block text-sm leading-4 text-gray-700"},Se={__name:"FilterValueSelector",props:H({label:{type:String,required:!1,default:"Value"},column:{type:Object,required:!0},operator:{type:Object,required:!0},dataSource:{type:String,required:!0}},{modelValue:{},modelModifiers:{}}),emits:["update:modelValue"],setup(t){const e=t,l=K(t,"modelValue"),n=_(()=>{var a;return(a=e.operator)==null?void 0:a.value}),r=_(()=>{var a,o;return(o=(a=e.column)==null?void 0:a.expression)==null?void 0:o.raw}),s=_(()=>{var a;return((a=e.column)==null?void 0:a.type)==="String"}),f=_(()=>{var a;return $.DATE.includes((a=e.column)==null?void 0:a.type)}),p=_(()=>["=","!=","in","not_in"].includes(n.value)),g=_(()=>["is_set","is_not_set"].includes(n.value)),m=_(()=>g.value?"none":f.value&&n.value==="between"?"datepickerrange":f.value&&n.value==="timespan"?"timespanpicker":f.value?"datepicker":!r.value&&s.value&&p.value?"combobox":"text");function c(a){l.value={value:a,label:a.split(",").map(o=>F(o)).join(" to ")}}function u(a){l.value={value:a,label:F(a)}}const b=_(()=>["in","not_in"].includes(n.value)),d=O([]),L=O(!1),B=J(async function(a=""){var o,w;if(!(!e.column||!n.value)&&["=","!=","in","not_in"].includes(n.value)&&!(!e.column.table||!e.column.column||!e.dataSource)&&((o=e.column)==null?void 0:o.type)=="String"&&e.dataSource){const I="insights.api.data_sources.fetch_column_values";L.value=!0;const P=await X(I,{data_source:e.dataSource,table:e.column.table,column:e.column.column,search_text:a});d.value=P.map(D=>({label:D,value:D})),Array.isArray((w=l.value)==null?void 0:w.value)&&l.value.forEach(D=>{d.value.find(S=>S.value===D.value)||d.value.unshift(D)}),L.value=!1}},300);Q(()=>({column:`${e.column.table}.${e.column.column}`,operator:n.value}),(a,o)=>{!a.column||!a.operator||a.column===(o==null?void 0:o.column)&&a.operator===(o==null?void 0:o.operator)||m.value==="combobox"&&B()},{deep:!0,immediate:!0});function W(a){l.value=b.value?{label:`${a.length} values`,value:a}:a}return(a,o)=>{var I,P,D,S;const w=z;return m.value!="none"?(h(),M("div",be,[i("span",ke,T(e.label),1),m.value==="combobox"?(h(),x(w,{key:b.value,placeholder:"Value",multiple:b.value,modelValue:(I=l.value)==null?void 0:I.value,options:d.value,"onUpdate:query":Y(B),"onUpdate:modelValue":W},null,8,["multiple","modelValue","options","onUpdate:query"])):k("",!0),m.value==="timespanpicker"?(h(),x(xe,{key:1,modelValue:l.value,"onUpdate:modelValue":o[0]||(o[0]=y=>l.value=y),placeholder:"Value"},null,8,["modelValue"])):k("",!0),m.value==="datepickerrange"?(h(),x(fe,{key:2,value:(P=l.value)==null?void 0:P.value,formatter:Y(F),onChange:o[1]||(o[1]=y=>c(y))},null,8,["value","formatter"])):k("",!0),m.value==="datepicker"?(h(),x(Z,{key:3,value:(D=l.value)==null?void 0:D.value,formatter:Y(F),onChange:o[2]||(o[2]=y=>u(y))},null,8,["value","formatter"])):k("",!0),m.value==="text"?(h(),x(Y(G),{key:4,type:"text",autocomplete:"off",placeholder:"Value",modelValue:(S=l.value)==null?void 0:S.value,"onUpdate:modelValue":o[3]||(o[3]=y=>l.value={value:y,label:y})},null,8,["modelValue"])):k("",!0)])):k("",!0)}}};export{fe as D,xe as T,Se as _};
//# sourceMappingURL=FilterValueSelector-3cbeb5d5.js.map
