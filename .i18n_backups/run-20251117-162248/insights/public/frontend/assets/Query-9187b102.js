import{u as A,P as ie,D as q,j as Q,r as R,o as i,c as V,w as O,f as l,t as P,d as h,h as c,K as d,e as E,F as D,g as J,E as B,J as H,i as I,aH as bt,I as je,O as ht,a1 as $e,am as ne,B as Ee,ad as Z,aK as ue,H as wt,aM as Ve,s as z,T as ve,ae as qe,C as be,_ as pe,aX as $t,aC as L,y as X,af as Me,aL as Re,z as Ge,bj as He,v as kt,aI as Ct,an as ze,aG as Tt}from"./frappe-ui-d69b39da.js";import{P as Ot}from"./PageBreadcrumbs-2c73064a.js";import{_ as Je}from"./Tabs-88c08023.js";import{_ as G}from"./Autocomplete-e91e4d1c.js";import{w as ee}from"./widgets-5dfe9af0.js";import{h as ce,d as Et,j as te,F as oe,k as Vt,l as Ke,m as re,n as Qe,a as At,o as Ae,r as St,p as Rt,q as We,b as Qt,t as Pt,G as Ye,A as Ft}from"./index-9194c21d.js";import{_ as Ze}from"./Checkbox-95c21eb1.js";import{u as Ut}from"./useDashboards-65106383.js";import{M as Bt}from"./maximize-3d779b9b.js";import{C as It}from"./ChartSectionEmptySvg-d77827da.js";import{C as Nt}from"./chevron-down-7c5e9308.js";import{C as Dt}from"./check-2c63c113.js";import{a as Lt,b as he,c as se,d as Xe,C as jt,_ as qt,e as Mt,u as Gt}from"./QueryDataSourceSelector-8ecc9714.js";import{s as et}from"./router-9009eafe.js";import{u as Ht,C as zt}from"./queryStore-e3123969.js";import{c as Y,D as Jt}from"./index-77f7bd6f.js";import{P as Kt}from"./play-63d306bd.js";import{B as Wt,C as Yt}from"./combine-0dbf7ac7.js";import{B as Zt}from"./bug-a1e6b610.js";import{d as ye}from"./format-a2b0a407.js";import{_ as me}from"./Popover-5414f173.js";import{D as Xt}from"./vuedraggable.umd-f13fb48a.js";import{D as eo}from"./DatePicker-296330db.js";import{T as to,D as oo,_ as lo}from"./FilterValueSelector-3cbeb5d5.js";import{_ as no}from"./ListPicker-9a2927d2.js";import{_ as so}from"./DraggableList-f8776dbd.js";import{c as ke}from"./toasts-2937f9d2.js";import{X as we}from"./x-3f18ad86.js";import{L as ao}from"./list-filter-e596ffc3.js";import{u as tt}from"./useDataSource-526c5b5a.js";import{u as Pe}from"./useDataSourceTable-37863c71.js";import{S as Fe}from"./square-chart-gantt-d62ce5e7.js";import{T as Ue}from"./table-2-565c43f4.js";/**
 * @license lucide-vue-next v0.484.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ro=Y("arrow-down-up",[["path",{d:"m3 16 4 4 4-4",key:"1co6wj"}],["path",{d:"M7 20V4",key:"1yoxec"}],["path",{d:"m21 8-4-4-4 4",key:"1c9v7m"}],["path",{d:"M17 4v16",key:"7dpous"}]]);/**
 * @license lucide-vue-next v0.484.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const io=Y("arrow-down",[["path",{d:"M12 5v14",key:"s699le"}],["path",{d:"m19 12-7 7-7-7",key:"1idqje"}]]);/**
 * @license lucide-vue-next v0.484.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const uo=Y("arrow-up",[["path",{d:"m5 12 7-7 7 7",key:"hav0vg"}],["path",{d:"M12 19V5",key:"x0mq9r"}]]);/**
 * @license lucide-vue-next v0.484.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const co=Y("bookmark-minus",[["path",{d:"m19 21-7-4-7 4V5a2 2 0 0 1 2-2h10a2 2 0 0 1 2 2v16z",key:"1fy3hk"}],["line",{x1:"15",x2:"9",y1:"10",y2:"10",key:"1gty7f"}]]);/**
 * @license lucide-vue-next v0.484.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const po=Y("corner-left-down",[["polyline",{points:"14 15 9 20 4 15",key:"nkc4i"}],["path",{d:"M20 4h-7a4 4 0 0 0-4 4v12",key:"nbpdq2"}]]);/**
 * @license lucide-vue-next v0.484.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const mo=Y("corner-right-up",[["polyline",{points:"10 9 15 4 20 9",key:"1lr6px"}],["path",{d:"M4 20h7a4 4 0 0 0 4-4V4",key:"1plgdj"}]]);/**
 * @license lucide-vue-next v0.484.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const fo=Y("crop",[["path",{d:"M6 2v14a2 2 0 0 0 2 2h14",key:"ron5a4"}],["path",{d:"M18 22V8a2 2 0 0 0-2-2H2",key:"7s9ehn"}]]);/**
 * @license lucide-vue-next v0.484.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Be=Y("external-link",[["path",{d:"M15 3h6v6",key:"1q9fwt"}],["path",{d:"M10 14 21 3",key:"gplh6r"}],["path",{d:"M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6",key:"a6xqqp"}]]);/**
 * @license lucide-vue-next v0.484.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const vo=Y("infinity",[["path",{d:"M6 16c5 0 7-8 12-8a4 4 0 0 1 0 8c-5 0-7-8-12-8a4 4 0 1 0 0 8",key:"18ogeb"}]]);/**
 * @license lucide-vue-next v0.484.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const yo=Y("option",[["path",{d:"M3 3h6l6 18h6",key:"ph9rgk"}],["path",{d:"M14 3h7",key:"16f0ms"}]]);/**
 * @license lucide-vue-next v0.484.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const _o=Y("sheet",[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",ry:"2",key:"1m3agn"}],["line",{x1:"3",x2:"21",y1:"9",y2:"9",key:"1vqk6q"}],["line",{x1:"3",x2:"21",y1:"15",y2:"15",key:"o2sbyz"}],["line",{x1:"9",x2:"9",y1:"9",y2:"21",key:"1ib60c"}],["line",{x1:"15",x2:"15",y1:"9",y2:"21",key:"1n26ft"}]]);/**
 * @license lucide-vue-next v0.484.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ot=Y("sigma",[["path",{d:"M18 7V5a1 1 0 0 0-1-1H6.5a.5.5 0 0 0-.4.8l4.5 6a2 2 0 0 1 0 2.4l-4.5 6a.5.5 0 0 0 .4.8H17a1 1 0 0 0 1-1v-2",key:"wuwx1p"}]]),xo={class:"bg-white px-4 py-5 sm:p-6"},go={class:"mb-3 text-lg font-medium leading-6 text-gray-900"},bo={class:"space-y-3 text-base"},ho={key:0,class:"space-y-4"},wo={class:"flex items-center space-x-4 rounded border px-4 py-2"},$o={class:"flex flex-1 flex-col"},ko={class:"text-sm text-gray-500"},Co={key:0,class:"flex overflow-hidden rounded bg-gray-100"},To={class:"font-code form-input flex-1 overflow-hidden text-ellipsis whitespace-nowrap rounded-r-none text-sm text-gray-600"},Oo={key:1},Eo={class:"space-y-3"},Vo={key:0,class:"space-y-3"},Ao={class:"ml-2 flex flex-col"},So={class:"text-gray-500"},Ro={key:1,class:"flex h-20 items-center justify-center rounded border-2 border-dashed text-sm font-light text-gray-500"},Qo={__name:"ShareDialog",props:{show:{type:Boolean,required:!0},resourceType:{type:String,required:!0},resourceName:{type:String,required:!0},allowPublicAccess:{type:Boolean,default:!1},isPublic:{type:Boolean,default:!1}},emits:["update:show","togglePublicAccess"],setup(r,{emit:e}){const n=et().settings,o=e,s=r,a=A({get:()=>s.show,set:p=>{o("update:show",p)}}),t=A(()=>`Share ${s.resourceType.replace("Insights ","")}`),u=A({get:()=>s.isPublic,set:p=>{o("togglePublicAccess",p?1:0)}}),b=ie({url:"insights.api.public.get_public_key",params:{resource_type:s.resourceType,resource_name:s.resourceName}});q(u,(p,k)=>{p&&!k&&b.fetch()},{immediate:!0});const m=A(()=>{const p=b.data,k=`${window.location.origin}/insights/public/dashboard/`;return u.value&&p?k+p:null}),_=A(()=>{const p=b.data,k=`${window.location.origin}/insights/public/dashboard/`,T='width="800" height="600" frameborder="0" allowtransparency';return u.value&&p?`<iframe src="${k+p}" ${T}></iframe>`:null}),f=ie({url:"insights.api.permissions.get_resource_access_info",params:{resource_type:s.resourceType,resource_name:s.resourceName}});q(a,(p,k)=>{p&&!k&&f.fetch()});const $=A(()=>{var p;return((p=f.data)==null?void 0:p.authorized_teams)||[]}),y=Q(null),v=A(()=>{var p;return(p=f.data)==null?void 0:p.unauthorized_teams.map(k=>({label:k.team_name,value:k.name,description:k.members_count+" members"}))}),C=ie({url:"insights.api.permissions.grant_access"});function x(p){C.submit({resource_type:s.resourceType,resource_name:s.resourceName,team:p.value}).then(()=>{f.fetch()}),y.value=null}const w=ie({url:"insights.api.permissions.revoke_access"});function g(p){w.submit({resource_type:s.resourceType,resource_name:s.resourceName,team:p}).then(()=>{f.fetch()})}return(p,k)=>{const T=R("FeatherIcon"),S=Ze,F=R("Button"),N=R("Tooltip"),M=G,j=R("Avatar"),Se=R("Dialog");return i(),V(Se,{modelValue:a.value,"onUpdate:modelValue":k[4]||(k[4]=K=>a.value=K),dismissable:!0},{body:O(()=>[l("div",xo,[l("h3",go,P(t.value),1),l("div",bo,[s.allowPublicAccess?(i(),h("div",ho,[l("div",wo,[c(T,{name:"globe",class:"h-5 w-5 text-blue-500"}),l("div",$o,[k[5]||(k[5]=l("div",{class:"font-medium text-gray-600"},"Create Public Link",-1)),l("div",ko," Anyone with the link can view this "+P(r.resourceType.replace("Insights ","").toLowerCase()),1)]),c(S,{modelValue:u.value,"onUpdate:modelValue":k[0]||(k[0]=K=>u.value=K)},null,8,["modelValue"])]),m.value?(i(),h("div",Co,[l("div",To,P(m.value),1),c(N,{text:"Copy Link",hoverDelay:.1},{default:O(()=>[c(F,{class:"w-8 rounded-none bg-gray-200 hover:bg-gray-300",icon:"link-2",onClick:k[1]||(k[1]=K=>d(ce)(m.value))})]),_:1}),c(N,{text:"Copy iFrame",hoverDelay:.1},{default:O(()=>[c(F,{class:"w-8 rounded-l-none bg-gray-200 hover:bg-gray-300",icon:"code",onClick:k[2]||(k[2]=K=>d(ce)(_.value))})]),_:1})])):E("",!0)])):E("",!0),d(n).enable_permissions?(i(),h("div",Oo,[c(M,{modelValue:y.value,"onUpdate:modelValue":[k[3]||(k[3]=K=>y.value=K),x],placeholder:"Add a team to share with",options:v.value,autofocus:!1},null,8,["modelValue","options"]),l("div",Eo,[k[6]||(k[6]=l("div",{class:"font-medium text-gray-600"},"Teams with access",-1)),$.value.length>0?(i(),h("div",Vo,[(i(!0),h(D,null,J($.value,K=>(i(),h("div",{class:"flex items-center text-gray-600",key:K.name},[c(j,{label:K.team_name},null,8,["label"]),l("div",Ao,[l("span",null,P(K.team_name),1),l("span",So,P(K.members_count)+" members",1)]),c(F,{icon:"x",class:"ml-auto",variant:"minimal",onClick:fu=>g(K.name)},null,8,["onClick"])]))),128))])):(i(),h("div",Ro," Only you have access to this "+P(r.resourceType.replace("Insights ","").toLowerCase()),1))])])):E("",!0)])])]),_:1},8,["modelValue"])}}},Po={class:"flex h-full flex-col space-y-4 overflow-y-auto p-0.5"},lt={__name:"ChartOptions",setup(r){const e=B("query");function n(){e.chart.doc.options={}}return(o,s)=>{const a=R("Button");return i(),h("div",Po,[l("div",null,[s[2]||(s[2]=l("label",{class:"mb-1.5 block text-xs text-gray-600"},"Chart type",-1)),c(G,{modelValue:d(e).chart.doc.chart_type,options:d(ee).getChartOptions(),"onUpdate:modelValue":s[0]||(s[0]=t=>{d(e).chart.doc.chart_type=t.value,d(e).chart.doc.options={}})},{prefix:O(()=>[(i(),V(H(d(ee).getIcon(d(e).chart.doc.chart_type)),{class:"mr-1.5 h-4 w-4 text-gray-600","stroke-width":"1.5"}))]),"item-prefix":O(({option:t})=>[(i(),V(H(d(ee).getIcon(t.label)),{class:"h-4 w-4","stroke-width":"1.5"}))]),_:1},8,["modelValue","options"])]),d(e).chart.doc.chart_type?(i(),V(H(d(ee).getOptionComponent(d(e).chart.doc.chart_type)),{key:d(e).chart.doc.chart_type,modelValue:d(e).chart.doc.options,"onUpdate:modelValue":s[1]||(s[1]=t=>d(e).chart.doc.options=t),columns:d(e).results.columns},null,8,["modelValue","columns"])):E("",!0),c(a,{variant:"subtle",onClick:n},{default:O(()=>s[3]||(s[3]=[I(" Reset Options ")])),_:1})])}}},Fo={class:"bg-white px-4 py-5 sm:p-6"},Uo={class:"mb-3 text-lg font-medium leading-6 text-gray-900"},Bo={class:"space-y-3 text-base"},Io={class:"space-y-4"},No={class:"flex items-center space-x-4 rounded border px-4 py-2"},Do={class:"flex flex-1 flex-col"},Lo={class:"text-sm text-gray-700"},jo={key:0,class:"flex overflow-hidden rounded bg-gray-100"},qo={class:"font-code form-input flex-1 overflow-hidden text-ellipsis whitespace-nowrap rounded-r-none text-sm text-gray-600"},Mo={__name:"PublicShareDialog",props:{show:{type:Boolean,required:!0},resourceType:{type:String,required:!0},resourceName:{type:String,required:!0},isPublic:{type:Boolean,default:!1}},emits:["update:show","togglePublicAccess"],setup(r,{emit:e}){const n=e,o=r,s=A({get:()=>o.show,set:f=>{n("update:show",f)}}),a=A(()=>`Share ${o.resourceType.replace("Insights ","")}`),t=A({get:()=>o.isPublic,set:f=>{n("togglePublicAccess",f?1:0)}}),u=ie({url:"insights.api.public.get_public_key",params:{resource_type:o.resourceType,resource_name:o.resourceName}});q(t,(f,$)=>{f&&!$&&u.fetch()},{immediate:!0});const b=o.resourceType.replace("Insights ","").toLowerCase(),m=A(()=>{const f=u.data,$=`${window.location.origin}/insights/public/${b}/`;return t.value&&f?$+f:null}),_=A(()=>{const f=u.data,$=`${window.location.origin}/insights/public/${b}/`,y='width="800" height="600" frameborder="0" allowtransparency';return t.value&&f?`<iframe src="${$+f}" ${y}></iframe>`:null});return(f,$)=>{const y=R("FeatherIcon"),v=Ze,C=R("Button"),x=R("Tooltip"),w=R("Dialog");return i(),V(w,{modelValue:s.value,"onUpdate:modelValue":$[3]||($[3]=g=>s.value=g),dismissable:!0},{body:O(()=>[l("div",Fo,[l("h3",Uo,P(a.value),1),l("div",Bo,[l("div",Io,[l("div",No,[c(y,{name:"globe",class:"h-5 w-5 text-blue-500"}),l("div",Do,[$[4]||($[4]=l("div",{class:"font-medium text-gray-800"},"Create Public Link",-1)),l("div",Lo," Anyone with the link can view this "+P(r.resourceType.replace("Insights ","").toLowerCase()),1)]),c(v,{modelValue:t.value,"onUpdate:modelValue":$[0]||($[0]=g=>t.value=g)},null,8,["modelValue"])]),m.value?(i(),h("div",jo,[l("div",qo,P(m.value),1),c(x,{text:"Copy Link",hoverDelay:.1},{default:O(()=>[c(C,{class:"w-8 rounded-none bg-gray-200 hover:bg-gray-300",icon:"link-2",onClick:$[1]||($[1]=g=>d(ce)(m.value))})]),_:1}),c(x,{text:"Copy iFrame",hoverDelay:.1},{default:O(()=>[c(C,{class:"w-8 rounded-l-none bg-gray-200 hover:bg-gray-300",icon:"code",onClick:$[2]||($[2]=g=>d(ce)(_.value))})]),_:1})])):E("",!0)])])])]),_:1},8,["modelValue"])}}},Go={class:"flex gap-2"},Ho={class:"text-base"},zo={class:"text-base"},Jo={__name:"ChartActionButtons",emits:["fullscreen"],setup(r,{emit:e}){const n=e,o=B("query"),s=Q(!1),a=Q(!1),t=Ut(),u=Q(null),b=Q(!1),m=A(()=>t.list.map(g=>({label:g.title,value:g.name}))),_=B("$notify");function f(){a.value=!0}const $=async()=>{u.value&&(await o.chart.addToDashboard(u.value.value),a.value=!1,_({variant:"success",title:"Success",message:"Chart added to dashboard"}))};q(a,g=>g&&t.reload(),{immediate:!0});const y=Q(!1);function v(){y.value=!0,a.value=!1}const C=Q(""),x=Q(!1);async function w(){C.value&&(x.value=!0,await t.create(C.value),x.value=!1,y.value=!1,a.value=!0)}return(g,p)=>{var N,M;const k=R("Button"),T=G,S=R("Dialog"),F=R("FormControl");return i(),h(D,null,[l("div",Go,[c(k,{variant:"outline",onClick:p[0]||(p[0]=j=>n("fullscreen"))},{icon:O(()=>[c(d(Bt),{class:"h-4 w-4"})]),_:1}),c(k,{variant:"outline",onClick:p[1]||(p[1]=j=>f())},{default:O(()=>p[8]||(p[8]=[I(" Add to Dashboard ")])),_:1}),c(k,{variant:"outline",onClick:p[2]||(p[2]=j=>s.value=!0)},{default:O(()=>p[9]||(p[9]=[I(" Share ")])),_:1})]),(N=d(o).chart.doc)!=null&&N.doctype&&((M=d(o).chart.doc)!=null&&M.name)?(i(),V(Mo,{key:0,show:s.value,"onUpdate:show":p[3]||(p[3]=j=>s.value=j),"resource-type":d(o).chart.doc.doctype,"resource-name":d(o).chart.doc.name,"allow-public-access":!0,isPublic:!!d(o).chart.doc.is_public,onTogglePublicAccess:d(o).chart.togglePublicAccess},null,8,["show","resource-type","resource-name","isPublic","onTogglePublicAccess"])):E("",!0),c(S,{options:{title:"Add to Dashboard",actions:[{label:"Add",variant:"solid",disabled:!u.value,onClick:$,loading:b.value}]},modelValue:a.value,"onUpdate:modelValue":p[5]||(p[5]=j=>a.value=j)},{"body-content":O(()=>[l("div",Ho,[p[11]||(p[11]=l("span",{class:"mb-2 block text-sm leading-4 text-gray-700"},"Dashboard",-1)),c(T,{options:m.value,modelValue:u.value,"onUpdate:modelValue":p[4]||(p[4]=j=>u.value=j)},{footer:O(({togglePopover:j})=>[c(k,{class:"w-full",variant:"ghost",iconLeft:"plus",onClick:Se=>v()||j()},{default:O(()=>p[10]||(p[10]=[I(" Create New ")])),_:2},1032,["onClick"])]),_:1},8,["options","modelValue"])])]),_:1},8,["options","modelValue"]),c(S,{options:{title:"Create New Dashboard",actions:[{label:"Create",variant:"solid",onClick:w,loading:x.value}]},modelValue:y.value,"onUpdate:modelValue":p[7]||(p[7]=j=>y.value=j)},{"body-content":O(()=>[l("div",zo,[p[12]||(p[12]=l("span",{class:"mb-2 block text-sm leading-4 text-gray-700"},"Dashboard Title",-1)),c(F,{modelValue:C.value,"onUpdate:modelValue":p[6]||(p[6]=j=>C.value=j),placeholder:"Enter title",class:"w-full",autocomplete:"off"},null,8,["modelValue"])])]),_:1},8,["options","modelValue"])],64)}}},Ko={class:"flex items-center gap-2"},Wo={class:"truncate"},Yo={__name:"ChartTypeSelector",setup(r){const e=B("query");e.chart.doc.chart_type||(e.chart.doc.chart_type="Auto");const n=A(()=>{var a;return(a=e.chart.doc)==null?void 0:a.chart_type}),o={label:"Auto",value:"Auto"},s=A(()=>[o,...ee.getChartOptions()]);return(a,t)=>{const u=R("Button"),b=G;return i(),V(b,{options:s.value,modelValue:d(e).chart.doc.chart_type,"onUpdate:modelValue":t[0]||(t[0]=m=>d(e).chart.doc.chart_type=m==null?void 0:m.value)},{target:O(({togglePopover:m})=>[c(u,{variant:"outline",onClick:m},{default:O(()=>[l("div",Ko,[(i(),V(H(d(ee).getIcon(n.value)),{class:"h-4 w-4 text-gray-600"})),l("span",Wo,P(n.value),1),c(d(Nt),{class:"h-4 w-4 text-gray-600"})])]),_:2},1032,["onClick"])]),"item-prefix":O(({option:m})=>[(i(),V(H(d(ee).getIcon(m.value)),{class:"h-4 w-4 text-gray-600"}))]),"item-suffix":O(({selected:m})=>[m?(i(),V(d(Dt),{key:0,class:"h-4 w-4 text-gray-600"})):E("",!0)]),_:1},8,["options","modelValue"])}}},Zo={key:0,class:"flex flex-1 flex-col gap-4 overflow-hidden"},Xo={key:0,class:"flex flex-1 flex-col items-center justify-center rounded border"},el={class:"text-gray-500"},tl={class:"flex w-full flex-shrink-0 justify-between"},ol={class:"flex w-full flex-1 overflow-hidden rounded border"},ll={class:"relative flex h-[40rem] w-full p-1"},nl={class:"absolute top-0 right-0 p-2"},nt={__name:"ChartSection",setup(r){const e=B("query"),n=Q(null),o=A(()=>{var _,f;return((_=e.chart.doc)==null?void 0:_.name)&&((f=e.results.formattedResults)==null?void 0:f.length)&&e.doc.status!=="Pending Execution"}),s=A(()=>{var _;return e.doc.status=="Pending Execution"?"Execute the query to see the chart":(_=e.results.formattedResults)!=null&&_.length?"Pick a chart type to get started":"No results found"}),a=A(()=>{const _=e.chart.doc.chart_type,f=e.chart.getGuessedChart(_);if(!f)return{};const $=Object.assign({},f.options,e.chart.doc.options);return{type:f.chart_type,data:e.chart.data,options:_=="Auto"?f.options:$,component:ee.getComponent(f.chart_type)}}),t=Q(!1);function u(){t.value=!0}const b=Q(!1);function m(){if(!n.value){$notify({variant:"error",title:"Chart container reference not found"});return}b.value=!0;const _=e.chart.doc.options.title||e.doc.title;Et(n.value.$el,`${_}.png`).then(()=>{b.value=!1})}return(_,f)=>{var v;const $=R("Button"),y=R("Dialog");return(v=d(e).chart.doc)!=null&&v.name?(i(),h("div",Zo,[o.value?(i(),h(D,{key:1},[l("div",tl,[c(Yo),c(Jo,{onFullscreen:u})]),l("div",ol,[a.value.type?(i(),V(H(a.value.component),{options:a.value.options,data:a.value.data,key:JSON.stringify(d(e).chart.doc)+JSON.stringify(d(e).chart.data)},null,8,["options","data"])):E("",!0)])],64)):(i(),h("div",Xo,[c(It),l("span",el,P(s.value),1)])),a.value.type?(i(),V(y,{key:2,modelValue:t.value,"onUpdate:modelValue":f[0]||(f[0]=C=>t.value=C),options:{size:"7xl"}},{body:O(()=>[l("div",ll,[a.value.type?(i(),V(H(a.value.component),{ref_key:"chartRef",ref:n,options:a.value.options,data:a.value.data,key:JSON.stringify(d(e).chart.doc)},null,8,["options","data"])):E("",!0),l("div",nl,[c($,{variant:"outline",onClick:m,loading:b.value,icon:"download"},null,8,["loading"])])])]),_:1},8,["modelValue"])):E("",!0)])):E("",!0)}}},sl={class:"flex h-full w-full flex-col pt-2"},al={class:"flex flex-1 flex-shrink-0 overflow-hidden rounded border"},rl={class:"flex w-full flex-1 flex-shrink-0 overflow-hidden py-4"},il={class:"flex justify-between"},ul={key:0,class:"flex items-center space-x-1"},cl={class:"font-mono"},dl={class:"font-mono"},pl={class:"font-mono"},ml={__name:"NativeQueryBuilder",setup(r){const e=B("query");Q(e.doc.sql);const n=A(()=>e.doc.execution_time),o=A(()=>e.doc.results_row_count),s=A(()=>Math.min(e.MAX_ROWS,o.value));return(a,t)=>{const u=R("Button");return i(),h("div",sl,[t[4]||(t[4]=l("div",{class:"flex-shrink-0 uppercase leading-7 tracking-wide text-gray-600"}," Native Query ",-1)),l("div",al,[c(Lt)]),l("div",rl,[c(he,null,{footer:O(()=>[l("div",il,[o.value>=0?(i(),h("div",ul,[t[0]||(t[0]=l("span",{class:"text-gray-600"},"Showing",-1)),l("span",cl,P(s.value),1),t[1]||(t[1]=l("span",{class:"text-gray-600"},"out of",-1)),l("span",dl,P(o.value),1),t[2]||(t[2]=l("span",{class:"text-gray-600"},"rows in",-1)),l("span",pl,P(n.value),1),t[3]||(t[3]=l("span",{class:"text-gray-600"},"seconds",-1))])):E("",!0),c(u,{variant:"ghost",class:"ml-1",icon:"download",onClick:d(e).downloadResults},null,8,["onClick"])])]),_:1})])])}}},fl={class:"flex flex-shrink-0 space-x-2"},vl={class:"relative"},yl={class:"max-h-[50vh] overflow-y-auto rounded border text-base"},_l={__name:"QueryMenu",props:["query"],setup(r){const e=et().settings,o=r.query||B("query"),s=Q(!1),a=Q(!1),t=Q(!1),u=Q(!1),m=bt()["Meta+E"];q(m,C=>C&&o.execute()),A(()=>o.doc.sql.replaceAll(`
`,"<br>").replaceAll("      ","&ensp;&ensp;&ensp;&ensp;"));const _=je(),f=B("$notify");function $(){o.duplicate().then(async C=>{await ne(),_.push(`/query/build/${C}`),f({variant:"success",title:"Query Duplicated"})})}function y(){o.store().then(C=>{f({variant:"success",title:"Query Stored"})})}function v(){o.unstore().then(C=>{f({variant:"success",title:"Query Unstored"})})}return(C,x)=>{const w=R("Button");return i(),h(D,null,[l("div",fl,[c(d(ht),{placement:"right",button:{icon:"more-horizontal",variant:"outline"},options:[d(o).doc.is_stored?{label:"Unstore Query",icon:d(co),onClick:v}:{label:"Store Query",icon:"bookmark",onClick:y},{label:"Execute (âŒ˜+E)",icon:"play",onClick:d(o).execute},d(e).enable_permissions&&d(o).isOwner?{label:"Share",icon:"share-2",onClick:()=>t.value=!0}:null,d(o).doc.is_native_query?null:{label:"View SQL",icon:"help-circle",onClick:()=>a.value=!0},{label:"Duplicate",icon:"copy",onClick:$},{label:"Download CSV",icon:"download",onClick:d(o).downloadResults},{label:d(o).doc.is_assisted_query?"Switch to Classic Query Builder":"Switch to Visual Query Builder",icon:"toggle-left",onClick:()=>u.value=!0},{label:"Delete",icon:"trash-2",onClick:()=>s.value=!0}]},null,8,["options"]),c(d($e),{modelValue:s.value,"onUpdate:modelValue":x[0]||(x[0]=g=>s.value=g),dismissable:!0,options:{title:"Delete Query",message:"Are you sure you want to delete this query?",icon:{name:"trash",appearance:"danger"},actions:[{label:"Delete",variant:"solid",theme:"red",onClick:()=>{d(Ht)().delete(d(o).doc.name).then(()=>{C.$router.push("/query"),s.value=!1})}}]}},null,8,["modelValue","options"]),c(d($e),{modelValue:u.value,"onUpdate:modelValue":x[1]||(x[1]=g=>u.value=g),dismissable:!0,options:{title:d(o).doc.is_assisted_query?"Switch to Classic Query Builder":"Switch to Visual Query Builder",message:d(o).doc.is_assisted_query?"All the changes you have made in the query will be preserved. However, if you make any changes in the Classic Query Builder, they will be lost when you switch back to the Visual Query Builder. Are you sure you want to continue?":"All the changes you have made in the Classic Query Builder will be converted to the Visual Query Builder. Are you sure you want to continue?",icon:{name:"toggle-left",appearance:"warning"},actions:[{label:"Switch",variant:"solid",onClick:()=>d(o).switchQueryBuilder().then(()=>u.value=!1)}]}},null,8,["modelValue","options"]),c(d($e),{options:{title:"Generated SQL",size:"3xl"},modelValue:a.value,"onUpdate:modelValue":x[3]||(x[3]=g=>a.value=g),dismissable:!0},{"body-content":O(()=>[l("div",vl,[l("div",yl,[c(se,{language:"sql","model-value":d(o).doc.sql,"read-only":!0,"hide-line-numbers":!0},null,8,["model-value"])]),c(w,{icon:"copy",variant:"outline",class:"absolute bottom-2 right-2",onClick:x[2]||(x[2]=g=>d(ce)(d(o).doc.sql))})])]),_:1},8,["modelValue"])]),d(e).enable_permissions?(i(),V(Qo,{key:0,show:t.value,"onUpdate:show":x[4]||(x[4]=g=>t.value=g),"resource-type":d(o).doc.doctype,"resource-name":d(o).doc.name},null,8,["show","resource-type","resource-name"])):E("",!0)],64)}}},xl={class:"flex items-center gap-2"},gl={__name:"QueryHeader",setup(r){const e=B("query");return(n,o)=>{const s=R("Button");return i(),h("div",xl,[c(_l),d(e).doc.is_assisted_query?E("",!0):(i(),V(Xe,{key:0})),!d(e).doc.is_script_query&&!d(e).doc.is_native_query?(i(),V(s,{key:1,variant:"solid",onClick:o[0]||(o[0]=a=>d(e).execute()),loading:d(e).executing,disabled:!d(e).doc.data_source||!d(e).doc.sql},{prefix:O(()=>[c(d(Kt),{class:"h-4 w-4"})]),default:O(()=>[o[1]||(o[1]=l("span",null,"Execute",-1))]),_:1},8,["loading","disabled"])):E("",!0)])}}},bl={key:0,class:"mr-1"},hl={key:1,class:"flex items-center gap-1 text-sm text-gray-600"},wl={__name:"QueryHeaderTitle",setup(r){const e=B("query"),n=Q(e.doc.title);return Ee(n,e.updateTitle,{debounce:500}),(o,s)=>{const a=R("LoadingIndicator");return i(),h(D,null,[d(e).doc.is_stored?(i(),h("div",bl,[c(d(zt),{class:"h-4 w-4 text-gray-600",fill:"currentColor"})])):E("",!0),c(jt,{modelValue:n.value,"onUpdate:modelValue":s[0]||(s[0]=t=>n.value=t),placeholder:"Untitled Query",class:"mr-3 rounded-sm px-1 text-lg font-medium focus:ring-2 focus:ring-gray-700 focus:ring-offset-2"},null,8,["modelValue"]),d(e).loading?(i(),h("div",hl,[c(a,{class:"w-3"}),s[1]||(s[1]=l("span",null,"Saving...",-1))])):E("",!0)],64)}}},$l={class:"flex flex-col overflow-hidden"},kl={class:"relative flex max-h-[10rem] flex-col overflow-y-auto"},Cl={class:"flex flex-1 flex-shrink-0"},Tl=["onUpdate:modelValue"],Ol={class:"flex flex-1 flex-shrink-0"},El=["onUpdate:modelValue"],Vl={class:"flex w-10 justify-end"},Al={key:0,class:"flex justify-center py-4"},Sl={class:"mt-4 flex justify-between"},Rl={__name:"VariablesDialog",props:{show:Boolean,variables:Array},emits:["update:show","update:variables","save"],setup(r,{emit:e}){const n=e,o=r,s=A({get:()=>o.show,set:t=>n("update:show",t)}),a=A({get:()=>o.variables,set:t=>n("update:variables",t)});return(t,u)=>{const b=R("Button"),m=R("Dialog");return i(),V(m,{modelValue:s.value,"onUpdate:modelValue":u[2]||(u[2]=_=>s.value=_),options:{title:"Variables"}},{"body-content":O(()=>{var _;return[u[6]||(u[6]=l("p",{class:"-mt-4 mb-5 text-base text-gray-600"},[I(" Variables are used to store sensitive information such as API keys and credentials. They can be referenced in your script just like any other variable. For eg.: "),l("code",{class:"text-sm text-gray-800"},"print(api_key)")],-1)),l("div",$l,[l("div",kl,[u[4]||(u[4]=l("div",{class:"sticky top-0 flex gap-x-2 border-b py-2 text-sm uppercase text-gray-600"},[l("div",{class:"flex flex-1 flex-shrink-0 px-2"},"Name"),l("div",{class:"flex flex-1 flex-shrink-0 px-2"},"Value"),l("div",{class:"flex w-10"})],-1)),(i(!0),h(D,null,J(a.value,(f,$)=>(i(),h("div",{class:"flex gap-x-2",key:$},[l("div",Cl,[Z(l("input",{class:"w-full rounded-sm border-none bg-transparent px-2 py-2 text-base focus:bg-gray-100 focus:outline-none focus:ring-0",type:"text","onUpdate:modelValue":y=>f.variable_name=y,placeholder:"eg. api_key"},null,8,Tl),[[ue,f.variable_name]])]),l("div",Ol,[Z(l("input",{type:"password",class:"w-full rounded-sm border-none bg-transparent px-2 py-2 text-base focus:bg-gray-100 focus:outline-none focus:ring-0","onUpdate:modelValue":y=>f.variable_value=y,placeholder:"**********************"},null,8,El),[[ue,f.variable_value]])]),l("div",Vl,[c(b,{variant:"ghost",icon:"x",onClick:y=>a.value.splice($,1)},null,8,["onClick"])])]))),128)),((_=a.value)==null?void 0:_.length)===0?(i(),h("div",Al,u[3]||(u[3]=[l("span",{class:"text-sm text-gray-400"},"No variables",-1)]))):E("",!0)]),l("div",Sl,[c(b,{variant:"subtle",onClick:u[0]||(u[0]=f=>a.value.push({variable_name:"",variable_type:"text",variable_value:""}))},{default:O(()=>u[5]||(u[5]=[l("span",{class:"text-sm"},"Add Variable",-1)])),_:1}),c(b,{variant:"solid",label:"Save",onClick:u[1]||(u[1]=f=>t.$emit("save",a.value))})])])]}),_:1},8,["modelValue"])}}},Ql={class:"flex h-full w-full flex-col pt-2"},Pl={class:"flex flex-1 flex-shrink-0 overflow-hidden rounded border"},Fl={class:"relative flex flex-1 flex-col overflow-y-auto"},Ul={class:"sticky bottom-0 flex justify-between border-t bg-white p-2"},Bl={class:"flex gap-2"},Il={key:0,class:"flex h-full w-[30rem] flex-col overflow-hidden bg-gray-50 p-3"},Nl={class:"mt-2 flex w-full flex-col gap-2 overflow-y-auto font-mono"},Dl={class:"text-gray-400"},Ll={class:"text-gray-500"},jl={class:"flex w-full flex-1 flex-shrink-0 overflow-hidden py-4"},ql={class:"flex w-full flex-col gap-2 text-base leading-5"},Ml={class:"rounded bg-gray-50 text-sm"},Gl=`def fetch_data_from_url():
		# URL of the CSV file
		csv_url = "https://example.com/data.csv"

		try:
				# Read data from the CSV file into a Pandas DataFrame
				df = pandas.read_csv(csv_url)

				# use the log function to log messages to the script log
				log(df)

				# return the DataFrame
				return df

		except Exception as e:
				log("An error occurred:", str(e))
				return None

# Call the function to execute the script and
# then convert the data into a Pandas DataFrame or a List of lists with first row as column names
results = fetch_data_from_url()`,Hl={__name:"ScriptQueryEditor",setup(r){const e=B("query"),n=Q(e.doc.script);q(()=>e.doc.script,_=>n.value=_);const o=Q(!1);async function s(){if(!o.value){o.value=!0;try{await e.updateScript(n.value),await e.execute()}finally{o.value=!1}}}const a=Q(!1);function t(_){e.updateScriptVariables(_),a.value=!1}const u=wt(`insights:query-${e.doc.name}-show-logs`,!1),b=A(()=>{var _,f;return(f=(_=e.doc.script_log)==null?void 0:_.split(`
`))==null?void 0:f.slice(1)}),m=Q(!1);return(_,f)=>{const $=R("Button"),y=R("Dialog");return i(),h(D,null,[l("div",Ql,[f[8]||(f[8]=l("div",{class:"flex-shrink-0 uppercase leading-7 tracking-wide text-gray-600"}," Script Query ",-1)),l("div",Pl,[l("div",Fl,[c(se,{language:"python",modelValue:n.value,"onUpdate:modelValue":f[0]||(f[0]=v=>n.value=v),placeholder:"Enter your script here..."},null,8,["modelValue"]),l("div",Ul,[l("div",Bl,[c($,{variant:"outline",icon:"help-circle",onClick:f[1]||(f[1]=v=>m.value=!0)}),c($,{variant:"outline",onClick:f[2]||(f[2]=v=>a.value=!a.value)},{icon:O(()=>[c(d(Wt),{class:"h-4 w-4"})]),_:1}),c($,{variant:"outline",onClick:f[3]||(f[3]=v=>u.value=!d(u))},{icon:O(()=>[c(d(Zt),{class:"h-4 w-4"})]),_:1}),c($,{variant:"solid",icon:"play",onClick:s,loading:o.value},null,8,["loading"])])])]),c(Ve,{tag:"div",name:"slide","enter-active-class":"transition ease-out duration-200","enter-from-class":"transform translate-x-full opacity-0","enter-to-class":"transform translate-x-0 opacity-100","leave-active-class":"transition ease-in duration-200","leave-from-class":"transform translate-x-0","leave-to-class":"transform translate-x-full"},{default:O(()=>[d(u)?(i(),h("div",Il,[f[7]||(f[7]=l("div",{class:"text-sm uppercase tracking-wide text-gray-600"},"Logs",-1)),l("div",Nl,[(i(!0),h(D,null,J(b.value,(v,C)=>(i(),h("div",{key:C,class:"flex gap-2"},[l("div",Dl,"["+P(C+1)+"]",1),l("div",Ll,P(v),1)]))),128))])])):E("",!0)]),_:1})]),l("div",jl,[c(he)])]),c(Rl,{show:a.value,"onUpdate:show":f[4]||(f[4]=v=>a.value=v),variables:d(e).doc.variables,"onUpdate:variables":f[5]||(f[5]=v=>d(e).doc.variables=v),onSave:t},null,8,["show","variables"]),c(y,{modelValue:m.value,"onUpdate:modelValue":f[6]||(f[6]=v=>m.value=v),options:{title:"Help",size:"3xl"}},{"body-content":O(()=>[l("div",ql,[f[9]||(f[9]=l("div",{class:""}," In the Script Query interface, you can write custom Python scripts to query the database and retrieve data as a Pandas DataFrame. You can also fetch data from external sources using Pandas functions ",-1)),f[10]||(f[10]=l("div",null,[I(" For detailed information about these functions and how to use them, please refer to "),l("a",{class:"text-blue-500 underline",href:"https://frappeframework.com/docs/user/en/desk/scripting/script-api"}," Frappe Framework's Script API ")],-1)),f[11]||(f[11]=l("div",{class:""}," Example script to read data from a CSV file hosted on a URL and create a Pandas DataFrame: ",-1)),l("div",Ml,[c(se,{readOnly:!0,language:"python","model-value":Gl})])])]),_:1},8,["modelValue"])],64)}}},zl={class:"relative flex flex-col space-y-3"},Jl={class:"space-y-1 text-sm"},Kl={key:0,class:"space-y-1 text-sm"},Wl={class:"space-y-1 text-sm"},Yl={key:1,class:"space-y-1 text-sm"},Zl={class:"space-y-1 text-sm"},Xl={class:"sticky bottom-0 mt-3 flex justify-end space-x-2 bg-white pt-1"},st={__name:"SimpleColumnPicker",props:{column:{type:Object,default:{}}},emits:["column-select","close"],setup(r,{emit:e}){const n=B("query"),o=e,s=r,a=Q([{label:"No Aggregation",value:""},{label:"Group by",value:"Group By"},{label:"Count of Records",value:"Count"},{label:"Sum of",value:"Sum"},{label:"Avg of",value:"Avg"},{label:"Min of",value:"Min"},{label:"Max of",value:"Max"},{label:"Cumulative Count of Records",value:"Cumulative Count"},{label:"Cumulative Sum of",value:"Cumulative Sum"}]),t=z({column:{...s.column,value:s.column.column},label:s.column.label,order_by:s.column.order_by,aggType:a.value.find(g=>g.value==s.column.aggregation),dateFormat:ye.find(g=>{var p;return g.value==((p=s.column.format_option)==null?void 0:p.date_format)})||{}});t.aggType||(t.aggType={label:"No Aggregation",value:""});const u=A(()=>{var g;return t.aggType.label&&!((g=t.aggType.label)!=null&&g.includes("Count"))}),b=A(()=>!t.label||u.value&&te(t.column)||$.value&&te(t.dateFormat)),m=n.columns.options,_=A(()=>t.aggType.value==="Sum"||t.aggType.value==="Avg"||t.aggType.value==="Min"||t.aggType.value==="Max"||t.aggType.value==="Cumulative Sum"),f=A(()=>_.value?m==null?void 0:m.filter(g=>oe.NUMBER.includes(g.type)):m),$=A(()=>["Date","Datetime"].includes(t.column.type));function y(g){t.column.format_option={date_format:typeof g=="string"?g:g.value}}function v(g){t.aggType=g||{},t.label=t.aggType.label}function C(g){t.column=g||{},t.column.name=s.column.name,t.aggType.value?t.label=t.aggType.label+" "+t.column.label:t.label=t.column.label}function x(){var k;if(b.value)return;const g=(k=s.column)==null?void 0:k.name,p={...t.column,aggregation:t.aggType.value,label:t.label,order_by:t.order_by,format_option:$.value?t.column.format_option:null};u.value||(p.column="count",p.type="Integer",p.table=n.tables.data[0].table,p.table_label=n.tables.data[0].table_label),g?n.updateColumn.submit({column:p}):n.addColumn.submit({column:p}),o("close")}function w(){n.removeColumn.submit({column:t.column}),o("close")}return(g,p)=>{const k=G,T=R("Input"),S=R("Button");return i(),h("div",zl,[l("div",Jl,[p[5]||(p[5]=l("div",{class:"text-gray-700"},"Aggregation Type",-1)),c(k,{modelValue:t.aggType,"onUpdate:modelValue":[p[0]||(p[0]=F=>t.aggType=F),v],options:a.value,placeholder:"Select aggregation type"},null,8,["modelValue","options"])]),u.value?(i(),h("div",Kl,[p[6]||(p[6]=l("div",{class:"text-gray-700"},"Column",-1)),c(k,{modelValue:t.column,"onUpdate:modelValue":[p[1]||(p[1]=F=>t.column=F),C],options:f.value,placeholder:"Select a column...",emptyText:_.value?"No number columns":"No columns"},null,8,["modelValue","options","emptyText"])])):E("",!0),l("div",Wl,[p[7]||(p[7]=l("div",{class:"text-gray-700"},"Label",-1)),c(T,{type:"text",modelValue:t.label,"onUpdate:modelValue":p[2]||(p[2]=F=>t.label=F),class:"placeholder:text-sm",placeholder:"Enter a label..."},null,8,["modelValue"])]),$.value?(i(),h("div",Yl,[p[8]||(p[8]=l("div",{class:"text-gray-700"},"Date Format",-1)),c(k,{modelValue:t.dateFormat,"onUpdate:modelValue":[p[3]||(p[3]=F=>t.dateFormat=F),y],options:d(ye).map(F=>({...F,description:F.value})),placeholder:"Select a date format..."},null,8,["modelValue","options"])])):E("",!0),l("div",Zl,[p[9]||(p[9]=l("div",{class:"text-gray-700"},"Sort",-1)),c(T,{type:"select",modelValue:t.order_by,"onUpdate:modelValue":p[4]||(p[4]=F=>t.order_by=F),options:[{label:"",value:""},{label:"Ascending",value:"asc"},{label:"Descending",value:"desc"}],class:"placeholder:text-sm",placeholder:"Enter a label..."},null,8,["modelValue"])]),l("div",Xl,[s.column.name?(i(),V(S,{key:0,class:"text-red-500",variant:"outline",onClick:w},{default:O(()=>p[10]||(p[10]=[I(" Remove ")])),_:1})):E("",!0),c(S,{onClick:x,variant:"solid",disabled:b.value},{default:O(()=>[I(P(s.column.name?"Update":"Add "),1)]),_:1},8,["disabled"])])])}}},W={in:{syntax:'in(column_name, "value1", "value2", ...)',description:"Checks if column contains any of the provided values.",example:'in(`order.status`, "Closed", "Resolved")',returnType:"boolean"},not_in:{syntax:'not_in(column_name, "value1", "value2", ...)',description:"Checks if column excludes the provided values.",example:'not_in(`order.status`, "Closed", "Resolved")',returnType:"boolean"},is_set:{syntax:"is_set(column_name)",description:"Checks if column has a value.",example:"is_set(`order.status`)",returnType:"boolean"},is_not_set:{syntax:"is_not_set(column_name)",description:"Checks if column lacks a value.",example:"is_not_set(`order.status`)",returnType:"boolean"},between:{syntax:'between(column_name, "value1", "value2")',description:"Checks if column value is between two values.",example:"between(`user.age`, 10, 30)",returnType:"boolean"},contains:{syntax:'contains(column_name, "value")',description:"Checks if column contains the specified value.",example:'contains(`order.customer`, "John")',returnType:"boolean"},not_contains:{syntax:'not_contains(column_name, "value")',description:"Checks if column excludes the specified value.",example:'not_contains(`order.customer`, "John")',returnType:"boolean"},ends_with:{syntax:'ends_with(column_name, "value")',description:"Checks if column ends with the specified value.",example:'ends_with(`order.customer`, "Souza")',returnType:"boolean"},starts_with:{syntax:'starts_with(column_name, "value")',description:"Checks if column starts with the specified value.",example:'starts_with(`order.customer`, "John")',returnType:"boolean"},lower:{syntax:"lower(string_column)",description:"Converts string to lowercase.",example:"lower(`product.category`)",returnType:"string"},upper:{syntax:"upper(string_column)",description:"Converts string to uppercase.",example:"upper(`product.category`)",returnType:"string"},concat:{syntax:"concat(column1, column2, ...)",description:"Combines values from columns or strings.",example:'concat(`user.first_name`, " ", `user.last_name`)',returnType:"string"},replace:{syntax:'replace(column_name, "search", "replace")',description:"Replaces occurrences in the column.",example:'replace(`product.category`, "_", "-")',returnType:"string"},substring:{syntax:"substring(column_name, start, end)",description:"Extracts part of the column value.",example:"substring(`order.customer`, 0, 5)",returnType:"string"},abs:{syntax:"abs(number_column)",description:"Returns absolute value of the column.",example:"abs(`order.paid_amount`)",returnType:"number"},sum:{syntax:"sum(number_column)",description:"Sums values of the column.",example:"sum(`order.paid_amount`)",returnType:"number"},min:{syntax:"min(number_column)",description:"Finds minimum value of the column.",example:"min(`order.paid_amount`)",returnType:"number"},max:{syntax:"max(number_column)",description:"Finds maximum value of the column.",example:"max(`order.paid_amount`)",returnType:"number"},avg:{syntax:"avg(number_column)",description:"Calculates average value of the column.",example:"avg(`order.paid_amount`)",returnType:"number"},round:{syntax:"round(number_column)",description:"Rounds the column value.",example:"round(`order.paid_amount`)",returnType:"number"},floor:{syntax:"floor(number_column)",description:"Rounds the column value down.",example:"floor(`order.paid_amount`)",returnType:"number"},ceil:{syntax:"ceil(number_column)",description:"Rounds the column value up.",example:"ceil(`order.paid_amount`)",returnType:"number"},timespan:{syntax:'timespan(column_name, "timespan")',description:"Checks if column value is within the timespan.",example:'timespan(`invoice.creation`, "Last 7 Days")',returnType:"boolean"},now:{syntax:"now()",description:"Gets current date and time.",example:"`invoice.posting_date` = now()",returnType:"datetime"},today:{syntax:"today()",description:"Gets current date.",example:"`invoice.posting_date` = today()",returnType:"date"},format_date:{syntax:'format_date(date, "format")',description:"Formats date to the given format.",example:'format_date(`invoice.posting_date`, "DD-MM-YYYY")',returnType:"string"},start_of:{syntax:"start_of(unit, date)",description:"Finds start of the given unit (e.g., Month, Year).",example:'start_of("Month", today())',returnType:"date"},time_elapsed:{syntax:"time_elapsed(unit, date1, date2)",description:"Calculates time between two dates.",example:'time_elapsed("day", `invoice.posting_date`, today())',returnType:"number"},case:{syntax:'case(condition1, "value1", ..., "default_value")',description:"Returns matched condition value or default.",example:'case(`invoice.amount` > 0, "Unpaid", `invoice.amount` < 0, "Return", "Paid")',returnType:"any"},count:{syntax:"count(column_name)",description:"Counts rows based on column.",example:"count(`invoice.id`)",returnType:"number"},coalesce:{syntax:"coalesce(column1, column2, ...)",description:"Returns first non-null value from columns.",example:"coalesce(`user.first_name`, `user.last_name`)",returnType:"any"},if_null:{syntax:'if_null(column_name, "default_value")',description:"Provides default if column is null.",example:'if_null(`product.category`, "No Category")',returnType:"any"},distinct:{syntax:"distinct(column_name)",description:"Lists distinct values of the column.",example:"distinct(`user.customer`)",returnType:"any"},distinct_count:{syntax:"distinct_count(column_name)",description:"Counts distinct values of the column.",example:"distinct_count(`user.customer`)",returnType:"number"},count_if:{syntax:"count_if(condition)",description:"Counts rows that satisfy the condition.",example:"count_if(`order.amount` > 0)",returnType:"number"},sum_if:{syntax:"sum_if(condition, column_name)",description:"Sums values of the column that satisfy the condition.",example:'sum_if(`order.customer` = "John", `grand_total`)',returnType:"number"},descendants:{syntax:'descendants("value", "doctype", "fieldname")',description:"Lists all descendants of the given value.",example:'descendants("India", "tabTerritory", `territory`)',returnType:"boolean"},descendants_and_self:{syntax:'descendants_and_self("value", "doctype", "fieldname")',description:"Lists all descendants and self of the given value.",example:'descendants_and_self("India", "tabTerritory", `territory`)',returnType:"boolean"},sql:{syntax:'sql("query")',description:"Write raw SQL queries.",example:'sql("MONTH(invoice.posting_date)")',returnType:"any"}},en={class:"mt-4 flex max-h-[30rem] flex-col space-y-1 divide-y overflow-y-auto text-base"},tn={class:"flex-1 space-y-1 py-2"},on={class:"font-mono text-lg font-medium"},ln={class:"text-sm text-gray-600"},nn={class:"mt-2 flex-1 rounded bg-gray-50 p-2 text-sm leading-5"},sn={key:0,class:"py-2 text-center text-gray-700"},at={__name:"ExpressionHelpDialog",setup(r){const e=Q(!1),n=Q(""),o=Object.keys(W).map(a=>({name:a,...W[a]})),s=A(()=>n.value?o.filter(a=>{var t;return a.name.toLowerCase().includes(n.value.toLowerCase())||((t=a.syntax)==null?void 0:t.toLowerCase().includes(n.value.toLowerCase()))}):o);return(a,t)=>{const u=R("Button"),b=R("Dialog");return i(),h(D,null,[c(u,{variant:"ghost",onClick:t[0]||(t[0]=m=>e.value=!0),icon:"help-circle"}),c(b,{options:{title:"Functions"},modelValue:e.value,"onUpdate:modelValue":t[2]||(t[2]=m=>e.value=m),dismissable:!0},{"body-content":O(()=>[Z(l("input",{"onUpdate:modelValue":t[1]||(t[1]=m=>n.value=m),placeholder:"Search functions",class:"form-input block w-full border-gray-400 placeholder-gray-500"},null,512),[[ue,n.value]]),l("div",en,[(i(!0),h(D,null,J(s.value,m=>(i(),h("div",{key:m.name,class:"flex"},[l("div",tn,[l("p",on,P(m.name),1),l("p",ln,P(m.description),1)]),l("div",nn,[l("code",null,[t[3]||(t[3]=l("span",{class:"text-gray-600"},"# Syntax",-1)),t[4]||(t[4]=l("br",null,null,-1)),I(" "+P(m.syntax)+" ",1),t[5]||(t[5]=l("br",null,null,-1)),t[6]||(t[6]=l("br",null,null,-1)),t[7]||(t[7]=l("span",{class:"text-gray-600"},"# Example",-1)),t[8]||(t[8]=l("br",null,null,-1)),I(" "+P(m.example),1)])])]))),128)),s.value.length?E("",!0):(i(),h("div",sn," No functions found "))])]),_:1},8,["modelValue"])],64)}}},an={class:"ml-auto w-[20rem] rounded border bg-white p-2 shadow-lg"},rn={class:"mt-2 rounded bg-gray-50 p-2 text-xs leading-5"},rt={__name:"ExpressionHelp",props:{info:Object},setup(r){return(e,n)=>{var o,s,a;return i(),h("div",an,[l("p",null,P((o=r.info)==null?void 0:o.description),1),l("div",rn,[l("code",null,[n[0]||(n[0]=l("span",{class:"text-gray-600"},"# Syntax",-1)),n[1]||(n[1]=l("br",null,null,-1)),I(" "+P((s=r.info)==null?void 0:s.syntax)+" ",1),n[2]||(n[2]=l("br",null,null,-1)),n[3]||(n[3]=l("br",null,null,-1)),n[4]||(n[4]=l("span",{class:"text-gray-600"},"# Example",-1)),n[5]||(n[5]=l("br",null,null,-1)),I(" "+P((a=r.info)==null?void 0:a.example),1)])])])}}},U={EOF:"EOF",NUMBER:"NUMBER",OPEN_PARENTHESIS:"OPEN_PARENTHESIS",CLOSE_PARENTHESIS:"CLOSE_PARENTHESIS",OPERATOR_ADD:"OPERATOR_ADD",OPERATOR_SUB:"OPERATOR_SUB",OPERATOR_MUL:"OPERATOR_MUL",OPERATOR_DIV:"OPERATOR_DIV",OPERATOR_GT:"OPERATOR_GT",OPERATOR_LT:"OPERATOR_LT",OPERATOR_EQ:"OPERATOR_EQ",OPERATOR_NEQ:"OPERATOR_NEQ",OPERATOR_GTE:"OPERATOR_GTE",OPERATOR_LTE:"OPERATOR_LTE",BACKTICK:"BACKTICK",COLUMN:"COLUMN",FUNCTION:"FUNCTION",ARGUMENT_SEPARATOR:"ARGUMENT_SEPARATOR",FUNCTION_ARGUMENTS:"FUNCTION_ARGUMENTS",STRING:"STRING",LOGICAL_AND:"LOGICAL_AND",LOGICAL_OR:"LOGICAL_OR"},Ie="abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789_$";function un(r){return/^[()]$/.test(r)}function cn(r){return/^\s$/.test(r)}function Ce(r){return/^[0-9]$/.test(r)}function dn(r){return r==="`"}function pn(r){return r===","}function mn(r){return r==='"'||r==="'"}function Ne(r){return r==="+"||r==="-"||r==="*"||r==="/"||r===">"||r==="<"||r==="="||r==="!"}function fn(r){switch(r){case"+":return U.OPERATOR_ADD;case"-":return U.OPERATOR_SUB;case"*":return U.OPERATOR_MUL;case"/":return U.OPERATOR_DIV;case">":return U.OPERATOR_GT;case"<":return U.OPERATOR_LT;case"=":return U.OPERATOR_EQ;case"!=":return U.OPERATOR_NEQ;case">=":return U.OPERATOR_GTE;case"<=":return U.OPERATOR_LTE;default:console.warn(`Unknown operator: ${r}`)}}function Te(r){return r==="&"||r==="|"}function it(r,e=0){if(r=r==null?void 0:r.replace(/\t\f\r\n/g,""),!r)return[];let n=0,o=[],s=r[n],a=r[n+1];function t(){s=r[++n],a=r[n+1]}function u(){let y="";for(;Ne(s);)y+=s,t();o.push({type:fn(y),value:y})}function b(){let y="";for(;Ce(s)||s=="."&&Ce(r[n+1]);)y+=s,t();o.push({type:U.NUMBER,value:y})}function m(){o.push({type:U.BACKTICK}),t();let y="";for(;s!="`"&&n<r.length;)y+=s,t();if(y.length){const v=e+n-y.length,[C,x]=y.split(".");o.push({type:U.COLUMN,start:v,end:e+n,value:{table:x?C:null,column:x||C}})}s==="`"&&(o.push({type:U.BACKTICK}),t())}function _(){let y="";for(;Ie.includes(s)&&n<r.length;)y+=s,t();if(!y)return;const v={type:U.FUNCTION,start:e+n-y.length,end:e+n,value:y};let C=null;s==="("&&(C={type:U.OPEN_PARENTHESIS},t());let x=n,w=vn(r,n-1),g=w!==-1?w:r.length,p=r.substring(x,g);if(!p){v.end=e+n,o.push(v),C&&o.push(C);return}let k=it(p,e+x).filter(S=>S.type!==U.EOF);n=g-1,t();let T=null;s===")"&&(T={type:U.CLOSE_PARENTHESIS},t()),v.end=e+n,o.push(v),C&&o.push(C),o=o.concat(k),T&&o.push(T)}function f(){let y=s;t();let v="";for(;s!=y&&n<r.length;)v+=s,t();s==y&&(o.push({type:U.STRING,value:v}),t())}function $(){o.push({type:s=="&"?U.LOGICAL_AND:U.LOGICAL_OR,value:s+a}),t(),t()}for(;n<r.length;){if(cn(s)){t();continue}if(Ne(s)){u();continue}if(un(s)){o.push({type:s=="("?U.OPEN_PARENTHESIS:U.CLOSE_PARENTHESIS}),t();continue}if(pn(s)){o.push({type:U.ARGUMENT_SEPARATOR,value:s}),t();continue}if(Ce(s)){b();continue}if(dn(s)){m();continue}if(mn(s)){f();continue}if(Te(s)&&Te(s)==Te(a)){$();continue}if(Ie.includes(s)){_();continue}console.warn(`Unexpected character: ${s} while parsing expression: ${r}`);break}return o.push({type:U.EOF}),o}function vn(r,e){if(r[e]!=="(")return-1;let n=0;for(let o=e;o<r.length;o++)if(r[o]=="("&&n++,r[o]==")"&&n--,n==0)return o;return-1}const ut=5;function yn(r){switch(r){case U.NUMBER:case U.STRING:case U.COLUMN:case U.FUNCTION:case U.OPEN_PARENTHESIS:case U.CLOSE_PARENTHESIS:case U.BACKTICK:return ut;case U.OPERATOR_MUL:case U.OPERATOR_DIV:return 4;case U.OPERATOR_ADD:case U.OPERATOR_SUB:return 3;case U.OPERATOR_GT:case U.OPERATOR_LT:case U.OPERATOR_EQ:case U.OPERATOR_NEQ:case U.OPERATOR_GTE:case U.OPERATOR_LTE:return 2;case U.LOGICAL_AND:return 1;case U.LOGICAL_OR:return 0;default:return 100}}function de(r){const e=it(r);let n=0,o=e[n],s=null;function a(y){if(y<ut){let v=a(y+1);for(;yn(o.type)==y&&o.type!==U.EOF;){const C=o.value;o=e[++n];const x=a(y+1);v={type:"BinaryExpression",operator:C,left:v,right:x}}return v}switch(o.type){case U.NUMBER:return t();case U.STRING:return u();case U.OPEN_PARENTHESIS:return b();case U.BACKTICK:return m();case U.FUNCTION:return _();case U.EOF:return{type:"EOF"};default:throw s=`Unexpected token: ${o.value}`,new Error(`Failed to Parse Expression ${r}: Unexpected token: ${o.type}`)}}function t(){const y=o.value;return o=e[++n],{type:"Number",value:parseFloat(y)}}function u(){const y=o.value;return o=e[++n],{type:"String",value:y}}function b(){if(o=e[++n],!f())throw s="Missing closing parenthesis for opening parenthesis",new Error(`Failed to Parse Expression ${r}: Missing closing parenthesis`);const y=a(0);return o=e[++n],y}function m(){if(o=e[++n],o.type!==U.COLUMN)throw s="Missing column name",new Error(`Failed to Parse Expression ${r}: Expected column reference, got: ${o.type}`);const y=o.value;if(!y.table||!y.column)throw s="Invalid column reference",new Error(`Failed to Parse Expression ${r}: Invalid column reference: ${y}`);if(o=e[++n],o.type!==U.BACKTICK)throw s="Missing closing backtick",new Error(`Failed to Parse Expression ${r}: Expected closing backtick, got: ${o.type}`);return o=e[++n],{type:"Column",value:y}}function _(){const y=o.value;if(o=e[++n],o.type!==U.OPEN_PARENTHESIS)throw s=`Expected opening parenthesis after ${y} function`,new Error(`Failed to Parse Expression ${r}: Expected opening parenthesis, got: ${o.type}`);if(o=e[++n],!f())throw s=`Missing closing parenthesis for ${y} function`,new Error(`Failed to Parse Expression ${r}: Missing closing parenthesis for ${y} function`);const v=[];for(;o.type!==U.CLOSE_PARENTHESIS&&o.type!==U.EOF;)v.push(a(0)),o.type===U.ARGUMENT_SEPARATOR&&(o=e[++n]);return o=e[++n],{type:"CallExpression",function:y,arguments:v}}function f(){let y=-1;for(let v=n;v<e.length;v++)if(e[v].type===U.CLOSE_PARENTHESIS){y=v;break}if(y!==-1)return!0}let $=null;try{$=a(0)}catch(y){console.groupCollapsed("Failed to Parse Expression"),console.error(y),console.groupEnd()}return{ast:$,errorMessage:s,tokens:e}}const _n={class:"relative flex flex-col"},xn={class:"flex justify-between"},gn={class:"!mt-1 flex cursor-pointer items-center text-xs text-red-500"},bn={class:"relative h-full w-full rounded border p-1"},hn={class:"absolute bottom-1 left-1"},wn={class:"w-full pr-3 text-base"},$n={class:"mt-2 text-sm text-gray-700"},kn={class:"mt-2 text-sm text-gray-700"},Cn={key:0,class:"mt-2 text-sm text-gray-700"},Tn={class:"mt-2 space-y-1 text-sm text-gray-700"},On={class:"mt-4 text-sm text-gray-700"},En={class:"sticky bottom-0 mt-3 flex justify-end space-x-2 bg-white pt-1"},ct={__name:"ColumnExpressionPicker",props:{column:{type:Object,default:{},validate:r=>{if(r.is_expression!=1)return"Column must be an expression"}}},emits:["close"],setup(r,{emit:e}){var x;const n=B("query"),o=e,s=r,a={...s.column,expression:s.column.expression||{}},t=Q(!!a.name),u=z({value:a.expression.raw||"",caretPosition:((x=a.expression.raw)==null?void 0:x.length)||0}),b=["String","Integer","Decimal","Text","Datetime","Date","Time"],m=z({raw:u.value,label:a.label,order_by:a.order_by,groupBy:a.aggregation=="Group By",valueType:a.type||"String",ast:null,error:null,tokens:[],help:null,dateFormat:["Date","Datetime"].includes(s.column.type)?ye.find(w=>{var g;return w.value===((g=s.column.format_option)==null?void 0:g.date_format)}):{}});ve(()=>{m.raw=u.value;const{ast:w,tokens:g,errorMessage:p}=de(u.value);m.ast=w,m.tokens=g,m.error=p});const _=A(()=>["Date","Datetime"].includes(m.valueType));ve(()=>{(_.value||m.valueType!=="String")&&(m.groupBy=!1)});const f=be(function({cursorPos:w}){m.help=null;const{tokens:g}=m,p=g.filter(k=>k.start<=w-1&&k.end>=w&&k.type=="FUNCTION").at(-1);if(p){const{value:k}=p;W[k]&&(m.help=W[k])}},300),$=(w,g)=>{let p=w.matchBefore(/\w*/),k=g.resolveInner(w.pos,-1);if(k.name==="TemplateString")return{from:p.from,options:n.columns.options.map(T=>({label:`${T.table}.${T.column}`}))};if(k.name==="VariableName")return{from:p.from,options:Object.keys(W).map(T=>({label:T}))}},y=A(()=>!!(m.error||!m.raw||!m.label||!m.valueType)),v=()=>{const w={name:s.column.name,is_expression:1,expression:{raw:m.raw,ast:m.ast},type:m.valueType,label:m.label,order_by:m.order_by,column:m.label.replace(/\s/g,"_"),aggregation:m.groupBy?"Group By":""};_.value&&(w.format_option={date_format:m.dateFormat.value}),s.column.name?n.updateColumn.submit({column:w}):n.addColumn.submit({column:w}),o("close")},C=()=>{n.removeColumn.submit({column:s.column}),o("close")};return(w,g)=>{const p=R("FeatherIcon"),k=R("Tooltip"),T=me,S=R("Input"),F=G,N=R("Button");return i(),h("div",_n,[l("div",xn,[g[6]||(g[6]=l("div",{class:"mb-1 text-sm"},"Expression",-1)),m.error?(i(),V(k,{key:0,text:m.error},{default:O(()=>[l("div",gn,[c(p,{name:"alert-circle",class:"h-4 w-4"})])]),_:1},8,["text"])):E("",!0)]),c(T,{class:"h-36 w-full text-sm",placement:"left-start"},{target:O(({open:M})=>[l("div",bn,[c(se,{modelValue:u.value,"onUpdate:modelValue":g[0]||(g[0]=j=>u.value=j),completions:$,onInputChange:M,onViewUpdate:d(f)},null,8,["modelValue","onInputChange","onViewUpdate"]),l("div",hn,[c(at)])])]),body:O(()=>[l("div",wn,[c(Ve,{"enter-active-class":"transition duration-100 ease-out","enter-from-class":"transform scale-95 opacity-0","enter-to-class":"transform scale-100 opacity-100","leave-active-class":"transition duration-75 ease-in","leave-from-class":"transform opacity-100","leave-to-class":"transform opacity-0"},{default:O(()=>[Z(c(rt,{info:m.help},null,8,["info"]),[[qe,m.help]])]),_:1})])]),_:1}),l("div",$n,[g[7]||(g[7]=l("div",{class:"mb-1"},"Label",-1)),c(S,{type:"text",modelValue:m.label,"onUpdate:modelValue":g[1]||(g[1]=M=>m.label=M),class:"placeholder:text-sm",placeholder:"Enter a label..."},null,8,["modelValue"])]),l("div",kn,[g[8]||(g[8]=l("div",{class:"mb-1"},"Type",-1)),c(S,{type:"select",modelValue:m.valueType,"onUpdate:modelValue":g[2]||(g[2]=M=>m.valueType=M),class:"placeholder:text-sm",placeholder:"Select a type...",options:b},null,8,["modelValue"])]),_.value?(i(),h("div",Cn,[g[9]||(g[9]=l("div",{class:"mb-1"},"Date Format",-1)),c(F,{modelValue:m.dateFormat,"onUpdate:modelValue":g[3]||(g[3]=M=>m.dateFormat=M),options:d(ye),placeholder:"Select a date format..."},null,8,["modelValue","options"])])):E("",!0),l("div",Tn,[g[10]||(g[10]=l("div",{class:""},"Sort",-1)),c(S,{type:"select",modelValue:m.order_by,"onUpdate:modelValue":g[4]||(g[4]=M=>m.order_by=M),options:[{label:"",value:""},{label:"Ascending",value:"asc"},{label:"Descending",value:"desc"}],class:"placeholder:text-sm",placeholder:"Enter a label..."},null,8,["modelValue"])]),l("div",On,[m.valueType=="String"?(i(),V(S,{key:0,type:"checkbox",label:"Group By",modelValue:m.groupBy,"onUpdate:modelValue":g[5]||(g[5]=M=>m.groupBy=M)},null,8,["modelValue"])):E("",!0)]),l("div",En,[t.value?(i(),V(N,{key:0,class:"text-red-500",variant:"outline",onClick:C},{default:O(()=>g[11]||(g[11]=[I(" Remove ")])),_:1})):E("",!0),c(N,{variant:"solid",onClick:v,disabled:y.value},{default:O(()=>[I(P(t.value?"Update":"Add "),1)]),_:1},8,["disabled"])])])}}},Vn={class:"flex w-full flex-shrink-0 items-center bg-white pb-2"},An={class:"flex flex-1 flex-col overflow-y-scroll"},Sn={__name:"ColumnEditor",props:{column:{type:Object,default:{},required:!0}},emits:["close"],setup(r,{emit:e}){const n=r;return(o,s)=>{const a=R("Button");return i(),h(D,null,[l("div",Vn,[c(a,{icon:"chevron-left",class:"mr-2",onClick:s[0]||(s[0]=t=>o.$emit("close"))}),s[3]||(s[3]=l("div",{class:"text-sm uppercase tracking-wide text-gray-700"},"Edit Column",-1))]),l("div",An,[n.column.is_expression?(i(),V(ct,{key:0,column:n.column,onClose:s[1]||(s[1]=t=>o.$emit("close"))},null,8,["column"])):(i(),V(st,{key:1,column:n.column,onClose:s[2]||(s[2]=t=>o.$emit("close"))},null,8,["column"]))])],64)}}},Rn={name:"DragHandleIcon"},Qn={xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"};function Pn(r,e,n,o,s,a){return i(),h("svg",Qn,e[0]||(e[0]=[$t('<circle cx="12" cy="9" r="1"></circle><circle cx="19" cy="9" r="1"></circle><circle cx="5" cy="9" r="1"></circle><circle cx="12" cy="15" r="1"></circle><circle cx="19" cy="15" r="1"></circle><circle cx="5" cy="15" r="1"></circle>',6)]))}const Fn=pe(Rn,[["render",Pn]]),Un={key:0,class:"flex h-full w-full items-center justify-center rounded border-2 border-dashed border-gray-200 text-sm text-gray-500"},Bn={key:1,class:"flex h-full w-full flex-col overflow-y-scroll"},In=["onClick"],Nn={class:"overflow-hidden text-ellipsis whitespace-nowrap text-base font-medium"},Dn={class:"ml-auto mr-1 overflow-hidden text-ellipsis whitespace-nowrap text-gray-700"},Ln=["onClick"],jn={__name:"ColumnList",emits:["edit-column"],setup(r){const e=B("query"),n=Q(d(e.columns.data));q(()=>e.columns.data,s=>{n.value=s});function o(s){s.oldIndex!=s.newIndex&&e.moveColumn.submit({from_index:s.oldIndex,to_index:s.newIndex})}return(s,a)=>{const t=R("FeatherIcon");return n.value.length==0?(i(),h("div",Un,a[1]||(a[1]=[l("p",null,"No columns selected",-1)]))):n.value.length>0?(i(),h("div",Bn,[c(d(Xt),{class:"w-full",modelValue:n.value,"onUpdate:modelValue":a[0]||(a[0]=u=>n.value=u),group:"columns","item-key":"name",handle:".handle",onSort:o},{item:O(({element:u})=>[l("div",{class:"flex h-10 w-full cursor-pointer items-center border-b text-sm last:border-0 hover:bg-gray-50",onClick:L(()=>{s.$emit("edit-column",u),s.newColumnType=u.aggregation=="Group By"?"Dimension":"Metric"},["prevent","stop"])},[c(Fn,{class:"handle -ml-1 mr-1 h-4 w-4 rotate-90 cursor-grab self-center text-gray-500"}),l("span",Nn,P(u.label),1),l("span",Dn,P(u.is_expression?"Expression":d(Vt)(u.table_label,12)),1),l("div",{class:"flex items-center px-1 py-0.5 text-gray-700 hover:text-gray-700",onClick:L(b=>d(e).removeColumn.submit({column:u}),["prevent","stop"])},[c(t,{name:"x",class:"h-3 w-3"})],8,Ln)],8,In)]),_:1},8,["modelValue"])])):E("",!0)}}},qn={class:"flex w-full flex-shrink-0 items-center bg-white pb-2"},Mn={class:"flex flex-1 flex-col space-y-3 overflow-y-scroll"},Gn={class:"flex h-9 flex-shrink-0 cursor-pointer items-center space-x-2 rounded bg-gray-100 p-1 text-sm"},Hn=["onClick"],zn={__name:"ColumnPicker",emits:["close"],setup(r){const e=Q("Simple");return(n,o)=>{const s=R("Button");return i(),h(D,null,[l("div",qn,[c(s,{icon:"chevron-left",class:"mr-2",onClick:o[0]||(o[0]=a=>n.$emit("close"))}),o[3]||(o[3]=l("div",{class:"text-sm uppercase tracking-wide text-gray-700"},"Add Column",-1))]),l("div",Mn,[l("div",Gn,[(i(),h(D,null,J(["Simple","Expression"],a=>l("div",{class:X(["flex h-full flex-1 items-center justify-center rounded",{" bg-white font-normal shadow":e.value==a}]),onClick:L(t=>e.value=a,["prevent","stop"])},P(a),11,Hn)),64))]),e.value=="Simple"?(i(),V(st,{key:0,onClose:o[1]||(o[1]=a=>n.$emit("close"))})):E("",!0),e.value=="Expression"?(i(),V(ct,{key:1,onClose:o[2]||(o[2]=a=>n.$emit("close"))})):E("",!0)])],64)}}},Jn={class:"flex flex-1 flex-shrink-0 flex-col overflow-hidden text-gray-900"},Kn={class:"flex w-full flex-shrink-0 items-center justify-between bg-white pb-2"},Wn={class:"w-full flex-1 overflow-hidden"},Yn={__name:"ColumnPanel",setup(r){const e=Q(!1),n=Q({}),o=Q(!1);return(s,a)=>{const t=R("Button");return i(),h("div",Jn,[!e.value&&!o.value?(i(),h(D,{key:0},[l("div",Kn,[a[4]||(a[4]=l("div",{class:"text-sm tracking-wide text-gray-700"},"COLUMNS",-1)),c(t,{icon:"plus",onClick:a[0]||(a[0]=u=>e.value=!0)})]),l("div",Wn,[c(jn,{onEditColumn:a[1]||(a[1]=u=>[n.value,o.value]=[u,!0])})])],64)):E("",!0),e.value?(i(),V(zn,{key:1,onClose:a[2]||(a[2]=u=>e.value=!1)})):E("",!0),o.value?(i(),V(Sn,{key:2,onClose:a[3]||(a[3]=u=>o.value=!1),column:n.value},null,8,["column"])):E("",!0)])}}},Zn={class:"inline-flex w-full flex-wrap"},Xn={class:"whitespace-nowrap font-mono font-medium text-purple-700"},es={class:"flex items-center"},ts={key:0},dt={__name:"CallExpression",props:{expression:{type:Object,required:!0}},setup(r){const e=r;return(n,o)=>(i(),h("div",Zn,[l("div",Xn,P(e.expression.function),1),o[0]||(o[0]=l("div",{class:"font-mono text-purple-700"},"(",-1)),(i(!0),h(D,null,J(e.expression.arguments,(s,a)=>(i(),h("div",es,[c(Oe,{term:s},null,8,["term"]),a<e.expression.arguments.length-1?(i(),h("div",ts,",Â ")):E("",!0)]))),256)),o[1]||(o[1]=l("div",{class:"font-mono text-purple-700"},")",-1))]))}},os={key:2,class:"w-fit"},ls={key:3,class:"w-fit"},ns={key:4,class:"w-fit"},Oe={__name:"ExpressionTerm",props:{term:{type:Object,required:!0}},setup(r){const e=r,n=e.term.type,o=e.term.value;return(s,a)=>{const t=R("Tooltip");return d(n)=="BinaryExpression"?(i(),V(pt,{key:0,expression:e.term},null,8,["expression"])):d(n)=="CallExpression"?(i(),V(dt,{key:1,expression:e.term},null,8,["expression"])):d(n)=="Column"?(i(),h("p",os,[c(t,{text:d(o).table},{default:O(()=>[l("span",null,P(d(o).column),1)]),_:1},8,["text"])])):d(n)=="String"?(i(),h("p",ls,P(d(o)),1)):d(n)=="Number"?(i(),h("p",ns,P(d(o)),1)):E("",!0)}}},ss={class:"inline-flex w-full flex-wrap items-baseline"},as={class:"whitespace-nowrap text-sm font-medium text-green-600"},pt={__name:"BinaryExpression",props:{expression:{type:Object,required:!0}},setup(r){const e=r;return(n,o)=>(i(),h("div",ss,[c(Oe,{term:e.expression.left},null,8,["term"]),o[0]||(o[0]=l("span",{class:"w-2"},null,-1)),l("p",as,P(e.expression.operator),1),o[1]||(o[1]=l("span",{class:"w-2"},null,-1)),c(Oe,{term:e.expression.right},null,8,["term"])]))}},rs={__name:"Expression",props:{expression:{type:Object,required:!0,validate:r=>r.type==="BinaryExpression"||r.type==="CallExpression"}},emits:["edit","remove"],setup(r){var t,u;let n=z(d(r.expression));const o=b=>b.type=="String"||b.type=="Number",s=n.type=="BinaryExpression"&&n.left.type=="Column"&&o(n.right)||n.type=="CallExpression"&&n.arguments[0].type=="Column"&&n.arguments.slice(1).every(o),a=B("query");if(s){const b=a.filters.convertIntoSimpleFilter(n);b&&(n=z({type:"BinaryExpression",left:{type:"Column",value:{table:(t=b.column)==null?void 0:t.table_label,column:(u=b.column)==null?void 0:u.label}},operator:b.operator.label,right:{type:"String",value:b.value.label}}))}return(b,m)=>{const _=R("FeatherIcon");return i(),h("div",{class:"group relative flex w-full max-w-fit cursor-pointer items-center rounded border p-2 pr-6 hover:border-gray-300",onClick:m[1]||(m[1]=L(f=>b.$emit("edit"),["prevent","stop"]))},[d(n).type=="BinaryExpression"?(i(),V(pt,{key:0,expression:d(n)},null,8,["expression"])):d(n).type=="CallExpression"?(i(),V(dt,{key:1,expression:d(n)},null,8,["expression"])):E("",!0),c(_,{name:"x",class:"absolute right-1.5 h-3 w-3 self-center text-gray-600 hover:text-gray-700",onClick:m[0]||(m[0]=L(f=>b.$emit("remove"),["prevent","stop"]))})])}}},is={class:"relative flex w-full"},us={class:"z-[5] flex w-full items-center"},cs={class:"flex flex-1 flex-col space-y-2"},ds={class:"absolute top-0 left-0 z-0 h-full w-full"},ps={width:"100%",height:"100%",class:"text-gray-400"},ms={__name:"LogicalExpression",props:{expression:{type:Object,required:!0,validate:r=>r.type==="LogicalExpression"}},emits:["add-filter","edit-filter","remove-filter","toggle-operator"],setup(r){const e=r,n=A(()=>e.expression.level),o=A(()=>e.expression.position),s=A(()=>e.expression.operator),a=A(()=>e.expression.conditions);Me(()=>{q(()=>e.expression,()=>ne(()=>_()),{immediate:!0,deep:!0})});const t=Q(null),u=Q(null),b=Q(null),m=Q([]);function _(){var y;!b.value||!u.value||!t.value||!((y=m.value)!=null&&y.length)||(b.value.innerHTML="",m.value.forEach(v=>{f(t.value,v)}),f(t.value,u.value,!0))}function f(y,v,C=!1){let x=document.createElementNS("http://www.w3.org/2000/svg","path");const w={x:y.offsetLeft+y.offsetWidth/2,y:y.offsetTop+y.offsetHeight/2},g={x:v.offsetLeft,y:v.offsetTop+v.offsetHeight/2},p=$(w,g);x.setAttribute("d",p),x.setAttribute("stroke","currentColor"),C&&x.setAttribute("stroke-dasharray","3,3"),b.value.appendChild(x)}function $(y,v){if(Math.abs(y.y-v.y)<3)return`M${y.x},${y.y} L${v.x},${v.y}`;{let C="",x=0;return y.y>v.y?(C="a5,5 0 0 1 5,-5 ",x=5):(C="a5,5 1 0 0 5,5 ",x=-5),`M${y.x},${y.y} L${y.x},${v.y+x} ${C}L${v.x},${v.y}`}}return(y,v)=>{const C=R("LogicalExpression",!0);return i(),h("div",is,[l("div",us,[l("div",{ref_key:"operatorRef",ref:t,class:"z-[5] mr-2 flex h-6 w-6 flex-shrink-0 cursor-pointer items-center justify-center rounded-full border border-gray-300 bg-white hover:border-blue-300 hover:font-normal hover:text-blue-500",onClick:v[0]||(v[0]=L(x=>y.$emit("toggle-operator",{level:n.value,position:o.value}),["prevent","stop"]))},P(s.value=="&&"?"&":"or"),513),l("div",cs,[(i(!0),h(D,null,J(a.value,(x,w)=>(i(),h("div",{key:w,ref_for:!0,ref_key:"conditionRefs",ref:m},[x.type=="LogicalExpression"?(i(),V(C,{key:0,expression:x,onAddFilter:v[1]||(v[1]=g=>y.$emit("add-filter",g)),onEditFilter:v[2]||(v[2]=g=>y.$emit("edit-filter",g)),onRemoveFilter:v[3]||(v[3]=g=>y.$emit("remove-filter",g)),onToggleOperator:v[4]||(v[4]=g=>y.$emit("toggle-operator",g))},null,8,["expression"])):(i(),V(rs,{key:1,expression:x,onEdit:g=>y.$emit("edit-filter",{condition:x,level:n.value,position:o.value,idx:w}),onRemove:g=>y.$emit("remove-filter",{level:n.value,position:o.value,idx:w})},null,8,["expression","onEdit","onRemove"]))]))),128)),l("div",{ref_key:"addConditionRef",ref:u,class:"!-mt-0.5 !-mb-2 flex h-9 cursor-pointer items-center text-sm text-gray-600 hover:text-gray-700",onClick:v[5]||(v[5]=L(x=>y.$emit("add-filter",{level:n.value,position:o.value}),["prevent","stop"]))}," + "+P(s.value=="&&"?"and":"or")+" condition ",513)])]),l("div",ds,[(i(),h("svg",ps,[l("g",{ref_key:"connectorsRef",ref:b,fill:"none"},null,512)]))])])}}},fs={class:"flex flex-col"},vs={class:"flex justify-between"},ys={class:"!mt-1 flex cursor-pointer items-center text-xs text-red-500"},_s={class:"relative h-full w-full rounded border p-1"},xs={class:"absolute bottom-1 left-1"},gs={class:"w-full pr-3 text-base"},bs={class:"mt-3 flex justify-end space-x-2"},hs={__name:"FilterExpressionPicker",props:{filter:{type:Object,default:{}}},emits:["filter-select","close"],setup(r,{emit:e}){var f;const n=B("query"),o=e,s=r,a=A(()=>n.filters.editFilterAt.idx!==-1),t=Q(((f=s.filter)==null?void 0:f.raw)||""),u=z({raw:t.value,ast:null,error:null,tokens:[],help:null});ve(()=>{u.raw=t.value;const{ast:$,tokens:y,errorMessage:v}=de(u.raw);u.ast=$,u.tokens=y,u.error=v});const b=($,y)=>{let v=$.matchBefore(/\w*/),C=y.resolveInner($.pos,-1);if(C.name==="TemplateString")return{from:v.from,options:n.columns.options.map(x=>({label:`${x.table}.${x.column}`}))};if(C.name==="VariableName")return{from:v.from,options:Object.keys(W).map(x=>({label:x}))}},m=be(function({cursorPos:$}){u.help=null;const{tokens:y}=u,v=y.filter(C=>C.start<=$-1&&C.end>=$&&C.type=="FUNCTION").at(-1);if(v){const{value:C}=v;W[C]&&(u.help=W[C])}},300),_=()=>{o("filter-select",{...u.ast,raw:u.raw,is_expression:!0})};return($,y)=>{const v=R("FeatherIcon"),C=R("Tooltip"),x=me,w=R("Button");return i(),h("div",fs,[l("div",vs,[y[1]||(y[1]=l("div",{class:"mb-1 text-sm"},"Expression",-1)),u.error?(i(),V(C,{key:0,text:u.error},{default:O(()=>[l("div",ys,[c(v,{name:"alert-circle",class:"h-4 w-4"})])]),_:1},8,["text"])):E("",!0)]),c(x,{class:"h-36 w-full text-sm",placement:"left-start"},{target:O(({open:g})=>[l("div",_s,[c(se,{modelValue:t.value,"onUpdate:modelValue":y[0]||(y[0]=p=>t.value=p),completions:b,onInputChange:g,onViewUpdate:d(m)},null,8,["modelValue","onInputChange","onViewUpdate"]),l("div",xs,[c(at)])])]),body:O(()=>[l("div",gs,[c(Ve,{"enter-active-class":"transition duration-100 ease-out","enter-from-class":"transform scale-95 opacity-0","enter-to-class":"transform scale-100 opacity-100","leave-active-class":"transition duration-75 ease-in","leave-from-class":"transform scale-100 opacity-100","leave-to-class":"transform scale-95 opacity-0"},{default:O(()=>[Z(c(rt,{info:u.help},null,8,["info"]),[[qe,u.help]])]),_:1})])]),_:1}),l("div",bs,[c(w,{variant:"solid",onClick:_,disabled:!!u.error},{default:O(()=>[I(P(a.value?"Update":"Add "),1)]),_:1},8,["disabled"])])])}}},ws={class:"flex flex-col space-y-3"},$s={class:"space-y-1 text-sm text-gray-700"},ks={class:"space-y-1 text-sm text-gray-700"},Cs={class:"space-y-1 text-sm text-gray-700"},Ts={class:"flex justify-end"},Os={__name:"SimpleFilterPicker",props:{filter:{type:Object,default:{column:{},operator:{},value:{}}}},emits:["filter-select"],setup(r,{emit:e}){const n=B("query"),o=r,s=e,a={column:{},operator:{},value:{}};let t=z(a);if(o.filter&&o.filter.type){const p=n.filters.convertIntoSimpleFilter(o.filter);t=z(p)}const u=n.columns.options,b=A(()=>{var p;return Ke((p=t.column)==null?void 0:p.type)}),m=A(()=>{var p,k;return["Date","Datetime"].includes((p=t.column)==null?void 0:p.type)&&["=","!=",">",">=","<","<=","between"].includes((k=t.operator)==null?void 0:k.value)}),_=A(()=>{var p,k;return["Date","Datetime"].includes((p=t.column)==null?void 0:p.type)&&((k=t.operator)==null?void 0:k.value)==="timespan"}),f=A(()=>{var p,k;return["in","not_in"].includes((p=t.operator)==null?void 0:p.value)&&((k=t.column)==null?void 0:k.type)=="String"}),$=A(()=>{var p,k;return["=","!=","is"].includes((p=t.operator)==null?void 0:p.value)&&((k=t.column)==null?void 0:k.type)=="String"}),y=A(()=>{var p,k;return((p=t.operator)==null?void 0:p.value)=="is"?[{label:"Set",value:"set"},{label:"Not Set",value:"not set"}]:(k=n.fetchColumnValues.data)==null?void 0:k.message}),v=A(()=>{var p,k,T;return m.value?"Select a date...":te(t.operator)?"Type a value...":((p=t.operator)==null?void 0:p.value)=="between"?"Type two comma separated values...":((k=t.operator)==null?void 0:k.value)=="in"||((T=t.operator)==null?void 0:T.value)=="not_in"?"Select one or more values...":"Type a value..."}),C=A(()=>te(t.column,t.operator,t.value));q(()=>t.column,p=>{t.column=p,t.operator={},t.value={}}),q(()=>t.operator,p=>{t.operator=p,t.value={}});function x(p){return Array.isArray(p)?{value:p.map(k=>k.hasOwnProperty("value")?k.value:k),label:p.length>1?p.length+" values":p.length>0?p[0].value||p[0]:""}:{value:[],label:""}}function w(){C.value||(f.value?t.value=x(t.value.value):m.value&&(t.value={value:t.value.value,label:re(t.value.value)}),s("filter-select",n.filters.convertIntoExpression(t)),Object.assign(t,a))}const g=be(function(p=""){var k,T;te(t.column)||!["=","!=","in","not_in"].includes((k=t.operator)==null?void 0:k.value)||((T=t.column)==null?void 0:T.type)=="String"&&n.fetchColumnValues.submit({column:t.column,search_text:p})},300);return q(()=>{var p;return{shouldFetch:f.value||$.value,columnChanged:(p=t.column)==null?void 0:p.value}},({shouldFetch:p,columnChanged:k})=>{var S,F;const T=(S=n.fetchColumnValues.data)==null?void 0:S.message;k&&(T!=null&&T.length)&&(n.fetchColumnValues.data.message=[]),p&&k&&!((F=y.value)!=null&&F.length)&&g()},{immediate:!0}),(p,k)=>{const T=G,S=R("Input"),F=R("Button");return i(),h("div",ws,[l("div",$s,[k[8]||(k[8]=l("div",{class:""},"Column",-1)),c(T,{modelValue:d(t).column,"onUpdate:modelValue":k[0]||(k[0]=N=>d(t).column=N),options:d(u),placeholder:"Select a column..."},null,8,["modelValue","options"])]),l("div",ks,[k[9]||(k[9]=l("div",{class:""},"Operator",-1)),c(T,{modelValue:d(t).operator,"onUpdate:modelValue":k[1]||(k[1]=N=>d(t).operator=N),options:b.value,placeholder:"Select operator..."},null,8,["modelValue","options"])]),l("div",Cs,[k[10]||(k[10]=l("div",{class:""},"Value",-1)),$.value?(i(),V(T,{key:0,modelValue:d(t).value,"onUpdate:modelValue":k[2]||(k[2]=N=>d(t).value=N),options:y.value,placeholder:v.value,"onUpdate:query":d(g),loading:d(n).fetchColumnValues.loading},null,8,["modelValue","options","placeholder","onUpdate:query","loading"])):_.value?(i(),V(to,{key:1,id:"value",modelValue:d(t).value,"onUpdate:modelValue":k[3]||(k[3]=N=>d(t).value=N),placeholder:v.value},null,8,["modelValue","placeholder"])):f.value?(i(),V(no,{key:2,value:d(t).value.value,onChange:k[4]||(k[4]=N=>{d(t).value.value||(d(t).value={value:null,label:null}),d(t).value.value=N}),options:y.value,placeholder:v.value,onInputChange:d(g),loading:d(n).fetchColumnValues.loading},null,8,["value","options","placeholder","onInputChange","loading"])):m.value&&d(t).operator.value==="between"?(i(),V(oo,{key:3,id:"value",value:d(t).value.value,placeholder:v.value,formatter:d(re),onChange:k[5]||(k[5]=N=>{d(t).value={value:N,label:d(re)(N)}})},null,8,["value","placeholder","formatter"])):m.value?(i(),V(eo,{key:4,id:"value",value:d(t).value.value,placeholder:v.value,formatter:d(re),onChange:k[6]||(k[6]=N=>{d(t).value={value:N,label:d(re)(N)}})},null,8,["value","placeholder","formatter"])):(i(),V(S,{key:5,type:"text",modelValue:d(t).value.value,"onUpdate:modelValue":k[7]||(k[7]=N=>d(t).value.value=N),placeholder:v.value},null,8,["modelValue","placeholder"]))]),l("div",Ts,[c(F,{onClick:w,variant:"solid",disabled:C.value},{default:O(()=>k[11]||(k[11]=[I(" Apply ")])),_:1},8,["disabled"])])])}}},Es={class:"flex w-full flex-shrink-0 items-center bg-white pb-2"},Vs={class:"text-sm tracking-wide text-gray-700"},As={class:"flex flex-1 flex-col space-y-3 overflow-y-scroll"},Ss={class:"flex h-9 flex-shrink-0 items-center space-x-2 rounded bg-gray-100 p-1 text-sm"},Rs={__name:"FilterPicker",props:["filter"],emits:["filter-select","close"],setup(r){var s;const e=r,n=Q(!!e.filter),o=Q((s=e.filter)!=null&&s.is_expression?"expression":"simple");return(a,t)=>{const u=R("Button");return i(),h(D,null,[l("div",Es,[c(u,{icon:"chevron-left",class:"mr-2",onClick:t[0]||(t[0]=b=>a.$emit("close"))}),l("div",Vs,P(n.value?"EDIT":"ADD")+" FILTER",1)]),l("div",As,[l("div",Ss,[l("div",{class:X(["flex h-full flex-1 items-center justify-center rounded",{"bg-white font-normal shadow":o.value=="simple"}]),onClick:t[1]||(t[1]=L(b=>o.value="simple",["prevent","stop"]))}," Simple ",2),l("div",{class:X(["flex h-full flex-1 items-center justify-center rounded",{" bg-white font-normal shadow":o.value=="expression"}]),onClick:t[2]||(t[2]=L(b=>o.value="expression",["prevent","stop"]))}," Expression ",2)]),o.value=="simple"?(i(),V(Os,{key:0,filter:e.filter,onFilterSelect:t[3]||(t[3]=b=>a.$emit("filter-select",b))},null,8,["filter"])):E("",!0),o.value=="expression"?(i(),V(hs,{key:1,filter:e.filter,onFilterSelect:t[4]||(t[4]=b=>a.$emit("filter-select",b))},null,8,["filter"])):E("",!0)])],64)}}},Qs={class:"flex flex-1 flex-shrink-0 flex-col overflow-hidden"},Ps={key:0,class:"flex w-full flex-shrink-0 items-center justify-between bg-white pb-2"},Fs={key:1,class:"flex h-full w-full items-center justify-center rounded border-2 border-dashed border-gray-200 text-sm text-gray-600"},Us={key:2,class:"h-full w-full overflow-scroll"},Bs={__name:"FilterPanel",setup(r){const e=Q(!1),n=B("query"),o=A(()=>n.filters.data||{}),s=Q(null),a=({condition:m,level:_,position:f,idx:$})=>{e.value=!0,m?(s.value=m,n.filters.editFilterAt.level=_,n.filters.editFilterAt.position=f,n.filters.editFilterAt.idx=$):(s.value=null,n.filters.addNextFilterAt.level=_,n.filters.addNextFilterAt.position=f)};function t(m){s.value?n.filters.edit(m):n.filters.add(m),s.value=null,e.value=!1}function u({level:m,position:_,idx:f}){n.filters.remove(m,_,f)}function b({level:m,position:_}){n.filters.toggleOperator(m,_)}return(m,_)=>{var $;const f=R("Button");return i(),h("div",Qs,[e.value?E("",!0):(i(),h("div",Ps,[_[2]||(_[2]=l("div",{class:"text-sm tracking-wide text-gray-700"},"FILTERS",-1)),c(f,{icon:"plus",onClick:_[0]||(_[0]=y=>e.value=!0)})])),!e.value&&(!o.value.conditions||o.value.conditions.length==0)?(i(),h("div",Fs,_[3]||(_[3]=[l("p",null,"No filters added",-1)]))):!e.value&&(($=o.value.conditions)==null?void 0:$.length)>0?(i(),h("div",Us,[(i(),V(ms,{key:JSON.stringify(o.value),expression:o.value,onAddFilter:a,onEditFilter:a,onRemoveFilter:u,onToggleOperator:b},null,8,["expression"]))])):e.value?(i(),V(Rs,{key:3,onClose:_[1]||(_[1]=y=>e.value=!1),onFilterSelect:t,filter:s.value},null,8,["filter"])):E("",!0)])}}},Is={class:"flex h-full flex-1 items-center justify-between rounded-b-md px-1 text-base text-gray-600"},Ns={key:0,class:"flex items-center space-x-1 text-gray-900"},Ds={class:"font-mono"},Ls={class:"font-mono"},js={class:"font-mono"},qs={class:"ml-auto space-x-1"},Ms=["size"],Gs={__name:"LimitsAndOrder",setup(r){const e=B("query"),n=A(()=>e.doc.execution_time),o=A(()=>e.doc.results_row_count),s=A(()=>Math.min(e.MAX_ROWS,o.value)),a=Q(e.doc.limit);return A(()=>e.doc.columns.filter(t=>t.order_by).map(t=>({column:t.label,order:t.order_by}))),(t,u)=>(i(),h("div",Is,[o.value>=0?(i(),h("div",Ns,[u[3]||(u[3]=l("span",{class:"text-gray-600"},"Showing",-1)),l("span",Ds,P(s.value),1),u[4]||(u[4]=l("span",{class:"text-gray-600"},"out of",-1)),l("span",Ls,P(o.value),1),u[5]||(u[5]=l("span",{class:"text-gray-600"},"rows in",-1)),l("span",js,P(n.value),1),u[6]||(u[6]=l("span",{class:"text-gray-600"},"seconds",-1))])):E("",!0),l("div",qs,[u[7]||(u[7]=l("span",null,"Limit to",-1)),Z(l("input",{type:"text",ref:"limitInput","onUpdate:modelValue":u[0]||(u[0]=b=>a.value=b),size:String(a.value).length,class:"form-input border-gray-400 pr-1 placeholder-gray-500",onKeydown:[u[1]||(u[1]=Re(L(()=>{d(e).setLimit.submit({limit:parseInt(a.value)}),t.$refs.limitInput.blur()},["stop"]),["enter"])),u[2]||(u[2]=Re(L(b=>t.$refs.limitInput.blur(),["stop"]),["esc"]))]},null,40,Ms),[[ue,a.value,void 0,{number:!0}]]),u[8]||(u[8]=l("span",null,"rows",-1))])]))}},Hs={},zs={xmlns:"http://www.w3.org/2000/svg",height:"20",width:"20"};function Js(r,e){return i(),h("svg",zs,e[0]||(e[0]=[l("path",{strokeWidth:"1",fill:"currentColor",d:"M6.667 15.833Q4.229 15.833 2.531 14.135Q0.833 12.438 0.833 10Q0.833 7.562 2.531 5.865Q4.229 4.167 6.667 4.167Q7.188 4.167 7.594 4.25Q8 4.333 8.333 4.5Q7.333 5.292 6.771 6.75Q6.208 8.208 6.208 10Q6.208 11.792 6.771 13.25Q7.333 14.708 8.333 15.5Q8 15.667 7.594 15.75Q7.188 15.833 6.667 15.833ZM10 14.792Q8.958 14.792 8.25 13.406Q7.542 12.021 7.542 10Q7.542 7.979 8.25 6.594Q8.958 5.208 10 5.208Q11.042 5.208 11.75 6.594Q12.458 7.979 12.458 10Q12.458 12.021 11.75 13.406Q11.042 14.792 10 14.792ZM13.333 15.833Q12.875 15.833 12.448 15.76Q12.021 15.688 11.604 15.562Q11.958 15.292 12.292 14.865Q12.625 14.438 12.854 14.042Q12.979 14.062 13.094 14.073Q13.208 14.083 13.333 14.083Q15.021 14.083 16.219 12.885Q17.417 11.688 17.417 10Q17.417 8.312 16.219 7.115Q15.021 5.917 13.333 5.917Q13.208 5.917 13.094 5.927Q12.979 5.938 12.854 5.958Q12.625 5.562 12.292 5.135Q11.958 4.708 11.604 4.438Q12.021 4.312 12.448 4.24Q12.875 4.167 13.333 4.167Q15.75 4.167 17.458 5.875Q19.167 7.583 19.167 10Q19.167 12.417 17.458 14.125Q15.75 15.833 13.333 15.833Z"},null,-1)]))}const mt=pe(Hs,[["render",Js]]),Ks={},Ws={xmlns:"http://www.w3.org/2000/svg",height:"20",width:"20"};function Ys(r,e){return i(),h("svg",Ws,e[0]||(e[0]=[l("path",{strokeWidth:"1",fill:"currentColor",d:"M13.333 15.833Q12.812 15.833 12.406 15.75Q12 15.667 11.667 15.5Q12.667 14.708 13.229 13.25Q13.792 11.792 13.792 10Q13.792 8.208 13.229 6.75Q12.667 5.292 11.667 4.5Q12 4.333 12.406 4.25Q12.812 4.167 13.333 4.167Q15.771 4.167 17.469 5.865Q19.167 7.562 19.167 10Q19.167 12.438 17.469 14.135Q15.771 15.833 13.333 15.833ZM10 14.792Q8.958 14.792 8.25 13.406Q7.542 12.021 7.542 10Q7.542 7.979 8.25 6.594Q8.958 5.208 10 5.208Q11.042 5.208 11.75 6.594Q12.458 7.979 12.458 10Q12.458 12.021 11.75 13.406Q11.042 14.792 10 14.792ZM6.667 15.833Q4.25 15.833 2.542 14.125Q0.833 12.417 0.833 10Q0.833 7.583 2.542 5.875Q4.25 4.167 6.667 4.167Q7.125 4.167 7.552 4.24Q7.979 4.312 8.396 4.438Q8.042 4.708 7.708 5.135Q7.375 5.562 7.146 5.958Q7.021 5.938 6.906 5.927Q6.792 5.917 6.667 5.917Q4.979 5.917 3.781 7.115Q2.583 8.312 2.583 10Q2.583 11.688 3.781 12.885Q4.979 14.083 6.667 14.083Q6.792 14.083 6.906 14.073Q7.021 14.062 7.146 14.042Q7.375 14.438 7.708 14.865Q8.042 15.292 8.396 15.562Q7.979 15.688 7.552 15.76Q7.125 15.833 6.667 15.833Z"},null,-1)]))}const ft=pe(Ks,[["render",Ys]]),Zs={},Xs={xmlns:"http://www.w3.org/2000/svg",height:"20",width:"20"};function ea(r,e){return i(),h("svg",Xs,e[0]||(e[0]=[l("path",{strokeWidth:"1",fill:"currentColor",d:"M13.333 15.833Q12.875 15.833 12.448 15.76Q12.021 15.688 11.604 15.562Q11.958 15.292 12.292 14.865Q12.625 14.438 12.854 14.042Q12.979 14.062 13.094 14.073Q13.208 14.083 13.333 14.083Q15.021 14.083 16.219 12.885Q17.417 11.688 17.417 10Q17.417 8.312 16.219 7.115Q15.021 5.917 13.333 5.917Q13.208 5.917 13.094 5.927Q12.979 5.938 12.854 5.958Q12.625 5.562 12.292 5.135Q11.958 4.708 11.604 4.438Q12.021 4.312 12.448 4.24Q12.875 4.167 13.333 4.167Q15.75 4.167 17.458 5.875Q19.167 7.583 19.167 10Q19.167 12.417 17.458 14.125Q15.75 15.833 13.333 15.833ZM10 14.792Q8.958 14.792 8.25 13.406Q7.542 12.021 7.542 10Q7.542 7.979 8.25 6.594Q8.958 5.208 10 5.208Q11.042 5.208 11.75 6.594Q12.458 7.979 12.458 10Q12.458 12.021 11.75 13.406Q11.042 14.792 10 14.792ZM6.667 15.833Q4.25 15.833 2.542 14.125Q0.833 12.417 0.833 10Q0.833 7.583 2.542 5.875Q4.25 4.167 6.667 4.167Q7.125 4.167 7.552 4.24Q7.979 4.312 8.396 4.438Q8.042 4.708 7.708 5.135Q7.375 5.562 7.146 5.958Q7.021 5.938 6.906 5.927Q6.792 5.917 6.667 5.917Q4.979 5.917 3.781 7.115Q2.583 8.312 2.583 10Q2.583 11.688 3.781 12.885Q4.979 14.083 6.667 14.083Q6.792 14.083 6.906 14.073Q7.021 14.062 7.146 14.042Q7.375 14.438 7.708 14.865Q8.042 15.292 8.396 15.562Q7.979 15.688 7.552 15.76Q7.125 15.833 6.667 15.833Z"},null,-1)]))}const vt=pe(Zs,[["render",ea]]),ta={},oa={xmlns:"http://www.w3.org/2000/svg",height:"20",width:"20"};function la(r,e){return i(),h("svg",oa,e[0]||(e[0]=[l("path",{strokeWidth:"1",fill:"currentColor",d:"M13.333 15.833Q12.812 15.833 12.406 15.75Q12 15.667 11.667 15.5Q12.667 14.708 13.229 13.25Q13.792 11.792 13.792 10Q13.792 8.208 13.229 6.75Q12.667 5.292 11.667 4.5Q12 4.333 12.406 4.25Q12.812 4.167 13.333 4.167Q15.771 4.167 17.469 5.865Q19.167 7.562 19.167 10Q19.167 12.438 17.469 14.135Q15.771 15.833 13.333 15.833ZM10 14.792Q8.958 14.792 8.25 13.406Q7.542 12.021 7.542 10Q7.542 7.979 8.25 6.594Q8.958 5.208 10 5.208Q11.042 5.208 11.75 6.594Q12.458 7.979 12.458 10Q12.458 12.021 11.75 13.406Q11.042 14.792 10 14.792ZM6.667 15.833Q4.229 15.833 2.531 14.135Q0.833 12.438 0.833 10Q0.833 7.562 2.531 5.865Q4.229 4.167 6.667 4.167Q7.188 4.167 7.594 4.25Q8 4.333 8.333 4.5Q7.333 5.292 6.771 6.75Q6.208 8.208 6.208 10Q6.208 11.792 6.771 13.25Q7.333 14.708 8.333 15.5Q8 15.667 7.594 15.75Q7.188 15.833 6.667 15.833Z"},null,-1)]))}const yt=pe(ta,[["render",la]]),na={class:"relative"},De={__name:"LinkIcon",props:{link:{type:String,required:!0}},setup(r){const e=r;function n(){window.open(e.link,"_blank")}return(o,s)=>{const a=R("FeatherIcon");return i(),h("div",na,[Ge(o.$slots,"default"),e.link?(i(),h("div",{key:0,class:"absolute top-0 right-0 flex h-full w-8 cursor-pointer items-center justify-center",onClick:L(n,["prevent","stop"])},[c(a,{name:"link-2",class:"h-4 w-4 text-gray-600 hover:text-gray-800"})])):E("",!0)])}}},sa={class:"flex w-full flex-col overflow-hidden"},aa={class:"flex flex-shrink-0 items-center bg-white pb-3 pt-1"},ra={class:"flex flex-1 flex-col space-y-3 overflow-y-scroll"},ia={class:"flex flex-col space-y-3"},ua={class:"space-y-1 text-sm"},ca={class:"space-y-1 text-sm"},da={class:"space-y-1 text-sm"},pa={class:"text-sm"},ma={class:"flex items-end space-x-1"},fa={class:"flex-1"},va={class:"flex-1"},ya={class:"flex justify-end space-x-2"},_a={__name:"TableJoiner",props:{table:{type:Object,required:!0}},emits:["close"],setup(r,{emit:e}){const n=e,o=r,s=B("query"),a=Q({type:{label:"Left",value:"left"},with:{},condition:{left:{},right:{}}}),t=Q({...o.table});t.value.join&&(a.value=t.value.join);const u=Q([{label:"Inner Join",value:"inner"},{label:"Left Join",value:"left"},{label:"Full Outer Join",value:"full"}]);q(()=>a.value.with,C=>C&&_());const b=Q([]),m=Q([]);function _(){const C=t.value.table,x=a.value.with.value;!C||!x||s.fetchJoinOptions.submit({left_table:C,right_table:x}).then(({message:w})=>{f(w),w.saved_links.length&&$(w.saved_links[0])})}function f({left_columns:C,right_columns:x}){b.value=C.map(w=>({label:w.label,value:w.column})),m.value=x.map(w=>({label:w.label,value:w.column}))}function $({left:C,right:x}){a.value.condition={left:b.value.find(w=>w.value===C),right:m.value.find(w=>w.value===x)}}function y(){t.value.join=a.value,s.updateTable.submit({table:t.value}),n("close")}function v(){t.value.join="",s.updateTable.submit({table:t.value}),n("close")}return(C,x)=>{var k,T;const w=R("Button"),g=R("Input"),p=G;return i(),h("div",sa,[l("div",aa,[c(w,{icon:"chevron-left",class:"mr-2",onClick:x[0]||(x[0]=S=>C.$emit("close"))}),x[6]||(x[6]=l("div",{class:"text-sm tracking-wide text-gray-700"},"JOIN",-1))]),l("div",ra,[l("div",ia,[l("div",ua,[x[7]||(x[7]=l("div",{class:"text-gray-700"},"Left Table",-1)),c(De,{link:d(Qe)(t.value.table),show:t.value.label},{default:O(()=>[c(g,{modelValue:t.value.label,"onUpdate:modelValue":x[1]||(x[1]=S=>t.value.label=S),disabled:"",class:"cursor-not-allowed"},null,8,["modelValue"])]),_:1},8,["link","show"])]),l("div",ca,[x[8]||(x[8]=l("div",{class:"text-gray-700"},"Join Type",-1)),c(p,{modelValue:a.value.type,"onUpdate:modelValue":x[2]||(x[2]=S=>a.value.type=S),options:u.value,placeholder:"Select a type..."},null,8,["modelValue","options"])]),l("div",da,[x[9]||(x[9]=l("div",{class:"text-gray-700"},"Right Table",-1)),c(De,{link:d(Qe)((k=a.value.with)==null?void 0:k.value),show:(T=a.value.with)==null?void 0:T.label},{default:O(()=>[c(p,{modelValue:a.value.with,"onUpdate:modelValue":x[3]||(x[3]=S=>a.value.with=S),options:d(s).tables.joinOptions,placeholder:"Select a table..."},null,8,["modelValue","options"])]),_:1},8,["link","show"])]),l("div",pa,[l("div",ma,[l("div",fa,[x[10]||(x[10]=l("div",{class:"mb-1 text-gray-700"},"Left Column",-1)),(i(),V(p,{key:a.value.condition.left,modelValue:a.value.condition.left,"onUpdate:modelValue":x[4]||(x[4]=S=>a.value.condition.left=S),options:b.value,placeholder:"Select a Column"},null,8,["modelValue","options"]))]),x[12]||(x[12]=l("span",{class:"flex items-center px-1 text-lg"}," = ",-1)),l("div",va,[x[11]||(x[11]=l("div",{class:"mb-1 text-gray-700"},"Right Column",-1)),(i(),V(p,{key:a.value.condition.right,modelValue:a.value.condition.right,"onUpdate:modelValue":x[5]||(x[5]=S=>a.value.condition.right=S),options:m.value,placeholder:"Select a Column"},null,8,["modelValue","options"]))])])])]),l("div",ya,[c(w,{disabled:!t.value.join,onClick:v},{default:O(()=>x[13]||(x[13]=[I(" Clear ")])),_:1},8,["disabled"]),c(w,{variant:"solid",disabled:!a.value.with||!a.value.condition||!a.value.type,onClick:y},{default:O(()=>x[14]||(x[14]=[I(" Apply ")])),_:1},8,["disabled"])])])])}}},xa={class:"flex flex-1 flex-shrink-0 flex-col overflow-hidden text-gray-900"},ga={key:0,class:"flex flex-shrink-0 items-center justify-between bg-white pb-2"},ba={key:1,class:"flex w-full flex-shrink-0 space-x-2 pb-3 pt-1"},ha={class:"flex-1"},wa={key:2,class:"flex flex-1 items-center justify-center rounded border-2 border-dashed border-gray-200 text-sm text-gray-700"},$a={key:3,class:"flex w-full flex-1 select-none flex-col divide-y overflow-y-scroll"},ka=["onClick"],Ca={class:"overflow-hidden text-ellipsis whitespace-nowrap text-base font-medium"},Ta={key:0,class:"ml-2 text-gray-700"},Oa={key:1,class:"ml-2 overflow-hidden text-ellipsis whitespace-nowrap text-base font-medium"},Ea={class:"ml-auto mr-1 overflow-hidden text-ellipsis whitespace-nowrap text-gray-700"},Va=["onClick"],Aa={__name:"TablePanel",setup(r){const e=B("query"),n=Q({}),o=Q(null),s=Q(!1),a=Q(null);q(s,m=>{n.value={},m&&e.fetchTables.submit().then(()=>{a.value.input.el.focus()})});const t=B("$notify");function u(m){s.value=!1,m!=null&&m.value&&e.addTable.submit({table:{table:m.value,label:m.label}})}function b(m){const _=e.tables.validateRemoveTable(m);if(_)return t(_);e.removeTable.submit({table:m})}return(m,_)=>{var v;const f=R("Button"),$=G,y=R("FeatherIcon");return i(),h("div",xa,[o.value?(i(),V(_a,{key:1,table:o.value,onClose:_[3]||(_[3]=C=>o.value=null)},null,8,["table"])):(i(),h(D,{key:0},[s.value?E("",!0):(i(),h("div",ga,[_[4]||(_[4]=l("div",{class:"text-sm tracking-wide text-gray-700"},"TABLES",-1)),c(f,{icon:"plus",onClick:_[0]||(_[0]=C=>s.value=!0)})])),s.value?(i(),h("div",ba,[l("div",ha,[c($,{ref_key:"tableSearch",ref:a,modelValue:n.value,"onUpdate:modelValue":[_[1]||(_[1]=C=>n.value=C),u],options:d(e).tables.newTableOptions,placeholder:"Select a table..."},null,8,["modelValue","options"])]),c(f,{icon:"x",onClick:_[2]||(_[2]=C=>s.value=!1)})])):E("",!0),((v=d(e).tables.data)==null?void 0:v.length)==0?(i(),h("div",wa,_[5]||(_[5]=[l("p",null,"No tables selected",-1)]))):(i(),h("div",$a,[(i(!0),h(D,null,J(d(e).tables.data,(C,x)=>(i(),h("div",{key:x,class:"flex h-10 w-full cursor-pointer items-center border-b text-sm last:border-0 hover:bg-gray-50",onClick:L(w=>o.value=C,["prevent","stop"])},[c(y,{name:"layout",class:"mr-2 h-[14px] w-[14px]"}),l("span",Ca,P(C.label),1),C.join?(i(),h("span",Ta,[C.join.type.value=="left"?(i(),V(mt,{key:0})):E("",!0),C.join.type.value=="right"?(i(),V(ft,{key:1})):E("",!0),C.join.type.value=="inner"?(i(),V(vt,{key:2})):E("",!0),C.join.type.value=="full"?(i(),V(yt,{key:3})):E("",!0)])):E("",!0),C.join?(i(),h("span",Oa,P(C.join.with.label),1)):E("",!0),l("span",Ea,P(d(e).doc.data_source),1),l("div",{class:"flex items-center px-1 py-0.5 text-gray-700 hover:text-gray-700",onClick:L(w=>b(C),["prevent","stop"])},[c(y,{name:"x",class:"h-3 w-3"})],8,Va)],8,ka))),128))]))],64))])}}},Sa={key:0,class:"flex h-full w-full flex-col pt-4"},Ra={class:"flex flex-1 flex-shrink-0 gap-4 overflow-y-scroll"},Qa={class:"flex w-full flex-1 flex-shrink-0 overflow-hidden rounded py-4"},Pa={__name:"ClassicQueryBuilder",setup(r){const e=B("query"),n=A(()=>{var o,s;return{title:(o=e.doc)==null?void 0:o.title,subtitle:(s=e.doc)==null?void 0:s.name}});return At(n),(o,s)=>{var a;return(a=d(e).doc)!=null&&a.name?(i(),h("div",Sa,[l("div",Ra,[c(Aa),c(Yn),c(Bs)]),l("div",Qa,[c(he,null,{footer:O(()=>[c(Gs)]),_:1})])])):E("",!0)}}},Fa={class:"min-w-[32rem]"},Ua={class:"-mt-1 flex h-[14rem] divide-x divide-gray-300 rounded rounded-t-none border border-t border-gray-300"},Ba={class:"relative flex flex-1 flex-col overflow-hidden overflow-y-auto"},Ia={class:"sticky top-0 flex-shrink-0 truncate bg-gray-50 px-2.5 py-1.5 text-sm font-medium text-gray-600"},Na=["onClick"],Da={class:"flex flex-1 items-center justify-between overflow-hidden"},La={class:"flex-1 truncate text-sm text-gray-700"},ja={key:0,class:"flex-shrink-0 text-xs text-gray-500"},qa={key:0,class:"flex h-10 items-center justify-center text-sm text-gray-500"},Ma={class:"flex flex-1 flex-col overflow-hidden pb-2"},Ga={key:0,class:"flex flex-col px-3 py-2 text-sm"},Ha={class:"mt-2 rounded bg-gray-50 p-2 text-xs leading-5"},_t={__name:"ExpressionBuilder",props:{modelValue:Object,columnOptions:Array},emits:["update:modelValue"],setup(r,{emit:e}){const n=e,o=r,s=A({get:()=>{var x;return((x=o.modelValue)==null?void 0:x.raw)||""},set:x=>n("update:modelValue",{raw:x,ast:de(x).ast})}),a=Q(!1),t=Q(null),u=Q(null),b=z({from:null,to:null,text:null});q(s,x=>{x.length||(b.from=null,b.to=null,b.text=null)});const m=function({cursorPos:x}){if(u.value=null,!s.value){b.from=null,b.to=null,b.text=null;return}const g=de(s.value).tokens.filter(p=>p.type=="FUNCTION"&&p.start<x&&p.end>=x).at(-1);if(g){const{value:p}=g;W[p]&&(u.value=W[p])}};function _(x){const w=s.value||"",g=isNaN(b.from)?t.value.cursorPos:b.from,p=isNaN(b.to)?t.value.cursorPos:b.to;if(x.suggestionType==="function"){const k=w.slice(0,g),T=w.slice(p);let S=`${x.label}`;T.trim().startsWith("(")||(S+="()"),s.value=`${k}${S}${T}`;const F=g+S.length-1;ne(()=>{t.value.focus(),t.value.setCursorPos(F)})}if(x.suggestionType==="column"){const k=w.slice(0,g),T=w.slice(p);let S=`${x.table}.${x.column}`;k.trim().endsWith("`")||(S="`"+S),T.trim().startsWith("`")||(S+="`"),s.value=`${k}${S}${T}`;const F=g+S.length;ne(()=>{t.value.focus(),t.value.setCursorPos(F)})}}const f=Object.keys(W).map(x=>({label:x,...W[x]})),$=A(()=>[...o.columnOptions.map(x=>({...x,icon:Ae[x.type],label:x.label||x.column,value:`${x.table}.${x.column}`,description:x.table_label,suggestionType:"column"})),...f.map(x=>({icon:St[x.returnType],label:x.label,value:x.label,description:x.returnType,suggestionType:"function"}))]),y=A(()=>{if(!b.text)return $.value;const x=b.text.toLowerCase();return $.value.filter(w=>{var g;return w.label.toLowerCase().includes(x)||w.value.toLowerCase().includes(x)||((g=w.description)==null?void 0:g.toLowerCase().includes(x))})}),v=A(()=>[{groupLabel:"Columns",items:y.value.filter(x=>x.suggestionType==="column")},{groupLabel:"Functions",items:y.value.filter(x=>x.suggestionType==="function")}]),C=x=>{const w=x.matchBefore(/\w*/);w&&(b.from=w.from,b.to=w.to,b.text=w.text)};return(x,w)=>{const g=He("auto-animate");return i(),h("div",Fa,[w[10]||(w[10]=l("span",{class:"mb-2 block text-sm leading-4 text-gray-700"},"Expression",-1)),l("div",{class:X(["h-fit min-h-[2.5rem] rounded rounded-b-none border border-transparent bg-gray-100 p-0 px-1 transition-all",a.value?" border border-b-0 !border-gray-300 bg-white hover:bg-transparent":""])},[c(se,{ref_key:"codeEditor",ref:t,modelValue:s.value,"onUpdate:modelValue":w[0]||(w[0]=p=>s.value=p),completions:C,placeholder:"Write an expression",onFocus:w[1]||(w[1]=p=>a.value=!0),onBlur:w[2]||(w[2]=p=>a.value=!1),onViewUpdate:m},null,8,["modelValue"])],2),l("div",Ua,[Z((i(),h("div",Ba,[(i(!0),h(D,null,J(v.value,p=>(i(),h(D,null,[l("div",Ia,P(p.groupLabel),1),(i(!0),h(D,null,J(p.items.slice(0,25),k=>(i(),h("div",{key:k.value,class:"exp-editor-suggestion flex cursor-pointer items-center rounded py-1.5 px-2 hover:bg-gray-100",onClick:L(T=>_(k),["prevent","stop"])},[(i(),V(H(k.icon),{class:"mr-1 h-4 w-4 flex-shrink-0 text-gray-600"})),l("div",Da,[l("span",La,P(k.label),1),k.description?(i(),h("span",ja,P(k.description),1)):E("",!0)])],8,Na))),128)),p.items.length==0?(i(),h("div",qa," No "+P(p.groupLabel.toLowerCase())+" found ",1)):E("",!0)],64))),256))])),[[g]]),Z((i(),h("div",Ma,[w[9]||(w[9]=l("div",{class:"flex-shrink-0 truncate bg-gray-50 px-2.5 py-1.5 text-sm font-medium text-gray-600"}," Info ",-1)),u.value?(i(),h("div",Ga,[l("p",null,P(u.value.description),1),l("div",Ha,[l("code",null,[w[3]||(w[3]=l("span",{class:"text-gray-600"},"# Syntax",-1)),w[4]||(w[4]=l("br",null,null,-1)),I(" "+P(u.value.syntax)+" ",1),w[5]||(w[5]=l("br",null,null,-1)),w[6]||(w[6]=l("br",null,null,-1)),w[7]||(w[7]=l("span",{class:"text-gray-600"},"# Example",-1)),w[8]||(w[8]=l("br",null,null,-1)),I(" "+P(u.value.example),1)])])])):E("",!0)])),[[g]])])])}}},le={table:"",column:"",label:"",type:"",alias:"",order:"",granularity:"",aggregation:"",format:{},expression:{}},xt={column:{...le},operator:{},value:{},expression:{}},gt={join_type:{label:"Inner Join",value:"inner"},left_table:{},left_column:{},right_table:{},right_column:{}},za={type:"",options:{}},Ja=(r,e)=>({variant:"warning",title:"Unable to find a relationship",message:`Please add a relationship between ${r} and ${e} manually`}),Ka=()=>({variant:"error",title:"Cannot add self as table",message:"Please select a different table"}),Wa=()=>({variant:"error",title:"Unable to reset main table",message:"Please remove all columns and joins before resetting the main table"});function Ya(r){const e=oe.DATE.includes(r.type),n=oe.NUMBER.includes(r.type);return{...le,...r,granularity:r.granularity||(e?"Month":""),aggregation:r.aggregation||(n?"sum":"")}}async function Za(r){const e=[],n=r.data_source,o=r.table;if(!o.table)return e;const a=[...r.columns.filter(t=>t.table&&t.column),...r.filters.map(t=>t.column).filter(t=>t.table&&t.column)].reduce((t,u)=>(t[u.table]=u,t),{});for(const t of Object.values(a)){if(t.table==o.table)continue;const u=await xe(o.table,t.table,n);if(u){e.push(_e(u));continue}for(const b of Object.keys(a)){if(b===t.table||b===o.table)continue;const m=await xe(b,t.table,n);if(m){e.push(_e(m));break}}}return e}function _e(r){return{...gt,left_table:{table:r.primary_table,label:r.primary_table_label},left_column:{table:r.primary_table,column:r.primary_column},right_table:{table:r.foreign_table,label:r.foreign_table_label},right_column:{table:r.foreign_table,column:r.foreign_column}}}const fe={};async function xe(r,e,n){const o=`${n}-${r}-${e}`;return fe[o]||(fe[o]=await kt("insights.api.data_sources.get_relation",{data_source:n,table_one:r,table_two:e})),fe[o]}async function Xa(r,e){const n=e.table,o=e.data_source;if(!n.table)return null;const s=await xe(n.table,r.table,o);if(s)return _e(s);for(const a of e.joins){const t=await xe(a.right_table.table,r.table,o);if(t)return _e(t)}return null}function er(r,e){return r.table.table===e.table?!0:r.joins.some(o=>o.right_table.table===e.table)}function tr(r){return(r.measures.length||r.dimensions.length)&&(r.measures.forEach(e=>{r.columns.find(n=>n.label===e.label)||r.columns.push(e)}),r.dimensions.forEach(e=>{r.columns.find(n=>n.label===e.label)||r.columns.push(e)})),r.orders.length&&r.columns.forEach(e=>{const n=r.orders.find(o=>o.label===e.label);n&&(e.order=n.order)}),r.filters.length,r.limit||(r.limit=100),{...r}}function or(r){const e=z({data_source:A(()=>r.doc.data_source),table:{},joins:[],columns:[],filters:[],calculations:[],dimensions:[],measures:[],orders:[],limit:100,transforms:A(()=>[...r.doc.transforms]),joinAssistEnabled:!0,columnOptions:[],groupedColumnOptions:[],setDataSource:o,addTable:s,resetMainTable:a,removeJoinAt:t,updateJoinAt:u,addColumns:b,removeColumnAt:m,updateColumnAt:_,moveColumn:f,addFilter:$,removeFilterAt:y,updateFilterAt:v,setOrderBy:C,setLimit:x,addTransform:w,removeTransformAt:g,updateTransformAt:p,fetchColumnOptions:be(n,500)});Me(()=>{const T=tr(r.doc.json);e.table=T.table,e.joins=T.joins,e.columns=T.columns,e.filters=T.filters,e.calculations=T.calculations,e.dimensions=T.dimensions,e.measures=T.measures,e.orders=T.orders,e.limit=T.limit}),Ee(()=>({table:e.table,joins:e.joins,columns:e.columns,filters:e.filters,calculations:e.calculations,dimensions:e.dimensions,measures:e.measures,orders:e.orders,limit:e.limit}),(T,S)=>{const F=nr(T,S);r.updateQuery(T).then(({query_updated:N})=>{N&&F&&n()})},{deep:!0,debounce:500});async function n(T=""){if(!e.data_source)return;const S=T.toLowerCase(),F=await Rt("fetch_related_tables_columns",r.doc,{search_txt:S});e.columnOptions=F.message.map(We),e.groupedColumnOptions=lr(F.message)}async function o(T){if(!(!T||r.doc.data_source))return r.changeDataSource(T)}async function s(T){if(!(T!=null&&T.table))return;if(T.table===r.doc.name)return ke(Ka());const S=e.table;if(!(S!=null&&S.table)){e.table={table:T.table,label:T.label};return}if(er(e,T))return;const F=await Xa(T,e);if(F)return e.joins.push(F);ke(Ja(S.label,T.label)),e.joins.push({...gt,left_table:{table:S.table,label:S.label},right_table:{table:T.table,label:T.label}})}function a(){if(e.joins.length||e.columns.length){ke(Wa());return}e.table={}}function t(T){e.joins.splice(T,1)}function u(T,S){e.joins.splice(T,1,S)}function b(T){const S=T.map(Ya);e.columns.push(...S),e.joinAssistEnabled&&k()}function m(T){e.columns.splice(T,1)}function _(T,S){e.columns.splice(T,1,S),e.joinAssistEnabled&&k()}function f(T,S){e.columns.splice(S,0,e.columns.splice(T,1)[0])}function $(){e.filters.push({...xt})}function y(T){e.filters.splice(T,1)}function v(T,S){e.filters.splice(T,1,S),e.joinAssistEnabled&&k()}function C(T,S){e.columns.some(F=>{if(F.label===T)return F.order=S,!0})}function x(T){T!==e.limit&&(e.limit=T)}function w(){e.transforms.push({type:"",options:{}}),r.updateTransforms(e.transforms)}function g(T){e.transforms.splice(T,1),r.updateTransforms(e.transforms)}function p(T,S){e.transforms.splice(T,1,S),r.updateTransforms(e.transforms)}async function k(){const S=(await Za(e)).filter(F=>!e.joins.some(N=>N.left_table.table===F.left_table.table&&N.right_table.table===F.right_table.table));e.joins.push(...S)}return e}function lr(r){const e=r.reduce((n,o)=>(n[o.table_label]||(n[o.table_label]=[]),n[o.table_label].push(o),n),{});return Object.entries(e).map(([n,o])=>o.length?(o.splice(0,0,{...le,table:o[0].table,column:"count",type:"Integer",label:"Count of Rows",alias:"Count of Rows",aggregation:"count"}),{group:n,items:o.map(We)}):{group:n,items:[]})}function nr(r,e){if(!e)return!0;const n=ge(r),o=ge(e);return!Qt(n,o)}function ge(r){return r?[r.table.table,...r.joins.map(n=>n.right_table.table)].filter(n=>n):[]}const sr={class:"space-y-3 text-base"},ar={class:"grid grid-cols-2 gap-4"},rr={key:0,class:"col-span-1 space-y-1"},ir={class:"flex flex-col justify-end gap-2 lg:flex-row"},ur={__name:"ColumnExpressionEditor",props:{column:Object},emits:["save","remove"],setup(r,{emit:e}){const n={...le,expression:{raw:"",ast:{}}},o=B("assistedQuery"),s=e,t=r.column||n,u=z({...le,...t});u.expression||(u.expression={...n.expression});const b=A(()=>!(!u.label||!u.type||!u.expression.raw)),m=A(()=>{const f=ge(o);return o.columnOptions.filter($=>f.includes($.table))||[]});function _(){b.value&&s("save",{...u,label:u.label.trim(),type:u.type.trim(),expression:{raw:u.expression.raw,ast:de(u.expression.raw).ast}})}return(f,$)=>{const y=R("FormControl"),v=G,C=R("Button");return i(),h("div",sr,[c(_t,{modelValue:u.expression,"onUpdate:modelValue":$[0]||($[0]=x=>u.expression=x),columnOptions:m.value},null,8,["modelValue","columnOptions"]),l("div",ar,[c(y,{type:"text",label:"Label",class:"col-span-1",modelValue:u.label,"onUpdate:modelValue":$[1]||($[1]=x=>u.label=x),placeholder:"Label",autocomplete:"off"},null,8,["modelValue"]),c(y,{label:"Type",type:"select",class:"col-span-1",modelValue:u.type,"onUpdate:modelValue":$[2]||($[2]=x=>u.type=x),options:d(Pt)},null,8,["modelValue","options"]),d(oe).DATE.includes(u.type)?(i(),h("div",rr,[$[5]||($[5]=l("span",{class:"mb-2 block text-sm leading-4 text-gray-700"},"Date Format",-1)),c(v,{modelValue:u.granularity,placeholder:"Date Format",options:d(Ye),"onUpdate:modelValue":$[3]||($[3]=x=>u.granularity=x.value)},null,8,["modelValue","options"])])):E("",!0)]),l("div",ir,[c(C,{variant:"outline",theme:"red",onClick:$[4]||($[4]=x=>s("remove"))},{default:O(()=>$[6]||($[6]=[I("Remove")])),_:1}),c(C,{variant:"solid",disabled:!b.value,onClick:_},{default:O(()=>$[7]||($[7]=[I(" Save ")])),_:1},8,["disabled"])])])}}},cr={class:"flex w-full items-center overflow-hidden"},dr={key:0,class:"flex w-full items-center space-x-1.5 truncate"},pr={key:1,class:"text-gray-600"},mr={class:"flex items-center space-x-2"},Le={__name:"ColumnListItem",props:["column","isActive"],emits:["edit-column","remove-column"],setup(r){function e(n){var s;const o=(s=n.expression)==null?void 0:s.raw;return n.label&&n.type&&(o||n.table&&n.column)}return(n,o)=>(i(),h("div",{class:X(["group relative flex h-8 flex-1 cursor-pointer items-center justify-between overflow-hidden rounded border border-gray-300 bg-white px-2 pl-2.5 hover:shadow",r.isActive?"border-gray-500 bg-white shadow-sm ring-1 ring-gray-400":""]),onClick:o[1]||(o[1]=L(s=>n.$emit("edit-column",r.column),["prevent","stop"]))},[o[2]||(o[2]=l("div",{class:"absolute left-0 h-full w-1 flex-shrink-0 bg-blue-500"},null,-1)),l("div",cr,[e(r.column)?(i(),h("div",dr,[(i(),V(H(d(Ae)[r.column.type]),{class:"h-4 w-4 text-gray-600"})),l("div",null,P(r.column.label),1)])):(i(),h("div",pr,"Select a column"))]),l("div",mr,[c(d(we),{class:"invisible h-4 w-4 text-gray-600 transition-all hover:text-gray-800 group-hover:visible",onClick:o[0]||(o[0]=L(s=>n.$emit("remove-column",r.column),["prevent","stop"]))})])],2))}},fr={class:"flex items-center justify-between"},vr={class:"flex items-center space-x-1.5"},yr={class:"flex items-baseline"},_r={class:"cursor-pointer font-medium"},xr={key:1,class:"font-medium"},ae={__name:"SectionHeader",props:["title","info","icon"],setup(r){return(e,n)=>{const o=R("Tooltip");return i(),h("div",fr,[l("div",vr,[(i(),V(H(r.icon),{class:"h-4 w-4 text-gray-600"})),r.info?(i(),V(o,{key:0,text:r.info,bodyClasses:"!max-w-[8rem] !text-left ml-1",placement:"right"},{default:O(()=>[l("div",yr,[l("p",_r,P(r.title),1),n[0]||(n[0]=l("span",{class:"ml-1.5 font-mono text-xs text-gray-600"}," i ",-1))])]),_:1},8,["text"])):(i(),h("p",xr,P(r.title),1))]),Ge(e.$slots,"default")])}}},gr={class:"flex flex-col gap-4 p-4"},br={class:"space-y-1"},hr={class:"space-y-1"},wr={class:"space-y-1"},$r={key:0,class:"space-y-1"},kr={class:"flex justify-between"},Cr={class:"flex gap-2"},Tr={__name:"SimpleColumnEditor",props:{column:Object},emits:["save","discard","remove"],setup(r,{emit:e}){const n=e,o=r,s=B("assistedQuery");B("query");const a=z({...le,...o.column});a.table&&a.column&&!a.value&&(a.value=`${a.table}.${a.column}`),a.aggregation||(a.aggregation="group by");function t(m){const _={...m};a.table=_.table,a.table_label=_.table_label,a.column=_.column,a.label=_.label,a.alias=_.label,a.type=_.type,a.value=_.value}const u=A(()=>!a.label||!a.type?!1:!!(a.table&&a.column));function b(m){a.aggregation=m.value,["count","sum","avg","cumulative sum","cumulative count","distinct","distinct_count","min","max"].includes(m.value)&&(a.type="Decimal")}return(m,_)=>{const f=G,$=R("FormControl"),y=R("Button");return i(),h("div",gr,[l("div",br,[_[6]||(_[6]=l("span",{class:"text-sm font-medium text-gray-700"},"Aggregation",-1)),c(f,{modelValue:a.aggregation.toLowerCase(),placeholder:"Aggregation",options:d(Ft),"onUpdate:modelValue":b},null,8,["modelValue","options"])]),l("div",hr,[_[7]||(_[7]=l("span",{class:"text-sm font-medium text-gray-700"},"Column",-1)),c(f,{modelValue:a,bodyClasses:"w-[18rem]",placeholder:"Column","onUpdate:modelValue":t,options:d(s).groupedColumnOptions,"onUpdate:query":d(s).fetchColumnOptions},null,8,["modelValue","options","onUpdate:query"])]),l("div",wr,[_[8]||(_[8]=l("span",{class:"text-sm font-medium text-gray-700"},"Label",-1)),c($,{type:"text",class:"w-full",modelValue:a.label,"onUpdate:modelValue":[_[0]||(_[0]=v=>a.label=v),_[1]||(_[1]=v=>a.alias=v)],placeholder:"Label"},null,8,["modelValue"])]),d(oe).DATE.includes(a.type)?(i(),h("div",$r,[_[9]||(_[9]=l("span",{class:"text-sm font-medium text-gray-700"},"Date Format",-1)),c(f,{modelValue:a.granularity,placeholder:"Date Format",options:d(Ye),"onUpdate:modelValue":_[2]||(_[2]=v=>a.granularity=v.value)},null,8,["modelValue","options"])])):E("",!0),l("div",kr,[c(y,{variant:"outline",onClick:_[3]||(_[3]=v=>n("discard"))},{default:O(()=>_[10]||(_[10]=[I(" Discard ")])),_:1}),l("div",Cr,[c(y,{variant:"outline",theme:"red",onClick:_[4]||(_[4]=v=>n("remove"))},{default:O(()=>_[11]||(_[11]=[I("Remove")])),_:1}),c(y,{variant:"solid",disabled:!u.value,onClick:_[5]||(_[5]=v=>n("save",a))},{default:O(()=>_[12]||(_[12]=[I(" Save ")])),_:1},8,["disabled"])])])])}}},Or={class:"space-y-2"},Er={key:0},Vr={key:0,class:"ml-2 w-[20rem] rounded-lg border border-gray-100 bg-white text-base shadow-xl"},Ar={class:"bg-white px-4 pb-6 pt-5 sm:px-6"},Sr={class:"flex items-center justify-between pb-4"},Rr={__name:"ColumnSection",setup(r){B("query");const e=B("assistedQuery");!e.columnOptions.length&&e.fetchColumnOptions();const n=A({get:()=>e.columns,set:f=>e.columns=f});Q(null);const o=Q(null),s=A(()=>{if(o.value===null)return!1;const f=n.value[o.value];return t(f)}),a=A(()=>o.value===null?!1:!s.value);function t(f){return f.expression.hasOwnProperty("raw")||f.expression.hasOwnProperty("ast")}function u(f){!f||n.value.find(y=>y.table===f.table&&y.column===f.column&&y.label===f.label)||e.addColumns([f])}function b(){e.removeColumnAt(o.value),o.value=null}function m(f){e.updateColumnAt(o.value,f),o.value=null}function _(){e.addColumns([{...le,expression:{raw:"",ast:{}}}]),ne(()=>{o.value=n.value.length-1})}return(f,$)=>{const y=R("Button"),v=G,C=me,x=R("Dialog");return i(),h(D,null,[l("div",Or,[c(ae,{title:"Columns",icon:d(Yt),info:"Select the columns you want to see in the results."},{default:O(()=>[c(v,{modelValue:n.value,bodyClasses:"w-[18rem]","onUpdate:modelValue":u,options:d(e).groupedColumnOptions,"onUpdate:query":d(e).fetchColumnOptions},{target:O(({togglePopover:w})=>[c(y,{variant:"outline",icon:"plus",onClick:w},null,8,["onClick"])]),footer:O(({togglePopover:w})=>[c(y,{class:"w-full",variant:"ghost",iconLeft:"plus",onClick:g=>_()||w()},{default:O(()=>$[3]||($[3]=[I(" Custom Expression ")])),_:2},1032,["onClick"])]),_:1},8,["modelValue","options","onUpdate:query"])]),_:1},8,["icon"]),n.value.length?(i(),V(so,{key:0,items:n.value,"onUpdate:items":$[1]||($[1]=w=>n.value=w),group:"columns","item-key":"label",showEmptyState:!0,showHandle:!1},{item:O(({item:w,index:g})=>[t(w)?(i(),h("div",Er,[c(Le,{column:w,isActive:o.value===g,onEditColumn:p=>o.value=g,onRemoveColumn:p=>d(e).removeColumnAt(g)},null,8,["column","isActive","onEditColumn","onRemoveColumn"])])):(i(),V(C,{key:1,show:a.value&&o.value===g,onClose:p=>o.value===g?o.value=null:null,placement:"right-start"},{target:O(({togglePopover:p})=>[c(Le,{column:w,isActive:o.value===g,onEditColumn:k=>o.value=g,onRemoveColumn:k=>d(e).removeColumnAt(g)},null,8,["column","isActive","onEditColumn","onRemoveColumn"])]),body:O(()=>[a.value&&o.value===g?(i(),h("div",Vr,[c(Tr,{column:w,onRemove:b,onSave:m,onDiscard:$[0]||($[0]=p=>o.value=null)},null,8,["column"])])):E("",!0)]),_:2},1032,["show","onClose"]))]),_:1},8,["items"])):E("",!0)]),c(x,{modelValue:s.value,options:{size:"3xl"}},{body:O(()=>[l("div",Ar,[l("div",Sr,[$[4]||($[4]=l("h3",{class:"text-2xl font-semibold leading-6 text-gray-900"}," Column Expression ",-1)),c(y,{variant:"ghost",onClick:$[2]||($[2]=w=>o.value=null),icon:"x"})]),c(ur,{column:n.value[o.value],onRemove:b,onSave:m},null,8,["column"])])]),_:1},8,["modelValue"])],64)}}},Qr={class:"flex flex-col gap-4 p-4"},Pr={class:"flex h-8 w-full cursor-pointer select-none items-center rounded bg-gray-100 p-1"},Fr=["onClick"],Ur={class:"space-y-1"},Br={key:2,class:"text-xs text-orange-500"},Ir={class:"space-y-1"},Nr={class:"flex justify-between"},Dr={class:"flex gap-2"},Lr={__name:"FilterEditor",props:{filter:Object},emits:["save","discard","remove"],setup(r,{emit:e}){var $,y,v,C,x;const n=e,o=r,s=B("assistedQuery"),a=Q("Simple"),t=z({...xt,...o.filter});($=t.expression)!=null&&$.raw&&(a.value="Expression"),t.column&&t.column.column&&t.column.table&&!t.column.value&&(t.column.value=`${t.column.table}.${t.column.column}`),((y=t.operator)==null?void 0:y.value)=="is"&&((C=(v=t.value)==null?void 0:v.value)!=null&&C.toLowerCase().includes("set"))&&(t.operator.value=t.value.value==="Set"?"is_set":"is_not_set");const u=A(()=>s.groupedColumnOptions.map(w=>({group:w.group,items:w.items.filter(g=>g.column!=="count")}))),b=A(()=>{var w,g,p,k,T,S,F,N;return!!((w=t.expression)!=null&&w.raw&&((g=t.expression)!=null&&g.ast)||(p=t.column)!=null&&p.value&&((k=t.operator)!=null&&k.value)&&((T=t.value)!=null&&T.value)||(F=(S=t.operator)==null?void 0:S.value)!=null&&F.includes("is_")&&((N=t.column)!=null&&N.column))}),m=A(()=>{var g;return Ke((g=t.column)==null?void 0:g.type).filter(p=>p.value!=="is").concat([{label:"is set",value:"is_set"},{label:"is not set",value:"is_not_set"}])});(x=t.operator)!=null&&x.value||(t.operator=m.value[0]),q(()=>t.operator.value,(w,g)=>{w!==g&&(t.value={})});function _(w){var g,p;return w?((g=w.expression)==null?void 0:g.raw)&&((p=w.expression)==null?void 0:p.ast):!1}const f=A(()=>{const w=ge(s);return s.columnOptions.filter(g=>w.includes(g.table))||[]});return(w,g)=>{var S;const p=G,k=R("FormControl"),T=R("Button");return i(),h("div",Qr,[l("div",Pr,[(i(),h(D,null,J(["Simple","Expression"],(F,N)=>l("div",{class:X(["flex h-full flex-1 items-center justify-center px-4 text-sm transition-all",a.value===F?"rounded bg-white shadow":""]),onClick:L(M=>a.value=F,["prevent","stop"])},P(F),11,Fr)),64))]),a.value=="Expression"?(i(),V(_t,{key:0,modelValue:t.expression,"onUpdate:modelValue":g[0]||(g[0]=F=>t.expression=F),columnOptions:f.value},null,8,["modelValue","columnOptions"])):E("",!0),a.value=="Simple"?(i(),h(D,{key:1},[l("div",Ur,[g[8]||(g[8]=l("span",{class:"text-sm font-medium text-gray-700"},"Column",-1)),_(t.column)?(i(),V(k,{key:1,type:"textarea",class:"w-full",modelValue:(S=t.column)==null?void 0:S.expression.raw,disabled:""},null,8,["modelValue"])):(i(),V(p,{key:0,modelValue:t.column,placeholder:"Column",options:u.value,"onUpdate:modelValue":g[1]||(g[1]=F=>t.column=F||{}),"onUpdate:query":d(s).fetchColumnOptions},null,8,["modelValue","options","onUpdate:query"])),_(t.column)?(i(),h("span",Br,g[7]||(g[7]=[I(" Editing a filter with a "),l("i",null,"column expression",-1),I(" is not supported yet. Remove this filter and add an expression filter instead. ")]))):E("",!0)]),l("div",Ir,[g[9]||(g[9]=l("span",{class:"text-sm font-medium text-gray-700"},"Operator",-1)),c(p,{modelValue:t.operator,placeholder:"Operator",options:m.value,"onUpdate:modelValue":g[2]||(g[2]=F=>t.operator=F)},null,8,["modelValue","options"])]),l("div",null,[c(lo,{column:t.column,operator:t.operator,modelValue:t.value,"data-source":d(s).data_source,"onUpdate:modelValue":g[3]||(g[3]=F=>t.value=F)},null,8,["column","operator","modelValue","data-source"])])],64)):E("",!0),l("div",Nr,[c(T,{variant:"outline",onClick:g[4]||(g[4]=F=>n(b.value?"discard":"remove"))},{default:O(()=>g[10]||(g[10]=[I(" Discard ")])),_:1}),l("div",Dr,[c(T,{variant:"outline",theme:"red",onClick:g[5]||(g[5]=F=>n("remove"))},{default:O(()=>g[11]||(g[11]=[I("Remove")])),_:1}),c(T,{variant:"solid",disabled:!b.value,onClick:g[6]||(g[6]=F=>n("save",t))},{default:O(()=>g[12]||(g[12]=[I(" Save ")])),_:1},8,["disabled"])])])])}}},jr={class:"flex w-full items-center overflow-hidden"},qr={key:0,class:"flex w-full space-x-2"},Mr={class:"truncate font-mono"},Gr={class:"flex max-w-[60%] flex-shrink-0 gap-1 truncate"},Hr={class:"flex-shrink-0 font-medium text-green-600"},zr={key:0,class:"flex-1 flex-shrink-0 truncate"},Jr={key:1,class:"text-gray-600"},Kr={class:"flex items-center"},Wr={__name:"FilterListItem",props:["filter","isActive"],emits:["edit","remove"],setup(r){function e(o){return(o==null?void 0:o.raw)&&(o==null?void 0:o.ast)}function n(o){return e(o.expression)?!0:(o.column.column||e(o.column.expression))&&o.operator.value&&(o.value.value||o.operator.value.includes("is_"))}return(o,s)=>{var a;return i(),h("div",{class:X(["group relative flex h-8 w-full cursor-pointer items-center justify-between overflow-hidden rounded border border-gray-300 bg-white px-2 pl-2.5 hover:shadow",r.isActive?"border-gray-500 bg-white shadow-sm ring-1 ring-gray-400":""]),onClick:s[1]||(s[1]=L(t=>o.$emit("edit"),["prevent","stop"]))},[s[2]||(s[2]=l("div",{class:"absolute left-0 h-full w-1 flex-shrink-0 bg-green-600"},null,-1)),l("div",jr,[n(r.filter)?(i(),h("div",qr,[(a=r.filter.expression)!=null&&a.raw?(i(),h(D,{key:0},[(i(),V(H(d(ot)),{class:"h-4 w-4 flex-shrink-0 text-gray-600"})),l("span",Mr,P(r.filter.expression.raw),1)],64)):(i(),h(D,{key:1},[l("div",Gr,[(i(),V(H(d(Ae)[r.filter.column.type]),{class:"h-4 w-4 flex-shrink-0 text-gray-600"})),I(" "+P(r.filter.column.label||r.filter.column.column),1)]),l("span",Hr,P(r.filter.operator.value),1),r.filter.operator.value.includes("is_")?E("",!0):(i(),h("span",zr,P(r.filter.value.label||r.filter.value.value),1))],64))])):(i(),h("div",Jr,"Select a filter"))]),l("div",Kr,[c(d(we),{class:"invisible h-4 w-4 text-gray-600 transition-all hover:text-gray-800 group-hover:visible",onClick:s[0]||(s[0]=L(t=>o.$emit("remove"),["prevent","stop"]))})])],2)}}},Yr={class:"space-y-2"},Zr={key:0,class:"space-y-2"},Xr={key:0,class:"ml-2 min-w-[20rem] rounded-lg border border-gray-100 bg-white text-base shadow-xl transition-all"},ei={__name:"FilterSection",setup(r){B("query");const e=B("assistedQuery"),n=A(()=>e.filters),o=Q(null);A(()=>{if(o.value===null)return!1;const u=n.value[o.value];return u?u.expression.hasOwnProperty("raw")||u.expression.hasOwnProperty("ast"):!1});function s(){e.addFilter(),ne(()=>{o.value=n.value.length-1})}function a(){e.removeFilterAt(o.value),o.value=null}function t(u){e.updateFilterAt(o.value,u),o.value=null}return(u,b)=>{const m=R("Button"),_=me;return i(),h("div",Yr,[c(ae,{title:"Filters",icon:d(ao),info:"Apply filters to narrow down the results."},{default:O(()=>[c(m,{variant:"outline",icon:"plus",onClick:L(s,["prevent","stop"])})]),_:1},8,["icon"]),n.value.length?(i(),h("div",Zr,[(i(!0),h(D,null,J(n.value,(f,$)=>(i(),V(_,{key:$,show:o.value===$,onClose:y=>o.value===$?o.value=null:null,placement:"right-start"},{target:O(({togglePopover:y})=>[c(Wr,{filter:f,isActive:o.value===$,onEdit:v=>o.value=$,onRemove:v=>d(e).removeFilterAt($)},null,8,["filter","isActive","onEdit","onRemove"])]),body:O(()=>[o.value===$?(i(),h("div",Xr,[c(Lr,{filter:n.value[o.value],onDiscard:b[0]||(b[0]=y=>o.value=null),onRemove:a,onSave:t},null,8,["filter"])])):E("",!0)]),_:2},1032,["show","onClose"]))),128))])):E("",!0)])}}},ti=["size"],oi={__name:"LimitSection",setup(r){const e=B("assistedQuery"),n=Q(e.limit);return Ee(n,e.setLimit,{debounce:300}),q(()=>e.limit,o=>n.value=o),(o,s)=>(i(),h("div",null,[c(ae,{icon:d(vo),title:"Row Limit",info:"Limit the number of rows returned by the query"},{default:O(()=>[Z(l("input",{type:"text",ref:"limitInput","onUpdate:modelValue":s[0]||(s[0]=a=>n.value=a),size:String(n.value).length,class:"tnum form-input rounded border border-gray-300 bg-white pr-1.5 text-gray-800 placeholder-gray-500 transition-colors hover:border-gray-400 hover:bg-white"},null,8,ti),[[ue,n.value,void 0,{number:!0}]])]),_:1},8,["icon"])]))}},li={class:"flex items-center space-x-1"},ni={__name:"ResultColumnActions",props:{column:Object},setup(r){const e=r,n=B("assistedQuery");function o(t){var u;return(u=n.columns.find(b=>b.label==t))==null?void 0:u.order}const s=[{label:"Sort Ascending",onClick:()=>n.setOrderBy(e.column.label,"asc")},{label:"Sort Descending",onClick:()=>n.setOrderBy(e.column.label,"desc")},{label:"Remove Sort",onClick:()=>n.setOrderBy(e.column.label,"")}],a={asc:uo,desc:io};return(t,u)=>{const b=R("Dropdown");return i(),h("div",li,[c(b,{options:s},{default:O(()=>[(i(),V(H(a[o(r.column.label)]||d(ro)),{class:"h-4 w-4 cursor-pointer text-gray-500 hover:text-gray-700"}))]),_:1})])}}},si={__name:"SourceSection",setup(r){return(e,n)=>(i(),V(ae,{icon:d(Jt),title:"Data Source",info:"Select the data source you want to query."},{default:O(()=>[c(Xe)]),_:1},8,["icon"]))}},ai={class:"flex flex-col gap-1 p-4"},ri={class:"mb-2 flex gap-2"},ii={class:"flex-1"},ui={class:"flex-shrink-0"},ci={class:"flex-1"},di={class:"mb-2 flex gap-2"},pi={class:"flex-1"},mi={class:"flex-1"},fi={class:"flex justify-between"},vi={class:"flex gap-2"},yi={__name:"TableJoinEditor",props:{join:Object},emits:["save","remove","discard"],setup(r,{emit:e}){const n=e,o=r,s=B("assistedQuery"),a=tt(s.data_source);!a.tableList.length&&a.fetchTables();const t=z({left_table:{},left_column:{},join_type:{},right_table:{},right_column:{},...o.join}),u=(y,v)=>y.value=v;u(t.left_table,t.left_table.table),u(t.left_column,t.left_column.column),u(t.right_table,t.right_table.table),u(t.right_column,t.right_column.column);const b=A(()=>[{label:"Inner Join",value:"inner"},{label:"Left Join",value:"left"}]),m=A(()=>{const y=[s.table];return s.joins.forEach(v=>{v.right_table.table!==t.right_table.table&&(y.find(C=>C.table===v.right_table.table)||y.push(v.right_table))}),y.map(v=>({...v,value:v.table}))}),_=A(()=>(a==null?void 0:a.groupedTableOptions)||[]),f=Q(null),$=Q(null);return q(()=>{var y;return(y=t.left_table)==null?void 0:y.table},async(y,v)=>{var x;if(!y||y===v)return;const C=await Pe({data_source:s.data_source,table:y});f.value=C.columns.map(w=>({column:w.column,table:w.table,label:w.label,value:w.column})),((x=t.left_column)==null?void 0:x.table)!==y&&(t.left_column={})},{immediate:!0}),q(()=>{var y;return(y=t.right_table)==null?void 0:y.table},async(y,v)=>{var x;if(!y||y===v)return;const C=await Pe({data_source:s.data_source,table:y});$.value=C.columns.map(w=>({column:w.column,table:w.table,label:w.label,value:w.column})),((x=t.right_column)==null?void 0:x.table)!==y&&(t.right_column={})},{immediate:!0}),(y,v)=>{const C=G,x=R("Button");return i(),h("div",ai,[v[12]||(v[12]=l("span",{class:"text-sm font-medium text-gray-700"},"Join",-1)),l("div",ri,[l("div",ii,[c(C,{modelValue:t.left_table,"onUpdate:modelValue":v[0]||(v[0]=w=>t.left_table=w),hideSearch:!0,options:m.value,placeholder:"Left Table"},null,8,["modelValue","options"])]),l("div",ui,[c(C,{modelValue:t.join_type,"onUpdate:modelValue":v[1]||(v[1]=w=>t.join_type=w),"hide-search":!0,options:b.value,placeholder:"Join Type"},null,8,["modelValue","options"])]),l("div",ci,[c(C,{modelValue:t.right_table,"onUpdate:modelValue":v[2]||(v[2]=w=>t.right_table=w),options:_.value,placeholder:"Right Table"},null,8,["modelValue","options"])])]),v[13]||(v[13]=l("span",{class:"text-sm font-medium text-gray-700"},"Condition",-1)),l("div",di,[l("div",pi,[c(C,{modelValue:t.left_column,"onUpdate:modelValue":v[3]||(v[3]=w=>t.left_column=w),options:f.value,placeholder:"Left Column"},null,8,["modelValue","options"])]),v[8]||(v[8]=l("div",{class:"flex flex-shrink-0 items-center font-mono"},"=",-1)),l("div",mi,[c(C,{modelValue:t.right_column,"onUpdate:modelValue":v[4]||(v[4]=w=>t.right_column=w),options:$.value,placeholder:"Right Column"},null,8,["modelValue","options"])])]),l("div",fi,[c(x,{variant:"outline",onClick:v[5]||(v[5]=w=>n("discard"))},{default:O(()=>v[9]||(v[9]=[I("Discard")])),_:1}),l("div",vi,[c(x,{variant:"outline",theme:"red",onClick:v[6]||(v[6]=w=>n("remove"))},{default:O(()=>v[10]||(v[10]=[I("Remove")])),_:1}),c(x,{variant:"solid",onClick:v[7]||(v[7]=w=>n("save",t))},{default:O(()=>v[11]||(v[11]=[I("Save")])),_:1})])])])}}},_i={class:"space-y-2"},xi={key:0,class:"group relative flex h-8 cursor-pointer items-center justify-between overflow-hidden rounded border border-gray-300 bg-white px-2 pl-2.5 hover:shadow"},gi={class:"flex flex-1 items-center gap-1 overflow-hidden"},bi={class:"flex flex-1 items-center gap-1 overflow-hidden"},hi={class:"truncate"},wi={class:"ml-2 flex items-center space-x-2"},$i=["onClick"],ki={class:"flex flex-1 items-center gap-1"},Ci={class:"truncate"},Ti={class:"min-w-[24rem] rounded bg-white text-base shadow-2xl"},Oi={__name:"TableSection",setup(r){const e=B("assistedQuery");let n=z({});Ct(()=>e.data_source,(_,f)=>{_&&_!=f&&(n=tt(e.data_source),n.fetchTables())},{immediate:!0});const o=A(()=>e.joins),s=Q([]),a=Q(null);function t(_){e.updateJoinAt(a.value,_),a.value=null}function u(){e.removeJoinAt(a.value),a.value=null}const b=je();function m(_){const f=_.startsWith("QRY-")?b.resolve({name:"Query",params:{name:_}}):b.resolve({name:"DataSource",params:{name:e.data_source}});window.open(f.href,"_blank")}return(_,f)=>{var y;const $=R("Button");return i(),h(D,null,[(i(),h("div",{key:d(e).data_source,class:"space-y-2"},[c(ae,{icon:d(_o),title:"Tables",info:"Select the tables you want to extract data from."},{default:O(()=>[c(G,{bodyClasses:"w-[18rem]",options:d(n).groupedTableOptions,"onUpdate:modelValue":f[0]||(f[0]=v=>v&&d(e).addTable(v))},{target:O(({togglePopover:v})=>[c($,{variant:"outline",icon:"plus",onClick:v},null,8,["onClick"])]),_:1},8,["options"])]),_:1},8,["icon"]),l("div",_i,[d(e).table.table?(i(),h("div",xi,[f[6]||(f[6]=l("div",{class:"absolute left-0 h-full w-1 flex-shrink-0 bg-orange-500"},null,-1)),l("div",gi,[(i(),V(H(d(e).table.table.startsWith("QRY-")?d(Fe):d(Ue)),{class:"h-4 w-4 flex-shrink-0 text-gray-600"})),l("div",bi,[l("span",hi,P(d(e).table.label),1),c(d(Be),{class:"h-3 w-3 text-gray-600 opacity-0 transition-all hover:text-gray-800 group-hover:opacity-100",onClick:f[1]||(f[1]=L(v=>m(d(e).table.table),["prevent","stop"]))})])]),l("div",wi,[c(d(we),{class:"invisible h-4 w-4 text-gray-600 transition-all hover:text-gray-800 group-hover:visible",onClick:f[2]||(f[2]=v=>d(e).resetMainTable())})])])):E("",!0),(i(!0),h(D,null,J(o.value,(v,C)=>(i(),h("div",{ref_for:!0,ref_key:"joinRefs",ref:s,key:v.right_table.table,class:X(["group relative flex h-8 cursor-pointer items-center justify-between overflow-hidden rounded border border-gray-300 bg-white px-2 pl-2.5 hover:shadow",C===a.value?"border-gray-500 bg-white shadow-sm ring-1 ring-gray-400":""]),onClick:x=>a.value=C},[f[7]||(f[7]=l("div",{class:"absolute left-0 h-full w-1 flex-shrink-0 bg-orange-500"},null,-1)),l("div",ki,[(i(),V(H(v.right_table.table.startsWith("QRY-")?d(Fe):d(Ue)),{class:"h-4 w-4 text-gray-600"})),l("span",Ci,P(v.right_table.label),1),c(d(Be),{class:"h-3 w-3 text-gray-600 opacity-0 transition-all hover:text-gray-800 group-hover:opacity-100",onClick:L(x=>m(v.right_table.table),["prevent","stop"])},null,8,["onClick"])]),v.join_type.value=="left"?(i(),V(mt,{key:0,class:"text-gray-600"})):E("",!0),v.join_type.value=="right"?(i(),V(ft,{key:1,class:"text-gray-600"})):E("",!0),v.join_type.value=="inner"?(i(),V(vt,{key:2,class:"text-gray-600"})):E("",!0),v.join_type.value=="full"?(i(),V(yt,{key:3,class:"text-gray-600"})):E("",!0)],10,$i))),128))])])),(y=s.value)!=null&&y[a.value]?(i(),V(qt,{key:a.value,show:a.value!==null,"onUpdate:show":f[5]||(f[5]=v=>a.value=null),"target-element":s.value[a.value],placement:"right-start"},{default:O(()=>[l("div",Ti,[c(yi,{join:o.value[a.value],onSave:f[3]||(f[3]=v=>t(v)),onDiscard:f[4]||(f[4]=v=>a.value=null),onRemove:u},null,8,["join"])])]),_:1},8,["show","target-element"])):E("",!0)],64)}}},Ei={class:"space-y-1"},Vi={__name:"CumulativeSumTransformFields",props:{transformOptions:Object},emits:["update:transformOptions"],setup(r,{emit:e}){const n=e,o=r,s=B("query"),a=A({get:()=>o.transformOptions,set:u=>n("update:transformOptions",u)}),t=A(()=>s.results.columns?s.results.columns.filter(u=>oe.NUMBER.includes(u.type)).map(u=>({label:u.label,value:u.label,description:u.type})):[]);return(u,b)=>{const m=G;return i(),h("div",Ei,[b[1]||(b[1]=l("span",{class:"text-sm font-medium text-gray-700"},"Number Column",-1)),c(m,{placeholder:"Number Column",options:t.value,modelValue:a.value.column,"onUpdate:modelValue":b[0]||(b[0]=_=>a.value.column=_==null?void 0:_.value)},null,8,["options","modelValue"])])}}},Ai={class:"space-y-1"},Si={key:0,class:"text-xs text-red-500"},Ri={class:"space-y-1"},Qi={key:0,class:"text-xs text-red-500"},Pi={class:"space-y-1"},Fi={key:0,class:"text-xs text-red-500"},Ui={__name:"PivotTransformFields",props:{transformOptions:Object},emits:["update:transformOptions"],setup(r,{emit:e}){const n=e,o=r,s=B("query"),a=A({get:()=>o.transformOptions,set:m=>n("update:transformOptions",m)}),t=A(()=>s.results.columns?s.results.columns.filter(m=>oe.NUMBER.includes(m.type)).map(m=>({label:m.label,value:m.label,description:m.type})):[]),u=A(()=>s.results.columns?s.results.columns.map(m=>({label:m.label,value:m.label,description:m.type})):[]),b=A(()=>({column:a.value.column&&[a.value.index,a.value.value].includes(a.value.column)?"Column cannot be same as Row or Value":"",index:a.value.index&&[a.value.column,a.value.value].includes(a.value.index)?"Row cannot be same as Column or Value":"",value:a.value.value&&[a.value.column,a.value.index].includes(a.value.value)?"Value cannot be same as Column or Row":""}));return(m,_)=>{const f=G;return i(),h(D,null,[l("div",Ai,[_[3]||(_[3]=l("span",{class:"text-sm font-medium text-gray-700"},"Column",-1)),c(f,{placeholder:"Column",options:u.value,modelValue:a.value.column,"onUpdate:modelValue":_[0]||(_[0]=$=>a.value.column=$==null?void 0:$.value)},null,8,["options","modelValue"]),b.value.column?(i(),h("span",Si,P(b.value.column),1)):E("",!0)]),l("div",Ri,[_[4]||(_[4]=l("span",{class:"text-sm font-medium text-gray-700"},"Row",-1)),c(f,{placeholder:"Row",options:u.value,modelValue:a.value.index,"onUpdate:modelValue":_[1]||(_[1]=$=>a.value.index=$==null?void 0:$.value)},null,8,["options","modelValue"]),b.value.index?(i(),h("span",Qi,P(b.value.index),1)):E("",!0)]),l("div",Pi,[_[5]||(_[5]=l("span",{class:"text-sm font-medium text-gray-700"},"Value",-1)),c(f,{placeholder:"Value",options:t.value,modelValue:a.value.value,"onUpdate:modelValue":_[2]||(_[2]=$=>a.value.value=$==null?void 0:$.value)},null,8,["options","modelValue"]),b.value.value?(i(),h("span",Fi,P(b.value.value),1)):E("",!0)])],64)}}},Bi={class:"flex flex-col gap-4 p-4"},Ii={class:"space-y-1"},Ni={class:"flex justify-between"},Di={class:"flex gap-2"},Li={__name:"TransformEditor",props:{transform:Object},emits:["save","discard","remove"],setup(r,{emit:e}){const n=e,o=r;B("assistedQuery"),B("query");const s=z({...za,...o.transform});s.type||(s.type="Pivot"),s.options||(s.options={});const a=[{label:"Select Transform Type",value:"",disabled:!0},{label:"Pivot",value:"Pivot"},{label:"Cumulative Sum",value:"CumulativeSum"}],t=A(()=>(s==null?void 0:s.type)&&!te(s.options));return(u,b)=>{const m=R("FormControl"),_=R("Button");return i(),h("div",Bi,[l("div",Ii,[b[7]||(b[7]=l("span",{class:"text-sm font-medium text-gray-700"},"Type",-1)),c(m,{type:"select",modelValue:s.type,"onUpdate:modelValue":[b[0]||(b[0]=f=>s.type=f),b[1]||(b[1]=f=>s.options={})],placeholder:"Select Transform Type",options:a},null,8,["modelValue"])]),s.type=="Pivot"?(i(),V(Ui,{key:0,transformOptions:s.options,"onUpdate:transformOptions":b[2]||(b[2]=f=>s.options=f)},null,8,["transformOptions"])):s.type=="CumulativeSum"?(i(),V(Vi,{key:1,transformOptions:s.options,"onUpdate:transformOptions":b[3]||(b[3]=f=>s.options=f)},null,8,["transformOptions"])):E("",!0),l("div",Ni,[c(_,{variant:"outline",onClick:b[4]||(b[4]=f=>n(t.value?"discard":"remove"))},{default:O(()=>b[8]||(b[8]=[I(" Discard ")])),_:1}),l("div",Di,[c(_,{variant:"outline",theme:"red",onClick:b[5]||(b[5]=f=>n("remove"))},{default:O(()=>b[9]||(b[9]=[I("Remove")])),_:1}),c(_,{variant:"solid",disabled:!t.value,onClick:b[6]||(b[6]=f=>n("save",s))},{default:O(()=>b[10]||(b[10]=[I(" Save ")])),_:1},8,["disabled"])])])])}}},ji={class:"flex w-full items-center overflow-hidden"},qi={key:0,class:"flex w-full space-x-2 truncate"},Mi={class:"truncate"},Gi={key:1,class:"text-gray-600"},Hi={class:"flex items-center space-x-2"},zi={__name:"TransformListItem",props:["transform","isActive"],emits:["edit","remove"],setup(r){const e={Pivot:mo,Unpivot:po,Transpose:fo,CumulativeSum:ot},n={Pivot:"Convert Row to Column",Unpivot:"Convert Column to Row",Transpose:"Transpose",CumulativeSum:"Cumulative Sum"};function o(s){return(s==null?void 0:s.type)&&!te(s.options)}return(s,a)=>(i(),h("div",{class:X(["group flex h-8 w-full cursor-pointer items-center justify-between rounded border border-gray-300 bg-white px-2 hover:shadow",r.isActive?"border-gray-500 bg-white shadow-sm ring-1 ring-gray-400":""]),onClick:a[1]||(a[1]=L(t=>s.$emit("edit"),["prevent","stop"]))},[l("div",ji,[o(r.transform)?(i(),h("div",qi,[(i(),V(H(e[r.transform.type]),{class:"h-4 w-4 text-gray-600"})),l("span",Mi,P(n[r.transform.type]),1)])):(i(),h("div",Gi,"Select a transform"))]),l("div",Hi,[c(d(we),{class:"invisible h-4 w-4 text-gray-600 transition-all hover:text-gray-800 group-hover:visible",onClick:a[0]||(a[0]=L(t=>s.$emit("remove"),["prevent","stop"]))})])],2))}},Ji={class:"space-y-2"},Ki={key:0,class:"space-y-2"},Wi={key:0,class:"ml-2 min-w-[20rem] rounded-lg border border-gray-100 bg-white text-base shadow-xl transition-all"},Yi={__name:"TransformSection",setup(r){B("query");const e=B("assistedQuery"),n=Q(null);async function o(){e.addTransform(),setTimeout(()=>{n.value=e.transforms.length-1},500)}function s(){e.removeTransformAt(n.value),n.value=null}function a(t){e.updateTransformAt(n.value,t),n.value=null}return(t,u)=>{const b=R("Button"),m=me;return i(),h("div",Ji,[c(ae,{title:"Transform",icon:d(yo),info:"Apply transforms to the results."},{default:O(()=>[c(b,{variant:"outline",icon:"plus",onClick:L(o,["prevent","stop"])})]),_:1},8,["icon"]),d(e).transforms.length?(i(),h("div",Ki,[(i(!0),h(D,null,J(d(e).transforms,(_,f)=>(i(),V(m,{key:f,show:n.value===f,onClose:$=>n.value===f?n.value=null:null,placement:"right-start"},{target:O(({togglePopover:$})=>[c(zi,{transform:_,isActive:n.value===f,onEdit:y=>n.value=f,onRemove:s},null,8,["transform","isActive","onEdit"])]),body:O(()=>[n.value===f?(i(),h("div",Wi,[c(Li,{transform:d(e).transforms[n.value],onDiscard:u[0]||(u[0]=$=>n.value=null),onRemove:s,onSave:a},null,8,["transform"])])):E("",!0)]),_:2},1032,["show","onClose"]))),128))])):E("",!0)])}}},Zi={class:"relative flex h-full w-full flex-row-reverse overflow-hidden"},Xi={class:"flex h-full w-full flex-col overflow-hidden p-4 pt-0 pr-0"},eu={key:0,class:"flex h-[60%] !max-h-[60%] flex-shrink-0 flex-col overflow-hidden pt-4"},tu={class:"flex flex-1 flex-shrink-0 flex-col overflow-hidden"},ou={class:"relative flex w-[22rem] flex-shrink-0 flex-col overflow-y-auto bg-white px-0.5"},lu={class:"sticky top-0 z-10 w-full flex-shrink-0 bg-white py-4"},nu={class:"flex flex-1 flex-col gap-4 pb-4"},su={__name:"VisualQueryBuilder",setup(r){const e=Q("Build"),n=["Build","Visualize"],o=B("query"),s=or(o);ze("assistedQuery",s);const a=Q(!1);return(t,u)=>{const b=He("auto-animate");return i(),h("div",Zi,[Z((i(),h("div",Xi,[a.value?E("",!0):(i(),h("div",eu,[c(nt)])),l("div",{class:X(["my-1.5 mx-auto w-2 rounded-full bg-gray-200 pt-1 transition-all hover:bg-gray-400",a.value?"cursor-s-resize":"cursor-n-resize"]),onClick:u[0]||(u[0]=m=>a.value=!a.value)},null,2),l("div",tu,[c(he,null,{columnActions:O(({column:m})=>[c(ni,{column:m},null,8,["column"])]),footer:O(()=>[c(Mt)]),_:1})])])),[[b]]),l("div",ou,[l("div",lu,[c(Je,{modelValue:e.value,"onUpdate:modelValue":u[1]||(u[1]=m=>e.value=m),class:"w-full",tabs:n},null,8,["modelValue"])]),l("div",nu,[e.value==="Build"?(i(),h(D,{key:0},[c(si),u[2]||(u[2]=l("hr",{class:"border-gray-200"},null,-1)),c(Oi),u[3]||(u[3]=l("hr",{class:"border-gray-200"},null,-1)),c(ei),u[4]||(u[4]=l("hr",{class:"border-gray-200"},null,-1)),c(Rr),u[5]||(u[5]=l("hr",{class:"border-gray-200"},null,-1)),c(oi),u[6]||(u[6]=l("hr",{class:"border-gray-200"},null,-1)),c(Yi)],64)):E("",!0),e.value==="Visualize"?(i(),V(lt,{key:1})):E("",!0)])])])}}},au={class:"sticky top-0 z-10 flex w-full items-center justify-between border-b bg-white px-4 py-2.5"},ru={class:"flex gap-2"},iu={key:0,class:"flex h-full w-full flex-col space-y-4 overflow-hidden bg-white px-4"},uu={key:0,class:"flex flex-1 flex-shrink-0 overflow-hidden"},cu={key:1,class:"flex flex-1 flex-shrink-0 gap-4 overflow-hidden pt-4"},du={class:"w-[21rem] flex-shrink-0"},pu={class:"flex flex-1"},mu={__name:"Query",props:{name:String},async setup(r){let e,n;const s=Gt(r.name);[e,n]=Tt(()=>s.reload()),await e,n(),ze("query",s);const a=Q(0),t=Q([{label:"Query",value:0},{label:"Visualize",value:1}]);return ve(()=>{var u;if((u=s.doc)!=null&&u.name){const b=s.doc.title||s.doc.name;document.title=`${b} - Frappe Insights`}}),(u,b)=>{var m,_;return i(),h(D,null,[l("header",au,[c(Ot,{class:"h-7",items:[{label:"Queries",route:{path:"/query"}},{component:wl}]},null,8,["items"]),l("div",ru,[c(gl),d(s).doc.is_assisted_query?E("",!0):(i(),V(Je,{key:0,modelValue:a.value,"onUpdate:modelValue":b[0]||(b[0]=f=>a.value=f),tabs:t.value},null,8,["modelValue","tabs"]))])]),(m=d(s).doc)!=null&&m.name?(i(),h("div",iu,[a.value==0?(i(),h("div",uu,[d(s).doc.is_assisted_query?(i(),V(su,{key:0})):d(s).doc.is_native_query?(i(),V(ml,{key:1})):d(s).doc.is_script_query?(i(),V(Hl,{key:2})):!d(s).doc.is_assisted_query&&!d(s).doc.is_native_query&&!d(s).doc.is_script_query?(i(),V(Pa,{key:3})):E("",!0)])):E("",!0),a.value==1&&((_=d(s).chart.doc)!=null&&_.name)?(i(),h("div",cu,[l("div",du,[c(lt)]),l("div",pu,[c(nt)])])):E("",!0)])):E("",!0)],64)}}},Ju=Object.freeze(Object.defineProperty({__proto__:null,default:mu},Symbol.toStringTag,{value:"Module"}));export{Ju as Q,Qo as _,mu as a};
//# sourceMappingURL=Query-9187b102.js.map
