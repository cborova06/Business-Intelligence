import{x as P,E as de,T as H,r as T,K as f,o as r,d as k,h as t,w as d,c as V,e as w,k as xe,j as Q,f as p,z as A,t as E,y as W,L as B,M as L,u as $,C as $e,F as D,a as ge,_ as Te,aN as Ie,V as te,W as ae,ad as le,ae as oe,aM as je,al as Ee,aO as ze,aP as Ge,aQ as We,aR as Qe,aS as He,aT as Ke,am as Ye,g as ie,m as re,aC as ce,an as Re,af as Ze,D as Je,aU as we,s as Xe,a1 as el,aV as fe,a0 as _e,R as pe,i as G,aG as ll,B as ol,aH as tl,aI as ke,G as al,I as nl}from"./frappe-ui-d69b39da.js";import{_ as sl,g as ee,h as se,d as I,i as ne,b as Fe,j as ul,c as il,C as Ce}from"./DrillDown.vue_vue_type_script_setup_true_lang-3700404a.js";import{F as ue,j as Z,m as rl,i as Oe,n as dl,o as ve,h as ml,p as Ue,w as cl,s as pl,d as vl}from"./main-d2d228fc.js";import{g as fl,c as he,C as _l,b as bl,w as gl}from"./dashboard-37329027.js";import{C as hl}from"./calendar-1687c485.js";import{C as yl}from"./check-2c63c113.js";import{C as Vl}from"./chevron-right-abc82e4c.js";import{_ as be}from"./ColorInput-9369aab6.js";import{_ as xl}from"./Popover-5414f173.js";import{S as wl,a as kl,_ as Me}from"./Autocomplete-e91e4d1c.js";import{X as me}from"./x-3f18ad86.js";import{P as ye}from"./plus-3394075c.js";import{T as Cl}from"./table-2-565c43f4.js";import{_ as Ol}from"./ChartRenderer.vue_vue_type_script_setup_true_lang-564d1b03.js";import{c as Pe}from"./index-77f7bd6f.js";import{A as Ul,a as Sl}from"./DataTable.vue_vue_type_script_setup_true_lang-0fc4cbd5.js";import{_ as $l,S as Tl}from"./ChartIcon.vue_vue_type_script_setup_true_lang-f01737f9.js";import{R as Rl}from"./refresh-ccw-f825866d.js";import"./ExpressionEditor.vue_vue_type_style_index_0_lang-9e2463ac.js";import"./vue-codemirror.esm-d1d2df5a.js";import"./play-63d306bd.js";import"./ellipsis-10a30b7b.js";import"./vuedraggable.umd-f13fb48a.js";import"./grip-vertical-c5c2fa7d.js";import"./index-9194c21d.js";import"./toasts-2937f9d2.js";import"./clock-73e01da8.js";import"./combine-0dbf7ac7.js";import"./search-34ad51bc.js";import"./chevron-down-7c5e9308.js";import"./DatePickerControl.vue_vue_type_script_setup_true_lang-6baff6f5.js";import"./tables-0e8be38f.js";import"./data_source-00c6028c.js";import"./chevron-left-c299c44c.js";import"./IndicatorIcon-21535c9e.js";import"./refresh-cw-ef6c08ee.js";import"./text-cursor-input-3636b908.js";import"./colors-18b5c913.js";import"./ColorPicker.vue_vue_type_script_setup_true_lang-15050772.js";import"./ChartSectionEmptySvg-d77827da.js";import"./ContentEditable-bc84e80c.js";import"./chart-scatter-06f2042d.js";/**
 * @license lucide-vue-next v0.484.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Fl=Pe("globe",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M12 2a14.5 14.5 0 0 0 0 20 14.5 14.5 0 0 0 0-20",key:"13o1zl"}],["path",{d:"M2 12h20",key:"9i4pu4"}]]);/**
 * @license lucide-vue-next v0.484.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ml=Pe("image-down",[["path",{d:"M10.3 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2v10l-3.1-3.1a2 2 0 0 0-2.814.014L6 21",key:"9csbqa"}],["path",{d:"m14 19 3 3v-5.5",key:"9ldu5r"}],["path",{d:"m17 22 3-3",key:"1nkfve"}],["circle",{cx:"9",cy:"9",r:"2",key:"af1f0g"}]]),Pl={key:0,class:"flex h-[18rem] flex-col overflow-hidden rounded border"},ql=P({__name:"ChartBuilderTable",setup(o){const l=de("chart");H(()=>{l.doc.config.order_by||(l.doc.config.order_by=[])});function e(n,a){const u=l.doc.config.order_by.find(i=>i.column.column_name===n);if(u)a?u.direction=a:l.doc.config.order_by=l.doc.config.order_by.filter(i=>i.column.column_name!==n);else{if(!a)return;l.doc.config.order_by.push({column:Z(n),direction:a})}}function s(n){return rl.map(a=>{const u={...a};return u.onClick=()=>l.updateGranularity(n,a.value),u.icon=a.label.toLowerCase()===fl(n,l.doc.config)?xe(yl,{class:"h-4 w-4 text-gray-700",strokeWidth:1.5}):xe("div",{class:"h-4 w-4"}),u})}return(n,a)=>{const u=T("Button"),i=T("Dropdown");return f(l).doc.chart_type!="Table"?(r(),k("div",Pl,[t(sl,{query:f(l).dataQuery,"enable-alerts":!0,"enable-sort":!0,"enable-drill-down":!0,"on-sort-change":e},{"header-suffix":d(({column:v})=>[f(ue).DATE.includes(v.type)?(r(),V(i,{key:0,options:s(v.name)},{default:d(()=>[t(u,{variant:"ghost",class:"rounded-none"},{icon:d(()=>[t(f(hl),{class:"h-3.5 w-3.5 text-gray-700","stroke-width":"1.5"})]),_:1})]),_:2},1032,["options"])):w("",!0)]),_:1},8,["query"])])):w("",!0)}}}),Dl={class:"flex items-center gap-1"},Al={class:"text-sm font-medium"},j=P({__name:"CollapsibleSection",props:{title:{},collapsed:{type:Boolean}},setup(o){const l=o,e=Q(l.collapsed??!1);return(s,n)=>(r(),k("div",{class:W(["flex flex-col",e.value?"":"pb-3.5"])},[p("button",{class:"sticky top-0 flex cursor-pointer items-center gap-1 bg-white py-3",onClick:n[0]||(n[0]=a=>e.value=!e.value)},[p("div",Dl,[A(s.$slots,"title-prefix"),p("p",Al,E(l.title),1),A(s.$slots,"title-suffix")]),t(f(Vl),{class:W(["h-4 w-4 text-gray-700 transition-all",{"rotate-90 transform":!e.value}]),"stroke-width":"1.5"},null,8,["class"])]),e.value?w("",!0):A(s.$slots,"default",{key:0})],2))}}),Bl={class:"flex flex-col gap-3 pt-1"},qe=P({__name:"SplitByConfig",props:B({dimensions:{}},{modelValue:{required:!0,default:()=>({})},modelModifiers:{}}),emits:["update:modelValue"],setup(o){const l=o,e=L(o,"modelValue");H(()=>{e.value||(e.value={dimension:{},max_split_values:10}),e.value.dimension||(e.value.dimension={}),e.value.max_split_values||(e.value.max_split_values=10)});const s=$({get:()=>e.value.dimension,set:n=>{e.value={...e.value,dimension:n||{}}}});return(n,a)=>{const u=T("FormControl");return r(),V(j,{title:"Split Series"},{default:d(()=>{var i;return[p("div",Bl,[t(ee,{label:"Split By",options:l.dimensions,modelValue:s.value,"onUpdate:modelValue":a[0]||(a[0]=v=>s.value=v||{}),onRemove:a[1]||(a[1]=v=>s.value={})},null,8,["options","modelValue"]),(i=s.value)!=null&&i.column_name?(r(),V(u,{key:0,type:"number",label:"Max Split Values",placeholder:"10",autocomplete:"off",modelValue:e.value.max_split_values||10,"onUpdate:modelValue":a[2]||(a[2]=v=>e.value.max_split_values=v||10)},null,8,["modelValue"])):w("",!0)])]}),_:1})}}}),Ll={class:"flex flex-col gap-3 pt-1"},De=P({__name:"XAxisConfig",props:B({dimensions:{}},{modelValue:{required:!0,default:()=>({})},modelModifiers:{}}),emits:["update:modelValue"],setup(o){const l=o,e=L(o,"modelValue");return H(()=>{e.value||(e.value={dimension:{}}),e.value.dimension||(e.value.dimension={})}),(s,n)=>{const a=T("FormControl");return r(),V(j,{title:"X Axis"},{default:d(()=>[p("div",Ll,[t(ee,{label:"Column",options:l.dimensions,modelValue:e.value.dimension,"onUpdate:modelValue":n[0]||(n[0]=u=>e.value.dimension=u||{}),onRemove:n[1]||(n[1]=u=>e.value.dimension={})},null,8,["options","modelValue"]),t(a,{label:"Rotate Values",type:"select",modelValue:e.value.label_rotation,"onUpdate:modelValue":n[2]||(n[2]=u=>e.value.label_rotation=u),options:[{label:"0°",value:0},{label:"30°",value:30},{label:"45°",value:45},{label:"60°",value:60},{label:"75°",value:75},{label:"90°",value:90}]},null,8,["modelValue"])])]),_:1})}}}),Nl={class:"flex flex-col gap-3 pt-1"},Ae=P({__name:"YAxisConfig",props:B({columnOptions:{}},{modelValue:{required:!0,default:()=>({series:[]})},modelModifiers:{}}),emits:["update:modelValue"],setup(o){const l=o,e=L(o,"modelValue"),s={measure:{}};H(()=>{var u,i;(i=(u=e.value)==null?void 0:u.series)!=null&&i.length||(e.value={series:[Oe(s)]})});function n(){e.value.series.push(Oe(s))}const a=$e((u,i)=>{e.value.series[i].color||(e.value.series[i].color=[]),e.value.series[i].color=u?[u]:[]},500);return(u,i)=>{const v=T("FormControl"),m=T("Toggle");return r(),V(j,{title:"Y Axis"},{default:d(()=>[p("div",Nl,[p("div",null,[i[7]||(i[7]=p("p",{class:"mb-1.5 text-xs text-gray-600"},"Series",-1)),p("div",null,[t(ne,{items:e.value.series,"onUpdate:items":i[0]||(i[0]=c=>e.value.series=c),group:"series"},{item:d(({item:c,index:U})=>[t(se,{"model-value":c.measure,"column-options":l.columnOptions,"onUpdate:modelValue":S=>Object.assign(c.measure,S||{}),onRemove:S=>e.value.series.splice(U,1)},{"config-fields":d(()=>[t(I,{label:"Type"},{default:d(()=>[t(v,{type:"select",modelValue:c.type,"onUpdate:modelValue":S=>c.type=S,options:["Line","Bar"]},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1024),t(I,{label:"Align"},{default:d(()=>[t(v,{type:"select",modelValue:c.align,"onUpdate:modelValue":S=>c.align=S,options:["Left","Right"]},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1024),t(I,{label:"Color"},{default:d(()=>{var S;return[t(be,{"model-value":(S=c.color)==null?void 0:S[0],"onUpdate:modelValue":x=>f(a)(x,U),placement:"left-start"},null,8,["model-value","onUpdate:modelValue"])]}),_:2},1024),t(m,{label:"Show Data Labels",modelValue:c.show_data_labels,"onUpdate:modelValue":S=>c.show_data_labels=S},null,8,["modelValue","onUpdate:modelValue"]),A(u.$slots,"series-settings",{series:c,idx:U})]),_:2},1032,["model-value","column-options","onUpdate:modelValue","onRemove"])]),_:3},8,["items"]),p("button",{class:"mt-1.5 text-left text-xs text-gray-600 hover:underline",onClick:n}," + Add series ")])]),A(u.$slots,"y-axis-settings",{y_axis:e.value}),t(m,{label:"Show Data Labels",modelValue:e.value.show_data_labels,"onUpdate:modelValue":i[1]||(i[1]=c=>e.value.show_data_labels=c)},null,8,["modelValue"]),t(m,{label:"Show Axis Label",modelValue:e.value.show_axis_label,"onUpdate:modelValue":i[2]||(i[2]=c=>e.value.show_axis_label=c)},null,8,["modelValue"]),t(m,{label:"Show Scrollbar",modelValue:e.value.show_scrollbar,"onUpdate:modelValue":i[3]||(i[3]=c=>e.value.show_scrollbar=c)},null,8,["modelValue"]),e.value.show_axis_label?(r(),V(v,{key:0,modelValue:e.value.axis_label,"onUpdate:modelValue":i[4]||(i[4]=c=>e.value.axis_label=c),label:"Axis Label"},null,8,["modelValue"])):w("",!0),t(I,{label:"Y-Min",class:"w-1/2"},{default:d(()=>[t(v,{type:"number",modelValue:e.value.min,"onUpdate:modelValue":i[5]||(i[5]=c=>e.value.min=c),placeholder:"Min"},null,8,["modelValue"])]),_:1}),t(I,{label:"Y-Max",class:"w-1/2"},{default:d(()=>[t(v,{type:"number",modelValue:e.value.max,"onUpdate:modelValue":i[6]||(i[6]=c=>e.value.max=c),placeholder:"Max"},null,8,["modelValue"])]),_:1})])]),_:3})}}}),Il=P({__name:"BarChartConfigForm",props:B({dimensions:{},columnOptions:{}},{modelValue:{required:!0,default:()=>({x_axis:{},y_axis:{},split_by:{}})},modelModifiers:{}}),emits:["update:modelValue"],setup(o){const l=o,e=L(o,"modelValue"),s=$(()=>{var n,a;return((n=e.value.y_axis.series)==null?void 0:n.find(u=>u.align==="Right"))&&((a=e.value.y_axis.series)==null?void 0:a.find(u=>u.align==="Left"))});return H(()=>{var n;e.value.x_axis||(e.value.x_axis={}),e.value.y_axis||(e.value.y_axis={}),((n=e.value.y_axis)==null?void 0:n.stack)===void 0&&(e.value.y_axis.stack=!0),s.value&&(e.value.y_axis.stack=!1)}),(n,a)=>{const u=T("Toggle");return r(),k(D,null,[t(De,{modelValue:e.value.x_axis,"onUpdate:modelValue":a[0]||(a[0]=i=>e.value.x_axis=i),dimensions:l.dimensions},null,8,["modelValue","dimensions"]),t(Ae,{modelValue:e.value.y_axis,"onUpdate:modelValue":a[1]||(a[1]=i=>e.value.y_axis=i),"column-options":l.columnOptions},{"y-axis-settings":d(({y_axis:i})=>[t(u,{label:"Stack",modelValue:i.stack,"onUpdate:modelValue":v=>i.stack=v,disabled:s.value},null,8,["modelValue","onUpdate:modelValue","disabled"]),t(u,{label:"Overlap",modelValue:i.overlap,"onUpdate:modelValue":v=>i.overlap=v,disabled:s.value},null,8,["modelValue","onUpdate:modelValue","disabled"]),t(u,{label:"Normalize",modelValue:i.normalize,"onUpdate:modelValue":v=>i.normalize=v},null,8,["modelValue","onUpdate:modelValue"])]),_:1},8,["modelValue","column-options"]),t(qe,{modelValue:e.value.split_by,"onUpdate:modelValue":a[2]||(a[2]=i=>e.value.split_by=i),dimensions:l.dimensions},null,8,["modelValue","dimensions"])],64)}}}),jl={class:"flex flex-col gap-3 pt-1"},El=P({__name:"DonutChartConfigForm",props:B({dimensions:{},columnOptions:{}},{modelValue:{required:!0,default:()=>({label_column:{},value_column:{}})},modelModifiers:{}}),emits:["update:modelValue"],setup(o){const l=o,e=L(o,"modelValue");H(()=>{e.value.label_column||(e.value.label_column={}),e.value.value_column||(e.value.value_column={})});const s=$(()=>l.dimensions.filter(n=>ue.DISCRETE.includes(n.data_type)));return(n,a)=>{const u=T("FormControl"),i=T("Toggle");return r(),V(j,{title:"Options"},{default:d(()=>[p("div",jl,[t(ee,{label:"Label",modelValue:e.value.label_column,"onUpdate:modelValue":a[0]||(a[0]=v=>e.value.label_column=v),options:s.value},null,8,["modelValue","options"]),t(se,{label:"Value",modelValue:e.value.value_column,"onUpdate:modelValue":a[1]||(a[1]=v=>e.value.value_column=v),"column-options":l.columnOptions},null,8,["modelValue","column-options"]),e.value.show_inline_labels?w("",!0):(r(),V(u,{key:0,modelValue:e.value.legend_position,"onUpdate:modelValue":a[2]||(a[2]=v=>e.value.legend_position=v),label:"Legend Position",type:"select",options:[{label:"Top",value:"top"},{label:"Bottom",value:"bottom"},{label:"Left",value:"left"},{label:"Right",value:"right"}]},null,8,["modelValue"])),t(u,{modelValue:e.value.max_slices,"onUpdate:modelValue":a[3]||(a[3]=v=>e.value.max_slices=v),label:"Max Slices",type:"number",min:"1"},null,8,["modelValue"]),t(i,{modelValue:e.value.show_inline_labels,"onUpdate:modelValue":a[4]||(a[4]=v=>e.value.show_inline_labels=v),label:"Inline Labels"},null,8,["modelValue"])])]),_:1})}}}),zl={class:"flex flex-col gap-3 pt-1"},Gl=P({__name:"FunnelChartConfigForm",props:B({dimensions:{},columnOptions:{}},{modelValue:{required:!0,default:()=>({label_column:{},value_column:{}})},modelModifiers:{}}),emits:["update:modelValue"],setup(o){const l=o,e=L(o,"modelValue");H(()=>{e.value.label_column||(e.value.label_column={}),e.value.value_column||(e.value.value_column={})});const s=$(()=>l.dimensions.filter(n=>ue.DISCRETE.includes(n.data_type)));return(n,a)=>{const u=T("FormControl");return r(),V(j,{title:"Options"},{default:d(()=>[p("div",zl,[t(ee,{label:"Label",modelValue:e.value.label_column,"onUpdate:modelValue":a[0]||(a[0]=i=>e.value.label_column=i),options:s.value},null,8,["modelValue","options"]),t(se,{label:"Value",modelValue:e.value.value_column,"onUpdate:modelValue":a[1]||(a[1]=i=>e.value.value_column=i),"column-options":l.columnOptions},null,8,["modelValue","column-options"]),t(u,{modelValue:e.value.label_position,"onUpdate:modelValue":a[2]||(a[2]=i=>e.value.label_position=i),label:"Label Position",type:"select",options:[{label:"Left",value:"left"},{label:"Right",value:"right"},{label:"Alternate",value:"alternate"}]},null,8,["modelValue"])])]),_:1})}}}),Wl=P({__name:"LineChartConfigForm",props:B({dimensions:{},columnOptions:{}},{modelValue:{required:!0,default:()=>({x_axis:{},y_axis:{},split_by:{}})},modelModifiers:{}}),emits:["update:modelValue"],setup(o){const l=o,e=L(o,"modelValue");return(s,n)=>{const a=T("Toggle");return r(),k(D,null,[t(De,{modelValue:e.value.x_axis,"onUpdate:modelValue":n[0]||(n[0]=u=>e.value.x_axis=u),dimensions:l.dimensions},null,8,["modelValue","dimensions"]),t(Ae,{modelValue:e.value.y_axis,"onUpdate:modelValue":n[1]||(n[1]=u=>e.value.y_axis=u),"column-options":l.columnOptions},{"y-axis-settings":d(({y_axis:u})=>[t(a,{label:"Curved Lines",modelValue:u.smooth,"onUpdate:modelValue":i=>u.smooth=i},null,8,["modelValue","onUpdate:modelValue"]),t(a,{label:"Show Area",modelValue:u.show_area,"onUpdate:modelValue":i=>u.show_area=i},null,8,["modelValue","onUpdate:modelValue"]),t(a,{label:"Show Data Points",modelValue:u.show_data_points,"onUpdate:modelValue":i=>u.show_data_points=i},null,8,["modelValue","onUpdate:modelValue"])]),"series-settings":d(({series:u})=>[t(a,{label:"Curved Lines",modelValue:u.smooth,"onUpdate:modelValue":i=>u.smooth=i},null,8,["modelValue","onUpdate:modelValue"]),t(a,{label:"Show Area",modelValue:u.show_area,"onUpdate:modelValue":i=>u.show_area=i},null,8,["modelValue","onUpdate:modelValue"]),t(a,{label:"Show Data Points",modelValue:u.show_data_points,"onUpdate:modelValue":i=>u.show_data_points=i},null,8,["modelValue","onUpdate:modelValue"])]),_:1},8,["modelValue","column-options"]),t(qe,{modelValue:e.value.split_by,"onUpdate:modelValue":n[2]||(n[2]=u=>e.value.split_by=u),dimensions:l.dimensions},null,8,["modelValue","dimensions"])],64)}}}),Ql={class:"flex flex-col gap-3 pt-1"},Hl=P({__name:"MapChartConfigForm",props:B({dimensions:{},columnOptions:{}},{modelValue:{required:!0,default:()=>({location_column:{},value_column:{},map_type:"world"})},modelModifiers:{}}),emits:["update:modelValue"],setup(o){const l=o,e=L(o,"modelValue");H(()=>{e.value.location_column||(e.value.location_column={}),e.value.value_column||(e.value.value_column={})});const s=$(()=>l.dimensions.filter(a=>ue.DISCRETE.includes(a.data_type))),n=[{label:"World Map",value:"world"},{label:"India",value:"india"}];return(a,u)=>(r(),V(j,{title:"Options"},{default:d(()=>[p("div",Ql,[t(f(ge),{modelValue:e.value.map_type,"onUpdate:modelValue":u[0]||(u[0]=i=>e.value.map_type=i),label:"Map Type",type:"select",options:n},null,8,["modelValue"]),t(ee,{modelValue:e.value.location_column,"onUpdate:modelValue":u[1]||(u[1]=i=>e.value.location_column=i),options:s.value,label:"Region Column"},null,8,["modelValue","options"]),t(se,{modelValue:e.value.value_column,"onUpdate:modelValue":u[2]||(u[2]=i=>e.value.value_column=i),"column-options":l.columnOptions,label:"Value"},null,8,["modelValue","column-options"])])]),_:1}))}}),Kl={class:"flex flex-col gap-3 pt-1"},Yl=P({__name:"NumberChartConfigForm",props:B({dimensions:{},columnOptions:{}},{modelValue:{required:!0,default:()=>({number_columns:[],number_column_options:[],comparison:!1,sparkline:!1})},modelModifiers:{}}),emits:["update:modelValue"],setup(o){const l=o,e=L(o,"modelValue"),s=$(()=>l.dimensions.filter(v=>ue.DATE.includes(v.data_type)));H(()=>{var v;(v=e.value.number_columns)!=null&&v.length||n(),e.value.date_column||(e.value.date_column={}),e.value.number_column_options||(e.value.number_column_options=[])});function n(){e.value.number_columns||(e.value.number_columns=[]),e.value.number_columns.push({})}const a=$e(v=>{e.value.sparkline_color=v},500);function u(v,m){var c;return(c=e.value.number_column_options[v])==null?void 0:c[m]}function i(v,m,c){e.value.number_column_options[v]||(e.value.number_column_options[v]={}),e.value.number_column_options[v][m]=c}return(v,m)=>{const c=T("FormControl"),U=T("Toggle");return r(),V(j,{title:"Options"},{default:d(()=>{var S;return[p("div",Kl,[p("div",null,[m[11]||(m[11]=p("p",{class:"mb-1.5 text-xs text-gray-600"},"Columns",-1)),p("div",null,[t(ne,{items:e.value.number_columns,"onUpdate:items":m[0]||(m[0]=x=>e.value.number_columns=x),group:"numbers"},{item:d(({item:x,index:b})=>[t(se,{"model-value":x,"column-options":l.columnOptions,"onUpdate:modelValue":R=>Object.assign(x,R||{}),onRemove:R=>e.value.number_columns.splice(b,1)},{"config-fields":d(()=>[t(I,{label:"Prefix"},{default:d(()=>[t(c,{autocomplete:"off",modelValue:u(b,"prefix"),"onUpdate:modelValue":R=>i(b,"prefix",R)},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1024),t(I,{label:"Suffix"},{default:d(()=>[t(c,{autocomplete:"off",modelValue:u(b,"suffix"),"onUpdate:modelValue":R=>i(b,"suffix",R)},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1024),t(I,{label:"Decimal"},{default:d(()=>[t(c,{autocomplete:"off",modelValue:u(b,"decimal"),"onUpdate:modelValue":R=>i(b,"decimal",R),type:"number"},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1024),t(I,{label:"Color"},{default:d(()=>[t(be,{"model-value":u(b,"color"),"onUpdate:modelValue":R=>i(b,"color",R),placement:"left-start"},null,8,["model-value","onUpdate:modelValue"])]),_:2},1024),t(U,{label:"Show short numbers",modelValue:u(b,"shorten_numbers"),"onUpdate:modelValue":R=>i(b,"shorten_numbers",R)},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1032,["model-value","column-options","onUpdate:modelValue","onRemove"])]),_:1},8,["items"]),p("button",{class:"mt-1.5 text-left text-xs text-gray-600 hover:underline",onClick:m[1]||(m[1]=x=>e.value.number_columns.push({}))}," + Add column ")])]),t(ee,{label:"Date",options:s.value,"model-value":e.value.date_column,"onUpdate:modelValue":m[2]||(m[2]=x=>e.value.date_column=x||{})},null,8,["options","model-value"]),t(I,{label:"Prefix"},{default:d(()=>[t(c,{modelValue:e.value.prefix,"onUpdate:modelValue":m[3]||(m[3]=x=>e.value.prefix=x),autocomplete:"off"},null,8,["modelValue"])]),_:1}),t(I,{label:"Suffix"},{default:d(()=>[t(c,{modelValue:e.value.suffix,"onUpdate:modelValue":m[4]||(m[4]=x=>e.value.suffix=x),autocomplete:"off"},null,8,["modelValue"])]),_:1}),t(I,{label:"Decimal"},{default:d(()=>[t(c,{modelValue:e.value.decimal,"onUpdate:modelValue":m[5]||(m[5]=x=>e.value.decimal=x),type:"number",autocomplete:"off"},null,8,["modelValue"])]),_:1}),t(U,{label:"Show short numbers",modelValue:e.value.shorten_numbers,"onUpdate:modelValue":m[6]||(m[6]=x=>e.value.shorten_numbers=x)},null,8,["modelValue"]),(S=e.value.date_column)!=null&&S.column_name?(r(),V(U,{key:0,label:"Show comparison",modelValue:e.value.comparison,"onUpdate:modelValue":m[7]||(m[7]=x=>e.value.comparison=x)},null,8,["modelValue"])):w("",!0),e.value.comparison?(r(),V(U,{key:1,label:"Negative is better",modelValue:e.value.negative_is_better,"onUpdate:modelValue":m[8]||(m[8]=x=>e.value.negative_is_better=x)},null,8,["modelValue"])):w("",!0),e.value.comparison?(r(),V(U,{key:2,label:"Show sparkline",modelValue:e.value.sparkline,"onUpdate:modelValue":m[9]||(m[9]=x=>e.value.sparkline=x)},null,8,["modelValue"])):w("",!0),e.value.sparkline?(r(),V(I,{key:3,label:"Color"},{default:d(()=>[t(be,{"model-value":e.value.sparkline_color,"onUpdate:modelValue":m[10]||(m[10]=x=>f(a)(x)),placement:"left-start"},null,8,["model-value"])]),_:1})):w("",!0)])]}),_:1})}}}),Zl={name:"Popover",inheritAttrs:!1,props:{show:{default:void 0},trigger:{type:String,default:"click"},hoverDelay:{type:Number,default:0},leaveDelay:{type:Number,default:0},placement:{type:String,default:"bottom-start"},popoverClass:[String,Object,Array],bodyClass:[String,Object,Array],transition:{default:null},hideOnBlur:{default:!0}},emits:["open","close","update:show"],expose:["open","close"],data(){return{popoverContainerClass:"body-container",showPopup:!1,targetWidth:null,pointerOverTargetOrPopup:!1}},watch:{show(o){o?this.open():this.close()}},created(){if(!(typeof window>"u")&&!document.getElementById("frappeui-popper-root")){const o=document.createElement("div");o.id="frappeui-popper-root",document.body.appendChild(o)}},mounted(){this.listener=o=>{if(!this.isOpen)return;const l=o.target,e=this.$refs.reference,s=this.$refs.popover;if(l===e||l===s||(e==null?void 0:e.contains(l))||(s==null?void 0:s.contains(l)))return;if(!document.getElementById("frappeui-popper-root").contains(l))return this.close();const i=`.${this.popoverContainerClass}`,v=l==null?void 0:l.closest(i),m=e==null?void 0:e.closest(i);v&&m&&v===m&&this.close()},this.hideOnBlur&&(document.addEventListener("click",this.listener),document.addEventListener("mousedown",this.listener)),this.$nextTick(()=>{this.targetWidth=this.$refs.target.clientWidth})},beforeDestroy(){this.popper&&this.popper.destroy(),document.removeEventListener("click",this.listener),document.removeEventListener("mousedown",this.listener)},computed:{showPropPassed(){return this.show!=null},isOpen:{get(){return this.showPropPassed?this.show:this.showPopup},set(o){o=!!o,this.showPropPassed?this.$emit("update:show",o):this.showPopup=o,o===!1?this.$emit("close"):o===!0&&this.$emit("open")}},popupTransition(){let o={default:{enterActiveClass:"transition duration-150 ease-out",enterFromClass:"translate-y-1 opacity-0",enterToClass:"translate-y-0 opacity-100",leaveActiveClass:"transition duration-150 ease-in",leaveFromClass:"translate-y-0 opacity-100",leaveToClass:"translate-y-1 opacity-0"}};return typeof this.transition=="string"?o[this.transition]:this.transition}},methods:{setupPopper(){this.popper?this.updatePosition():this.popper=Ie(this.$refs.reference,this.$refs.popover,{placement:this.placement})},updatePosition(){this.popper&&this.popper.update()},togglePopover(o){o instanceof Event&&(o=null),o==null&&(o=!this.isOpen),o=!!o,o?this.open():this.close()},open(){this.isOpen=!0,this.$nextTick(()=>this.setupPopper())},close(){this.isOpen=!1},onMouseover(){this.pointerOverTargetOrPopup=!0,this.leaveTimer&&(clearTimeout(this.leaveTimer),this.leaveTimer=null),this.trigger==="hover"&&(this.hoverDelay?this.hoverTimer=setTimeout(()=>{this.pointerOverTargetOrPopup&&this.open()},Number(this.hoverDelay)*1e3):this.open())},onMouseleave(o){this.pointerOverTargetOrPopup=!1,this.hoverTimer&&(clearTimeout(this.hoverTimer),this.hoverTimer=null),this.trigger==="hover"&&(this.leaveTimer&&clearTimeout(this.leaveTimer),this.leaveDelay?this.leaveTimer=setTimeout(()=>{this.pointerOverTargetOrPopup||this.close()},Number(this.leaveDelay)*1e3):this.pointerOverTargetOrPopup||this.close())}}},Jl={ref:"reference"};function Xl(o,l,e,s,n,a){return r(),k("div",Jl,[p("div",{ref:"target",class:W(["flex",o.$attrs.class]),onClick:l[0]||(l[0]=(...u)=>a.updatePosition&&a.updatePosition(...u)),onFocusin:l[1]||(l[1]=(...u)=>a.updatePosition&&a.updatePosition(...u)),onKeydown:l[2]||(l[2]=(...u)=>a.updatePosition&&a.updatePosition(...u)),onMouseover:l[3]||(l[3]=(...u)=>a.onMouseover&&a.onMouseover(...u)),onMouseleave:l[4]||(l[4]=(...u)=>a.onMouseleave&&a.onMouseleave(...u))},[A(o.$slots,"target",te(ae({togglePopover:a.togglePopover,updatePosition:a.updatePosition,open:a.open,close:a.close,isOpen:a.isOpen})))],34),(r(),V(ze,{to:"#frappeui-popper-root"},[p("div",{ref:"popover",class:W(["relative z-[100]",[n.popoverContainerClass,e.popoverClass]]),style:Ee({minWidth:n.targetWidth?n.targetWidth+"px":null}),onMouseover:l[5]||(l[5]=u=>n.pointerOverTargetOrPopup=!0),onMouseleave:l[6]||(l[6]=(...u)=>a.onMouseleave&&a.onMouseleave(...u))},[t(je,te(ae(a.popupTransition)),{default:d(()=>[le(p("div",null,[A(o.$slots,"body",te(ae({togglePopover:a.togglePopover,updatePosition:a.updatePosition,open:a.open,close:a.close,isOpen:a.isOpen})),()=>[p("div",{class:W(["rounded-lg border border-gray-100 bg-white shadow-xl",e.bodyClass])},[A(o.$slots,"body-main",te(ae({togglePopover:a.togglePopover,updatePosition:a.updatePosition,open:a.open,close:a.close,isOpen:a.isOpen})))],2)])],512),[[oe,a.isOpen]])]),_:3},16)],38)]))],512)}const eo=Te(Zl,[["render",Xl]]),lo={name:"Autocomplete",props:["label","modelValue","options","placeholder","bodyClasses","multiple","loading","hideSearch","autoFocus","placement","showFooter","buttonClasses"],emits:["update:modelValue","update:query","change"],components:{Popover:eo,Combobox:Ge,ComboboxInput:We,ComboboxOptions:Qe,ComboboxOption:He,ComboboxButton:Ke,CheckSquare:wl,Square:kl},expose:["togglePopover"],data(){return{query:"",showOptions:!1}},computed:{selectedValue:{get(){var l;let o;return this.multiple?(o=(l=this.modelValue)==null?void 0:l.map(e=>{const s=this.findOption(e);return s||this.sanitizeOption(e)}),this.modelValue&&!o.length&&(o=this.sanitizeOptions(this.modelValue)),o):(o=this.findOption(this.modelValue),this.modelValue&&!o&&(o=this.sanitizeOption(this.modelValue)),o)},set(o){this.query="",o&&!this.multiple&&(this.showOptions=!1),this.$emit("update:modelValue",o)}},groups(){var l;return!this.options||this.options.length==0?[]:((l=this.options[0])!=null&&l.group?this.options:[{group:"",items:this.sanitizeOptions(this.options)}]).map((e,s)=>({key:s,group:e.group,hideLabel:e.hideLabel||!1,items:this.filterOptions(this.sanitizeOptions(e.items))})).filter(e=>e.items.length>0)},allOptions(){return this.groups.flatMap(o=>o.items)},areAllOptionsSelected(){var o;return this.multiple?this.allOptions.length===((o=this.selectedValue)==null?void 0:o.length):!1}},watch:{query(o){this.$emit("update:query",o)},showOptions(o){o&&Ye(()=>{var l,e;return(e=(l=this.$refs.searchInput)==null?void 0:l.$el)==null?void 0:e.focus()})}},methods:{togglePopover(o){this.showOptions=o??!this.showOptions},findOption(o){return o&&this.allOptions.find(l=>l.value===(o.value||o))},filterOptions(o){return this.query?dl(o,{term:this.query,keys:["label","value"]}):o},displayValue(o){if(!o)return"";if(!this.multiple){if(typeof o=="object")return this.getLabel(o);let l=this.allOptions.find(e=>e.value===o);return this.getLabel(l)}return!Array.isArray(o)||o.length===0?"":o.length===1?this.getLabel(o[0]):`${o.length} selected`},getLabel(o){return typeof o!="object"?o:(o==null?void 0:o.label)||(o==null?void 0:o.value)||"No label"},sanitizeOptions(o){return o?o.map(l=>this.sanitizeOption(l)):[]},sanitizeOption(o){return typeof o=="string"?{label:o,value:o}:o},isOptionSelected(o){var l,e;return this.multiple?(e=this.selectedValue)==null?void 0:e.find(s=>s&&s.value===o.value):((l=this.selectedValue)==null?void 0:l.value)===o.value},selectAll(){this.selectedValue=this.allOptions},clearAll(){this.selectedValue=[]}}},oo={class:"w-full space-y-1.5"},to={key:0,class:"block text-xs text-gray-600"},ao=["onClick"],no={class:"flex flex-1 items-center gap-2 overflow-hidden"},so={key:0,class:"flex-1 truncate text-left text-base leading-5"},uo={key:1,class:"text-base leading-5 text-gray-500"},io={key:0,class:"relative mb-1 w-full flex-shrink-0"},ro={class:"w-full flex-1 overflow-y-auto"},mo={key:0,class:"sticky top-0 truncate bg-white px-2.5 py-1.5 text-sm font-medium text-gray-600"},co={class:"flex flex-1 items-center gap-2 overflow-hidden"},po={key:0,class:"flex-shrink-0"},vo={class:"flex-1 truncate"},fo={key:0,class:"ml-2 flex-shrink-0"},_o={key:0,class:"text-sm text-gray-600"},bo={key:1,class:"rounded-md px-2.5 py-1.5 text-base text-gray-600"},go={key:0,class:"border-t p-1"},ho={key:0,class:"flex items-center justify-end"},yo={key:1,class:"flex items-center justify-end"};function Vo(o,l,e,s,n,a){const u=T("FeatherIcon"),i=T("LoadingIndicator"),v=T("ComboboxInput"),m=T("Square"),c=T("CheckSquare"),U=T("ComboboxOption"),S=T("ComboboxOptions"),x=T("Button"),b=xl,R=T("Combobox");return r(),V(R,{modelValue:a.selectedValue,"onUpdate:modelValue":l[4]||(l[4]=O=>a.selectedValue=O),multiple:e.multiple,nullable:""},{default:d(({open:O})=>[t(b,{class:"w-full",show:n.showOptions,"onUpdate:show":l[3]||(l[3]=h=>n.showOptions=h),placement:e.placement},{target:d(({open:h,togglePopover:M,close:_})=>[A(o.$slots,"target",te(ae({open:h,close:_,togglePopover:M,isOpen:O})),()=>[p("div",oo,[o.$props.label?(r(),k("label",to,E(o.$props.label),1)):w("",!0),p("button",{class:W(["flex h-7 w-full items-center justify-between gap-2 rounded bg-gray-100 py-1 px-2 transition-colors hover:bg-gray-200 focus:ring-2 focus:ring-gray-400",[O?"bg-gray-200":"",o.$props.buttonClasses]]),onClick:()=>M()},[p("div",no,[A(o.$slots,"prefix"),a.selectedValue?(r(),k("span",so,E(a.displayValue(a.selectedValue)),1)):(r(),k("span",uo,E(e.placeholder||""),1)),A(o.$slots,"suffix")]),le(t(u,{name:"chevron-down",class:"h-4 w-4 text-gray-600","aria-hidden":"true"},null,512),[[oe,!o.$props.loading]]),le(t(i,{class:"h-4 w-4 text-gray-600"},null,512),[[oe,o.$props.loading]])],10,ao)])])]),body:d(({isOpen:h,togglePopover:M})=>[le(p("div",null,[p("div",{class:W(["relative mt-1 overflow-hidden rounded-lg bg-white text-base shadow-2xl",e.bodyClasses])},[t(S,{class:"flex max-h-[15rem] flex-col overflow-hidden p-1.5",static:""},{default:d(()=>[e.hideSearch?w("",!0):(r(),k("div",io,[t(v,{ref:"searchInput",class:"form-input w-full",type:"text",value:n.query,onChange:l[0]||(l[0]=_=>n.query=_.target.value),autocomplete:"off",placeholder:"Search"},null,8,["value"]),p("button",{class:"absolute right-0 inline-flex h-7 w-7 items-center justify-center",onClick:l[1]||(l[1]=_=>a.selectedValue=null)},[t(u,{name:"x",class:"w-4"})])])),p("div",ro,[(r(!0),k(D,null,ie(a.groups,_=>le((r(),k("div",{key:_.key},[_.group&&!_.hideLabel?(r(),k("div",mo,E(_.group),1)):w("",!0),(r(!0),k(D,null,ie(_.items.slice(0,50),(g,z)=>(r(),V(U,{as:"template",key:(g==null?void 0:g.value)||z,value:g,disabled:g.disabled},{default:d(({active:q,selected:J})=>[p("li",{class:W(["flex h-7 cursor-pointer items-center justify-between rounded px-2.5 text-base",{"bg-gray-100":q,"opacity-50":g.disabled}])},[p("div",co,[o.$slots["item-prefix"]||o.$props.multiple?(r(),k("div",po,[A(o.$slots,"item-prefix",re({ref_for:!0},{active:q,selected:J,option:g}),()=>[le(t(m,{class:"h-4 w-4 text-gray-700"},null,512),[[oe,!a.isOptionSelected(g)]]),le(t(c,{class:"h-4 w-4 text-gray-700"},null,512),[[oe,a.isOptionSelected(g)]])])])):w("",!0),p("span",vo,E(a.getLabel(g)),1)]),o.$slots["item-suffix"]||g!=null&&g.description?(r(),k("div",fo,[A(o.$slots,"item-suffix",re({ref_for:!0},{active:q,selected:J,option:g}),()=>[g!=null&&g.description?(r(),k("div",_o,E(g.description),1)):w("",!0)])])):w("",!0)],2)]),_:2},1032,["value","disabled"]))),128))])),[[oe,_.items.length>0]])),128))]),a.groups.length==0?(r(),k("li",bo," No options available ")):w("",!0)]),_:3}),o.$slots.footer||e.showFooter||e.multiple?(r(),k("div",go,[A(o.$slots,"footer",te(ae({togglePopover:M})),()=>[e.multiple?(r(),k("div",ho,[a.areAllOptionsSelected?w("",!0):(r(),V(x,{key:0,label:"Select All",onClick:ce(a.selectAll,["stop"])},null,8,["onClick"])),a.areAllOptionsSelected?(r(),V(x,{key:1,label:"Clear All",onClick:ce(a.clearAll,["stop"])},null,8,["onClick"])):w("",!0)])):(r(),k("div",yo,[t(x,{label:"Clear",onClick:l[2]||(l[2]=ce(_=>a.selectedValue=null,["stop"]))})]))])])):w("",!0)],2)],512),[[oe,h]])]),_:2},1032,["show","placement"])]),_:3},8,["modelValue","multiple"])}const xo=Te(lo,[["render",Vo]]),Y=P({__name:"FormControl",setup(o){return(l,e)=>(r(),V(f(ge),re(l.$attrs,{autocomplete:"off"}),{default:d(()=>[A(l.$slots,"default")]),_:3},16))}}),wo=["aria-labelledby"],ko=P({__name:"Radio",props:{modelValue:{},name:{},disabled:{type:Boolean,default:!1}},emits:["update:modelValue"],setup(o,{emit:l}){const e=o,s=l,n=$(()=>`radio-group-${Math.random().toString(36).substr(2,9)}`),a=u=>{e.disabled||s("update:modelValue",u)};return Re("radioGroup",{modelValue:$(()=>e.modelValue),name:$(()=>e.name),disabled:$(()=>e.disabled),updateValue:a}),(u,i)=>(r(),k("div",re({class:"flex flex-col gap-2",role:"radiogroup","aria-labelledby":n.value},u.$attrs),[A(u.$slots,"default")],16,wo))}}),Co={class:"relative flex items-start"},Oo=["id","name","value","checked","disabled","aria-describedby"],Uo=["for"],Se=P({__name:"RadioGroupItem",props:{value:{},disabled:{type:Boolean,default:!1},id:{},describedBy:{}},setup(o,{expose:l}){const e=o,s=de("radioGroup"),n=Q(),a=$(()=>e.id||`radio-${Math.random().toString(36).substr(2,9)}`),u=$(()=>{var m;return((m=s==null?void 0:s.modelValue)==null?void 0:m.value)===e.value}),i=$(()=>{var m;return e.disabled||((m=s==null?void 0:s.disabled)==null?void 0:m.value)}),v=()=>{i.value||s==null||s.updateValue(e.value)};return l({inputRef:n}),(m,c)=>{var U,S;return r(),k("div",Co,[p("input",re({id:a.value,ref_key:"inputRef",ref:n,type:"radio",name:(S=(U=f(s))==null?void 0:U.name)==null?void 0:S.value,value:m.value,checked:u.value,disabled:i.value,"aria-describedby":m.describedBy,class:"sr-only peer",onChange:v},m.$attrs),null,16,Oo),p("label",{for:a.value,class:W(["flex items-center gap-2 text-sm font-medium leading-none cursor-pointer",{"cursor-not-allowed opacity-70":i.value}])},[p("span",{class:W(["flex h-4 w-4 aspect-square items-center justify-center rounded-full border transition-colors duration-200 ease-in-out",[u.value?"border-black bg-black":"border-gray-300",i.value&&"border-gray-200 bg-gray-100"]])},[p("span",{class:W(["h-2 w-2 rounded-full transition-opacity duration-200",[u.value?"opacity-100":"opacity-0",i.value&&u.value?"bg-gray-400":"bg-white"]])},null,2)],2),A(m.$slots,"default")],10,Uo)])}}}),So={class:"flex flex-col gap-1.5 relative"},$o={key:0,class:"text-xs text-red-500"},To={key:0,class:"w-full"},Ro={key:1,class:"flex flex-col gap-3"},Fo=P({__name:"FormatRule",props:B({columnOptions:{},formatMode:{}},{modelValue:{required:!0},modelModifiers:{}}),emits:["update:modelValue"],setup(o){const l=L(o,"modelValue"),e=o;Ze(()=>{var y;if((y=l.value.column)!=null&&y.column_name)return;const C=s("");n(C,"")}),Je(()=>e.formatMode,C=>{const y=l.value.column;if(C==="cell_rules"){const N=s(y.column_name);n(N,y.column_name)}else{const N={mode:"color_scale",column:y,colorScale:x[0].value,value:void 0};l.value=N}});function s(C){const N=ve(e.columnOptions).find(X=>X.value===C);return N?["Date","Datetime","Time"].includes(N.data_type)?"date_rules":["String","Text"].includes(N.data_type)?"text_rules":(["Decimal","Number","Integer"].includes(N.data_type),"cell_rules"):"cell_rules"}function n(C,y){switch(C){case"text_rules":const N={mode:"text_rules",column:Z(y),operator:c[0].value,color:v[0].value,value:""};l.value=N;break;case"date_rules":const X={mode:"date_rules",column:Z(y),operator:U[0].value,color:v[0].value,value:void 0};l.value=X;break;case"rank_rules":const F={mode:"rank_rules",column:Z(y),operator:S[0].value,color:v[0].value,value:5};l.value=F;break;default:const Ne={mode:"cell_rules",column:Z(y),operator:m[0].value,color:v[0].value,value:0};l.value=Ne}}function a(C){if(e.formatMode==="cell_rules"){const y=s(C);n(y,C)}else{const y={mode:"color_scale",column:Z(C),colorScale:x[0].value,value:void 0};l.value=y}}const u=$(()=>{var N;if(!((N=e.columnOptions)!=null&&N.length)||!l.value.column.column_name)return;const y=ve(e.columnOptions).find(X=>X.value===l.value.column.column_name);if(y)return y.data_type}),i=$(()=>{const C=ve(e.columnOptions);return e.formatMode==="color_scale"?C.filter(y=>["Decimal","Number","Integer"].includes(y.data_type)):C}),v=[{label:"Red",value:"red"},{label:"Green",value:"green"},{label:"Amber",value:"amber"}],m=[{label:"equals",value:"="},{label:"not equals",value:"!="},{label:"greater than",value:">"},{label:"greater than or equals",value:">="},{label:"less than",value:"<"},{label:"less than or equals",value:"<="}],c=[{label:"contains",value:"contains"},{label:"does not contain",value:"not_contains"},{label:"starts with",value:"starts_with"},{label:"ends with",value:"ends_with"},{label:"equals",value:"equals_text"},{label:"does not equal",value:"not_equals_text"},{label:"is empty",value:"is_empty"},{label:"is not empty",value:"is_not_empty"}],U=[{label:"is today",value:"is_today"},{label:"is yesterday",value:"is_yesterday"},{label:"is tomorrow",value:"is_tomorrow"},{label:"is this week",value:"is_this_week"},{label:"is last week",value:"is_last_week"},{label:"is this month",value:"is_this_month"},{label:"is last month",value:"is_last_month"},{label:"is this year",value:"is_this_year"},{label:"before date",value:"date_before"},{label:"after date",value:"date_after"},{label:"between dates",value:"date_between"}],S=[{label:"Top N values",value:"top_n"},{label:"Bottom N values",value:"bottom_n"},{label:"Top N percent",value:"top_percent"},{label:"Bottom N percent",value:"bottom_percent"},{label:"Above average",value:"above_average"},{label:"Below average",value:"below_average"}],x=[{label:"Red-Green",value:"Red-Green"},{label:"Green-Red",value:"Green-Red"}],b=$(()=>{const C=[];return["Decimal","Number","Integer"].includes(u.value||"")&&C.push({label:"Value Rules",value:"cell_rules"},{label:"Ranking Rules",value:"rank_rules"}),["String","Text"].includes(u.value||"")&&C.push({label:"Text Rules",value:"text_rules"}),["Date","Datetime","Time"].includes(u.value||"")&&C.push({label:"Date Rules",value:"date_rules"}),C});function R(C){n(C,l.value.column.column_name)}function O(C){(l.value.mode==="cell_rules"||l.value.mode==="text_rules"||l.value.mode==="date_rules"||l.value.mode==="rank_rules")&&(l.value.operator=C)}function h(C){e.formatMode==="color_scale"&&l.value.mode==="color_scale"&&(l.value.colorScale=C)}function M(C){(l.value.mode==="cell_rules"||l.value.mode==="text_rules"||l.value.mode==="date_rules"||l.value.mode==="rank_rules")&&(l.value.color=C)}const _=$(()=>l.value.mode==="cell_rules"),g=$(()=>l.value.mode==="text_rules"),z=$(()=>l.value.mode==="date_rules"),q=$(()=>l.value.mode==="rank_rules"),J=$(()=>l.value.mode==="cell_rules"||l.value.mode==="text_rules"||l.value.mode==="date_rules"||l.value.mode==="rank_rules"?l.value.color:""),K=$(()=>{if(!g.value)return!1;const C=l.value.operator;return!["is_empty","is_not_empty"].includes(C)}),Be=$(()=>{if(!z.value)return!1;const C=l.value.operator;return["date_before","date_after","date_between"].includes(C)}),Le=$(()=>{if(!q.value)return!1;const C=l.value.operator;return["top_n","bottom_n","top_percent","bottom_percent"].includes(C)}),Ve=$(()=>!!(l.value.column.column_name&&!i.value.find(C=>C.value===l.value.column.column_name)));return(C,y)=>{var N,X;return r(),k(D,null,[p("div",So,[t(xo,{label:"Column",placeholder:"Column",modelValue:(N=l.value.column)==null?void 0:N.column_name,options:i.value,"onUpdate:modelValue":y[0]||(y[0]=F=>a(typeof F=="string"?F:F==null?void 0:F.value))},null,8,["modelValue","options"]),Ve.value?(r(),k("p",$o,"Invalid Column")):w("",!0)]),Ve.value?w("",!0):(r(),k(D,{key:0},[e.formatMode==="color_scale"?(r(),k("div",To,[p("div",null,[y[15]||(y[15]=p("h3",{class:"text-sm text-gray-600 mb-3"},"Color",-1)),t(ko,{name:"color-scale",modelValue:l.value.colorScale,"onUpdate:modelValue":y[1]||(y[1]=F=>h(F))},{default:d(()=>[t(Se,{value:"Red-Green",class:"[&_label]:w-full"},{default:d(()=>y[13]||(y[13]=[p("div",{class:"flex items-center justify-between gap-2 w-full"},[p("span",{class:"text-sm"},"Red to Green"),p("div",{class:"flex h-2 w-32"},[p("div",{class:"w-1/2 bg-red-400"}),p("div",{class:"w-1/2 bg-red-300"}),p("div",{class:"w-1/2 bg-green-300"}),p("div",{class:"w-1/2 bg-green-500"})])],-1)])),_:1}),t(Se,{value:"Green-Red",class:"[&_label]:w-full"},{default:d(()=>y[14]||(y[14]=[p("div",{class:"flex items-center justify-between gap-2 w-full"},[p("span",{class:"text-sm"},"Green to Red"),p("div",{class:"flex h-2 w-32"},[p("div",{class:"w-1/2 bg-green-500"}),p("div",{class:"w-1/2 bg-green-300"}),p("div",{class:"w-1/2 bg-red-300"}),p("div",{class:"w-1/2 bg-red-400"})])],-1)])),_:1})]),_:1},8,["modelValue"])])])):(r(),k("div",Ro,[b.value.length>1?(r(),V(Y,{key:0,type:"select",label:"Rule Type",placeholder:"Rule Type",modelValue:l.value.mode,options:b.value,"onUpdate:modelValue":y[2]||(y[2]=F=>R(F))},null,8,["modelValue","options"])):w("",!0),_.value?(r(),k(D,{key:1},[t(Y,{type:"select",label:"Condition",placeholder:"Operator",modelValue:l.value.operator,options:m,"onUpdate:modelValue":y[3]||(y[3]=F=>O(F))},null,8,["modelValue"]),t(Y,{type:"number",label:"Compare to",modelValue:l.value.value,placeholder:"Value","onUpdate:modelValue":y[4]||(y[4]=F=>l.value.value=Number(F))},null,8,["modelValue"])],64)):w("",!0),g.value?(r(),k(D,{key:2},[t(Y,{type:"select",label:"Condition",modelValue:l.value.operator,options:c,"onUpdate:modelValue":y[5]||(y[5]=F=>O(F))},null,8,["modelValue"]),K.value?(r(),V(Y,{key:0,type:"text",label:"Text Value",modelValue:l.value.value,placeholder:"Enter text","onUpdate:modelValue":y[6]||(y[6]=F=>l.value.value=F)},null,8,["modelValue"])):w("",!0)],64)):w("",!0),z.value?(r(),k(D,{key:3},[t(Y,{type:"select",label:"Condition",modelValue:l.value.operator,options:U,"onUpdate:modelValue":y[7]||(y[7]=F=>O(F))},null,8,["modelValue"]),Be.value?(r(),k(D,{key:0},[y[16]||(y[16]=p("h3",{class:"text-sm text-gray-600"},"Date Value",-1)),l.value.operator==="date_between"?(r(),V(we,{key:0,modelValue:l.value.value,"onUpdate:modelValue":y[8]||(y[8]=F=>l.value.value=F),range:!0},null,8,["modelValue"])):(r(),V(we,{key:1,modelValue:l.value.value,"onUpdate:modelValue":y[9]||(y[9]=F=>l.value.value=F),range:!1},null,8,["modelValue"]))],64)):w("",!0)],64)):w("",!0),q.value?(r(),k(D,{key:4},[t(Y,{type:"select",placeholder:"Ranking Condition",label:"Rule",modelValue:l.value.operator,options:S,"onUpdate:modelValue":y[10]||(y[10]=F=>O(F))},null,8,["modelValue"]),Le.value?(r(),V(Y,{key:0,label:"value",type:"number",modelValue:l.value.value,placeholder:(X=l.value.operator)!=null&&X.includes("percent")?"Percentage (1-100)":"Number of items","onUpdate:modelValue":y[11]||(y[11]=F=>l.value.value=Number(F))},null,8,["modelValue","placeholder"])):w("",!0)],64)):w("",!0),t(Y,{type:"select",label:"Color",placeholder:"Color",modelValue:J.value,options:v,"onUpdate:modelValue":y[12]||(y[12]=F=>M(F))},null,8,["modelValue"])]))],64))],64)}}}),Mo={class:"min-w-[20rem] rounded-lg bg-white px-4 pb-6 pt-5 sm:px-6"},Po={class:"flex items-center justify-between pb-4"},qo={class:"flex flex-col gap-3"},Do={class:"mt-6 flex items-center justify-end gap-2"},Ao=P({__name:"FormattingSelector",props:{initialRule:{},columnOptions:{}},emits:["close","select"],setup(o,{emit:l}){const e=o,s=l,n=Xe(e.initialRule?{...e.initialRule}:{mode:"cell_rules",column:Z(""),operator:"=",color:"red",value:0}),a=Q(n.mode==="color_scale"?"color_scale":"cell_rules");function u(){const v={formats:[n],columns:[n.column]};s("select",v)}const i=$(()=>e.initialRule?JSON.stringify(e.initialRule)!==JSON.stringify(n):!0);return(v,m)=>{const c=T("Button"),U=T("FormControl");return r(),k("div",Mo,[p("div",Po,[m[3]||(m[3]=p("h3",{class:"text-2xl font-semibold leading-6 text-gray-900"},"Formatting Rule",-1)),t(c,{variant:"ghost",onClick:m[0]||(m[0]=()=>s("close")),icon:"x",size:"md"})]),p("div",qo,[t(U,{type:"select",modelValue:a.value,"onUpdate:modelValue":m[1]||(m[1]=S=>a.value=S),label:"Format Type",options:[{label:"Highlight Cell",value:"cell_rules"},{label:"Color Scale",value:"color_scale"}]},null,8,["modelValue"]),t(Fo,{modelValue:n,columnOptions:e.columnOptions,formatMode:a.value,"onUpdate:modelValue":m[2]||(m[2]=S=>Object.assign(n,S))},null,8,["modelValue","columnOptions","formatMode"])]),p("div",Do,[t(c,{label:"Apply",variant:"solid",disabled:!i.value,onClick:u},null,8,["disabled"])])])}}}),Bo=P({__name:"ConditonalFormattingDialog",props:B({columnOptions:{},initialRule:{},selectorKey:{}},{modelValue:{},modelModifiers:{}}),emits:B({select:o=>!0},["update:modelValue"]),setup(o,{emit:l}){const e=o,s=l,n=L(o,"modelValue");function a(u){s("select",u),n.value=!1}return(u,i)=>(r(),V(f(el),{modelValue:n.value,"onUpdate:modelValue":i[1]||(i[1]=v=>n.value=v),options:{size:"md"}},{body:d(()=>[(r(),V(Ao,{key:e.selectorKey??"new","initial-rule":e.initialRule??null,"column-options":e.columnOptions,onSelect:a,onClose:i[0]||(i[0]=v=>n.value=!1)},null,8,["initial-rule","column-options"]))]),_:1},8,["modelValue"]))}}),Lo={class:"flex flex-col gap-3"},No={class:"flex flex-col gap-3"},Io={class:"tnum"},jo={class:"flex flex-col gap-2"},Eo={key:0,class:"flex flex-col gap-1"},zo={class:"flex-1 overflow-hidden"},Go=P({__name:"TableChartConfigForm",props:B({formatGroup:{},dimensions:{},columnOptions:{}},{modelValue:{required:!0,default:()=>({rows:[],columns:[],values:[],enable_color_scale:!1})},modelModifiers:{}}),emits:B({select:o=>!0},["update:modelValue"]),setup(o,{emit:l}){const e=o,s=L(o,"modelValue"),n=Q(!1),a=Q(null),u=Q(null);H(()=>{var O,h,M;(O=s.value.rows)!=null&&O.length||(s.value.rows=[{}]),(h=s.value.columns)!=null&&h.length||(s.value.columns=[{}]),(M=s.value.values)!=null&&M.length||(s.value.values=[{}])});const i=$(()=>e.columnOptions.filter(O=>ue.NUMBER.includes(O.data_type)).map(O=>({column_name:O.value,data_type:O.data_type,dimension_name:O.label,label:O.label,value:O.value}))),v=$(()=>[...e.dimensions,...i.value]);function m(O,h,M,_){return{query:"",label:O[h],data_type:O[_],value:O[M],description:O[_]}}const c=$(()=>{const O=s.value.values.filter(_=>_==null?void 0:_.measure_name).map(_=>m(_,"measure_name","measure_name","data_type")),h=s.value.columns.filter(_=>_==null?void 0:_.column_name).map(_=>m(_,"column_name","column_name","data_type")),M=s.value.rows.filter(_=>_==null?void 0:_.dimension_name).map(_=>m(_,"dimension_name","dimension_name","data_type"));return[...O,...h,...M]}),U=$(()=>c.value||[]);function S(O){var M;const h=(M=s.value.conditional_formatting)==null?void 0:M.formats[O];h&&(u.value=h,a.value=O,n.value=!0)}function x(){a.value=null,u.value=null,n.value=!0}function b(O){var M;const h=O.formats[0];if(h&&((M=h.column)!=null&&M.column_name)){s.value.conditional_formatting||(s.value.conditional_formatting={formats:[],columns:[]});const _=a.value;_!==null?s.value.conditional_formatting.formats[_]=h:s.value.conditional_formatting.formats.push(h),a.value=null,u.value=null}}function R(O){const h=c.value.find(M=>M.data_type===O);return h?h.data_type:"String"}return(O,h)=>{var _;const M=T("Toggle");return r(),k(D,null,[t(j,{title:"Rows"},{default:d(()=>[p("div",null,[t(ne,{items:s.value.rows,"onUpdate:items":h[0]||(h[0]=g=>s.value.rows=g),group:"rows"},{item:d(({item:g,index:z})=>[t(ee,{options:v.value,"model-value":g,"onUpdate:modelValue":q=>Object.assign(g,q||{}),onRemove:q=>s.value.rows.splice(z,1)},null,8,["options","model-value","onUpdate:modelValue","onRemove"])]),_:1},8,["items"]),p("button",{class:"mt-1.5 text-left text-xs text-gray-600 hover:underline",onClick:h[1]||(h[1]=g=>s.value.rows.push({}))}," + Add column ")])]),_:1}),t(j,{title:"Columns"},{default:d(()=>[p("div",Lo,[p("div",null,[t(ne,{items:s.value.columns,"onUpdate:items":h[2]||(h[2]=g=>s.value.columns=g),group:"columns"},{item:d(({item:g,index:z})=>[t(ee,{options:e.dimensions,"model-value":g,"onUpdate:modelValue":q=>Object.assign(g,q||{}),onRemove:q=>s.value.columns.splice(z,1)},null,8,["options","model-value","onUpdate:modelValue","onRemove"])]),_:1},8,["items"]),p("button",{class:"mt-1.5 text-left text-xs text-gray-600 hover:underline",onClick:h[3]||(h[3]=g=>s.value.columns.push({}))}," + Add column ")]),s.value.columns.length?(r(),V(I,{key:0,class:"!w-1/2",label:"Max Column Values"},{default:d(()=>[t(f(ge),{type:"number",autocomplete:"off",modelValue:s.value.max_column_values,"onUpdate:modelValue":h[4]||(h[4]=g=>s.value.max_column_values=g)},null,8,["modelValue"])]),_:1})):w("",!0)])]),_:1}),t(j,{title:"Values"},{default:d(()=>[p("div",No,[p("div",null,[t(ne,{items:s.value.values,"onUpdate:items":h[5]||(h[5]=g=>s.value.values=g),group:"values"},{item:d(({item:g,index:z})=>[t(se,{"model-value":g,"column-options":e.columnOptions,"onUpdate:modelValue":q=>Object.assign(g,q||{}),onRemove:q=>s.value.values.splice(z,1)},null,8,["model-value","column-options","onUpdate:modelValue","onRemove"])]),_:1},8,["items"]),p("button",{class:"mt-1.5 text-left text-xs text-gray-600 hover:underline",onClick:h[6]||(h[6]=g=>s.value.values.push({}))}," + Add column ")]),t(M,{label:"Show Filters",modelValue:s.value.show_filter_row,"onUpdate:modelValue":h[7]||(h[7]=g=>s.value.show_filter_row=g)},null,8,["modelValue"]),t(M,{label:"Show Row Totals",modelValue:s.value.show_row_totals,"onUpdate:modelValue":h[8]||(h[8]=g=>s.value.show_row_totals=g)},null,8,["modelValue"]),t(M,{label:"Show Column Totals",modelValue:s.value.show_column_totals,"onUpdate:modelValue":h[9]||(h[9]=g=>s.value.show_column_totals=g)},null,8,["modelValue"]),t(M,{label:"Compact Number Format",modelValue:s.value.compact_numbers,"onUpdate:modelValue":h[10]||(h[10]=g=>s.value.compact_numbers=g)},null,8,["modelValue"]),s.value.values.length===1?(r(),V(M,{key:0,label:"Show Color Scale",modelValue:s.value.enable_color_scale,"onUpdate:modelValue":h[11]||(h[11]=g=>s.value.enable_color_scale=g)},null,8,["modelValue"])):w("",!0)])]),_:1}),t(j,{title:"Formatting Rules",collapsed:""},fe({default:d(()=>{var g,z;return[p("div",jo,[(g=s.value.conditional_formatting)!=null&&g.formats.length?(r(),k("div",Eo,[(r(!0),k(D,null,ie((z=s.value.conditional_formatting)==null?void 0:z.formats,(q,J)=>(r(),k("div",{key:J,class:"flex rounded"},[p("div",zo,[t(f(pe),{class:"w-full !justify-start rounded-r-none [&>span]:truncate",onClick:K=>S(J)},{prefix:d(()=>{var K;return[t(Fe,{"column-type":R((K=q.column)==null?void 0:K.column_name)},null,8,["column-type"])]}),default:d(()=>{var K;return[G(" "+E((K=q.column)==null?void 0:K.column_name),1)]}),_:2},1032,["onClick"])]),t(f(pe),{class:"flex-shrink-0 rounded-l-none border-l",onClick:K=>s.value.conditional_formatting.formats.splice(J,1)},{icon:d(()=>[t(f(me),{class:"h-4 w-4 text-gray-700","stroke-width":"1.5"})]),_:2},1032,["onClick"])]))),128))])):w("",!0),t(f(pe),{class:"w-full",onClick:x},{prefix:d(()=>[t(f(ye),{class:"h-4 w-4 text-gray-700","stroke-width":"1.5"})]),default:d(()=>[h[13]||(h[13]=G(" Add Rule "))]),_:1})])]}),_:2},[(_=s.value.conditional_formatting)!=null&&_.formats.length?{name:"title-suffix",fn:d(()=>[t(f(_e),{theme:"orange"},{default:d(()=>[p("span",Io,E(s.value.conditional_formatting.formats.length),1)]),_:1})]),key:"0"}:void 0]),1024),n.value?(r(),V(Bo,{key:0,modelValue:n.value,"onUpdate:modelValue":h[12]||(h[12]=g=>n.value=g),"column-options":U.value,"initial-rule":u.value,"selector-key":a.value??"new",onSelect:b},null,8,["modelValue","column-options","initial-rule","selector-key"])):w("",!0)],64)}}}),Wo=P({__name:"ChartConfigForm",props:{chart:{}},setup(o){const l=o,e=$(()=>l.chart.doc.query?he(l.chart.doc.query):{}),s=$(()=>e.value.dimensions?e.value.dimensions.map(a=>({...a,label:a.column_name,value:a.column_name})):[]),n=$(()=>{var a;return((a=e.value.result)==null?void 0:a.columnOptions)||[]});return(a,u)=>(r(),k(D,null,[l.chart.doc.chart_type=="Number"?(r(),V(Yl,{key:0,modelValue:l.chart.doc.config,"onUpdate:modelValue":u[0]||(u[0]=i=>l.chart.doc.config=i),dimensions:s.value,"column-options":n.value},null,8,["modelValue","dimensions","column-options"])):w("",!0),l.chart.doc.chart_type=="Donut"?(r(),V(El,{key:1,modelValue:l.chart.doc.config,"onUpdate:modelValue":u[1]||(u[1]=i=>l.chart.doc.config=i),dimensions:s.value,"column-options":n.value},null,8,["modelValue","dimensions","column-options"])):w("",!0),l.chart.doc.chart_type=="Funnel"?(r(),V(Gl,{key:2,modelValue:l.chart.doc.config,"onUpdate:modelValue":u[2]||(u[2]=i=>l.chart.doc.config=i),dimensions:s.value,"column-options":n.value},null,8,["modelValue","dimensions","column-options"])):w("",!0),l.chart.doc.chart_type=="Table"?(r(),V(Go,{key:3,modelValue:l.chart.doc.config,"onUpdate:modelValue":u[3]||(u[3]=i=>l.chart.doc.config=i),dimensions:s.value,"column-options":n.value},null,8,["modelValue","dimensions","column-options"])):w("",!0),l.chart.doc.chart_type=="Bar"||l.chart.doc.chart_type=="Row"?(r(),V(Il,{key:4,modelValue:l.chart.doc.config,"onUpdate:modelValue":u[4]||(u[4]=i=>l.chart.doc.config=i),dimensions:s.value,"column-options":n.value},null,8,["modelValue","dimensions","column-options"])):w("",!0),l.chart.doc.chart_type=="Line"?(r(),V(Wl,{key:5,modelValue:l.chart.doc.config,"onUpdate:modelValue":u[5]||(u[5]=i=>l.chart.doc.config=i),dimensions:s.value,"column-options":n.value},null,8,["modelValue","dimensions","column-options"])):w("",!0),l.chart.doc.chart_type=="Map"?(r(),V(Hl,{key:6,modelValue:l.chart.doc.config,"onUpdate:modelValue":u[6]||(u[6]=i=>l.chart.doc.config=i),dimensions:s.value,"column-options":n.value},null,8,["modelValue","dimensions","column-options"])):w("",!0)],64))}}),Qo={class:"flex flex-col gap-2"},Ho={key:0,class:"flex flex-col gap-1"},Ko={class:"flex-1 overflow-hidden"},Yo=P({__name:"ChartFilterConfig",props:{modelValue:{default:()=>({logical_operator:"And",filters:[]})},modelModifiers:{}},emits:["update:modelValue"],setup(o){const l=L(o,"modelValue"),e=de("chart"),s=$(()=>e.doc.query?he(e.doc.query).result.columnOptions:[]),n=Q(!1);function a(i){const v=s.value.find(m=>m.value===i);return v?v.data_type:"String"}function u(i){return"column"in i?`${i.column.column_name} ${i.operator} ${i.value}`:i.expression}return(i,v)=>{const m=T("Button");return r(),k(D,null,[p("div",Qo,[l.value.filters.length?(r(),k("div",Ho,[(r(!0),k(D,null,ie(l.value.filters,(c,U)=>(r(),k("div",{key:U,class:"flex rounded"},[p("div",Ko,[t(m,{class:"w-full !justify-start rounded-r-none [&>span]:truncate",onClick:v[0]||(v[0]=S=>n.value=!0)},{prefix:d(()=>["column"in c?(r(),V(Fe,{key:0,"column-type":a(c.column.column_name)},null,8,["column-type"])):w("",!0)]),default:d(()=>[G(" "+E(u(c)),1)]),_:2},1024)]),t(m,{class:"flex-shrink-0 rounded-l-none border-l",onClick:S=>l.value.filters.splice(U,1)},{icon:d(()=>[t(f(me),{class:"h-4 w-4 text-gray-700","stroke-width":"1.5"})]),_:2},1032,["onClick"])]))),128))])):w("",!0),t(m,{class:"w-full",onClick:v[1]||(v[1]=c=>n.value=!0)},{prefix:d(()=>[t(f(ye),{class:"h-4 w-4 text-gray-700","stroke-width":"1.5"})]),default:d(()=>[v[4]||(v[4]=G(" Add Filter "))]),_:1})]),n.value?(r(),V(ul,{key:0,modelValue:n.value,"onUpdate:modelValue":v[2]||(v[2]=c=>n.value=c),"filter-group":l.value,"column-options":s.value,onSelect:v[3]||(v[3]=c=>l.value=c)},null,8,["modelValue","filter-group","column-options"])):w("",!0)],64)}}}),Zo=P({__name:"ChartQuerySelector",props:B({queries:{}},{modelValue:{},modelModifiers:{}}),emits:["update:modelValue"],setup(o){const l=L(o,"modelValue"),e=o;return!l.value&&e.queries.length&&(l.value=e.queries[0].value),ml(l,()=>{if(l.value){const s=he(l.value);s&&!s.result.executedSQL&&s.execute()}},{immediate:!0}),(s,n)=>{const a=Me;return r(),V(I,{label:"Query"},{default:d(()=>[t(a,{showFooter:!0,options:e.queries,modelValue:l.value,"onUpdate:modelValue":n[0]||(n[0]=u=>l.value=u==null?void 0:u.value)},{prefix:d(()=>[t(f(Cl),{class:"mr-1.5 h-4 w-4 text-gray-700","stroke-width":"1.5"})]),_:1},8,["options","modelValue"])]),_:1})}}}),Jo={class:"space-y-3 text-base"},Xo={class:"space-y-4"},et={class:"flex items-center gap-3 rounded border px-3 py-2"},lt={key:0,class:"flex overflow-hidden rounded bg-gray-100"},ot={class:"font-code form-input flex-1 overflow-hidden text-ellipsis whitespace-nowrap rounded-r-none text-sm text-gray-600"},tt=P({__name:"ChartShareDialog",props:B({chart:{}},{modelValue:{},modelModifiers:{}}),emits:["update:modelValue"],setup(o){const l=o,e=L(o,"modelValue"),s=l.chart,n=Q(f(s.doc.is_public)),a=$(()=>s.getShareLink()),u=$(()=>`<iframe src="${a.value}" width="100%" height="300" frameborder="0"></iframe>`),i=$(()=>{const m=!!s.doc.is_public,c=!!n.value;return m!==c});function v(){s.doc.is_public=n.value,e.value=!1}return(m,c)=>{const U=T("Toggle"),S=T("Button"),x=T("Tooltip"),b=T("Dialog");return r(),V(b,{modelValue:e.value,"onUpdate:modelValue":c[3]||(c[3]=R=>e.value=R),options:{title:"Share Chart",actions:[{label:"Done",variant:"solid",disabled:!i.value,onClick:v}]}},{"body-content":d(()=>[p("div",Jo,[p("div",Xo,[p("div",et,[t(f(Fl),{class:"h-6 w-6 text-blue-500","stroke-width":"1.5"}),c[4]||(c[4]=p("div",{class:"flex flex-1 flex-col"},[p("div",{class:"font-medium leading-5 text-gray-800"}," Enable Public Access "),p("div",{class:"text-sm text-gray-700"}," Anyone with the link can view this chart ")],-1)),t(U,{modelValue:n.value,"onUpdate:modelValue":c[0]||(c[0]=R=>n.value=R)},null,8,["modelValue"])]),a.value?(r(),k("div",lt,[p("div",ot,E(a.value),1),t(x,{text:"Copy Link",hoverDelay:.1},{default:d(()=>[t(S,{class:"w-8 rounded-none bg-gray-200 hover:bg-gray-300",icon:"link-2",onClick:c[1]||(c[1]=R=>f(Ue)(a.value))})]),_:1}),t(x,{text:"Copy iFrame",hoverDelay:.1},{default:d(()=>[t(S,{class:"w-8 rounded-l-none bg-gray-200 hover:bg-gray-300",icon:"code",onClick:c[2]||(c[2]=R=>f(Ue)(u.value))})]),_:1})])):w("",!0)])])]),_:1},8,["modelValue","options"])}}}),at={class:"flex flex-col gap-2"},nt={class:"flex rounded"},st={class:"flex-1 overflow-hidden"},ut=P({__name:"ChartSortConfig",props:B({columnOptions:{}},{modelValue:{default:()=>[]},modelModifiers:{}}),emits:["update:modelValue"],setup(o){const l=o,e=L(o,"modelValue"),s=$(()=>e.value.map(m=>({...m,value:m.column.column_name})));function n(m){e.value.find(U=>U.column.column_name===m)||e.value.push({column:Z(m),direction:"asc"})}function a(m){e.value.splice(m,1)}function u(m,c){const U=e.value[m];e.value.splice(m,1,{column:Z(c),direction:(U==null?void 0:U.direction)||"asc"})}function i(m){const c=e.value[m];c&&e.value.splice(m,1,{...c,direction:c.direction==="asc"?"desc":"asc"})}function v(m,c){if(!e.value)return;const U=e.value.splice(m,1);e.value.splice(c,0,...U)}return(m,c)=>{const U=T("Button"),S=Me;return r(),k("div",at,[t(ne,{group:"sortColumns","show-empty-state":!1,items:s.value,onSort:v},{item:d(({item:x,index:b})=>[p("div",nt,[t(U,{class:"flex-shrink-0 rounded-r-none border-r",onClick:R=>i(b)},{icon:d(()=>[x.direction=="asc"?(r(),V(f(Ul),{key:0,class:"h-4 w-4 text-gray-700","stroke-width":"1.5"})):(r(),V(f(Sl),{key:1,class:"h-4 w-4 text-gray-700","stroke-width":"1.5"}))]),_:2},1032,["onClick"]),p("div",st,[t(S,{showFooter:!0,options:l.columnOptions,modelValue:x.value,"onUpdate:modelValue":R=>u(b,R.value)},{target:d(({togglePopover:R})=>[t(U,{class:"w-full !justify-start rounded-none [&>span]:truncate",onClick:R},{default:d(()=>[G(E(x.column.column_name),1)]),_:2},1032,["onClick"])]),_:2},1032,["options","modelValue","onUpdate:modelValue"])]),t(U,{class:"flex-shrink-0 rounded-l-none border-l",onClick:R=>a(b)},{icon:d(()=>[t(f(me),{class:"h-4 w-4 text-gray-700","stroke-width":"1.5"})]),_:2},1032,["onClick"])])]),_:1},8,["items"]),t(S,{options:l.columnOptions,"onUpdate:modelValue":c[0]||(c[0]=x=>n(x.value))},{target:d(({togglePopover:x})=>[t(U,{class:"w-full",onClick:x},{prefix:d(()=>[t(f(ye),{class:"h-4 w-4 text-gray-700","stroke-width":"1.5"})]),default:d(()=>[c[1]||(c[1]=G(" Add Sort "))]),_:2},1032,["onClick"])]),_:1},8,["options"])])}}}),it={class:"grid grid-cols-3 gap-2 pt-0.5"},rt={class:"flex items-center gap-1.5"},dt={class:"text-sm"},mt=P({__name:"ChartTypeSelector",props:{modelValue:{},modelModifiers:{}},emits:["update:modelValue"],setup(o){const l=L(o,"modelValue");return(e,s)=>{const n=T("Button");return r(),k("div",it,[(r(!0),k(D,null,ie(f(_l),a=>(r(),V(n,{key:a,variant:"subtle",class:W(["!justify-start",l.value===a?"bg-white shadow hover:bg-white":""]),onClick:u=>l.value=a},{default:d(()=>[p("div",rt,[t($l,{chartType:a,class:"!h-3.5 !w-3.5"},null,8,["chartType"]),p("div",dt,E(a),1)])]),_:2},1032,["class","onClick"]))),128))])}}}),ct={class:"relative flex h-full w-full overflow-hidden"},pt={class:"relative flex h-full w-full flex-col gap-4 overflow-hidden p-3 pt-4"},vt={class:"relative z-[1] mt-1 flex w-[19rem] flex-shrink-0 flex-col divide-y overflow-y-auto bg-white px-3.5"},ft={class:"flex flex-col gap-3"},_t={class:"tnum"},bt={class:"tnum"},gt={class:"flex flex-col gap-2"},ht=P({__name:"ChartBuilder",props:{chart_name:{},queries:{}},async setup(o){let l,e;const s=o,n=bl(s.chart_name);Re("chart",n),window.chart=n,[l,e]=ll(()=>cl(()=>n.isloaded)),await l,e(),n.refresh(),ol(()=>n.doc.config,()=>n.refresh(),{deep:!0,debounce:500});const a=tl(),u=a["Meta+Z"],i=a["Meta+Shift+Z"],v=ke(u,()=>n.history.undo()),m=ke(i,()=>n.history.redo());al(()=>{v(),m()});const c=Q(null);function U(){if(!c.value||!c.value.clientHeight){console.log(c.value),console.warn("Chart element not found");return}return vl(c.value,n.doc.title,2,{filter:x=>{var b;return!((b=x==null?void 0:x.classList)!=null&&b.contains("absolute"))}})}const S=Q(!1);return(x,b)=>{var h,M;const R=T("FormControl"),O=T("Button");return r(),k(D,null,[p("div",ct,[p("div",pt,[p("div",{ref_key:"chartEl",ref:c,class:"flex min-h-[24rem] flex-1 flex-shrink-0 items-center justify-center"},[t(Ol,{chart:f(n)},null,8,["chart"])],512),f(n).dataQuery.result.executedSQL?(r(),V(ql,{key:0})):w("",!0)]),p("div",vt,[t(j,{title:"Chart"},{default:d(()=>[p("div",ft,[t(mt,{modelValue:f(n).doc.chart_type,"onUpdate:modelValue":b[0]||(b[0]=_=>f(n).doc.chart_type=_)},null,8,["modelValue"]),t(Zo,{modelValue:f(n).doc.query,"onUpdate:modelValue":b[1]||(b[1]=_=>f(n).doc.query=_),queries:s.queries},null,8,["modelValue","queries"]),t(I,{label:"Title"},{default:d(()=>[t(il,{type:"text",placeholder:"Title",modelValue:f(n).doc.title,"onUpdate:modelValue":b[2]||(b[2]=_=>f(n).doc.title=_)},null,8,["modelValue"])]),_:1})])]),_:1}),f(n).doc.query?(r(),V(Wo,{key:0,chart:f(n)},null,8,["chart"])):w("",!0),t(j,{title:"Filters",collapsed:""},fe({default:d(()=>[t(Yo,{modelValue:f(n).doc.config.filters,"onUpdate:modelValue":b[3]||(b[3]=_=>f(n).doc.config.filters=_)},null,8,["modelValue"])]),_:2},[(h=f(n).doc.config.filters)!=null&&h.filters.length?{name:"title-suffix",fn:d(()=>[t(f(_e),{size:"sm",theme:"orange",type:"info",class:"mt-0.5"},{default:d(()=>[p("span",_t,E(f(n).doc.config.filters.filters.length),1)]),_:1})]),key:"0"}:void 0]),1024),t(j,{title:"Sort",collapsed:""},fe({default:d(()=>{var _;return[t(ut,{modelValue:f(n).doc.config.order_by,"onUpdate:modelValue":b[4]||(b[4]=g=>f(n).doc.config.order_by=g),"column-options":((_=f(n).dataQuery.result)==null?void 0:_.columnOptions)||[]},null,8,["modelValue","column-options"])]}),_:2},[(M=f(n).doc.config.order_by)!=null&&M.length?{name:"title-suffix",fn:d(()=>[t(f(_e),{size:"sm",theme:"orange",type:"info",class:"mt-0.5"},{default:d(()=>{var _;return[p("span",bt,E((_=f(n).doc.config.order_by)==null?void 0:_.length),1)]}),_:1})]),key:"0"}:void 0]),1024),t(j,{title:"Limit",collapsed:""},{default:d(()=>[t(R,{modelValue:f(n).doc.config.limit,"onUpdate:modelValue":b[5]||(b[5]=_=>f(n).doc.config.limit=_),type:"number"},null,8,["modelValue"])]),_:1}),t(j,{title:"Actions",class:"!border-b"},{default:d(()=>[p("div",gt,[f(n).doc.read_only?w("",!0):(r(),V(O,{key:0,onClick:f(n).resetConfig,class:"w-full"},{prefix:d(()=>[t(f(me),{class:"h-4 text-gray-700","stroke-width":"1.5"})]),default:d(()=>[b[9]||(b[9]=G(" Reset Options "))]),_:1},8,["onClick"])),t(O,{onClick:b[6]||(b[6]=_=>f(n).refresh(!0)),class:"w-full"},{prefix:d(()=>[t(f(Rl),{class:"h-4 text-gray-700","stroke-width":"1.5"})]),default:d(()=>[b[10]||(b[10]=G(" Refresh Chart "))]),_:1}),t(O,{class:"w-full",disabled:!c.value,onClick:U},{prefix:d(()=>[t(f(Ml),{class:"h-4 text-gray-700","stroke-width":"1.5"})]),default:d(()=>[b[11]||(b[11]=G(" Export as PNG "))]),_:1},8,["disabled"]),f(n).doc.read_only?w("",!0):(r(),V(O,{key:1,class:"w-full",onClick:b[7]||(b[7]=_=>S.value=!0)},{prefix:d(()=>[t(f(Tl),{class:"h-4 text-gray-700","stroke-width":"1.5"})]),default:d(()=>[b[12]||(b[12]=G(" Share Chart "))]),_:1})),t(O,{class:"w-full",onClick:f(n).copy},{prefix:d(()=>[t(f(Ce),{class:"h-4 text-gray-700","stroke-width":"1.5"})]),default:d(()=>[b[13]||(b[13]=G(" Copy JSON "))]),_:1},8,["onClick"]),f(pl).user.has_desk_access?(r(),V(O,{key:2,class:"w-full",onClick:f(n).openInDesk},{prefix:d(()=>[t(f(Ce),{class:"h-4 text-gray-700","stroke-width":"1.5"})]),default:d(()=>[b[14]||(b[14]=G(" Open in Desk "))]),_:1},8,["onClick"])):w("",!0)])]),_:1})])]),t(tt,{modelValue:S.value,"onUpdate:modelValue":b[8]||(b[8]=_=>S.value=_),chart:f(n)},null,8,["modelValue","chart"])],64)}}}),ia=P({__name:"WorkbookChart",props:{workbook_name:{},chart_name:{}},setup(o){const l=o,e=nl(),s=de(gl);let n=Q(l.chart_name);const a=Number(l.chart_name);return a>=0&&s.doc.charts[a]&&!s.doc.charts.find(u=>u.name===l.chart_name)&&(n.value=s.doc.charts[a].name,e.replace(`/workbook/${s.doc.name}/chart/${n.value}`)),(u,i)=>(r(),V(ht,{chart_name:f(n),queries:f(s).doc.queries.map(v=>({label:v.title,value:v.name}))},null,8,["chart_name","queries"]))}});export{ia as default};
//# sourceMappingURL=WorkbookChart-070c52d2.js.map
