import{_ as A,o as w,d as $,f as u,j as q,G as W,c as L,w as V,h as n,z as T,V as O,W as I,K as f,br as G,ad as K,bs as Y,bt as X,am as Z,ae as ee,aN as te,D,u as j,aD as le,a6 as P,r as Q,aV as ae,t as z,g as oe,a as B,J as se,F as J,Q as ne,e as re,k as R,I as ie,S as ue,H as ce,as as de,a2 as pe,aJ as me}from"./frappe-ui-d69b39da.js";import{I as fe}from"./IndicatorIcon-cba5cc16.js";import{N as ve}from"./NewDialogWithTypes-2e6d90f1.js";import{P as ye}from"./PageBreadcrumbs-2c73064a.js";import{u as _e}from"./useNotebooks-d72e5199.js";import{u as he,C as ge}from"./queryStore-e3123969.js";import{s as be}from"./toasts-2937f9d2.js";import{a as ke,j as xe}from"./index-9194c21d.js";import{g as we}from"./widgets-5dfe9af0.js";import{P as Ve}from"./plus-3394075c.js";import{S as Ce}from"./search-34ad51bc.js";import"./house-94cdb6cd.js";import"./index-77f7bd6f.js";import"./chevron-right-abc82e4c.js";import"./ellipsis-10a30b7b.js";import"./dayjs-e81f6541.js";import"./calendar-1687c485.js";import"./clock-73e01da8.js";import"./chart-scatter-06f2042d.js";import"./list-filter-e596ffc3.js";import"./text-cursor-input-3636b908.js";const Se={},qe={width:"16",height:"17",viewBox:"0 0 16 17",fill:"none",xmlns:"http://www.w3.org/2000/svg"};function Fe(S,g){return w(),$("svg",qe,g[0]||(g[0]=[u("path",{d:"M2 4.5H14",stroke:"currentColor","stroke-miterlimit":"10","stroke-linecap":"round","stroke-linejoin":"round"},null,-1),u("path",{d:"M4 8.5H12",stroke:"currentColor","stroke-miterlimit":"10","stroke-linecap":"round","stroke-linejoin":"round"},null,-1),u("path",{d:"M6.5 12.5H9.5",stroke:"currentColor","stroke-miterlimit":"10","stroke-linecap":"round","stroke-linejoin":"round"},null,-1)]))}const Ne=A(Se,[["render",Fe]]),Le={__name:"NestedPopover",props:{placement:{type:String,default:"bottom-start"}},setup(S){const g=S,b=q(null),r=q(null);let i=q(null);function d(){i.value?i.value.update():i.value=te(b.value.el,r.value.el,{placement:g.placement})}function x(){Z(()=>d())}return W(()=>{var v;(v=i.value)==null||v.destroy()}),(v,c)=>(w(),L(f(X),null,{default:V(({open:p})=>[n(f(G),{as:"div",ref_key:"reference",ref:b,onClick:x,onFocusin:x,onKeydown:x},{default:V(({open:l})=>[T(v.$slots,"target",O(I({open:l})))]),_:2},1536),K(u("div",null,[n(f(Y),{ref_key:"popover",ref:r,static:"",class:"z-[100]"},{default:V(({open:l,close:F})=>[T(v.$slots,"body",O(I({open:l,close:F})))]),_:2},1536)],512),[[ee,p]])]),_:3}))}},$e={__name:"SearchComplete",props:{value:{type:String,required:!1,default:""},doctype:{type:String,required:!0},searchField:{type:String,required:!1,default:"name"},labelField:{type:String,required:!1,default:"name"},valueField:{type:String,required:!1,default:"name"},pageLength:{type:Number,required:!1,default:10}},emits:["update:modelValue"],setup(S,{emit:g}){const b=g,r=S;D(()=>r.doctype,c=>{d.doctype=c,d.reload()});const i=j({get:()=>r.value,set:c=>b("update:modelValue",c)}),d=le({doctype:r.doctype,pageLength:r.pageLength,cache:["link_doctype",r.doctype],auto:!0,fields:[r.labelField,r.searchField,r.valueField],onSuccess:()=>{}}),x=j(()=>{var p;const c=((p=d.data)==null?void 0:p.map(l=>({label:l[r.labelField],value:l[r.valueField]})))||[];return i.value&&!c.find(l=>l.value===i.value)&&c.push({label:i.value,value:i.value}),c});function v(c){d.update({filters:{[r.searchField]:["like",`%${c}%`]}}),d.reload()}return(c,p)=>(w(),L(f(P),{placeholder:"Select an option",options:x.value,modelValue:i.value,"onUpdate:query":p[0]||(p[0]=l=>v(l)),"onUpdate:modelValue":p[1]||(p[1]=l=>i.value=l.value)},null,8,["options","modelValue"]))}},Ee={class:"flex h-5 w-5 items-center justify-center rounded bg-gray-900 pt-[1px] text-xs font-medium text-white"},Ue={class:"my-2 rounded-lg border border-gray-100 bg-white shadow-xl"},je={class:"min-w-[400px] p-2"},Be={class:"flex flex-1 items-center gap-2"},De={class:"w-13 flex-shrink-0 pl-2 text-end text-base text-gray-600"},Pe={id:"fieldname",class:"!min-w-[140px] flex-1"},Qe={id:"operator",class:"!min-w-[140px] flex-shrink-0"},Te={id:"value",class:"!min-w-[140px] flex-1"},Oe={class:"flex-shrink-0"},Ie={key:1,class:"mb-3 flex h-7 items-center px-3 text-sm text-gray-600"},ze={class:"flex items-center justify-between gap-2"},Re={__name:"ListFilter",props:{modelValue:{type:Object,default:()=>({})},docfields:{type:Array,default:()=>[]}},emits:["update:modelValue"],setup(S,{emit:g}){const b=["Check"],r=["Link"],i=["Float","Int"],d=["Select"],x=["Data","Long Text","Small Text","Text Editor","Text","JSON","Code"],v=g,c=S,p=j(()=>c.docfields.filter(e=>!e.is_virtual&&(b.includes(e.fieldtype)||r.includes(e.fieldtype)||i.includes(e.fieldtype)||d.includes(e.fieldtype)||x.includes(e.fieldtype))).map(e=>({label:e.label,value:e.fieldname,description:e.fieldtype,...e}))),l=q(F(c.modelValue));D(l,t=>v("update:modelValue",a(t)),{deep:!0}),D(()=>c.modelValue,t=>{const e=F(t);JSON.stringify(l.value)!==JSON.stringify(e)&&(l.value=e)},{deep:!0});function F(t){return Object.entries(t).map(([e,[h,U]])=>{const s=E(e);return{fieldname:e,operator:h,value:U,field:s}})}function E(t){return p.value.find(e=>e.fieldname===t)}function a(t){return t.reduce((e,h)=>{const{fieldname:U,operator:s,value:N}=h;return e[U]=[s,N],e},{})}function o(t){let e=[];return(x.includes(t)||r.includes(t))&&e.push({label:"Equals",value:"="},{label:"Not Equals",value:"!="},{label:"Like",value:"like"},{label:"Not Like",value:"not like"}),i.includes(t)&&e.push({label:"<",value:"<"},{label:">",value:">"},{label:"<=",value:"<="},{label:">=",value:">="},{label:"Equals",value:"="},{label:"Not Equals",value:"!="}),d.includes(t)&&e.push({label:"Equals",value:"="},{label:"Not Equals",value:"!="}),b.includes(t)&&e.push({label:"Equals",value:"="}),e}function y(t){return d.includes(t)||r.includes(t)||b.includes(t)||i.includes(t)?"=":"like"}function m(t,e){if(d.includes(t)||b.includes(t)){const h=t=="Check"?["Yes","No"]:k(e);return R(B,{type:"select",options:h})}else return R(B,{type:"text"})}function _(t){return d.includes(t.fieldtype)?k(t.options)[0]:b.includes(t.fieldtype)?"Yes":""}function k(t){return t.split(`
`)}function H(t){const e=E(t),h={fieldname:t,operator:y(e.fieldtype),value:_(e),field:e};l.value=[...l.value,h]}function M(t){l.value=l.value.filter((e,h)=>h!==t)}return(t,e)=>{const h=Q("Button");return w(),L(Le,null,{target:V(()=>[n(h,{label:"Filter"},ae({prefix:V(()=>[n(Ne,{class:"h-4"})]),_:2},[l.value.length?{name:"suffix",fn:V(()=>[u("div",Ee,z(l.value.length),1)]),key:"0"}:void 0]),1024)]),body:V(({close:U})=>[u("div",Ue,[u("div",je,[l.value.length?(w(!0),$(J,{key:0},oe(l.value,(s,N)=>(w(),$("div",{key:N,id:"filter-list",class:"mb-3 flex items-center justify-between gap-2"},[u("div",Be,[u("div",De,z(N==0?"Where":"And"),1),u("div",Pe,[n(f(P),{modelValue:s.fieldname,options:p.value,"onUpdate:modelValue":C=>s.fieldname=C.value,placeholder:"Filter by..."},null,8,["modelValue","options","onUpdate:modelValue"])]),u("div",Qe,[n(f(B),{type:"select",modelValue:s.operator,"onUpdate:modelValue":C=>s.operator=C,options:o(s.field.fieldtype),placeholder:"Operator"},null,8,["modelValue","onUpdate:modelValue","options"])]),u("div",Te,[r.includes(s.field.fieldtype)&&["=","!="].includes(s.operator)?(w(),L($e,{key:0,doctype:s.field.options,modelValue:s.value,"onUpdate:modelValue":C=>s.value=C,placeholder:"Value"},null,8,["doctype","modelValue","onUpdate:modelValue"])):(w(),L(se(m(s.field.fieldtype,s.field.options)),{key:1,modelValue:s.value,"onUpdate:modelValue":C=>s.value=C,placeholder:"Value"},null,8,["modelValue","onUpdate:modelValue"]))])]),u("div",Oe,[n(h,{variant:"ghost",icon:"x",onClick:C=>M(N)},null,8,["onClick"])])]))),128)):(w(),$("div",Ie," Empty - Choose a field to filter by ")),u("div",ze,[n(f(P),{modelValue:"",options:p.value,"onUpdate:modelValue":e[0]||(e[0]=s=>H(s.value)),placeholder:"Filter by..."},{target:V(({togglePopover:s})=>[n(h,{class:"!text-gray-600",variant:"ghost",onClick:N=>s(),label:"Add filter"},{prefix:V(()=>[n(f(ne),{name:"plus",class:"h-4"})]),_:2},1032,["onClick"])]),_:1},8,["options"]),l.value.length?(w(),L(h,{key:0,class:"!text-gray-600",variant:"ghost",label:"Clear all filter",onClick:e[1]||(e[1]=s=>l.value=[])})):re("",!0)])])])]),_:1})}}},Je=Re,He={class:"sticky top-0 z-10 flex items-center justify-between bg-white px-5 py-2.5"},Me={class:"mb-4 flex h-full flex-col gap-2 overflow-auto px-4"},Ae={class:"flex gap-2 overflow-visible py-1"},vt={__name:"QueryList",setup(S){const g=he(),b=ie(),r=ue(),i=q(!1);r.hash=="#new"&&(i.value=!0);const d=q({title:"Queries"});ke(d);const x=_e();async function v(a){if(a==="notebook"){await x.reload();const m=x.list.find(k=>k.title==="Uncategorized"),_=await x.createPage(m.name);return b.push({name:"NotebookPage",params:{notebook:m.name,name:_}})}const o={};a==="visual"&&(o.is_assisted_query=1),a==="sql"&&(o.is_native_query=1),a==="script"&&(o.is_script_query=1);const y=await g.create(o);b.push({name:"Query",params:{name:y.name}})}const c=q([{label:"Visual",description:"Create a query using the visual interface",icon:"bar-chart-2",onClick:()=>v("visual")},{label:"SQL",description:"Create a query by writing native query",icon:"code",onClick:()=>v("sql")},{label:"Notebook",description:"Create a query using the notebook interface",icon:"book",tag:"beta",onClick:()=>v("notebook")},{label:"Script",description:"Create a query by writing a python script",icon:"code",tag:"beta",onClick:()=>v("script")}]),p=be().user.email,l=ce("insights:query-list-filters",{owner:["=",p]}),F=j(()=>xe(l.value)?g.list:g.list.filter(a=>{for(const[o,[y,m]]of Object.entries(l.value)){if(!o||!y||!m)continue;const _=a[o];if(y==="=")return _===m;if(y==="!=")return _!==m;if(y==="<")return _<m;if(y===">")return _>m;if(y==="<=")return _<=m;if(y===">=")return _>=m;if(y.includes("like"))return _.toLowerCase().includes(m.toLowerCase())}return!0})),E=[{label:"Title",key:"title",width:2,prefix:({row:a})=>a.is_stored?n(ge,{class:"h-4 w-4 text-gray-600",fill:"currentColor"},null):null},{label:"Execution Status",key:"status",width:1,getLabel:({row:a})=>a.status.replace("Execution",""),prefix:({row:a})=>{let o="text-gray-500";return a.status==="Pending Execution"&&(o="text-yellow-500"),a.status==="Execution Successful"&&(o="text-green-500"),a.status==="Execution Failed"&&(o="text-red-500"),n(fe,{class:o},null)}},{label:"Chart Type",key:"chart_type",width:1,prefix:({row:a})=>{if(!a.chart_type)return null;const o=we(a.chart_type);return n(o,{class:"h-4 w-4 text-gray-700"},null)}},{label:"Data Source",key:"data_source",width:1,getLabel:({row:a})=>a.data_source_title||a.data_source},{label:"ID",key:"name",width:1},{label:"Created By",key:"owner_name",width:1,prefix:({row:a})=>n(pe,{image:a.owner_image,label:a.owner_name,size:"md"},null)},{label:"Created",key:"created_from_now",width:1,align:"right"}];return(a,o)=>{var _;const y=Q("Button"),m=Q("FormControl");return w(),$(J,null,[u("header",He,[n(ye,{class:"h-7",items:[{label:"Queries"}]}),u("div",null,[n(y,{label:"New Query",variant:"solid",onClick:o[0]||(o[0]=k=>i.value=!0)},{prefix:V(()=>[n(f(Ve),{class:"w-4"})]),_:1})])]),u("div",Me,[u("div",Ae,[n(m,{placeholder:"Search by Title",modelValue:(_=f(l).title)==null?void 0:_[1],"onUpdate:modelValue":o[1]||(o[1]=k=>f(l).title=["like",k]),debounce:300},{prefix:V(()=>[n(f(Ce),{class:"h-4 w-4 text-gray-500"})]),_:1},8,["modelValue"]),n(Je,{modelValue:f(l),"onUpdate:modelValue":o[2]||(o[2]=k=>de(l)?l.value=k:null),docfields:f(g).getFilterableFields()},null,8,["modelValue","docfields"])]),n(f(me),{columns:E,rows:F.value.slice(0,100),"row-key":"name",options:{showTooltip:!1,getRowRoute:k=>({name:"Query",params:{name:k.name}}),emptyState:{title:"No Query Created.",description:"Create a new query to get started.",button:{label:"New Query",variant:"solid",onClick:()=>i.value=!0}}}},null,8,["rows","options"])]),n(ve,{show:i.value,"onUpdate:show":o[3]||(o[3]=k=>i.value=k),title:"Select Interface Type",types:c.value},null,8,["show","types"])],64)}}};export{vt as default};
//# sourceMappingURL=QueryList-606fc7db.js.map
