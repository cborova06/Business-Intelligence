import{x as F,M as R,E as P,r as q,o as c,c as C,w,f as s,h as n,K as a,j as T,k as oe,d as D,ad as tt,ae as lt,t as z,aE as ge,e as U,F as N,L as A,D as me,a as ue,i as L,R as be,a1 as ot,s as K,v as nt,u as O,m as je,aJ as Ue,b0 as at,aV as st,z as Y,V as it,W as ut,a5 as rt,aC as re,J as pe,T as de,af as dt,C as Qe,g as X,B as ct,y as fe,aL as Ne,b1 as qe,b2 as mt,an as pt,am as ft}from"./frappe-ui-d69b39da.js";import{p as vt,y as yt,g as Me,w as _t,h as ae,f as De,z as xt,j as J,i as ce,k as Z,o as he,A as ee,B as Ae,E as Ie,C as Ee,G as gt,H as bt,m as ht,F as Pe,I as Ge,J as H,K as wt}from"./main-d2d228fc.js";import{_ as Je,a as ve}from"./ExpressionEditor.vue_vue_type_style_index_0_lang-9e2463ac.js";import{c as se,D as kt,S as He}from"./index-77f7bd6f.js";import{P as Vt}from"./play-63d306bd.js";import{E as Ct}from"./ellipsis-10a30b7b.js";import{_ as ke}from"./Popover-5414f173.js";import{_ as ye}from"./Autocomplete-e91e4d1c.js";import{D as $t}from"./vuedraggable.umd-f13fb48a.js";import{G as St}from"./grip-vertical-c5c2fa7d.js";import{X as ne}from"./x-3f18ad86.js";import{S as Dt,B as Re,T as qt,C as Tt,H as Ot}from"./index-9194c21d.js";import{B as Ye,C as jt}from"./combine-0dbf7ac7.js";import{C as Ut}from"./clock-73e01da8.js";import{C as At}from"./calendar-1687c485.js";import{S as Ve}from"./search-34ad51bc.js";import{C as Ke}from"./chevron-down-7c5e9308.js";import{d as Et,o as Te,e as Bt,c as Be,p as Lt,q as Ft,w as Ce}from"./dashboard-37329027.js";import{a as ze}from"./DatePickerControl.vue_vue_type_script_setup_true_lang-6baff6f5.js";import{R as We}from"./refresh-ccw-f825866d.js";import{P as $e}from"./plus-3394075c.js";import{u as Se}from"./tables-0e8be38f.js";import{u as Xe}from"./data_source-00c6028c.js";import{T as Le}from"./table-2-565c43f4.js";import{C as we}from"./check-2c63c113.js";import{C as Mt}from"./chevron-left-c299c44c.js";import{_ as It}from"./DataTable.vue_vue_type_script_setup_true_lang-0fc4cbd5.js";import{I as Rt}from"./IndicatorIcon-21535c9e.js";import{R as zt}from"./refresh-cw-ef6c08ee.js";/**
 * @license lucide-vue-next v0.484.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Qt=se("bell",[["path",{d:"M10.268 21a2 2 0 0 0 3.464 0",key:"vwvbt9"}],["path",{d:"M3.262 15.326A1 1 0 0 0 4 17h16a1 1 0 0 0 .74-1.673C19.41 13.956 18 12.499 18 8A6 6 0 0 0 6 8c0 4.499-1.411 5.956-2.738 7.326",key:"11g9vi"}]]);/**
 * @license lucide-vue-next v0.484.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Nt=se("brackets",[["path",{d:"M16 3h2a1 1 0 0 1 1 1v16a1 1 0 0 1-1 1h-2",key:"tum69e"}],["path",{d:"M8 21H6a1 1 0 0 1-1-1V4a1 1 0 0 1 1-1h2",key:"z7wn0n"}]]);/**
 * @license lucide-vue-next v0.484.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Pt=se("copy",[["rect",{width:"14",height:"14",x:"8",y:"8",rx:"2",ry:"2",key:"17jyea"}],["path",{d:"M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2",key:"zix9uf"}]]);/**
 * @license lucide-vue-next v0.484.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Gt=se("download",[["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["polyline",{points:"7 10 12 15 17 10",key:"2ggqvy"}],["line",{x1:"12",x2:"12",y1:"15",y2:"3",key:"1vk2je"}]]);/**
 * @license lucide-vue-next v0.484.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Jt=se("scroll",[["path",{d:"M19 17V5a2 2 0 0 0-2-2H4",key:"zz82l3"}],["path",{d:"M8 21h12a2 2 0 0 0 2-2v-1a1 1 0 0 0-1-1H11a1 1 0 0 0-1 1v1a2 2 0 1 1-4 0V5a2 2 0 1 0-4 0v2a1 1 0 0 0 1 1h3",key:"1ph1d7"}]]);/**
 * @license lucide-vue-next v0.484.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ht=se("square-pen",[["path",{d:"M12 3H5a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7",key:"1m0v6g"}],["path",{d:"M18.375 2.625a1 1 0 0 1 3 3l-9.013 9.014a2 2 0 0 1-.853.505l-2.873.84a.5.5 0 0 1-.62-.62l.84-2.873a2 2 0 0 1 .506-.852z",key:"ohrbg2"}]]),Yt={class:"relative"},Kt={class:"max-h-[50vh] overflow-y-auto rounded border text-base"},Wt=F({__name:"ViewSQLDialog",props:{modelValue:{},modelModifiers:{}},emits:["update:modelValue"],setup(v){const e=R(v,"modelValue"),i=P("query");return(o,t)=>{const l=q("Button"),u=q("Dialog");return c(),C(u,{modelValue:e.value,"onUpdate:modelValue":t[1]||(t[1]=g=>e.value=g),options:{title:"Generated SQL",size:"3xl"},dismissable:!0},{"body-content":w(()=>[s("div",Yt,[s("div",Kt,[n(Je,{language:"sql","model-value":a(i).result.executedSQL,"read-only":!0,"hide-line-numbers":!0},null,8,["model-value"])]),n(l,{icon:"copy",variant:"outline",class:"absolute bottom-2 right-2",onClick:t[0]||(t[0]=g=>a(vt)(a(i).result.executedSQL))})])]),_:1},8,["modelValue"])}}}),Xt={class:"flex w-full flex-shrink-0 items-center justify-between bg-white"},Zt={class:"tnum flex items-center gap-2 text-sm text-gray-600"},el={key:0},tl={key:1},ll={class:"flex items-center gap-2"},ol=F({__name:"QueryBuilderToolbar",setup(v){const e=P("query"),i=T(!1),o=[{label:"View SQL",icon:oe(Jt,{class:"h-3 w-3 text-gray-700",strokeWidth:1.5}),onClick:()=>i.value=!0},{label:"Copy Query",icon:oe(Pt,{class:"h-3 w-3 text-gray-700",strokeWidth:1.5}),onClick:()=>e.copy()}];return(t,l)=>{const u=q("Button"),g=q("Dropdown");return c(),D(N,null,[s("div",Xt,[s("div",null,[tt(s("div",Zt,[l[2]||(l[2]=s("div",{class:"h-2 w-2 rounded-full bg-green-500"},null,-1)),s("div",null,[a(e).result.timeTaken==-1?(c(),D("span",el," Fetched from cache ")):(c(),D("span",tl," Fetched in "+z(a(e).result.timeTaken)+"s ",1)),s("span",null,z(a(ge)(a(e).result.lastExecutedAt).value),1)])],512),[[lt,a(e).result.executedSQL]])]),s("div",ll,[n(u,{variant:"ghost",label:"Execute",onClick:l[0]||(l[0]=()=>a(e).execute(!0)),class:"!h-6 !gap-1.5 bg-white !px-2 text-xs shadow"},{prefix:w(()=>[n(a(Vt),{class:"h-3 w-3 text-gray-700","stroke-width":"1.5"})]),_:1}),n(g,{placement:"right",options:o},{default:w(()=>[n(u,{variant:"ghost",class:"!h-6 !gap-1.5 bg-white !px-2 text-xs shadow"},{icon:w(()=>[n(a(Ct),{class:"h-3 w-3 text-gray-700","stroke-width":"1.5"})]),_:1})]),_:1})])]),i.value?(c(),C(Wt,{key:0,modelValue:i.value,"onUpdate:modelValue":l[1]||(l[1]=b=>i.value=b)},null,8,["modelValue"])):U("",!0)],64)}}}),nl={class:"space-y-4"},al={class:"space-y-2"},sl={class:"flex cursor-pointer items-center"},il={class:"flex items-center gap-2"},ul={class:"flex justify-end gap-2"},rl=F({__name:"ExportDialog",props:A({downloading:{type:Boolean},defaultFilename:{}},{modelValue:{type:Boolean,default:!1},modelModifiers:{}}),emits:A(["export","cancel"],["update:modelValue"]),setup(v,{emit:e}){const i=R(v,"modelValue"),o=v,t=e,l=T("csv"),u=T("data");me(()=>o.defaultFilename,b=>{b&&(u.value=b)},{immediate:!0});function g(){t("export",l.value,u.value)}return(b,p)=>(c(),C(a(ot),{modelValue:i.value,"onUpdate:modelValue":p[3]||(p[3]=d=>i.value=d),options:{title:"Export Data",size:"sm"}},{"body-content":w(()=>[s("div",nl,[s("div",null,[s("div",al,[s("label",sl,[n(a(ue),{class:"w-32",type:"select",label:"Export Format",options:[{label:"CSV",value:"csv"},{label:"Excel",value:"excel"}],modelValue:l.value,"onUpdate:modelValue":p[0]||(p[0]=d=>l.value=d)},null,8,["modelValue"])])])]),s("div",il,[n(a(ue),{type:"text",label:"Filename",modelValue:u.value,"onUpdate:modelValue":p[1]||(p[1]=d=>u.value=d),placeholder:"Enter filename",class:"w-44"},null,8,["modelValue"])])])]),actions:w(()=>[s("div",ul,[n(a(be),{variant:"ghost",onClick:p[2]||(p[2]=()=>{t("cancel"),i.value=!1})},{default:w(()=>p[4]||(p[4]=[L("Cancel")])),_:1}),n(a(be),{variant:"solid",onClick:g,loading:o.downloading},{default:w(()=>p[5]||(p[5]=[L("Export")])),_:1},8,["loading"])])]),_:1},8,["modelValue"]))}}),ie=T([]),Oe=T(!1);async function dl(v){return Oe.value=!0,ie.value=await nt("insights.api.alerts.get_alerts",{query:v}),ie.value=ie.value.map(e=>({...e,created_from_now:ge(e.creation),modified_from_now:ge(e.modified)})),Oe.value=!1,ie.value}const cl={doctype:"Insights Alert",name:"",disabled:0,title:"",channel:"Email",query:"",frequency:"Hourly",cron_format:"",last_execution:"",next_execution:"",telegram_chat_id:"",recipients:"",condition:"",custom_condition:0,message:"",creation:"",modified:"",created_from_now:"",modified_from_now:"",owner:""};function ml(v){return yt("Insights Alert",v,{initialDoc:{...cl,name:v},enableAutoSave:!1,disableLocalStorage:!0})}function Ze(){return K({alerts:ie,loading:Oe,loadAlerts:dl,getAlert:ml})}const pl={class:"flex h-[30rem] w-full flex-1 flex-col gap-3 overflow-auto text-base"},fl={class:"flex justify-between gap-2 overflow-visible py-1"},vl=F({__name:"QueryAlertsDialog",props:A({query:{}},{modelValue:{},modelModifiers:{}}),emits:A({"set-current-alert-name":v=>!0},["update:modelValue"]),setup(v,{emit:e}){const i=e,o=v,t=R(v,"modelValue"),l=Ze();l.loadAlerts(o.query.doc.name);const u=T(""),g=O(()=>u.value?l.alerts.filter(p=>p.title.toLowerCase().includes(u.value.toLowerCase())||p.owner.toLowerCase().includes(u.value.toLowerCase())):l.alerts),b=T({columns:[{label:"Title",key:"title"},{label:"Status",key:"disabled",getLabel:p=>p.row.disabled?"Disabled":"Enabled",prefix:p=>{const d=p.row.disabled?"text-gray-500":"text-green-500";return n(Rt,{class:d},null)}},{label:"Created By",key:"owner"},{label:"Last Execution",key:"last_execution",getLabel:p=>p.row.last_execution?ge(p.row.last_execution).value:""}],rows:g,rowKey:"name",options:{selectable:!0,showTooltip:!1,onRowClick:p=>{i("set-current-alert-name",p.name),t.value=!1},emptyState:{title:"No alerts",description:"Set up alerts to get notified when a condition is met",button:{label:"New Alert",variant:"solid",onClick:()=>{i("set-current-alert-name","new-alert-"+Me()),t.value=!1}}}}});return(p,d)=>{const y=q("FormControl"),r=q("Button"),m=q("Dialog");return c(),C(m,{modelValue:t.value,"onUpdate:modelValue":d[2]||(d[2]=k=>t.value=k),options:{title:"Alerts",size:"2xl"}},{"body-content":w(()=>[s("div",pl,[s("div",fl,[n(y,{placeholder:"Search",modelValue:u.value,"onUpdate:modelValue":d[0]||(d[0]=k=>u.value=k),debounce:300},{prefix:w(()=>[n(a(Ve),{class:"h-4 w-4 text-gray-500"})]),_:1},8,["modelValue"]),n(r,{label:"New Alert",variant:"outline",onClick:d[1]||(d[1]=()=>{i("set-current-alert-name","new-alert-"+a(Me)()),t.value=!1})},{prefix:w(()=>[n(a($e),{class:"h-4 w-4 text-gray-700","stroke-width":"1.5"})]),_:1})]),n(a(Ue),je({class:"h-full"},b.value),null,16)])]),_:1},8,["modelValue"])}}}),yl={class:"flex flex-col gap-3 text-base"},_l={class:"flex gap-4"},xl={class:"flex flex-1 flex-col gap-3"},gl={class:"flex flex-1 flex-col gap-3"},bl={class:"flex flex-col"},hl={key:0,class:"flex gap-4"},wl={key:1},kl=F({__name:"AlertSetupDialog",props:A({query:{},alert_name:{}},{modelValue:{},modelModifiers:{}}),emits:["update:modelValue"],setup(v){const e=v,i=R(v,"modelValue"),o=Ze().getAlert(e.alert_name),t=K({left:"",operator:"==",right:""});_t(()=>o.isloaded).then(()=>{if(o.doc.condition){const p=/q\['(.*)'\] ([!=><]+) (.*)/,d=o.doc.condition.match(p);d&&(t.left=d[1],t.operator=d[2],t.right=d[3])}}),ae(()=>t,()=>{o.doc.custom_condition=0,o.doc.condition=`q['${t.left}'] ${t.operator} ${t.right}`},{deep:!0});const l=O(()=>!(!o.doc.title||!o.doc.frequency||o.doc.frequency==="Cron"&&!o.doc.cron_format||!o.doc.channel||o.doc.channel==="Email"&&!o.doc.recipients||o.doc.channel==="Telegram"&&!o.doc.telegram_chat_id||o.doc.custom_condition&&!o.doc.condition||!o.doc.custom_condition&&!t.left||!o.doc.custom_condition&&!t.operator||!o.doc.custom_condition&&!t.right||!o.doc.message));function u(){if(!o.isdirty||!l.value)return;const p=a(o.islocal);return p&&(o.doc.query=e.query.doc.name),o.doc.disabled=0,o.save().then(()=>{De({title:p?"Alert Created":"Alert Updated",message:`Alert "${o.doc.title}" has been ${p?"created":"updated"}.`,variant:"success"}),i.value=!1})}function g(){if(l.value)return o.islocal&&(o.doc.query=e.query.doc.name),o.call("test_alert").then(()=>{De({title:"Alert Sent",message:`Alert "${o.doc.title}" has been sent.`,variant:"success"})})}function b(){return o.doc.disabled=o.doc.disabled?0:1,o.save().then(()=>{De({title:o.doc.disabled?"Alert Disabled":"Alert Enabled",message:`Alert "${o.doc.title}" has been ${o.doc.disabled?"disabled":"enabled"}.`,variant:"success"})})}return(p,d)=>{const y=q("FormControl"),r=q("Dialog");return c(),C(r,{modelValue:i.value,"onUpdate:modelValue":d[12]||(d[12]=m=>i.value=m),disableOutsideClickToClose:a(o).isdirty||a(o).islocal,options:{title:"Setup Alert",size:"2xl",actions:[{label:"Send Test Alert",disabled:!l.value||a(o).loading||a(o).saving,loading:a(o).loading,onClick:g},{label:a(o).doc.disabled?"Enable Alert":"Disable Alert",disabled:a(o).loading||a(o).saving,loading:a(o).loading,onClick:b},{label:a(o).islocal?"Create Alert":"Update Alert",variant:"solid",disabled:!l.value||!a(o).isdirty||a(o).saving||a(o).loading,loading:a(o).saving,onClick:u}]}},{"body-content":w(()=>[s("div",yl,[s("div",_l,[s("div",xl,[n(y,{type:"text",label:"Alert Name",modelValue:a(o).doc.title,"onUpdate:modelValue":d[0]||(d[0]=m=>a(o).doc.title=m),placeholder:"e.g. Low Inventory"},null,8,["modelValue"]),n(y,{type:"select",label:"Frequency",modelValue:a(o).doc.frequency,"onUpdate:modelValue":d[1]||(d[1]=m=>a(o).doc.frequency=m),options:[{value:"Hourly",label:"Check once an hour"},{value:"Daily",label:"Check once a day"},{value:"Weekly",label:"Check once a week"},{value:"Monthly",label:"Check once a month"},{value:"Cron",label:"Cron"}]},null,8,["modelValue"]),a(o).doc.frequency==="Cron"?(c(),C(y,{key:0,type:"text",label:"Cron",modelValue:a(o).doc.cron_format,"onUpdate:modelValue":d[2]||(d[2]=m=>a(o).doc.cron_format=m),placeholder:"e.g. 0 0 12 * * ?"},null,8,["modelValue"])):U("",!0)]),s("div",gl,[n(y,{type:"select",label:"Channel",modelValue:a(o).doc.channel,"onUpdate:modelValue":d[3]||(d[3]=m=>a(o).doc.channel=m),options:[{label:"Email",value:"Email"}]},null,8,["modelValue"]),a(o).doc.channel==="Email"?(c(),C(y,{key:0,type:"text",label:"Recipients",modelValue:a(o).doc.recipients,"onUpdate:modelValue":d[4]||(d[4]=m=>a(o).doc.recipients=m),placeholder:"e.g. john@example.com, henry@example.com"},null,8,["modelValue"])):U("",!0),a(o).doc.channel==="Telegram"?(c(),C(y,{key:1,type:"text",label:"Telegram Chat ID",modelValue:a(o).doc.telegram_chat_id,"onUpdate:modelValue":d[5]||(d[5]=m=>a(o).doc.telegram_chat_id=m),placeholder:"e.g. 123456789"},null,8,["modelValue"])):U("",!0)])]),s("div",bl,[d[13]||(d[13]=s("label",{class:"mb-1.5 block text-xs text-ink-gray-5"},"Send alert when",-1)),a(o).doc.custom_condition?(c(),D("div",wl,[n(ve,{language:"python",placeholder:"e.g. order_count < 100",class:"inline-expression h-fit max-h-[10rem] min-h-[5rem] text-sm",modelValue:a(o).doc.condition,"onUpdate:modelValue":d[9]||(d[9]=m=>a(o).doc.condition=m),"column-options":e.query.result.columnOptions},null,8,["modelValue","column-options"])])):(c(),D("div",hl,[n(y,{type:"select",class:"flex-1",placeholder:"Select Field",modelValue:t.left,"onUpdate:modelValue":d[6]||(d[6]=m=>t.left=m),options:e.query.result.columnOptions},null,8,["modelValue","options"]),n(y,{type:"select",class:"flex-1",modelValue:t.operator,"onUpdate:modelValue":d[7]||(d[7]=m=>t.operator=m),options:["==","!=",">",">=","<","<="]},null,8,["modelValue"]),n(y,{type:"text",class:"flex-1",modelValue:t.right,"onUpdate:modelValue":d[8]||(d[8]=m=>t.right=m),placeholder:"e.g. 100"},null,8,["modelValue"])])),n(xt,{class:"mt-1.5",label:"Use Custom Condition",modelValue:a(o).doc.custom_condition,"onUpdate:modelValue":d[10]||(d[10]=m=>a(o).doc.custom_condition=m)},null,8,["modelValue"])]),s("div",null,[n(a(at),{label:"Message",class:"min-h-40 text-p-sm",modelValue:a(o).doc.message,"onUpdate:modelValue":d[11]||(d[11]=m=>a(o).doc.message=m),placeholder:`e.g.
Hey,
We have **low inventory** for **{{ title }}**.
Please order more.
Thanks,
						`},null,8,["modelValue"]),d[14]||(d[14]=s("div",{class:"mt-2 text-p-sm text-gray-600"},[L(" You can use markdown to format the message. Use double asterisks (**) for bold text. You can use the following fields in the message: "),s("div",{innerHTML:`<ul class='list-disc pl-4'>
							<li>{{ rows }} - The result of the query</li>
							<li>{{ count }} - The number of rows in the query</li>
						</ul>`})],-1))])])]),_:1},8,["modelValue","disableOutsideClickToClose","options"])}}}),Vl={class:"tnum flex items-center gap-1 text-sm text-gray-600"},Cl={key:0,class:"inline-block"},$l={key:1},Sl=F({__name:"QueryDataTable",props:{query:{},enableAlerts:{type:Boolean},enableColumnRename:{type:Boolean},enableSort:{type:Boolean},enableDrillDown:{type:Boolean},enableNewColumn:{type:Boolean},onSortChange:{type:Function}},setup(v){const e=v,i=O(()=>e.query.result.columns),o=O(()=>e.query.result.formattedRows),t=O(()=>e.query.result.rows.length),l=O(()=>!e.query.result.totalRowCount&&t.value<100?t.value:e.query.result.totalRowCount);function u(x,f){f=f.trim(),f!==x&&f&&e.query.renameColumn(x,f)}const g=O(()=>{const x={};return e.query.currentOperations.forEach(f=>{if(f.type==="order_by"){const V=f.column.column_name,h=f.direction;x[V]=h}}),x});function b(x,f){if(e.onSortChange){e.onSortChange(x,f);return}if(!f){e.query.removeOrderBy(x);return}e.query.addOrderBy({column:J(x),direction:f})}const p=T(!1),d=T();function y(x,f){d.value=e.query.getDrillDownQuery(x,f),d.value&&(p.value=!0)}const r=T(!1),m=T(""),k=T(!1),_=O(()=>{const x=new Date;return`export_${`${x.getDate()}_${x.getMonth()}_${x.getFullYear()}`}`});function S(){var x;(x=e.query)!=null&&x.exportResults&&(k.value=!0)}me(()=>e.query.downloading,(x,f)=>{f&&!x&&(k.value=!1)});function $(x,f){e.query.exportResults(x,f)}return(x,f)=>{const V=q("Tooltip");return c(),D(N,null,[n(It,je({loading:e.query.executing,columns:i.value,rows:o.value,"enable-pagination":!0,"on-export":e.query.exportResults,downloading:e.query.downloading,"sort-order":g.value,"on-sort-change":e.enableSort?b:void 0,"on-column-rename":e.enableColumnRename?u:void 0,"on-drilldown":e.enableDrillDown?y:void 0,"enable-new-column":e.enableNewColumn},x.$attrs),st({"header-prefix":w(({column:h})=>[Y(x.$slots,"header-prefix",{column:h})]),"header-suffix":w(({column:h})=>[Y(x.$slots,"header-suffix",{column:h})]),"footer-left":w(()=>[s("div",Vl,[s("span",null," Showing "+z(t.value.toLocaleString())+" of ",1),l.value?(c(),D("span",$l,z(l.value.toLocaleString()),1)):(c(),D("span",Cl,[n(V,{text:"Load Count"},{default:w(()=>[e.query.fetchingCount?(c(),C(a(rt),{key:1,class:"h-3.5 w-3.5 text-gray-600"})):(c(),C(a(zt),{key:0,class:"h-3.5 w-3.5 cursor-pointer transition-all hover:text-gray-800","stroke-width":"1.5",onClick:e.query.fetchResultCount},null,8,["onClick"]))]),_:1})])),f[7]||(f[7]=L(" rows "))])]),"footer-right-actions":w(()=>[x.enableAlerts?(c(),C(a(be),{key:0,variant:"ghost",onClick:f[0]||(f[0]=h=>r.value=!0)},{icon:w(()=>[n(a(Qt),{class:"h-4 w-4 text-gray-700","stroke-width":"1.5"})]),_:1})):U("",!0),n(a(be),{variant:"ghost",onClick:S},{icon:w(()=>[n(a(Gt),{class:"h-4 w-4 text-gray-700","stroke-width":"1.5"})]),_:1})]),_:2},[e.enableNewColumn?{name:"new-column-editor",fn:w(h=>[Y(x.$slots,"new-column-editor",it(ut(h)))]),key:"0"}:void 0]),1040,["loading","columns","rows","on-export","downloading","sort-order","on-sort-change","on-column-rename","on-drilldown","enable-new-column"]),n(rl,{modelValue:k.value,"onUpdate:modelValue":f[1]||(f[1]=h=>k.value=h),downloading:e.query.downloading,"default-filename":_.value,onExport:$,onCancel:e.query.cancelDownload},null,8,["modelValue","downloading","default-filename","onCancel"]),d.value?(c(),C(Da,{key:0,modelValue:p.value,"onUpdate:modelValue":[f[2]||(f[2]=h=>p.value=h),f[3]||(f[3]=h=>h?void 0:d.value=void 0)],query:d.value},null,8,["modelValue","query"])):U("",!0),r.value?(c(),C(vl,{key:1,modelValue:r.value,"onUpdate:modelValue":f[4]||(f[4]=h=>r.value=h),query:e.query,onSetCurrentAlertName:f[5]||(f[5]=h=>m.value=h)},null,8,["modelValue","query"])):U("",!0),m.value?(c(),C(kl,{key:2,modelValue:!!m.value,"onUpdate:modelValue":f[6]||(f[6]=h=>h?void 0:m.value=""),query:e.query,alert_name:m.value},null,8,["modelValue","query","alert_name"])):U("",!0)],64)}}}),Dl={class:"mb-1.5 flex items-center gap-1 last:mb-0"},ql={class:"flex-1 overflow-hidden"},Tl={class:"group flex flex-1 cursor-pointer items-center justify-between gap-1 overflow-hidden rounded bg-gray-50 py-1.5 px-2 hover:bg-gray-100"},Ol={class:"flex-1 overflow-hidden"},jl={class:"flex-shrink-0"},Ul={key:0,class:"flex h-full flex-col items-center justify-center rounded border border-dashed border-gray-300 py-2"},Al={class:"text-xs text-gray-500"},El={__name:"DraggableList",props:A({items:{type:Array,required:!0},group:{type:String,required:!0},itemKey:{type:String,default:"value"},emptyText:{type:String,default:"No items"},showEmptyState:{type:Boolean,default:!0},showHandle:{type:Boolean,default:!0}},{items:{},itemsModifiers:{}}),emits:A(["sort"],["update:items"]),setup(v,{emit:e}){const i=e,o=R(v,"items"),t=v;function l(u){u.moved&&(i("sort",u.moved.oldIndex,u.moved.newIndex),o.value.splice(u.moved.newIndex,0,o.value.splice(u.moved.oldIndex,1)[0])),u.added&&o.value.splice(u.added.newIndex,0,u.added.element),u.removed&&o.value.splice(u.removed.oldIndex,1)}return(u,g)=>{var b;return c(),D(N,null,[n(a($t),{class:"w-full","model-value":o.value,group:t.group,"item-key":v.itemKey,onChange:l},{item:w(({element:p,index:d})=>[s("div",Dl,[t.showHandle?(c(),C(a(St),{key:0,class:"h-4 w-4 flex-shrink-0 cursor-grab text-gray-500"})):U("",!0),s("div",ql,[Y(u.$slots,"item",{item:p,index:d},()=>[s("div",Tl,[s("div",Ol,[Y(u.$slots,"item-content",{item:p,index:d},()=>[s("div",null,z(typeof p=="object"?p[v.itemKey]:p),1)])]),s("div",jl,[n(a(ne),{onClick:re(y=>o.value.splice(d,1),["prevent","stop"]),class:"invisible h-4 w-4 text-gray-600 transition-all hover:text-gray-800 group-hover:visible","stroke-width":"1.5"},null,8,["onClick"])])])])]),Y(u.$slots,"item-suffix",{item:p,index:d})])]),_:3},8,["model-value","group","item-key"]),v.showEmptyState&&!((b=o.value)!=null&&b.length)?(c(),D("div",Ul,[s("div",Al,z(t.emptyText),1)])):U("",!0)],64)}}},Bl=F({__name:"DataTypeIcon",props:{columnType:{}},setup(v){const e=v,i=O(()=>{switch(e.columnType){case"Integer":case"Decimal":return Ot;case"Date":return At;case"Datetime":return Tt;case"Time":return Ut;case"Text":return qt;case"JSON":return Ye;case"Array":return Nt;case"String":return Re;case"Auto":return Re;default:return Dt}});return(o,t)=>(c(),C(pe(i.value),{class:"h-4 w-4 text-gray-700","stroke-width":"1.5"}))}}),Ll={class:"-mb-7 flex h-[22rem] flex-col p-0.5 text-base"},Fl={class:"flex items-center gap-1.5"},Ml={class:"truncate"},Il={class:"flex-shrink-0 bg-white pt-1.5 text-sm text-gray-500"},Rl=F({__name:"ColumnsSelectorDialog",props:A({columns:{}},{modelValue:{},modelModifiers:{}}),emits:A({select:v=>!0},["update:modelValue"]),setup(v,{emit:e}){const i=e,o=R(v,"modelValue"),t=P("query"),l=T([]);de(()=>{l.value=[...t.result.columns]});const u=T([]);t.getColumnsForSelection().then(y=>u.value=y);const g=T(null);function b(y){l.value=y.map(r=>({name:r.value,type:r.data_type})),setTimeout(()=>{var r;(r=g.value)==null||r.scrollTo({top:g.value.scrollHeight,behavior:"smooth"})},100)}const p=O(()=>l.value.length===0||l.value.map(y=>y.name).join()===t.result.columns.map(y=>y.name).join());function d(){i("select",{column_names:l.value.map(y=>y.name).filter(y=>y).filter((y,r,m)=>m.indexOf(y)===r)}),o.value=!1}return(y,r)=>{const m=q("Button"),k=ye,_=q("Dialog");return c(),C(_,{modelValue:o.value,"onUpdate:modelValue":r[1]||(r[1]=S=>o.value=S),options:{size:"sm",title:"Select Columns",actions:[{label:"Confirm",variant:"solid",disabled:p.value,onClick:d},{label:"Cancel",onClick:()=>o.value=!1}]}},{"body-content":w(()=>[s("div",Ll,[n(k,{class:"flex-shrink-0",multiple:!0,options:u.value,placeholder:"Add column",modelValue:l.value.map(S=>S.name),"onUpdate:modelValue":b},{target:w(({togglePopover:S})=>[n(m,{class:"w-full !justify-start",onClick:S},{prefix:w(()=>[n(a(Ve),{class:"h-4 w-4 text-gray-500","stroke-width":"1.5"})]),suffix:w(()=>[n(a(Ke),{class:"ml-auto h-4 w-4 text-gray-500","stroke-width":"1.5"})]),default:w(()=>[r[2]||(r[2]=s("span",{class:"flex-1 text-gray-500"},"Add column",-1))]),_:2},1032,["onClick"])]),_:1},8,["options","modelValue"]),s("div",{ref_key:"columns",ref:g,class:"relative mt-4 flex-1 overflow-y-scroll"},[n(El,{items:l.value,"onUpdate:items":r[0]||(r[0]=S=>l.value=S),"item-key":"name",group:"columns","empty-text":"No columns selected"},{"item-content":w(({item:S})=>[s("div",Fl,[n(Bl,{columnType:S.type},null,8,["columnType"]),s("span",Ml,z(S.name),1)])]),_:1},8,["items"])],512),s("p",Il,z(l.value.length)+" columns selected ",1)])]),_:1},8,["modelValue","options"])}}}),zl={class:"bg-white px-4 pb-6 pt-5 sm:px-6"},Ql={class:"flex items-center justify-between pb-4"},Nl={class:"flex flex-col gap-2"},Pl={class:"mt-2 flex items-center justify-between gap-2"},Gl={class:"flex items-center gap-2"},Jl=F({__name:"CustomScriptDialog",props:A({operation:{},columnOptions:{}},{modelValue:{},modelModifiers:{}}),emits:A({select:v=>!0},["update:modelValue"]),setup(v,{emit:e}){const i=v,o=e,t=R(v,"modelValue"),l=T(i.operation?ce(i.operation):{expression:Z("")}),u=O(()=>l.value.expression.expression.trim().length>0);function g(){u.value&&(o("select",l.value),b(),t.value=!1)}function b(){l.value={expression:Z("")}}return(p,d)=>{const y=q("Button"),r=q("Dialog");return c(),C(r,{modelValue:t.value,onAfterLeave:b,onClose:d[2]||(d[2]=m=>!l.value.expression.expression&&(t.value=!1)),options:{size:"4xl"}},{body:w(()=>[s("div",zl,[s("div",Ql,[d[3]||(d[3]=s("h3",{class:"text-2xl font-semibold leading-6 text-gray-900"},"Custom Operation",-1)),n(y,{variant:"ghost",onClick:d[0]||(d[0]=m=>t.value=!1),icon:"x",size:"md"})]),s("div",Nl,[n(ve,{class:"h-[26rem]",modelValue:l.value.expression.expression,"onUpdate:modelValue":d[1]||(d[1]=m=>l.value.expression.expression=m),"column-options":i.columnOptions},null,8,["modelValue","column-options"])]),s("div",Pl,[d[4]||(d[4]=s("div",null,null,-1)),s("div",Gl,[n(y,{label:"Confirm",variant:"solid",disabled:!u.value,onClick:g},null,8,["disabled"])])])])]),_:1},8,["modelValue"])}}}),Hl=["Last","Current","Next"],Yl=["Day","Week","Month","Quarter","Year","Fiscal Year"],Kl={class:"flex w-[15rem] select-none flex-col gap-2 rounded bg-white text-base"},Wl={class:"flex gap-2"},Xl={key:0,class:"flex items-center gap-2"},Zl={class:"text-p-sm text-gray-600"},eo=F({__name:"RelativeDatePicker",props:{modelValue:{default:()=>"Last 1 Day",required:!0},modelModifiers:{}},emits:["update:modelValue"],setup(v){const e=R(v,"modelValue"),i=K({span:"Last",interval:"1",intervalType:"Day",includeCurrent:!1});if(e.value){const t=/\(include current\)$/.test(e.value),u=e.value.replace(/\s*\(include current\)$/,"").split(" ");i.span=u[0],i.span==="Current"?(i.interval="1",i.intervalType=u.slice(1).join(" ")):(i.interval=u[1],i.intervalType=u.slice(2).join(" ")),i.includeCurrent=t}de(()=>{i.intervalType==="Fiscal Year"&&(i.includeCurrent=!1);const t=i.span==="Current"?`${i.span} ${i.intervalType}`:`${i.span} ${i.interval} ${i.intervalType}`;e.value=i.includeCurrent&&i.span!=="Current"?`${t} (include current)`:t});const o=(t,l)=>t==="Current"?`${l} to Date`:`Include Current ${l}`;return(t,l)=>{const u=q("Toggle");return c(),D("div",Kl,[s("div",Wl,[n(a(ue),{type:"select",modelValue:i.span,"onUpdate:modelValue":l[0]||(l[0]=g=>i.span=g),class:"flex-[3] flex-shrink-0 text-sm",options:a(Hl)},null,8,["modelValue","options"]),i.span!=="Current"?(c(),C(a(ue),{key:0,type:"number",modelValue:i.interval,"onUpdate:modelValue":l[1]||(l[1]=g=>i.interval=g),class:"flex-[2] flex-shrink-0 text-sm"},null,8,["modelValue"])):U("",!0),n(a(ue),{type:"select",modelValue:i.intervalType,"onUpdate:modelValue":l[2]||(l[2]=g=>i.intervalType=g),class:"flex-[3] flex-shrink-0 text-sm",options:a(Yl)},null,8,["modelValue","options"])]),i.span!=="Current"&&i.intervalType!=="Fiscal Year"?(c(),D("div",Xl,[n(u,{size:"sm",modelValue:i.includeCurrent,"onUpdate:modelValue":l[3]||(l[3]=g=>i.includeCurrent=g)},null,8,["modelValue"]),s("span",Zl,z(o(i.span,i.intervalType)),1)])):U("",!0)])}}}),to=["value","placeholder","onFocus"],lo={class:"flex flex-col p-2"},oo={class:"mt-2 flex justify-end"},no=F({__name:"RelativeDatePickerControl",props:A({placeholder:{}},{modelValue:{default:()=>"Last 1 Day",required:!0},modelModifiers:{}}),emits:["update:modelValue"],setup(v){const e=v,i=R(v,"modelValue");return(o,t)=>{const l=q("Button"),u=ke;return c(),C(u,{class:"flex w-full [&>div:first-child]:w-full"},{target:w(({togglePopover:g})=>[s("input",{readonly:"",type:"text",value:i.value,placeholder:e.placeholder,onFocus:b=>g(),class:"form-input block h-7 w-full cursor-text select-none rounded border-gray-400 text-sm placeholder-gray-500"},null,40,to)]),"body-main":w(({togglePopover:g})=>[s("div",lo,[n(eo,{modelValue:i.value,"onUpdate:modelValue":t[0]||(t[0]=b=>i.value=b)},null,8,["modelValue"]),s("div",oo,[n(l,{variant:"solid",onClick:g},{default:w(()=>t[1]||(t[1]=[L(" Done ")])),_:2},1032,["onClick"])])])]),_:1})}}}),ao={class:"flex flex-1 gap-2"},so={id:"column_name",class:"!min-w-[140px] flex-1 flex-shrink-0"},io={id:"operator",class:"!min-w-[100px] flex-1"},uo={id:"value",class:"!min-w-[140px] flex-1 flex-shrink-0"},ro=F({__name:"FilterRule",props:A({columnOptions:{}},{modelValue:{required:!0},modelModifiers:{}}),emits:["update:modelValue"],setup(v){const e=R(v,"modelValue"),i=v;dt(()=>{g.value==="select"&&d()});function o(y){var r;e.value.column=J(y),e.value.operator=(r=l.value[0])==null?void 0:r.value,e.value.value=void 0,g.value==="select"&&(e.value.value=[],d())}const t=O(()=>{var m;if(!((m=i.columnOptions)!=null&&m.length)||!e.value.column.column_name)return;const r=he(i.columnOptions).find(k=>k.value===e.value.column.column_name);if(!r)throw new Error(`Column not found: ${e.value.column.column_name}`);return r.data_type}),l=O(()=>t.value?Et(Te(t.value)):[]);function u(y){e.value.operator=y,e.value.value=void 0}const g=O(()=>{if(!(!e.value.column.column_name||!e.value.operator||!t.value))return Bt(e.value.operator,Te(t.value))}),b=T([]),p=T(!1),d=Qe(y=>{const m=he(i.columnOptions).find(x=>x.value===e.value.column.column_name);if(!(m!=null&&m.query)){p.value=!1,console.warn("Query not found for column:",e.value.column.column_name);return}const k="`",S=new RegExp(`${k}([^${k}]+)${k}\\.${k}([^${k}]+)${k}`).exec(e.value.column.column_name),$=S?S[2]:e.value.column.column_name;return p.value=!0,Be(m.query).getDistinctColumnValues($,y).then(x=>b.value=x).finally(()=>p.value=!1)},300);return(y,r)=>{const m=ye,k=q("FormControl");return c(),D("div",ao,[s("div",so,[n(m,{placeholder:"Column",modelValue:e.value.column.column_name,options:i.columnOptions,"onUpdate:modelValue":r[0]||(r[0]=_=>o(_==null?void 0:_.value))},null,8,["modelValue","options"])]),s("div",io,[n(k,{type:"select",placeholder:"Operator",disabled:!t.value,modelValue:e.value.operator,options:l.value,"onUpdate:modelValue":r[1]||(r[1]=_=>u(_))},null,8,["disabled","modelValue","options"])]),s("div",uo,[g.value==="text"?(c(),C(k,{key:0,modelValue:e.value.value,"onUpdate:modelValue":r[2]||(r[2]=_=>e.value.value=_),placeholder:"Value",autocomplete:"off"},null,8,["modelValue"])):g.value==="number"?(c(),C(k,{key:1,type:"number",modelValue:e.value.value,placeholder:"Value","onUpdate:modelValue":r[3]||(r[3]=_=>e.value.value=Number(_))},null,8,["modelValue"])):g.value==="date"?(c(),C(ze,{key:2,placeholder:"Select Date",modelValue:[e.value.value],"onUpdate:modelValue":r[4]||(r[4]=_=>e.value.value=_[0])},null,8,["modelValue"])):g.value==="date_range"?(c(),C(ze,{key:3,range:!0,modelValue:e.value.value,"onUpdate:modelValue":r[5]||(r[5]=_=>e.value.value=_),placeholder:"Select Date"},null,8,["modelValue"])):g.value==="relative_date"?(c(),C(no,{key:4,modelValue:e.value.value,"onUpdate:modelValue":r[6]||(r[6]=_=>e.value.value=_),placeholder:"Relative Date"},null,8,["modelValue"])):g.value==="select"?(c(),C(m,{key:5,class:"max-w-[200px]",placeholder:"Value",multiple:!0,modelValue:e.value.value||[],options:b.value,loading:p.value,"onUpdate:query":a(d),"onUpdate:modelValue":r[7]||(r[7]=_=>e.value.value=(_==null?void 0:_.map(S=>S.value))||[])},null,8,["modelValue","options","loading","onUpdate:query"])):(c(),C(k,{key:6,disabled:""}))])])}}}),co={class:"min-w-[36rem] rounded-lg bg-white px-4 pb-6 pt-5 sm:px-6"},mo={class:"flex items-center justify-between pb-4"},po={class:"flex flex-1 items-start gap-2"},fo={class:"flex h-7 w-15 flex-shrink-0 items-center text-base text-gray-600"},vo={key:0},yo={class:"flex h-full flex-shrink-0 items-start"},_o={key:1,class:"mb-3 flex h-7 items-center px-0 text-sm text-gray-600"},xo={class:"mt-2 flex items-center justify-between gap-2"},go={class:"flex items-center gap-2"},bo=F({__name:"FiltersSelector",props:{filterGroup:{},columnOptions:{},disableLogicalOperator:{type:Boolean},disableExpressions:{type:Boolean}},emits:{select:v=>!0,close:()=>!0},setup(v,{emit:e}){const i=v,o=e,t=K(i.filterGroup?ce(i.filterGroup):{logical_operator:"And",filters:[]});function l(){t.filters.push({column:J(""),operator:"=",value:void 0})}const u=O(()=>t.filters.length?t.filters.every(b=>{if("expression"in b)return Lt(b);const d=he(i.columnOptions).find(y=>y.value===b.column.column_name);return d?Ft(b,Te(d.data_type)):!1}):!0),g=O(()=>i.filterGroup?JSON.stringify(t)!==JSON.stringify(i.filterGroup):!0);return(b,p)=>{const d=q("Button"),y=q("Dropdown");return c(),D("div",co,[s("div",mo,[p[4]||(p[4]=s("h3",{class:"text-2xl font-semibold leading-6 text-gray-900"},"Filter",-1)),n(d,{variant:"ghost",onClick:p[0]||(p[0]=r=>o("close")),icon:"x",size:"md"})]),t.filters.length?(c(!0),D(N,{key:0},X(t.filters,(r,m)=>(c(),D("div",{key:m,id:"filter-list",class:"mb-3 flex items-start justify-between gap-2"},[s("div",po,[s("div",fo,[m==0?(c(),D("span",vo,"Where")):(c(),C(d,{key:1,class:"text-sm",onClick:p[1]||(p[1]=()=>{i.disableLogicalOperator||(t.logical_operator=t.logical_operator==="And"?"Or":"And")})},{prefix:w(()=>[n(a(We),{class:"h-3 w-3 text-gray-700","stroke-width":"1.5"})]),default:w(()=>[L(" "+z(t.logical_operator.toLowerCase()),1)]),_:1}))]),"expression"in t.filters[m]?(c(),C(ve,{key:0,language:"python",class:"inline-expression h-fit max-h-[10rem] min-h-[1.75rem] text-sm",modelValue:t.filters[m].expression.expression,"onUpdate:modelValue":k=>t.filters[m].expression.expression=k,"column-options":a(he)(i.columnOptions)},null,8,["modelValue","onUpdate:modelValue","column-options"])):U("",!0),"column"in t.filters[m]?(c(),C(ro,{key:1,modelValue:t.filters[m],columnOptions:i.columnOptions,"onUpdate:modelValue":k=>t.filters[m]=k},null,8,["modelValue","columnOptions","onUpdate:modelValue"])):U("",!0)]),s("div",yo,[n(y,{placement:"right",button:{icon:"more-horizontal",variant:"ghost"},options:[i.disableExpressions?null:{label:"Convert to Expression",onClick:()=>{t.filters[m]={expression:a(Z)("")}}},{label:"Duplicate",onClick:()=>{t.filters.splice(m+1,0,a(ce)(t.filters[m]))}},{label:"Remove",onClick:()=>t.filters.splice(m,1)}]},null,8,["options"])])]))),128)):(c(),D("div",_o," Empty - Click 'Add Filter' to add a filter ")),s("div",xo,[n(d,{onClick:l,label:"Add Filter"},{prefix:w(()=>[n(a($e),{class:"h-4 w-4 text-gray-700","stroke-width":"1.5"})]),_:1}),s("div",go,[n(d,{label:"Clear",variant:"outline",onClick:p[2]||(p[2]=r=>t.filters=[])}),n(d,{label:"Apply Filters",variant:"solid",disabled:!u.value||!g.value,onClick:p[3]||(p[3]=r=>o("select",t))},null,8,["disabled"])])])])}}}),ho=F({__name:"FiltersSelectorDialog",props:A({filterGroup:{},columnOptions:{},disableLogicalOperator:{type:Boolean},disableExpressions:{type:Boolean}},{modelValue:{},modelModifiers:{}}),emits:A({select:v=>!0},["update:modelValue"]),setup(v,{emit:e}){const i=v,o=e,t=R(v,"modelValue");return(l,u)=>{const g=q("Dialog");return c(),C(g,{modelValue:t.value,"onUpdate:modelValue":u[2]||(u[2]=b=>t.value=b),options:{size:"2xl"}},{body:w(()=>[n(bo,{filterGroup:i.filterGroup,columnOptions:i.columnOptions,disableLogicalOperator:i.disableLogicalOperator,disableExpressions:i.disableExpressions,onClose:u[0]||(u[0]=b=>t.value=!1),onSelect:u[1]||(u[1]=b=>{o("select",b),t.value=!1})},null,8,["filterGroup","columnOptions","disableLogicalOperator","disableExpressions"])]),_:1},8,["modelValue"])}}}),wo={class:"min-h-[1.75rem] w-full rounded border text-sm"},ko=F({__name:"InlineExpression",props:A({placeholder:{}},{modelValue:{default:()=>Z(""),required:!0},modelModifiers:{}}),emits:["update:modelValue"],setup(v){const e=R(v,"modelValue");return(i,o)=>(c(),D("div",wo,[n(Je,{class:"inline-expression",modelValue:e.value.expression,"onUpdate:modelValue":o[0]||(o[0]=t=>e.value.expression=t),language:"python",placeholder:i.placeholder},null,8,["modelValue","placeholder"])]))}});function Vo(v){var i,o;const e={...v};v&&((i=e.left_column)!=null&&i.column_name)&&((o=e.right_column)!=null&&o.column_name)&&(v.join_condition={left_column:e.left_column,right_column:e.right_column},delete v.left_column,delete v.right_column)}function et(v){const e=Se(),i=O(()=>{const t=e.tables[v.data_source.value]||[];return t.length?t.map(l=>({table_name:l.table_name,data_source:l.data_source,description:l.data_source,label:l.table_name,value:`${l.data_source}.${l.table_name}`})):[]}),o=T(v.initialSearchText||"");return ct(o,()=>e.getTables(v.data_source.value,o.value),{debounce:300,immediate:!0}),K({options:i,loading:e.loading,searchText:o})}function Co(v,e){const i=T([]),o=T(!1),t=Se();return ae(e,()=>{if(!e.value){i.value=[];return}o.value=!0,t.getTableColumns(v.value,e.value).then(l=>{i.value=l.map(u=>({label:u.name,value:u.name,description:u.type,data_type:u.type}))}).finally(()=>{o.value=!1})},{immediate:!0}),K({options:i,loading:o})}function $o(v){const e=T([]),i=T(!1);return me(v,(o,t)=>{if(o!==t&&(e.value=[]),!o)return;i.value=!0,Be(o).getColumnsForSelection().then(u=>{e.value=u}).catch(u=>{console.error("error:",u),e.value=[]}).finally(()=>{i.value=!1})},{immediate:!0}),K({options:e,loading:i})}const So={class:"rounded-lg bg-white px-4 pb-6 pt-5 sm:px-6"},Do={class:"flex items-center justify-between pb-4"},qo={class:"flex w-full flex-col gap-3 overflow-auto p-0.5 text-base"},To={class:"flex items-end gap-2"},Oo={class:"flex-1"},jo={class:"flex-1"},Uo={key:1,class:"flex-1"},Ao={class:"flex flex-shrink-0 items-start"},Eo={class:"flex gap-2"},Bo=["onClick"],Lo={class:"block text-center text-xs"},Fo={class:"mt-1 text-xs text-gray-600"},Mo={class:"mt-4 flex justify-end gap-2"},Io=F({__name:"JoinSelectorDialog",props:A({join:{}},{modelValue:{},modelModifiers:{}}),emits:A({select:v=>!0},["update:modelValue"]),setup(v,{emit:e}){const i=v,o=e,t=R(v,"modelValue");i.join&&Vo(i.join);const l=K(i.join?{...i.join}:{join_type:"inner",table:ee({}),join_condition:{left_column:J(""),right_column:J("")},select_columns:[]}),u=O({get(){if(l.table.type==="table"&&l.table.table_name)return`${l.table.data_source}.${l.table.table_name}`;if(l.table.type==="query"&&l.table.query_name)return l.table.query_name},set(I){I.data_source&&I.table_name&&(l.table=ee({data_source:I.data_source,table_name:I.table_name})),I.query_name&&(l.table=Ae({workbook:I.workbook,query_name:I.query_name}))}}),g=P("query"),b=O(()=>g.dataSource);ae(u,()=>{u.value&&(l.select_columns=[],"right_column"in l.join_condition&&l.join_condition.right_column.column_name&&(l.join_condition.right_column.column_name=""),"join_expression"in l.join_condition&&l.join_condition.join_expression&&(l.join_condition.join_expression=Z("")))});const p=O(()=>l.table.type==="table"?l.table.table_name:""),d=et({data_source:b,initialSearchText:p.value}),y=Co(b,p);me(()=>y.options,()=>{"join_expression"in l.join_condition||y.options.length&&"right_column"in l.join_condition&&!l.join_condition.right_column.column_name&&m()});const r=Se();async function m(){const I=g.currentOperations.filter(Q=>Q.type==="source"||Q.type==="join").map(Q=>Q.type==="source"&&Q.table.type==="table"||Q.type==="join"&&Q.table.type==="table"?Q.table.table_name:"").filter(Q=>Q!==p.value),j=p.value,W=g.result.columns.map(Q=>Q.name);for(const Q of I){const te=await r.getTableLinks(b.value,Q,j);if(!(te!=null&&te.length))continue;const le=te.find(_e=>W.includes(_e.left_column));if(le&&"left_column"in l.join_condition){l.join_condition.left_column.column_name=le.left_column,l.join_condition.right_column.column_name=le.right_column;break}}}const k=P(Ce,null),_=O(()=>{if(!k)return[];const I=k.getLinkedQueries(g.doc.name);return k.doc.queries.filter(j=>j.name!==g.doc.name&&!I.includes(j.name)).map(j=>({workbook:k.doc.name,query_name:j.name,label:j.title,value:j.name,description:"Query"}))}),S=O(()=>[{group:"Queries",items:_.value},{group:"Tables",items:d.options}]),$=O(()=>l.table.type==="query"?l.table.query_name:""),x=$o($),f=O(()=>"join_expression"in l.join_condition);function V(){f.value?l.join_condition={left_column:J(""),right_column:J("")}:l.join_condition={join_expression:Z("")}}const h=O(()=>{const I=l.table.type==="table"&&l.table.table_name||l.table.type==="query"&&l.table.query_name,j="join_expression"in l.join_condition?l.join_condition.join_expression.expression:!1,W="left_column"in l.join_condition&&"right_column"in l.join_condition?l.join_condition.left_column.column_name&&l.join_condition.right_column.column_name:!1;return I&&l.join_type&&l.select_columns.length>0&&(j||W)});function E(){h.value&&(o("select",{...l}),t.value=!1,B())}function B(){Object.assign(l,{join_type:"inner",table:ee({}),join_condition:{left_column:J(""),right_column:J("")},select_columns:[]})}return(I,j)=>{const W=q("Button"),Q=ye,te=q("Dialog");return c(),C(te,{modelValue:t.value},{body:w(()=>{var le,_e;return[s("div",So,[s("div",Do,[j[8]||(j[8]=s("h3",{class:"text-2xl font-semibold leading-6 text-gray-900"},"Join Table",-1)),n(W,{variant:"ghost",onClick:j[0]||(j[0]=M=>t.value=!1),icon:"x",size:"md"})]),s("div",qo,[s("div",null,[n(Q,{label:"Right Table",placeholder:"Table",modelValue:u.value,"onUpdate:modelValue":j[1]||(j[1]=M=>u.value=M),loading:a(d).loading,options:S.value,"onUpdate:query":j[2]||(j[2]=M=>a(d).searchText=M)},null,8,["modelValue","loading","options"])]),s("div",null,[s("div",To,["left_column"in l.join_condition&&"right_column"in l.join_condition?(c(),D(N,{key:0},[s("div",Oo,[n(Q,{label:"Left Column",placeholder:"Column",options:a(g).result.columnOptions,modelValue:l.join_condition.left_column.column_name,"onUpdate:modelValue":j[3]||(j[3]=M=>l.join_condition.left_column.column_name=M==null?void 0:M.value)},null,8,["options","modelValue"])]),j[9]||(j[9]=s("div",{class:"flex h-7 flex-shrink-0 items-center font-mono"},"=",-1)),s("div",jo,[n(Q,{label:"Right Column",placeholder:"Column",loading:a(y).loading||a(x).loading,options:[...a(y).options,...a(x).options],modelValue:l.join_condition.right_column.column_name,"onUpdate:modelValue":j[4]||(j[4]=M=>l.join_condition.right_column.column_name=M==null?void 0:M.value)},null,8,["loading","options","modelValue"])])],64)):"join_expression"in l.join_condition?(c(),D("div",Uo,[j[10]||(j[10]=s("label",{class:"mb-1 block text-xs text-gray-600"},"Custom Join Condition ",-1)),n(ko,{modelValue:l.join_condition.join_expression,"onUpdate:modelValue":j[5]||(j[5]=M=>l.join_condition.join_expression=M),placeholder:"Example: (t1.column_name = t2.column_name) & (t1.column_name > 10)"},null,8,["modelValue"])])):U("",!0),s("div",Ao,[n(W,{onClick:V},{icon:w(()=>[n(a(Ye),{class:"h-4 w-4 text-gray-700","stroke-width":"1.5"})]),_:1})])])]),s("div",null,[j[11]||(j[11]=s("label",{class:"mb-1 block text-xs text-gray-600"},"Select Join Type",-1)),s("div",Eo,[(c(!0),D(N,null,X(a(Ie),M=>(c(),D("div",{key:M.label,class:fe(["flex flex-1 flex-col items-center justify-center rounded border py-3 transition-all",l.join_type===M.value?"border-gray-700":"cursor-pointer hover:border-gray-400"]),onClick:Fe=>l.join_type=M.value},[(c(),C(pe(M.icon),{class:"h-6 w-6 text-gray-600","stroke-width":"1.5"})),s("span",Lo,z(M.label),1)],10,Bo))),128))]),s("div",Fo,z((le=a(Ie).find(M=>M.value===l.join_type))==null?void 0:le.description),1)]),s("div",null,[j[12]||(j[12]=s("label",{class:"mb-1 block text-xs text-gray-600"},"Select Columns to Add",-1)),n(Q,{multiple:!0,placeholder:"Columns",loading:a(y).loading||a(x).loading,options:[...a(y).options,...a(x).options],modelValue:(_e=l.select_columns)==null?void 0:_e.map(M=>M.column_name),"onUpdate:modelValue":j[6]||(j[6]=M=>l.select_columns=(M==null?void 0:M.map(Fe=>a(J)(Fe.value)))||[])},null,8,["loading","options","modelValue"])])]),s("div",Mo,[n(W,{variant:"outline",label:"Cancel",onClick:j[7]||(j[7]=M=>t.value=!1)}),n(W,{variant:"solid",label:"Confirm",disabled:!h.value,onClick:E},null,8,["disabled"])])])]}),_:1},8,["modelValue"])}}}),Ro={class:"bg-white px-4 pb-6 pt-5 sm:px-6"},zo={class:"flex items-center justify-between pb-4"},Qo={class:"flex flex-col gap-2"},No={class:"flex gap-2"},Po={class:"mt-2 flex items-center justify-between gap-2"},Go={class:"flex items-center gap-2"},Jo=F({__name:"NewColumnSelectorDialog",props:A({mutation:{},columnOptions:{}},{modelValue:{},modelModifiers:{}}),emits:A({select:v=>!0},["update:modelValue"]),setup(v,{emit:e}){const i=v,o=e,t=R(v,"modelValue"),l=Ee.map(d=>d.value),u=T(i.mutation?{name:i.mutation.new_name,type:i.mutation.data_type,expression:i.mutation.expression.expression}:{name:"new_column",type:l[0],expression:""}),g=O(()=>u.value.name&&u.value.type&&u.value.expression.trim());function b(){g.value&&(o("select",{new_name:u.value.name.trim(),data_type:u.value.type,expression:Z(u.value.expression)}),p(),t.value=!1)}function p(){u.value={name:"New Column",type:l[0],expression:""}}return(d,y)=>{const r=q("Button"),m=q("FormControl"),k=q("Dialog");return c(),C(k,{modelValue:t.value,onAfterLeave:p,onClose:y[4]||(y[4]=_=>!u.value.expression&&(t.value=!1))},{body:w(()=>[s("div",Ro,[s("div",zo,[y[5]||(y[5]=s("h3",{class:"text-2xl font-semibold leading-6 text-gray-900"},"Create Column",-1)),n(r,{variant:"ghost",onClick:y[0]||(y[0]=_=>t.value=!1),icon:"x",size:"md"})]),s("div",Qo,[n(ve,{modelValue:u.value.expression,"onUpdate:modelValue":y[1]||(y[1]=_=>u.value.expression=_),"column-options":i.columnOptions},null,8,["modelValue","column-options"]),s("div",No,[n(m,{type:"text",class:"flex-1",label:"Column Name",autocomplete:"off",placeholder:"Column Name",modelValue:u.value.name,"onUpdate:modelValue":y[2]||(y[2]=_=>u.value.name=_)},null,8,["modelValue"]),n(m,{type:"select",class:"flex-1",label:"Column Type",autocomplete:"off",options:a(l),modelValue:u.value.type,"onUpdate:modelValue":y[3]||(y[3]=_=>u.value.type=_)},null,8,["options","modelValue"])])]),s("div",Po,[y[6]||(y[6]=s("div",null,null,-1)),s("div",Go,[n(r,{label:"Confirm",variant:"solid",disabled:!g.value,onClick:b},null,8,["disabled"])])])])]),_:1},8,["modelValue"])}}}),Ho={class:"flex h-full flex-col gap-2 overflow-auto p-8 px-10"},Yo={class:"text-xl font-semibold"},Ko={class:"flex justify-between overflow-visible py-1"},Wo={class:"flex gap-2"},Xo=F({__name:"DataSourceTableList",props:A({data_source:{}},{selectedTable:{},selectedTableModifiers:{}}),emits:["update:selectedTable"],setup(v){var p;const e=v,i=Xe(),o=O(()=>i.getSource(e.data_source)),t=Se(),l=R(v,"selectedTable"),u=T(((p=l.value)==null?void 0:p.table_name)||"");ae(()=>[u.value,e.data_source],()=>t.getTables(e.data_source,u.value),{debounce:300,immediate:!0});const g=[{label:"Table",key:"table_name",width:2,prefix:()=>oe(Le,{class:"h-4 w-4 text-gray-600"})},{label:"Data Source",key:"data_source",width:1},{label:"",key:"selected",width:"40px",getLabel:()=>"",prefix:d=>{var y;return d.row.table_name===((y=l.value)==null?void 0:y.table_name)&&oe(we,{class:"h-4 w-4"})}}],b=O(()=>t.updatingDataSourceTables?{title:"Refreshing Tables",description:"Please wait while we refresh the tables from your data source"}:{title:"No Tables Found",description:"Sync tables from your data source to get started",button:{variant:"outline",label:"Refresh Tables",onClick:()=>t.updateDataSourceTables(e.data_source)}});return(d,y)=>{var k;const r=q("FormControl"),m=q("Button");return c(),D("div",Ho,[s("h1",Yo,z((k=o.value)==null?void 0:k.title),1),s("div",Ko,[s("div",Wo,[n(r,{placeholder:"Search by Title",modelValue:u.value,"onUpdate:modelValue":y[0]||(y[0]=_=>u.value=_),autocomplete:"off"},{prefix:w(()=>[n(a(Ve),{class:"h-4 w-4 text-gray-500"})]),_:1},8,["modelValue"])]),s("div",null,[n(m,{variant:"outline",label:"Refresh Tables",loading:a(t).updatingDataSourceTables,onClick:y[1]||(y[1]=_=>a(t).updateDataSourceTables(e.data_source))},{prefix:w(()=>[n(a(We),{class:"h-4 w-4 text-gray-700","stroke-width":"1.5"})]),_:1},8,["loading"])])]),n(a(Ue),{class:"h-full",columns:g,rows:a(t).tables[e.data_source]||[],"row-key":"name",options:{selectable:!1,showTooltip:!1,onRowClick:_=>l.value=_,emptyState:b.value}},null,8,["rows","options"])])}}}),Zo={class:"flex h-full flex-col gap-2 overflow-auto p-8 px-10"},en={class:"flex justify-between overflow-visible py-1"},tn={class:"flex gap-2"},ln=F({__name:"WorkbookQueryList",props:{selectedQuery:{},selectedQueryModifiers:{}},emits:["update:selectedQuery"],setup(v){var p;const e=P(Ce),i=P("query"),o=R(v,"selectedQuery"),t=T(((p=o.value)==null?void 0:p.query_name)||""),l=e.getLinkedQueries(i.doc.name),u=e.doc.queries.filter(d=>d.name!==i.doc.name&&!l.includes(d.name)),g=O(()=>t.value?u.filter(d=>{var y;return d.name.includes(t.value)||((y=d.title)==null?void 0:y.includes(t.value))}):u),b=[{label:"Title",key:"title",width:2,prefix:()=>oe(Le,{class:"h-4 w-4 text-gray-600"})},{label:"Source",key:"source",width:1,getLabel:d=>{var y,r,m;return(m=(r=(y=d.row.operations)==null?void 0:y[0])==null?void 0:r.table)==null?void 0:m.table_name}},{label:"",key:"selected",width:"40px",getLabel:()=>"",prefix:d=>{var y;if(d.row.name===((y=o.value)==null?void 0:y.query_name))return oe(we,{class:"h-4 w-4"})}}];return(d,y)=>{const r=q("FormControl");return c(),D("div",Zo,[y[1]||(y[1]=s("h1",{class:"text-xl font-semibold"},"Queries",-1)),s("div",en,[s("div",tn,[n(r,{placeholder:"Search by Title",modelValue:t.value,"onUpdate:modelValue":y[0]||(y[0]=m=>t.value=m),autocomplete:"off"},{prefix:w(()=>[n(a(Ve),{class:"h-4 w-4 text-gray-500"})]),_:1},8,["modelValue"])])]),g.value.length?(c(),C(a(Ue),{key:0,class:"h-full",columns:b,rows:g.value,"row-key":"name",options:{selectable:!1,showTooltip:!1,onRowClick:m=>{o.value={type:"query",workbook:a(e).doc.name,query_name:m.name}},emptyState:{title:"No Queries Found"}}},null,8,["rows","options"])):U("",!0)])}}}),on={class:"relative flex pb-10",style:{height:"calc(100vh - 12rem)"}},nn={class:"absolute bottom-3 right-3 flex gap-2"},an=F({__name:"SourceSelectorDialog",props:A({source:{}},{modelValue:{},modelModifiers:{}}),emits:A({select:v=>!0},["update:modelValue"]),setup(v,{emit:e}){const i=e,o=v,t=R(v,"modelValue"),l=T(o.source&&o.source.table.type=="table"?{...o.source.table}:{type:"table",data_source:"",table_name:""}),u=Xe(),g=T([{groupLabel:"Data Sources",tabs:[]}]),b=T();ae(()=>{var m;return(m=b.value)==null?void 0:m.label},()=>{l.value={type:"table",data_source:"",table_name:""},p.value={type:"query",workbook:"",query_name:""}}),u.getSources().then(()=>{if(g.value[0].tabs=u.sources.map(m=>({label:m.title,icon:kt,component:()=>n(Xo,{selectedTable:l.value,"onUpdate:selectedTable":k=>l.value=k,data_source:m.name},null)})).sort((m,k)=>m.label.localeCompare(k.label)),b.value=g.value[0].tabs[0],o.source&&o.source.table.type=="table"){const m=o.source.table.data_source,k=g.value[0].tabs.find(_=>_.label==m);k&&(b.value=k)}});const p=T(o.source&&o.source.table.type=="query"?{...o.source.table}:{type:"query",workbook:"",query_name:""});P(Ce).doc.queries.length>1&&(g.value.push({groupLabel:"Workbook",tabs:[{label:"Queries",icon:Le,component:()=>n(ln,{selectedQuery:p.value,"onUpdate:selectedQuery":m=>p.value=m},null)}]}),o.source&&o.source.table.type=="query"&&(b.value=g.value[1].tabs[0]));const y=O(()=>!l.value.table_name&&!p.value.query_name);function r(){y.value||(i("select",p.value.query_name?{table:Ae(p.value)}:{table:ee(l.value)}),t.value=!1)}return(m,k)=>{const _=q("Button"),S=q("Dialog");return c(),C(S,{modelValue:t.value,"onUpdate:modelValue":k[2]||(k[2]=$=>t.value=$),options:{size:"4xl"}},{body:w(()=>[s("div",on,[n(gt,{title:"Pick Starting Data",tabs:g.value,activeTab:b.value,"onUpdate:activeTab":k[0]||(k[0]=$=>b.value=$)},null,8,["tabs","activeTab"]),s("div",nn,[n(_,{onClick:k[1]||(k[1]=$=>t.value=!1)},{default:w(()=>k[3]||(k[3]=[L(" Close ")])),_:1}),n(_,{variant:"solid",disabled:y.value,onClick:r},{default:w(()=>k[4]||(k[4]=[L(" Confirm ")])),_:1},8,["disabled"])])])]),_:1},8,["modelValue"])}}}),sn={class:"flex items-start justify-between gap-1"},un={class:"h-full flex-1 overflow-hidden"},xe=F({inheritAttrs:!1,__name:"InlineFormControlLabel",props:{label:{}},setup(v){const e=v;return(i,o)=>(c(),D("div",sn,[s("span",{class:fe(["inline-flex w-[30%] flex-shrink-0 text-xs leading-7 text-gray-600",i.$attrs.class])},z(e.label),3),s("div",un,[Y(i.$slots,"default")])]))}}),rn=F({__name:"LazyTextInput",props:{modelValue:{type:String,required:!0,default:""},modelModifiers:{}},emits:["update:modelValue"],setup(v){const e=R(v,"modelValue");return(i,o)=>(c(),C(a(qe),je(i.$attrs,{type:"text",class:"w-full",variant:"subtle",autocomplete:"off","model-value":e.value,onKeydown:o[0]||(o[0]=Ne(t=>e.value=t.target.value,["enter"])),onBlur:o[1]||(o[1]=t=>e.value=t.target.value)}),null,16,["model-value"]))}}),dn={class:"flex items-end gap-1 overflow-hidden"},cn={class:"flex-1 overflow-hidden"},mn={class:"flex w-full flex-col gap-1.5"},pn={key:0,class:"block text-xs text-gray-600"},fn={class:"flex w-[14rem] flex-col gap-2 p-2"},vn={class:"flex gap-1"},yn=F({__name:"DimensionPicker",props:A({label:{},options:{}},{modelValue:{required:!0,default:()=>({column_name:"",data_type:"String",dimension_name:""})},modelModifiers:{}}),emits:A({remove:()=>!0},["update:modelValue"]),setup(v,{emit:e}){const i=e,o=v,t=R(v,"modelValue");!t.value.dimension_name&&t.value.column_name&&(t.value.dimension_name=t.value.column_name);function l(u){if(!u||!u.column_name){t.value={column_name:"",data_type:"String",dimension_name:""};return}t.value=u}return(u,g)=>{const b=q("Button"),p=ye,d=q("FormControl"),y=ke;return c(),D("div",dn,[s("div",cn,[n(p,{placeholder:"Select a column",showFooter:!0,options:o.options,modelValue:t.value.column_name,"onUpdate:modelValue":l},{target:w(({togglePopover:r})=>[s("div",mn,[o.label?(c(),D("label",pn,z(o.label),1)):U("",!0),n(b,{onClick:r,class:"w-full !justify-start"},{suffix:w(()=>[n(a(Ke),{class:"ml-auto h-4 w-4 text-gray-700","stroke-width":"1.5"})]),default:w(()=>[s("span",{class:fe(["truncate",t.value.column_name?"text-gray-900":"text-gray-500"])},z(t.value.dimension_name||"Select a column"),3)]),_:2},1032,["onClick"])])]),_:1},8,["options","modelValue"])]),t.value.column_name?(c(),C(y,{key:0,placement:"bottom-end"},{target:w(({togglePopover:r})=>[n(b,{onClick:r},{icon:w(()=>[n(a(He),{class:"h-4 w-4 text-gray-700","stroke-width":"1.5"})]),_:2},1032,["onClick"])]),"body-main":w(()=>[s("div",fn,[n(xe,{label:"Label"},{default:w(()=>[n(rn,{placeholder:"Label",modelValue:t.value.dimension_name,"onUpdate:modelValue":g[0]||(g[0]=r=>t.value.dimension_name=r)},null,8,["modelValue"])]),_:1}),n(xe,{label:"Type"},{default:w(()=>[n(d,{type:"select",modelValue:t.value.data_type,"onUpdate:modelValue":g[1]||(g[1]=r=>t.value.data_type=r),options:a(Ee)},null,8,["modelValue","options"])]),_:1}),a(bt)(t.value.data_type)?(c(),C(xe,{key:0,label:"Granularity"},{default:w(()=>[n(d,{type:"select",modelValue:t.value.granularity,"onUpdate:modelValue":g[2]||(g[2]=r=>t.value.granularity=r),options:a(ht)},null,8,["modelValue","options"])]),_:1})):U("",!0),Y(u.$slots,"config-fields"),s("div",vn,[n(b,{class:"w-full",onClick:g[3]||(g[3]=r=>i("remove")),theme:"red"},{prefix:w(()=>[n(a(ne),{class:"h-4 w-4 text-red-700","stroke-width":"1.5"})]),default:w(()=>[g[5]||(g[5]=L(" Remove "))]),_:1})])])]),_:3})):(c(),C(b,{key:1,onClick:g[4]||(g[4]=r=>i("remove"))},{icon:w(()=>[n(a(ne),{class:"h-4 w-4 text-gray-700","stroke-width":"1.5"})]),_:1}))])}}}),_n={class:"bg-white px-4 pb-6 pt-5 sm:px-6"},xn={class:"flex items-center justify-between pb-4"},gn={class:"flex flex-col gap-2"},bn={class:"flex gap-2"},hn={class:"mt-2 flex items-center justify-between gap-2"},wn={class:"flex items-center gap-2"},kn=F({__name:"NewMeasureSelectorDialog",props:A({measure:{},columnOptions:{}},{modelValue:{},modelModifiers:{}}),emits:A({select:v=>!0},["update:modelValue"]),setup(v,{emit:e}){var d,y;const i=v,o=e,t=R(v,"modelValue"),l=Ee.map(r=>r.value).filter(r=>Pe.NUMBER.includes(r)),u=T((y=(d=i.measure)==null?void 0:d.expression)!=null&&y.expression?{name:i.measure.measure_name,type:i.measure.data_type,expression:i.measure.expression.expression}:{name:"new_measure",type:l[0],expression:""}),g=O(()=>u.value.name&&u.value.type&&u.value.expression.trim());function b(){g.value&&(o("select",{measure_name:u.value.name,data_type:u.value.type,expression:Z(u.value.expression)}),p(),t.value=!1)}function p(){u.value={name:"new_measure",type:l[0],expression:""}}return(r,m)=>{const k=q("Button"),_=q("FormControl"),S=q("Dialog");return c(),C(S,{modelValue:!!t.value,onAfterLeave:p,onClose:m[4]||(m[4]=$=>!u.value.expression&&(t.value=!1))},{body:w(()=>[s("div",_n,[s("div",xn,[m[5]||(m[5]=s("h3",{class:"text-2xl font-semibold leading-6 text-gray-900"},"Create Measure",-1)),n(k,{variant:"ghost",onClick:m[0]||(m[0]=$=>t.value=!1),icon:"x",size:"md"})]),s("div",gn,[n(ve,{modelValue:u.value.expression,"onUpdate:modelValue":m[1]||(m[1]=$=>u.value.expression=$),"column-options":i.columnOptions},null,8,["modelValue","column-options"]),s("div",bn,[n(_,{type:"text",class:"flex-1",label:"Measure Name",autocomplete:"off",placeholder:"Measure Name",modelValue:u.value.name,"onUpdate:modelValue":m[2]||(m[2]=$=>u.value.name=$)},null,8,["modelValue"]),n(_,{type:"select",class:"flex-1",label:"Data Type",autocomplete:"off",options:a(l),modelValue:u.value.type,"onUpdate:modelValue":m[3]||(m[3]=$=>u.value.type=$)},null,8,["options","modelValue"])])]),s("div",hn,[m[6]||(m[6]=s("div",null,null,-1)),s("div",wn,[n(k,{label:"Confirm",variant:"solid",disabled:!g.value,onClick:b},null,8,["disabled"])])])])]),_:1},8,["modelValue"])}}}),Vn={class:"flex items-end gap-1 overflow-hidden"},Cn={class:"flex-1 overflow-hidden"},$n={class:"w-full space-y-1.5"},Sn={key:0,class:"text-xs text-gray-600"},Dn=["onClick"],qn={class:"flex flex-1 items-center gap-2 overflow-hidden truncate"},Tn={key:0},On={key:1,class:"text-gray-500"},jn={class:"relative mt-1 overflow-hidden rounded-lg bg-white p-1.5 text-base shadow-2xl"},Un={key:0,class:"block px-1.5 py-0.5 text-p-xs text-gray-600"},An={key:1,class:"mb-1 flex items-center"},En={class:"block px-1.5 py-0.5 text-p-xs text-gray-600"},Bn={class:"flex max-h-[15rem] flex-col overflow-y-scroll"},Ln=["onClick"],Fn={key:0},Mn={class:"sticky top-0 z-10 bg-white space-y-1 p-1"},In=["onClick"],Rn={key:0},zn={class:"flex w-[14rem] flex-col gap-2 p-2"},Qn={class:"flex gap-1"},Nn=F({__name:"MeasurePicker",props:A({label:{},columnOptions:{}},{modelValue:{required:!0,default:()=>({column_name:"",data_type:"Decimal",measure_name:"",aggregation:""})},modelModifiers:{}}),emits:A({remove:()=>!0},["update:modelValue"]),setup(v,{emit:e}){const i=e,o=v,t=R(v,"modelValue"),l=O({get(){if("column_name"in t.value)return t.value},set(S){t.value=S}}),u=O({get(){if("expression"in t.value)return t.value},set(S){t.value=S}}),g=T("");de(()=>{!l.value&&!u.value&&k()}),de(()=>{const S=l.value;if(!S)return;const $=!S.measure_name||S.measure_name.includes(`${S.aggregation}_`)||S.measure_name.includes(S.column_name);S.aggregation&&S.column_name&&$&&(S.measure_name=`${S.aggregation}_of_${S.column_name}`)});const b=T(!1);function p(S){t.value={expression:S.expression,measure_name:S.measure_name,data_type:S.data_type},b.value=!1}const d=[{label:"Count of...",value:"count"},{label:"Sum of...",value:"sum"},{label:"Average of...",value:"avg"},{label:"Minimum of...",value:"min"},{label:"Maximum of...",value:"max"},{label:"Unique Count of...",value:"count_distinct"}],y=O(()=>{const S=t.value.aggregation;return S?o.columnOptions.filter($=>["sum","avg"].includes(S)?Pe.NUMBER.includes($.data_type):!0):[]}),r=O(()=>{if(!g.value)return y.value;const S=g.value.toLowerCase();return y.value.filter($=>$.label.toLowerCase().includes(S))});function m(S){var $;return($=d.find(x=>x.value===S))==null?void 0:$.label}function k(){t.value={column_name:"",data_type:"Decimal",measure_name:"",aggregation:""}}const _=T("");return(S,$)=>{const x=q("Button"),f=ke;return c(),D(N,null,[s("div",Vn,[s("div",Cn,[n(f,null,{target:w(({togglePopover:V,isOpen:h})=>[s("div",$n,[o.label?(c(),D("div",Sn,z(o.label),1)):U("",!0),s("button",{class:"flex h-7 w-full items-center justify-between gap-2 rounded bg-gray-100 py-1 px-2 text-base transition-colors hover:bg-gray-200 focus:ring-2 focus:ring-gray-400",onClick:()=>V()},[s("div",qn,[t.value.measure_name?(c(),D("span",Tn,z(t.value.measure_name),1)):(c(),D("span",On," Select a column "))])],8,Dn)])]),body:w(({isOpen:V,togglePopover:h})=>{var E;return[s("div",jn,[l.value&&!u.value?(c(),D(N,{key:0},[l.value.aggregation?l.value.aggregation?(c(),D("div",An,[n(x,{class:"!h-6 !w-6",onClick:re(k,["prevent","stop"])},{icon:w(()=>[n(a(Mt),{class:"h-4 w-4 text-gray-700","stroke-width":"1.5"})]),_:1}),s("span",En,z(m(l.value.aggregation)),1)])):U("",!0):(c(),D("span",Un," Select a Function ")),s("div",Bn,[l.value.aggregation?U("",!0):(c(),D(N,{key:0},X(d,B=>s("div",{key:B.value,class:"flex h-7 flex-shrink-0 cursor-pointer items-center justify-between rounded px-2.5 text-base hover:bg-gray-100",onClick:re(I=>l.value.aggregation=B.value,["prevent","stop"])},[s("span",null,z(B.label),1),B.value===l.value.aggregation?(c(),D("span",Fn,[n(a(we),{class:"h-4 w-4 text-gray-700","stroke-width":"1.5"})])):U("",!0)],8,Ln)),64)),l.value.aggregation?(c(),D(N,{key:1},[s("div",Mn,[n(a(qe),{modelValue:g.value,"onUpdate:modelValue":$[0]||($[0]=B=>g.value=B),placeholder:"Search...",autocomplete:"off"},null,8,["modelValue"])]),(c(!0),D(N,null,X(r.value,B=>(c(),D("div",{key:B.value,class:"flex h-7 flex-shrink-0 cursor-pointer items-center justify-between rounded px-2.5 text-base hover:bg-gray-100",onClick:re(()=>{t.value.column_name=B.value,t.value.data_type=B.data_type,h()},["prevent","stop"])},[s("span",null,z(B.label),1),B.value===l.value.column_name?(c(),D("span",Rn,[n(a(we),{class:"h-4 w-4 text-gray-700","stroke-width":"1.5"})])):U("",!0)],8,In))),128))],64)):U("",!0)])],64)):U("",!0),u.value||!((E=l.value)!=null&&E.aggregation)?(c(),D("div",{key:1,class:fe([u.value?"":"mt-1 border-t pt-1"])},[n(x,{class:"w-full",variant:"ghost",label:u.value?"Edit Expression":"Custom Expression",onClick:B=>{b.value=!0,h()}},{prefix:w(()=>[(c(),C(pe(u.value?a(Ht):a($e)),{class:"h-4 w-4 text-gray-700","stroke-width":"1.5"}))]),_:2},1032,["label","onClick"])],2)):U("",!0)])]}),_:1})]),t.value.measure_name?(c(),C(f,{key:0,placement:"bottom-end"},{target:w(({togglePopover:V})=>[n(x,{onClick:V},{icon:w(()=>[n(a(He),{class:"h-4 w-4 text-gray-700","stroke-width":"1.5"})]),_:2},1032,["onClick"])]),"body-main":w(()=>[s("div",zn,[n(xe,{label:"Label"},{default:w(()=>[n(a(qe),{autocomplete:"off",modelValue:t.value.measure_name,"onUpdate:modelValue":$[1]||($[1]=V=>_.value=V),onBlur:$[2]||($[2]=V=>t.value.measure_name=_.value),onKeydown:$[3]||($[3]=Ne(V=>t.value.measure_name=_.value,["enter"]))},null,8,["modelValue"])]),_:1}),Y(S.$slots,"config-fields"),s("div",Qn,[n(x,{class:"w-full",onClick:$[4]||($[4]=V=>i("remove")),theme:"red"},{prefix:w(()=>[n(a(ne),{class:"h-4 w-4 text-red-700","stroke-width":"1.5"})]),default:w(()=>[$[7]||($[7]=L(" Remove "))]),_:1})])])]),_:3})):(c(),C(x,{key:1,onClick:$[5]||($[5]=V=>i("remove"))},{icon:w(()=>[n(a(ne),{class:"h-4 w-4 text-gray-700","stroke-width":"1.5"})]),_:1}))]),b.value?(c(),C(kn,{key:0,"model-value":!!b.value,"onUpdate:modelValue":$[6]||($[6]=V=>!V&&(b.value=!1)),"column-options":o.columnOptions,measure:t.value,onSelect:p},null,8,["model-value","column-options","measure"])):U("",!0)],64)}}}),Pn={class:"min-w-[36rem] rounded-lg bg-white px-4 pb-6 pt-5 text-base sm:px-6"},Gn={class:"flex items-center justify-between pb-4"},Jn={class:"flex flex-col gap-4"},Hn={class:"flex gap-4"},Yn={class:"flex-1 flex-shrink-0"},Kn={class:"flex flex-col gap-2"},Wn={class:"flex-1 flex-shrink-0"},Xn={class:"flex flex-col gap-2"},Zn={class:"mt-2 flex justify-end"},ea={class:"flex gap-2"},ta=F({__name:"SummarySelectorDialog",props:A({summary:{}},{modelValue:{},modelModifiers:{}}),emits:A({select:v=>!0},["update:modelValue"]),setup(v,{emit:e}){var $,x;const i=v,o=e,t=R(v,"modelValue"),l=P("query"),u=T([]);l.getColumnsForSelection().then(f=>u.value=f);const g=O(()=>u.value.map(f=>({name:f.value,type:f.data_type})).map(Ge).map(f=>({...f,label:f.dimension_name,value:f.column_name}))),b=T([]),p=T([]);($=i.summary)!=null&&$.measures&&(b.value=ce(i.summary.measures)),(x=i.summary)!=null&&x.dimensions&&(p.value=ce(i.summary.dimensions)),de(()=>{b.value.length||m(),p.value.length||k()});function d(f){return"column_name"in f&&f.column_name||"expression"in f&&f.expression.expression}const y=O(()=>b.value.every(f=>d(f))),r=O(()=>p.value.every(f=>f.column_name));function m(){b.value.push({measure_name:"",column_name:"",aggregation:"",data_type:"Decimal"})}function k(){p.value.push({column_name:"",data_type:"String",granularity:"month",dimension_name:""})}function _(){b.value=[],p.value=[]}function S(){o("select",{measures:b.value.filter(f=>d(f)),dimensions:p.value.filter(f=>f.column_name)}),t.value=!1}return(f,V)=>{const h=q("Button"),E=q("Dialog");return c(),C(E,{modelValue:t.value,options:{size:"2xl"}},{body:w(()=>[s("div",Pn,[s("div",Gn,[V[1]||(V[1]=s("h3",{class:"text-2xl font-semibold leading-6 text-gray-900"},"Summarize",-1)),n(h,{variant:"ghost",onClick:V[0]||(V[0]=B=>t.value=!1),icon:"x",size:"md"})]),s("div",Jn,[s("div",Hn,[s("div",Yn,[V[2]||(V[2]=s("p",{class:"mb-1.5 text-p-sm text-gray-600"},"Group By",-1)),s("div",Kn,[(c(!0),D(N,null,X(p.value,(B,I)=>(c(),C(yn,{key:I,modelValue:p.value[I],"onUpdate:modelValue":j=>p.value[I]=j,options:g.value,onRemove:j=>p.value.splice(I,1)},null,8,["modelValue","onUpdate:modelValue","options","onRemove"]))),128))]),s("button",{class:"mt-1.5 text-left text-xs text-gray-600 hover:underline",onClick:k}," + Add ")]),s("div",Wn,[V[3]||(V[3]=s("p",{class:"mb-1.5 text-p-sm text-gray-600"},"Aggregate",-1)),s("div",Xn,[(c(!0),D(N,null,X(b.value,(B,I)=>(c(),C(Nn,{key:I,modelValue:b.value[I],"onUpdate:modelValue":j=>b.value[I]=j,columnOptions:u.value,onRemove:j=>b.value.splice(I,1)},null,8,["modelValue","onUpdate:modelValue","columnOptions","onRemove"]))),128))]),s("button",{class:"mt-1.5 text-left text-xs text-gray-600 hover:underline",onClick:m}," + Add ")])]),s("div",Zn,[s("div",ea,[n(h,{label:"Clear",variant:"outline",onClick:_}),n(h,{label:"Done",variant:"solid",disabled:!y.value&&!r.value,onClick:S},null,8,["disabled"])])])])])]),_:1},8,["modelValue"])}}}),la={class:"rounded-lg bg-white px-4 pb-6 pt-5 sm:px-6"},oa={class:"flex items-center justify-between pb-4"},na={class:"flex w-full flex-col gap-3 overflow-auto p-0.5 text-base"},aa={class:"mt-4 flex justify-end gap-2"},sa=F({__name:"UnionSelectorDialog",props:A({union:{}},{modelValue:{},modelModifiers:{}}),emits:A({select:v=>!0},["update:modelValue"]),setup(v,{emit:e}){const i=v,o=e,t=R(v,"modelValue"),l=K(i.union?{...i.union}:{table:ee({}),distinct:!1}),u=O({get(){if(l.table.type==="table"&&l.table.table_name)return`${l.table.data_source}.${l.table.table_name}`;if(l.table.type==="query"&&l.table.query_name)return l.table.query_name},set($){$.data_source&&$.table_name&&(l.table=ee({data_source:$.data_source,table_name:$.table_name})),$.query_name&&(l.table=Ae({workbook:$.workbook,query_name:$.query_name}))}}),g=P("query"),b=O(()=>g.dataSource),p=O(()=>l.table.type==="table"?l.table.table_name:""),d=et({data_source:b,initialSearchText:p.value}),y=P(Ce),r=O(()=>{const $=y.getLinkedQueries(g.doc.name);return y.doc.queries.filter(x=>x.name!==g.doc.name&&!$.includes(x.name)).map(x=>({workbook:y.doc.name,query_name:x.name,label:x.title,value:x.name,description:"Query"}))}),m=O(()=>[{group:"Queries",items:r.value},{group:"Tables",items:d.options}]),k=O(()=>l.table.type==="table"&&l.table.table_name||l.table.type==="query"&&l.table.query_name);function _(){k.value&&(o("select",{...l}),t.value=!1,S())}function S(){Object.assign(l,{table:ee({}),distinct:!1})}return($,x)=>{const f=q("Button"),V=ye,h=q("FormControl"),E=q("Dialog");return c(),C(E,{modelValue:t.value},{body:w(()=>[s("div",la,[s("div",oa,[x[5]||(x[5]=s("h3",{class:"text-2xl font-semibold leading-6 text-gray-900"},"Append Rows",-1)),n(f,{variant:"ghost",onClick:x[0]||(x[0]=B=>t.value=!1),icon:"x",size:"md"})]),s("div",na,[s("div",null,[x[6]||(x[6]=s("label",{class:"mb-1 block text-xs text-gray-600"},"Select Table",-1)),n(V,{placeholder:"Table",modelValue:u.value,"onUpdate:modelValue":x[1]||(x[1]=B=>u.value=B),loading:a(d).loading,options:m.value,"onUpdate:query":x[2]||(x[2]=B=>a(d).searchText=B)},null,8,["modelValue","loading","options"])]),s("div",null,[n(h,{type:"select",label:"Drop Duplicates",modelValue:l.distinct?"true":"false","onUpdate:modelValue":x[3]||(x[3]=B=>l.distinct=B==="true"),options:[{label:"Yes",value:"true"},{label:"No",value:"false"}]},null,8,["modelValue"])])]),s("div",aa,[n(f,{variant:"outline",label:"Cancel",onClick:x[4]||(x[4]=B=>t.value=!1)}),n(f,{variant:"solid",label:"Confirm",disabled:!k.value,onClick:_},null,8,["disabled"])])])]),_:1},8,["modelValue"])}}}),ia={class:"group relative flex cursor-pointer items-center gap-2"},ua={key:0,class:"flex flex-col p-1.5"},ra={class:"grid grid-cols-2"},da={class:"flex items-start gap-2 py-2"},ca={class:"flex flex-1 flex-col text-left"},ma={class:"truncate text-p-sm"},pa={class:"w-40 text-p-xs text-gray-500"},fa=F({__name:"AddOperationPopover",setup(v){const e=P("query"),i=T(!1),o=T(!1),t=T(!1),l=T(!1),u=T(!1),g=T(!1),b=T(!1),p=T(!1),d=[{label:"Select Source",description:"Select a table or query to start building your query",icon:H.source.icon,onClick:()=>i.value=!0},{label:"Choose Columns",description:"Show or hide columns from the table",icon:H.select.icon,onClick:()=>l.value=!0},{label:"Filter Rows",description:"Filter rows based on columns or expressions",icon:H.filter.icon,onClick:()=>u.value=!0},{label:"Join Table",description:"Join this table with another table or query",icon:H.join.icon,onClick:()=>o.value=!0},{label:"Append Table",description:"Append this table with another table or query",icon:H.union.icon,onClick:()=>t.value=!0},{label:"Add New Column",description:"Add a new column based on existing columns",icon:H.mutate.icon,onClick:()=>g.value=!0},{label:"Group & Summarize",description:"Group rows by columns and summarize the data",icon:H.summarize.icon,onClick:()=>b.value=!0},{label:"Custom Operation",description:"Apply a custom operation using python script",icon:H.custom_operation.icon,onClick:()=>p.value=!0}];return me(()=>e.activeEditOperation,y=>{switch(y.type){case"source":i.value=!0;break;case"join":o.value=!0;break;case"union":t.value=!0;break;case"select":l.value=!0;break;case"filter":case"filter_group":u.value=!0;break;case"mutate":g.value=!0;break;case"summarize":b.value=!0;break;case"custom_operation":p.value=!0;break}}),(y,r)=>{const m=q("Button"),k=ke;return c(),D(N,null,[n(k,{placement:"left-start","popover-class":"!min-w-fit pr-5"},{target:w(({togglePopover:_,isOpen:S})=>[s("div",ia,[n(m,{variant:"outline",label:"Add Operation",class:"-ml-[14px] !h-6 !gap-1.5 bg-white !px-2 text-p-xs",onClick:_},{prefix:w(()=>[n(a($e),{class:"h-4 w-4 text-gray-700","stroke-width":"1.5"})]),_:2},1032,["onClick"])])]),"body-main":w(({togglePopover:_,isOpen:S})=>[S?(c(),D("div",ua,[r[24]||(r[24]=s("span",{class:"flex h-6 items-center px-2 text-p-xs text-gray-500"}," Select an operation ",-1)),s("div",ra,[(c(),D(N,null,X(d,$=>n(m,{key:$.label,variant:"ghost",class:"!h-fit w-full !justify-start",onClick:()=>{$.onClick(),_()}},{prefix:w(()=>[s("div",da,[(c(),C(pe($.icon),{class:"h-4.5 w-4.5 flex-shrink-0 text-gray-700","stroke-width":"1.5"})),s("div",ca,[s("p",ma,z($.label),1),s("p",pa,z($.description),1)])])]),_:2},1032,["onClick"])),64))])])):U("",!0)]),_:1}),i.value?(c(),C(an,{key:0,modelValue:i.value,"onUpdate:modelValue":[r[0]||(r[0]=_=>i.value=_),r[1]||(r[1]=_=>!_&&a(e).setActiveEditIndex(-1))],source:a(e).activeEditOperation.type==="source"?a(e).activeEditOperation:void 0,onSelect:r[2]||(r[2]=_=>a(e).setSource(_))},null,8,["modelValue","source"])):U("",!0),o.value?(c(),C(Io,{key:1,modelValue:o.value,"onUpdate:modelValue":[r[3]||(r[3]=_=>o.value=_),r[4]||(r[4]=_=>!_&&a(e).setActiveEditIndex(-1))],join:a(e).activeEditOperation.type==="join"?a(e).activeEditOperation:void 0,onSelect:r[5]||(r[5]=_=>a(e).addJoin(_))},null,8,["modelValue","join"])):U("",!0),t.value?(c(),C(sa,{key:2,modelValue:t.value,"onUpdate:modelValue":[r[6]||(r[6]=_=>t.value=_),r[7]||(r[7]=_=>!_&&a(e).setActiveEditIndex(-1))],union:a(e).activeEditOperation.type==="union"?a(e).activeEditOperation:void 0,onSelect:r[8]||(r[8]=_=>a(e).addUnion(_))},null,8,["modelValue","union"])):U("",!0),l.value?(c(),C(Rl,{key:3,modelValue:l.value,"onUpdate:modelValue":[r[9]||(r[9]=_=>l.value=_),r[10]||(r[10]=_=>!_&&a(e).setActiveEditIndex(-1))],columns:a(e).activeEditOperation.type==="select"?a(e).activeEditOperation:void 0,onSelect:r[11]||(r[11]=_=>a(e).selectColumns(_))},null,8,["modelValue","columns"])):U("",!0),u.value?(c(),C(ho,{key:4,modelValue:u.value,"onUpdate:modelValue":[r[12]||(r[12]=_=>u.value=_),r[13]||(r[13]=_=>!_&&a(e).setActiveEditIndex(-1))],filter:a(e).activeEditOperation.type==="filter"?a(e).activeEditOperation:void 0,"filter-group":a(e).activeEditOperation.type==="filter_group"?a(e).activeEditOperation:void 0,"column-options":a(e).result.columnOptions,onSelect:r[14]||(r[14]=_=>a(e).addFilterGroup(_))},null,8,["modelValue","filter","filter-group","column-options"])):U("",!0),g.value?(c(),C(Jo,{key:5,modelValue:g.value,"onUpdate:modelValue":[r[15]||(r[15]=_=>g.value=_),r[16]||(r[16]=_=>!_&&a(e).setActiveEditIndex(-1))],mutation:a(e).activeEditOperation.type==="mutate"?a(e).activeEditOperation:void 0,"column-options":a(e).result.columnOptions,onSelect:r[17]||(r[17]=_=>a(e).addMutate(_))},null,8,["modelValue","mutation","column-options"])):U("",!0),b.value?(c(),C(ta,{key:6,modelValue:b.value,"onUpdate:modelValue":[r[18]||(r[18]=_=>b.value=_),r[19]||(r[19]=_=>!_&&a(e).setActiveEditIndex(-1))],summary:a(e).activeEditOperation.type==="summarize"?a(e).activeEditOperation:void 0,onSelect:r[20]||(r[20]=_=>a(e).addSummarize(_))},null,8,["modelValue","summary"])):U("",!0),p.value?(c(),C(Jl,{key:7,modelValue:p.value,"onUpdate:modelValue":[r[21]||(r[21]=_=>p.value=_),r[22]||(r[22]=_=>!_&&a(e).setActiveEditIndex(-1))],operation:a(e).activeEditOperation.type==="custom_operation"?a(e).activeEditOperation:void 0,"column-options":a(e).result.columnOptions,onSelect:r[23]||(r[23]=_=>a(e).addCustomOperation(_))},null,8,["modelValue","operation","column-options"])):U("",!0)],64)}}}),va={key:0,class:"flex w-full flex-col px-3.5 py-3"},ya={class:"relative ml-3 flex flex-col-reverse gap-3 border-l border-gray-300 text-sm"},_a=["onClick","onDblclick"],xa={class:"-ml-[14px] h-fit flex-shrink-0 rounded border border-gray-400 bg-white p-1"},ga={class:"flex flex-1 items-center justify-between gap-2 overflow-hidden pt-1"},ba={class:"flex flex-1 flex-col gap-1 overflow-hidden"},ha={class:"absolute right-0 flex h-full flex-shrink-0 items-center bg-white opacity-0 transition-all group-hover:opacity-100"};function G(v){return typeof v=="function"||Object.prototype.toString.call(v)==="[object Object]"&&!mt(v)}const wa=F({__name:"QueryOperations",setup(v){const e=P("query"),i=O(()=>e.doc.operations.map(x=>({...x,meta:H[x.type]}))),o=(x,{slots:f})=>{var V;return n("div",{class:"w-fit truncate rounded border border-orange-200 bg-orange-50 px-1 py-0.5 font-mono text-xs text-orange-800 opacity-90"},[(V=f.default)==null?void 0:V.call(f)])},t=x=>{const f=Be(x);return f?f.doc.title:x},l=x=>{const f=x.source,V=f.table.type==="table"?f.table.table_name:t(f.table.query_name),h=f.table.type==="table";return n("div",{class:"flex items-baseline gap-1 text-gray-700"},[n("p",null,[L("Select")]),n(o,null,G(V)?V:{default:()=>[V]}),n("p",null,[h?"table":"query"])])},u=x=>{const f=x.join,V=f.join_type,h=f.table.type==="table"?f.table.table_name:t(f.table.query_name),E=f.table.type==="table";return n("div",{class:"flex flex-wrap items-baseline gap-1 text-gray-700"},[n(o,null,G(V)?V:{default:()=>[V]}),n("p",null,[L("join")]),n(o,null,G(h)?h:{default:()=>[h]}),n("p",null,[E?"table":"query"])])},g=x=>{const f=x.union,V=f.table.type==="table"?f.table.table_name:t(f.table.query_name);return n("div",{class:"flex flex-wrap items-baseline gap-1 text-gray-700"},[n("p",null,[L("Append")]),n(o,null,G(V)?V:{default:()=>[V]}),n("p",null,[L("table")])])},b=x=>{const V=x.select.column_names;return n("div",{class:"flex flex-wrap items-baseline gap-1 text-gray-700"},[n("p",null,[L("Select")]),n(o,null,{default:()=>[V.length,L(" columns")]})])},p=x=>{const V=x.remove.column_names;return n("div",{class:"flex flex-wrap items-baseline gap-1 text-gray-700"},[n("p",null,[L("Remove")]),n(o,null,{default:()=>[V.length,L(" columns")]})])},d=x=>{const f=x.rename,V=f.column.column_name,h=f.new_name;return n("div",{class:"flex flex-wrap items-baseline gap-1 text-gray-700"},[n("p",null,[L("Rename")]),n(o,null,G(V)?V:{default:()=>[V]}),n("p",null,[L("to")]),n(o,null,G(h)?h:{default:()=>[h]})])},y=x=>{const f=x.cast,V=f.column.column_name,h=f.data_type;return n("div",{class:"flex flex-wrap items-baseline gap-1 text-gray-700"},[n("p",null,[L("Convert")]),n(o,null,G(V)?V:{default:()=>[V]}),n("p",null,[L("to")]),n(o,null,G(h)?h:{default:()=>[h]})])},r=x=>{const f=x.filter,V=f.filters.filter(E=>"expression"in E&&E.expression.expression),h=f.filters.filter(E=>"column"in E).map(E=>E.column.column_name);return n("div",{class:"flex flex-wrap items-baseline gap-1 text-gray-700"},[n("p",null,[L("Filter")]),h.map((E,B)=>n(o,null,G(E)?E:{default:()=>[E]})),V.map((E,B)=>n(o,null,{default:()=>[L("expression")]}))])},m=x=>{const V=x.mutate.new_name;return n("div",{class:"flex flex-wrap items-baseline gap-1 text-gray-700"},[n("p",null,[L("Calculate")]),n(o,null,G(V)?V:{default:()=>[V]})])},k=x=>{const f=x.summarize,V=f.measures,h=f.dimensions;return n("div",{class:"flex flex-wrap items-baseline gap-1 text-gray-700"},[n("p",null,[L("Summarize")]),V.map((E,B)=>n(o,null,{default:()=>[E.measure_name]})),n("p",null,[L("by")]),h.map((E,B)=>n(o,null,{default:()=>[E.column_name]}))])},_=x=>{const f=x.sort,V=f.column.column_name,h=f.direction;return n("div",{class:"flex flex-wrap items-baseline gap-1 text-gray-700"},[n("p",null,[L("Sort")]),n(o,null,G(V)?V:{default:()=>[V]}),n("p",null,[h])])},S=x=>{const V=x.limit.limit;return n("div",{class:"flex flex-wrap items-baseline gap-1 text-gray-700"},[n("p",null,[L("Limit to")]),n(o,null,G(V)?V:{default:()=>[V]}),n("p",null,[L("rows")])])},$=x=>{const f=x.custom_operation;return n("div",{class:"flex flex-wrap items-baseline gap-1 text-gray-700"},[n("p",null,[L("Apply")]),n(o,null,{default:()=>[f.expression.expression]})])};return(x,f)=>{const V=q("Button");return a(e).doc.operations.length?(c(),D("div",va,[f[0]||(f[0]=s("div",{class:"mb-2 flex h-6 items-center justify-between"},[s("div",{class:"flex items-center gap-1"},[s("div",{class:"text-sm font-medium"},"Operations")]),s("div")],-1)),s("div",ya,[(c(!0),D(N,null,X(i.value,(h,E)=>(c(),D(N,{key:E},[s("div",{class:fe(["group relative flex cursor-pointer select-none items-start gap-2",E<=a(e).activeOperationIdx?"opacity-100":"opacity-40"]),onClick:B=>a(e).setActiveOperation(E),onDblclick:B=>a(e).setActiveEditIndex(E)},[s("div",xa,[(c(),C(pe(h.meta.icon),{class:"h-4 w-4 text-gray-600","stroke-width":"1.5"}))]),s("div",ga,[s("div",ba,[h.type==="source"?(c(),C(l,{key:0,source:h},null,8,["source"])):h.type==="join"?(c(),C(u,{key:1,join:h},null,8,["join"])):h.type==="union"?(c(),C(g,{key:2,union:h},null,8,["union"])):h.type==="select"?(c(),C(b,{key:3,select:h},null,8,["select"])):h.type==="remove"?(c(),C(p,{key:4,remove:h},null,8,["remove"])):h.type==="cast"?(c(),C(y,{key:5,cast:h},null,8,["cast"])):h.type==="rename"?(c(),C(d,{key:6,rename:h},null,8,["rename"])):h.type==="filter_group"?(c(),C(r,{key:7,filter:h},null,8,["filter"])):h.type==="mutate"?(c(),C(m,{key:8,mutate:h},null,8,["mutate"])):h.type==="summarize"?(c(),C(k,{key:9,summarize:h},null,8,["summarize"])):h.type==="order_by"?(c(),C(_,{key:10,sort:h},null,8,["sort"])):h.type==="limit"?(c(),C(S,{key:11,limit:h},null,8,["limit"])):h.type==="custom_operation"?(c(),C($,{key:12,custom_operation:h},null,8,["custom_operation"])):U("",!0)]),s("div",ha,[n(V,{variant:"ghost",onClick:re(B=>a(e).removeOperation(E),["prevent","stop"])},{icon:w(()=>[n(a(ne),{class:"h-3.5 w-3.5 text-gray-500"})]),_:2},1032,["onClick"])])])],42,_a),E===a(e).activeOperationIdx?(c(),C(fa,{key:0})):U("",!0)],64))),128))])])):U("",!0)}}}),ka={key:0,class:"flex h-[32rem] w-full items-center justify-center"},Va={key:1,class:"relative flex h-[32rem] w-full flex-1 gap-4 overflow-hidden bg-white"},Ca={class:"flex h-full flex-1 flex-col gap-2 overflow-hidden p-0.5"},$a={class:"flex flex-1 overflow-hidden rounded border"},Sa={class:"relative z-[1] flex h-full w-[17rem] flex-shrink-0 overflow-y-auto rounded border bg-white"},Da=F({__name:"DrillDown",props:A({query:{}},{modelValue:{type:Boolean},modelModifiers:{}}),emits:["update:modelValue"],setup(v){const e=v,i=P("dashboard"),o=P("chartName","");if(i&&o){const b=i.getAdhocFilters(o);b&&(e.query.adhocFilters=b)}const t=R(v,"modelValue"),l=T(!1);ae(t,()=>{t.value&&(l.value=!1,ft(async()=>{await e.query.execute(!0),l.value=!0}))},{immediate:!0}),pt("query",e.query);function u(b){e.query.addSummarize({dimensions:[Ge(b)],measures:[wt()]})}const g=Qe(u,50);return(b,p)=>{const d=q("LoadingIndicator"),y=q("Button"),r=q("Tooltip"),m=q("Dialog");return c(),C(m,{modelValue:t.value,"onUpdate:modelValue":p[0]||(p[0]=k=>t.value=k),options:{title:"Drill Down",size:"5xl"}},{"body-content":w(()=>[l.value?(c(),D("div",Va,[s("div",Ca,[n(ol),s("div",$a,[n(Sl,{"enable-sort":!0,"enable-drill-down":!0,query:e.query},{"header-prefix":w(({column:k})=>[n(r,{text:"Group By","hover-delay":.2},{default:w(()=>[n(y,{variant:"ghost",class:"rounded-none",onClick:()=>a(g)(k)},{icon:w(()=>[n(a(jt),{class:"h-4 w-4 text-gray-700","stroke-width":"1.5"})]),_:2},1032,["onClick"])]),_:2},1024)]),_:1},8,["query"])])]),s("div",Sa,[n(wa)])])):(c(),D("div",ka,[n(d,{class:"h-5 w-5 text-gray-600"})]))]),_:1},8,["modelValue"])}}});export{Pt as C,Sl as _,an as a,Bl as b,rn as c,xe as d,ol as e,wa as f,yn as g,Nn as h,El as i,ho as j,eo as k,Da as l};
//# sourceMappingURL=DrillDown.vue_vue_type_script_setup_true_lang-3700404a.js.map
