import{x as B,L as W,M as R,E as T,j as k,u as V,c as _,w as h,r as D,o as c,f as s,h as n,K as t,i as $,t as O,d as U,g as P,J as I,y as j,F as L,a4 as q,a0 as G,aW as K,T as Y,aG as H,H as Q,e as w,an as X,I as Z}from"./frappe-ui-d69b39da.js";import{C as ee}from"./ContentEditable-bc84e80c.js";import{i as J,f as te,p as E,s as F,q as ae,w as oe}from"./main-d2d228fc.js";import{u as le,w as se}from"./dashboard-37329027.js";import{_ as ie,S as ne}from"./ChartIcon.vue_vue_type_script_setup_true_lang-f01737f9.js";import{S as re}from"./search-34ad51bc.js";import{S as de,a as ue,_ as ce}from"./Autocomplete-e91e4d1c.js";import{_ as me,a as pe}from"./VueGridLayout.vue_vue_type_style_index_0_lang-dd27665c.js";import{_ as fe}from"./UserSelector.vue_vue_type_script_setup_true_lang-09c49be5.js";import{u as ve}from"./users-398754d3.js";import{R as M}from"./refresh-ccw-f825866d.js";import{P as he}from"./pen-line-c3e93d95.js";import"./index-77f7bd6f.js";import"./text-cursor-input-3636b908.js";import"./combine-0dbf7ac7.js";import"./chevron-down-7c5e9308.js";import"./chart-scatter-06f2042d.js";import"./index-9194c21d.js";import"./toasts-2937f9d2.js";import"./calendar-1687c485.js";import"./clock-73e01da8.js";import"./table-2-565c43f4.js";import"./Popover-5414f173.js";import"./ChartRenderer.vue_vue_type_script_setup_true_lang-564d1b03.js";import"./ChartSectionEmptySvg-d77827da.js";import"./DrillDown.vue_vue_type_script_setup_true_lang-3700404a.js";import"./ExpressionEditor.vue_vue_type_style_index_0_lang-9e2463ac.js";import"./vue-codemirror.esm-d1d2df5a.js";import"./play-63d306bd.js";import"./ellipsis-10a30b7b.js";import"./vuedraggable.umd-f13fb48a.js";import"./grip-vertical-c5c2fa7d.js";import"./x-3f18ad86.js";import"./DatePickerControl.vue_vue_type_script_setup_true_lang-6baff6f5.js";import"./plus-3394075c.js";import"./tables-0e8be38f.js";import"./data_source-00c6028c.js";import"./check-2c63c113.js";import"./chevron-left-c299c44c.js";import"./DataTable.vue_vue_type_script_setup_true_lang-0fc4cbd5.js";import"./chevron-right-abc82e4c.js";import"./IndicatorIcon-21535c9e.js";import"./refresh-cw-ef6c08ee.js";import"./maximize-3d779b9b.js";import"./ColumnFilterValueSelector.vue_vue_type_script_setup_true_lang-88f0bec7.js";const _e={class:"-mb-5 flex flex-col gap-2 p-0.5"},ge={class:"flex gap-2"},be={class:"flex h-[15rem] flex-col overflow-y-scroll rounded border p-0.5 text-base"},xe=["onClick"],ye={class:"flex items-center gap-1.5"},we=B({__name:"DashboardChartSelectorDialog",props:W({chartOptions:{}},{modelValue:{},modelModifiers:{}}),emits:["update:modelValue"],setup(C){const f=R(C,"modelValue"),r=C,u=T("dashboard"),e=k(""),g=V(()=>r.chartOptions.length?e.value?r.chartOptions.filter(a=>a.name.toLowerCase().includes(e.value.toLowerCase())):r.chartOptions:[]),d=k(J(r.chartOptions.filter(a=>u.doc.items.some(l=>l.type==="chart"&&l.chart===a.name))));function x(a){return d.value.find(l=>l&&l.name===a.name)}function z(a){const l=d.value.findIndex(o=>o&&o.name===a.name);l===-1?d.value.push(a):d.value.splice(l,1)}function A(){m.value?d.value=[]:d.value=[...r.chartOptions]}const m=V(()=>d.value.length===r.chartOptions.length),y=V(()=>d.value.length===0);function b(){u.addChart(d.value),d.value=[],f.value=!1}return(a,l)=>{const o=D("FormControl"),i=D("Button"),S=D("Dialog");return c(),_(S,{modelValue:f.value,"onUpdate:modelValue":l[1]||(l[1]=v=>f.value=v),options:{size:"sm",title:"Select Charts",actions:[{label:"Add",variant:"solid",disabled:y.value,onClick:b},{label:"Cancel",onClick:()=>f.value=!1}]}},{"body-content":h(()=>[s("div",_e,[s("div",ge,[n(o,{class:"flex-1",autocomplete:"off",placeholder:"Search by name",modelValue:e.value,"onUpdate:modelValue":l[0]||(l[0]=v=>e.value=v)},{prefix:h(()=>[n(t(re),{class:"h-4 w-4 text-gray-500"})]),_:1},8,["modelValue"]),n(i,{onClick:A},{default:h(()=>[$(O(m.value?`Deselect All (${d.value.length})`:`Select All (${d.value.length})`),1)]),_:1})]),s("div",be,[(c(!0),U(L,null,P(g.value,v=>(c(),U("div",{class:"flex h-7 flex-shrink-0 cursor-pointer items-center justify-between rounded px-2 hover:bg-gray-100",onClick:N=>z(v)},[s("div",ye,[n(ie,{chartType:v.chart_type},null,8,["chartType"]),s("span",null,O(v.title||v.name),1)]),(c(),_(I(x(v)?t(de):t(ue)),{class:j(["h-4 w-4",x(v)?"text-gray-900":"text-gray-600"]),"stroke-width":"1.5"},null,8,["class"]))],8,xe))),256))])])]),_:1},8,["modelValue","options"])}}}),ke={class:"flex flex-col gap-4"},Ce={class:"flex flex-col gap-2"},Se={class:"flex gap-2"},Ve={class:"flex-1"},De={class:"flex flex-col"},$e={class:"mb-4 flex w-full gap-2"},ze={class:"flex-1"},Ae={class:"flex flex-col gap-1 overflow-y-auto"},Oe={class:"flex w-full items-center gap-2 py-1"},Ue={class:"flex flex-1 flex-col"},Be={class:"text-xs text-gray-600"},Te={class:"flex flex-1 flex-col"},Le={class:"leading-5"},Ne={class:"text-xs text-gray-600"},qe=B({__name:"DashboardShareDialog",props:{modelValue:{},modelModifiers:{}},emits:["update:modelValue"],setup(C){const f=R(C,"modelValue"),r=T("dashboard"),u=k(t(r.doc.is_public)),e=k(J(r.doc.people_with_access)),g=k(t(r.doc.is_shared_with_organization)),d=V(()=>r.getShareLink()),x=V(()=>`<iframe src="${d.value}" width="100%" height="100%" frameborder="0"></iframe>`),z=V(()=>{const l={is_public:u.value,people_with_access:e.value.map(i=>i.email),is_shared_with_organization:g.value},o={is_public:r.doc.is_public,people_with_access:r.doc.people_with_access.map(i=>i.email),is_shared_with_organization:r.doc.is_shared_with_organization};return JSON.stringify(l)!==JSON.stringify(o)});function A(){r.updateAccess({is_public:u.value,is_shared_with_organization:g.value,people_with_access:e.value.map(l=>l.email)}),te({variant:"success",title:"Dashboard Access Updated"}),f.value=!1}const m=k(""),y=ve();function b(){m.value&&(e.value||(e.value=[]),e.value.push({email:m.value,full_name:y.getName(m.value),user_image:y.getImage(m.value)}),m.value="")}const a=V({get:()=>u.value?"anyone":g.value?"organization":"specific",set:l=>{u.value=l.value=="anyone",g.value=l.value=="organization"}});return(l,o)=>{const i=ce,S=D("Button"),v=D("Avatar"),N=D("Dialog");return c(),_(N,{modelValue:f.value,"onUpdate:modelValue":o[4]||(o[4]=p=>f.value=p),options:{title:"Share Dashboard",actions:[{label:"Done",variant:"solid",disabled:!z.value,onClick:A}]}},{"body-content":h(()=>[s("div",ke,[s("div",Ce,[o[5]||(o[5]=s("span",{class:"text-sm text-gray-600"},"General Access",-1)),s("div",Se,[s("div",Ve,[n(i,{placeholder:"Select an option","hide-search":!0,modelValue:a.value,"onUpdate:modelValue":o[0]||(o[0]=p=>a.value=p),options:[{label:"Anyone with the link can view",value:"anyone"},{label:"Anyone in the organization can view",value:"organization"},{label:"Specific people can view",value:"specific"}]},null,8,["modelValue"])]),n(t(q),{text:"Copy Link",hoverDelay:.1},{default:h(()=>[n(S,{icon:"link-2",onClick:o[1]||(o[1]=p=>t(E)(d.value))})]),_:1}),n(t(q),{text:"Copy Embed",hoverDelay:.1},{default:h(()=>[n(S,{icon:"code",onClick:o[2]||(o[2]=p=>t(E)(x.value))})]),_:1})])]),o[9]||(o[9]=s("hr",{class:"my-1 border-t border-gray-200"},null,-1)),s("div",De,[s("div",$e,[s("div",ze,[n(fe,{modelValue:m.value,"onUpdate:modelValue":o[3]||(o[3]=p=>m.value=p),placeholder:"Search by name or email","hide-users":e.value.map(p=>p.email)},null,8,["modelValue","hide-users"])]),n(S,{class:"flex-shrink-0",variant:"solid",label:"Share",disabled:!m.value,onClick:b},null,8,["disabled"])]),o[8]||(o[8]=s("span",{class:"mb-2 text-sm text-gray-600"},"People with access",-1)),s("div",Ae,[s("div",Oe,[n(v,{size:"xl",label:"You",image:t(F).user.user_image},null,8,["image"]),s("div",Ue,[o[6]||(o[6]=s("div",{class:"leading-5"},"You",-1)),s("div",Be,O(t(F).user.email),1)]),n(t(G),{size:"lg",theme:"orange"},{default:h(()=>o[7]||(o[7]=[$("Owner")])),_:1})]),(c(!0),U(L,null,P(e.value,p=>(c(),U("div",{key:p.email,class:"flex w-full items-center gap-2 py-1"},[n(v,{size:"xl",label:p.full_name,image:p.user_image},null,8,["label","image"]),s("div",Te,[s("div",Le,O(p.full_name),1),s("div",Ne,O(p.email),1)]),n(S,{variant:"ghost",icon:"x",onClick:je=>e.value.splice(e.value.indexOf(p),1)},null,8,["onClick"])]))),128))])])])]),_:1},8,["modelValue","options"])}}}),Ee={class:"relative flex h-full w-full overflow-hidden bg-gray-50"},Fe={class:"relative flex h-full w-full flex-col overflow-hidden"},Me={class:"flex items-center justify-between p-4 pb-3"},Re={class:"flex gap-2"},Pe=B({__name:"DashboardBuilder",props:{dashboard_name:{},charts:{},queries:{}},async setup(C){let f,r;const u=C,e=le(u.dashboard_name);X("dashboard",e);const{width:g}=K(),d=V(()=>g.value<1058);Y(()=>{e.editing||d.value?e.autoSave=!1:e.autoSave=!0}),[f,r]=H(()=>oe(()=>e.isloaded)),await f,r();const x=k(!1);function z(b){b.dataTransfer&&(b.preventDefault(),b.dataTransfer.dropEffect="copy")}function A(b){if(!b.dataTransfer)return;b.preventDefault();const l=ae(b.dataTransfer.getData("text/plain")).item.name,o=u.charts.find(i=>i.name===l);o&&(e.editing||(e.editing=!0),e.addChart([o]))}const m=k(!1),y=Q("dashboard_vertical_compact",!0);return(b,a)=>{const l=D("Button"),o=D("Dropdown");return c(),U(L,null,[s("div",Ee,[s("div",Fe,[s("div",Me,[n(ee,{class:"cursor-text rounded-sm text-lg font-semibold !text-gray-800 focus:ring-2 focus:ring-gray-700 focus:ring-offset-4",modelValue:t(e).doc.title,"onUpdate:modelValue":a[0]||(a[0]=i=>t(e).doc.title=i),placeholder:"Untitled Dashboard"},null,8,["modelValue"]),s("div",Re,[t(e).editing?w("",!0):(c(),_(l,{key:0,variant:"outline",onClick:a[1]||(a[1]=()=>t(e).refresh(!0)),label:"Refresh"},{prefix:h(()=>[n(t(M),{class:"h-4 w-4 text-gray-700","stroke-width":"1.5"})]),_:1})),!t(e).editing&&!t(e).doc.read_only?(c(),_(l,{key:1,variant:"outline",onClick:a[2]||(a[2]=i=>m.value=!0),label:"Share"},{prefix:h(()=>[n(t(ne),{class:"h-4 text-gray-700","stroke-width":"1.5"})]),_:1})):w("",!0),t(e).editing?w("",!0):(c(),_(l,{key:2,variant:"outline",onClick:a[3]||(a[3]=i=>t(e).editing=!0),label:"Edit"},{prefix:h(()=>[n(t(he),{class:"h-4 w-4 text-gray-700","stroke-width":"1.5"})]),_:1})),t(e).editing?(c(),_(l,{key:3,variant:"outline","icon-left":"plus",onClick:a[4]||(a[4]=i=>x.value=!0)},{default:h(()=>a[11]||(a[11]=[$(" Chart ")])),_:1})):w("",!0),t(e).editing?(c(),_(l,{key:4,variant:"outline","icon-left":"plus",onClick:a[5]||(a[5]=()=>t(e).addFilter())},{default:h(()=>a[12]||(a[12]=[$(" Filter ")])),_:1})):w("",!0),t(e).editing?(c(),_(l,{key:5,variant:"outline","icon-left":"plus",onClick:a[6]||(a[6]=()=>t(e).addText())},{default:h(()=>a[13]||(a[13]=[$(" Text ")])),_:1})):w("",!0),t(e).editing?(c(),_(l,{key:6,variant:"solid","icon-left":"check",onClick:a[7]||(a[7]=()=>{t(e).save(),t(e).editing=!1})},{default:h(()=>a[14]||(a[14]=[$(" Done ")])),_:1})):w("",!0),n(o,{button:{icon:"more-horizontal",variant:"outline"},options:[{label:"Force Refresh",icon:t(M),onClick:()=>t(e).refresh(!0)},t(e).editing?{label:"Compact Layout",icon:t(y)?"check-square":"square",onClick:()=>y.value=!t(y)}:null,t(e).editing?{label:"Reset Layout",icon:"refresh-ccw",onClick:()=>(t(e).discard(),t(e).editing=!1)}:null]},null,8,["options"])])]),s("div",{class:"flex-1 overflow-y-auto p-2 pt-0",onDragover:z,onDrop:A},[t(e).doc.items.length>0?(c(),_(me,{key:0,class:j(["h-fit w-full",[t(e).editing?"mb-[20rem] !select-none":""]]),cols:20,disabled:!t(e).editing,verticalCompact:t(y),modelValue:t(e).doc.items.map(i=>i.layout),"onUpdate:modelValue":a[8]||(a[8]=i=>{i&&(t(e).doc.items.forEach((S,v)=>{S.layout=i[v]}),t(e).normalizeLayout())})},{item:h(({index:i})=>[n(pe,{index:i,item:t(e).doc.items[i]},null,8,["index","item"])]),_:1},8,["class","disabled","verticalCompact","modelValue"])):w("",!0)],32)])]),n(we,{modelValue:x.value,"onUpdate:modelValue":a[9]||(a[9]=i=>x.value=i),chartOptions:u.charts},null,8,["modelValue","chartOptions"]),m.value?(c(),_(qe,{key:0,modelValue:m.value,"onUpdate:modelValue":a[10]||(a[10]=i=>m.value=i)},null,8,["modelValue"])):w("",!0)],64)}}}),Lt=B({__name:"WorkbookDashboard",props:{workbook_name:{},dashboard_name:{}},setup(C){const f=C,r=Z(),u=T(se);let e=k(f.dashboard_name);const g=Number(f.dashboard_name);return g>=0&&u.doc.dashboards[g]&&!u.doc.dashboards.find(d=>d.name===f.dashboard_name)&&(e.value=u.doc.dashboards[g].name,r.replace(`/workbook/${u.doc.name}/dashboard/${e.value}`)),(d,x)=>(c(),_(Pe,{dashboard_name:t(e),charts:t(u).doc.charts,queries:t(u).doc.queries},null,8,["dashboard_name","charts","queries"]))}});export{Lt as default};
//# sourceMappingURL=WorkbookDashboard-4661de0a.js.map
