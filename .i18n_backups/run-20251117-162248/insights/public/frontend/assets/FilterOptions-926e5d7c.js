import{_ as D}from"./Autocomplete-e91e4d1c.js";import{u as g,E as h,j as B,s as E,D as N,r as S,o as i,d as m,h as c,f as n,e as b,F as j,g as F,y as Q,t as z,c as A,K}from"./frappe-ui-d69b39da.js";import{g as T,a as G}from"./useDashboards-65106383.js";import{_ as H}from"./FilterValueSelector-3cbeb5d5.js";import{l as J}from"./index-9194c21d.js";import"./Popover-5414f173.js";import"./index-77f7bd6f.js";import"./dayjs-e81f6541.js";import"./DatePicker-296330db.js";import"./Tabs-88c08023.js";import"./toasts-2937f9d2.js";import"./calendar-1687c485.js";import"./clock-73e01da8.js";const M={class:"space-y-4"},P={key:0},R={key:1},W={class:"max-h-[20rem] space-y-2 overflow-y-auto"},re={__name:"FilterOptions",props:{modelValue:{type:Object,required:!0}},emits:["update:modelValue"],setup(x,{emit:C}){const O=C,w=x,l=g({get:()=>w.modelValue,set:t=>O("update:modelValue",t)});l.value.links||(l.value.links={}),l.value.column||(l.value.column={});function q(t,e){l.value={...l.value,[t]:e}}const y=h("dashboard"),f=y.doc.items.filter(t=>y.isChart(t)),$=f.map(t=>t.options.query),_=B([]);T($).then(t=>{_.value=t.map(e=>({label:e.label,column:e.column,type:e.type,table:e.table,data_source:e.data_source,description:`${e.type} - ${e.table_label}`,value:`${e.table}.${e.column}`}))}),f.forEach(t=>{l.value.links[t.item_id]&&k(t)});async function L(t,e){var o;const s=l.value.links;if(t){s[e.item_id]={},v[e.options.query]||await k(e);const r=(o=v[e.options.query])==null?void 0:o.find(p=>{var d,a,u,V;return((d=p.column)==null?void 0:d.toLowerCase())===((a=l.value.column.column)==null?void 0:a.toLowerCase())&&((u=p.table)==null?void 0:u.toLowerCase())===((V=l.value.column.table)==null?void 0:V.toLowerCase())});r&&(s[e.item_id]=r)}else delete s[e.item_id];q("links",s)}const v=E({});async function k(t){const e=l.value.column;if(!(e!=null&&e.column))return;const s=await G(t.options.query);v[t.options.query]=s.map(o=>({label:o.label,column:o.column,table:o.table,type:o.type,table_label:o.table_label,data_source:o.data_source,description:`${o.type} - ${o.table_label}`,value:`${o.table}.${o.column}`}))}const U=g(()=>{var e;return J((e=l.value.column)==null?void 0:e.type).filter(s=>s.value!=="is").concat([{label:"is set",value:"is_set"},{label:"is not set",value:"is_not_set"}])});return N(()=>{var t;return(t=l.value.defaultOperator)==null?void 0:t.value},(t,e)=>{t!==e&&(l.value.defaultValue={})}),(t,e)=>{var r,p,d;const s=S("Input"),o=D;return i(),m("div",M,[c(s,{type:"text",label:"Label",modelValue:l.value.label,"onUpdate:modelValue":e[0]||(e[0]=a=>l.value.label=a),placeholder:"Enter filter label"},null,8,["modelValue"]),n("div",null,[e[4]||(e[4]=n("span",{class:"mb-2 block text-sm leading-4 text-gray-700"},"Column",-1)),c(o,{modelValue:l.value.column,"onUpdate:modelValue":e[1]||(e[1]=a=>l.value.column=a),options:_.value,placeholder:"Select a column"},null,8,["modelValue","options"])]),n("div",null,[e[5]||(e[5]=n("span",{class:"mb-2 block text-sm leading-4 text-gray-700"},"Default Operator",-1)),c(o,{modelValue:l.value.defaultOperator,"onUpdate:modelValue":e[2]||(e[2]=a=>l.value.defaultOperator=a),placeholder:"Default Operator",options:U.value},null,8,["modelValue","options"])]),(r=l.value.column)!=null&&r.value?(i(),m("div",P,[c(H,{label:"Default Value",column:l.value.column,operator:l.value.defaultOperator,modelValue:l.value.defaultValue,"data-source":(p=l.value.column)==null?void 0:p.data_source,"onUpdate:modelValue":e[3]||(e[3]=a=>l.value.defaultValue=a)},null,8,["column","operator","modelValue","data-source"])])):b("",!0),(d=l.value.column)!=null&&d.column?(i(),m("div",R,[e[6]||(e[6]=n("div",{class:"mb-2 space-y-1"},[n("span",{class:"block text-sm leading-4 text-gray-700"},"Links"),n("span",{class:"block text-xs leading-4 text-gray-600"}," Select charts to link to this filter. The filter will be applied to the selected column in the linked charts. ")],-1)),n("div",W,[(i(!0),m(j,null,F(K(f),a=>(i(),m("div",{class:"flex h-8 w-full items-center",key:a.item_id},[c(s,{type:"checkbox",class:"flex-shrink-0 focus:ring-0",onChange:u=>L(u,a),value:l.value.links[a.item_id]},null,8,["onChange","value"]),n("span",{class:Q(["mx-2 flex-1 truncate text-base font-medium",[l.value.links[a.item_id]?"text-gray-900":"font-normal text-gray-600"]])},z(a.options.title),3),l.value.links[a.item_id]&&a.options.query?(i(),A(o,{key:0,class:"w-28 flex-shrink-0",placeholder:"Select Column",options:v[a.options.query],modelValue:l.value.links[a.item_id],"onUpdate:modelValue":u=>l.value.links[a.item_id]=u,"empty-text":"No matching columns found"},null,8,["options","modelValue","onUpdate:modelValue"])):b("",!0)]))),128))])])):b("",!0)])}}};export{re as default};
//# sourceMappingURL=FilterOptions-926e5d7c.js.map
