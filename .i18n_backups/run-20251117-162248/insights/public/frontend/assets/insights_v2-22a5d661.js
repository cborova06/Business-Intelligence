import{c as $e,D as Ce,B as Se,S as Ee,V as Te,b as Ve,e as De,o as Ie}from"./index-77f7bd6f.js";import{u as ee,j as V,E as G,r as b,o as g,c as S,w as y,f as d,d as O,F as Q,g as ue,y as F,t as j,h as f,K as _,ac as Be,ad as Me,ae as Oe,v as Ne,S as te,J as fe,a2 as pe,e as me,a5 as J,D as Ae,af as Le,U as he,G as We,l as je,$ as Pe,a0 as Re,R as Fe,a1 as He,a4 as ze,O as Ye,a as Xe,b as Ue,Q as qe,ag as Ge,q as Qe,a9 as Je,aa as Ke,ab as Ze}from"./frappe-ui-d69b39da.js";import{_ as le}from"./insights-logo-new-611f92f4.js";import{s as oe,c as ge}from"./toasts-2937f9d2.js";import{s as ve,r as et}from"./router-9009eafe.js";import{H as tt}from"./house-94cdb6cd.js";import{L as ot}from"./layout-panel-top-f86bd902.js";import{S as nt}from"./square-chart-gantt-d62ce5e7.js";import{_ as st}from"./Checkbox-95c21eb1.js";import{_ as it}from"./Autocomplete-e91e4d1c.js";import{_ as at}from"./Popover-5414f173.js";import{u as rt}from"./index-9194c21d.js";import"./dayjs-e81f6541.js";import"./calendar-1687c485.js";import"./clock-73e01da8.js";/**
 * @license lucide-vue-next v0.484.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const lt=$e("book-open",[["path",{d:"M12 7v14",key:"1akyts"}],["path",{d:"M3 18a1 1 0 0 1-1-1V4a1 1 0 0 1 1-1h5a4 4 0 0 1 4 4 4 4 0 0 1 4-4h5a1 1 0 0 1 1 1v13a1 1 0 0 1-1 1h-6a3 3 0 0 0-3 3 3 3 0 0 0-3-3z",key:"ruj8y"}]]),be=new Set,v=new WeakMap,N=new WeakMap,I=new WeakMap,K=new WeakMap,ct=new WeakMap,A=new WeakMap,H=new WeakMap,W=new WeakSet;let D,ne=0,se=0;const C="__aa_tgt",P="__aa_del",z="__aa_new",dt=e=>{const t=gt(e);t&&t.forEach(n=>vt(n))},ut=e=>{e.forEach(t=>{t.target===D&&pt(),v.has(t.target)&&B(t.target)})};function ft(e){const t=K.get(e);t==null||t.disconnect();let n=v.get(e),o=0;const s=5;n||(n=L(e),v.set(e,n));const{offsetWidth:a,offsetHeight:i}=D,c=[n.top-s,a-(n.left+s+n.width),i-(n.top+s+n.height),n.left-s].map(r=>`${-1*Math.floor(r)}px`).join(" "),u=new IntersectionObserver(()=>{++o>1&&B(e)},{root:D,threshold:1,rootMargin:c});u.observe(e),K.set(e,u)}function B(e){clearTimeout(H.get(e));const t=Y(e),n=R(t)?500:t.duration;H.set(e,setTimeout(async()=>{const o=I.get(e);try{await(o==null?void 0:o.finished),v.set(e,L(e)),ft(e)}catch{}},n))}function pt(){clearTimeout(H.get(D)),H.set(D,setTimeout(()=>{be.forEach(e=>xe(e,t=>we(()=>B(t))))},100))}function mt(e){setTimeout(()=>{ct.set(e,setInterval(()=>we(B.bind(null,e)),2e3))},Math.round(2e3*Math.random()))}function we(e){typeof requestIdleCallback=="function"?requestIdleCallback(()=>e()):requestAnimationFrame(()=>e())}let Z,M;const ht=typeof window<"u"&&"ResizeObserver"in window;ht&&(D=document.documentElement,Z=new MutationObserver(dt),M=new ResizeObserver(ut),window.addEventListener("scroll",()=>{se=window.scrollY,ne=window.scrollX}),M.observe(D));function gt(e){return e.reduce((o,s)=>[...o,...Array.from(s.addedNodes),...Array.from(s.removedNodes)],[]).every(o=>o.nodeName==="#comment")?!1:e.reduce((o,s)=>{if(o===!1)return!1;if(s.target instanceof Element){if(q(s.target),!o.has(s.target)){o.add(s.target);for(let a=0;a<s.target.children.length;a++){const i=s.target.children.item(a);if(i){if(P in i)return!1;q(s.target,i),o.add(i)}}}if(s.removedNodes.length)for(let a=0;a<s.removedNodes.length;a++){const i=s.removedNodes[a];if(P in i)return!1;i instanceof Element&&(o.add(i),q(s.target,i),N.set(i,[s.previousSibling,s.nextSibling]))}}return o},new Set)}function q(e,t){!t&&!(C in e)?Object.defineProperty(e,C,{value:e}):t&&!(C in t)&&Object.defineProperty(t,C,{value:e})}function vt(e){var t;const n=e.isConnected,o=v.has(e);n&&N.has(e)&&N.delete(e),I.has(e)&&((t=I.get(e))===null||t===void 0||t.cancel()),z in e?ce(e):o&&n?wt(e):o&&!n?_t(e):ce(e)}function k(e){return Number(e.replace(/[^0-9.\-]/g,""))}function bt(e){let t=e.parentElement;for(;t;){if(t.scrollLeft||t.scrollTop)return{x:t.scrollLeft,y:t.scrollTop};t=t.parentElement}return{x:0,y:0}}function L(e){const t=e.getBoundingClientRect(),{x:n,y:o}=bt(e);return{top:t.top+o,left:t.left+n,width:t.width,height:t.height}}function _e(e,t,n){let o=t.width,s=t.height,a=n.width,i=n.height;const l=getComputedStyle(e);if(l.getPropertyValue("box-sizing")==="content-box"){const u=k(l.paddingTop)+k(l.paddingBottom)+k(l.borderTopWidth)+k(l.borderBottomWidth),r=k(l.paddingLeft)+k(l.paddingRight)+k(l.borderRightWidth)+k(l.borderLeftWidth);o-=r,a-=r,s-=u,i-=u}return[o,a,s,i].map(Math.round)}function Y(e){return C in e&&A.has(e[C])?A.get(e[C]):{duration:250,easing:"ease-in-out"}}function ye(e){if(C in e)return e[C]}function ie(e){const t=ye(e);return t?W.has(t):!1}function xe(e,...t){t.forEach(n=>n(e,A.has(e)));for(let n=0;n<e.children.length;n++){const o=e.children.item(n);o&&t.forEach(s=>s(o,A.has(o)))}}function ae(e){return Array.isArray(e)?e:[e]}function R(e){return typeof e=="function"}function wt(e){const t=v.get(e),n=L(e);if(!ie(e))return v.set(e,n);let o;if(!t)return;const s=Y(e);if(typeof s!="function"){const a=t.left-n.left,i=t.top-n.top,[l,c,u,r]=_e(e,t,n),w={transform:`translate(${a}px, ${i}px)`},p={transform:"translate(0, 0)"};l!==c&&(w.width=`${l}px`,p.width=`${c}px`),u!==r&&(w.height=`${u}px`,p.height=`${r}px`),o=e.animate([w,p],{duration:s.duration,easing:s.easing})}else{const[a]=ae(s(e,"remain",t,n));o=new Animation(a),o.play()}I.set(e,o),v.set(e,n),o.addEventListener("finish",B.bind(null,e))}function ce(e){z in e&&delete e[z];const t=L(e);v.set(e,t);const n=Y(e);if(!ie(e))return;let o;if(typeof n!="function")o=e.animate([{transform:"scale(.98)",opacity:0},{transform:"scale(0.98)",opacity:0,offset:.5},{transform:"scale(1)",opacity:1}],{duration:n.duration*1.5,easing:"ease-in"});else{const[s]=ae(n(e,"add",t));o=new Animation(s),o.play()}I.set(e,o),o.addEventListener("finish",B.bind(null,e))}function de(e,t){var n;e.remove(),v.delete(e),N.delete(e),I.delete(e),(n=K.get(e))===null||n===void 0||n.disconnect(),setTimeout(()=>{if(P in e&&delete e[P],Object.defineProperty(e,z,{value:!0,configurable:!0}),t&&e instanceof HTMLElement)for(const o in t)e.style[o]=""},0)}function _t(e){var t;if(!N.has(e)||!v.has(e))return;const[n,o]=N.get(e);Object.defineProperty(e,P,{value:!0,configurable:!0});const s=window.scrollX,a=window.scrollY;if(o&&o.parentNode&&o.parentNode instanceof Element?o.parentNode.insertBefore(e,o):n&&n.parentNode?n.parentNode.appendChild(e):(t=ye(e))===null||t===void 0||t.appendChild(e),!ie(e))return de(e);const[i,l,c,u]=xt(e),r=Y(e),w=v.get(e);(s!==ne||a!==se)&&yt(e,s,a,r);let p,x={position:"absolute",top:`${i}px`,left:`${l}px`,width:`${c}px`,height:`${u}px`,margin:"0",pointerEvents:"none",transformOrigin:"center",zIndex:"100"};if(!R(r))Object.assign(e.style,x),p=e.animate([{transform:"scale(1)",opacity:1},{transform:"scale(.98)",opacity:0}],{duration:r.duration,easing:"ease-out"});else{const[T,h]=ae(r(e,"remove",w));(h==null?void 0:h.styleReset)!==!1&&(x=(h==null?void 0:h.styleReset)||x,Object.assign(e.style,x)),p=new Animation(T),p.play()}I.set(e,p),p.addEventListener("finish",de.bind(null,e,x))}function yt(e,t,n,o){const s=ne-t,a=se-n,i=document.documentElement.style.scrollBehavior;if(getComputedStyle(D).scrollBehavior==="smooth"&&(document.documentElement.style.scrollBehavior="auto"),window.scrollTo(window.scrollX+s,window.scrollY+a),!e.parentElement)return;const c=e.parentElement;let u=c.clientHeight,r=c.clientWidth;const w=performance.now();function p(){requestAnimationFrame(()=>{if(!R(o)){const x=u-c.clientHeight,T=r-c.clientWidth;w+o.duration>performance.now()?(window.scrollTo({left:window.scrollX-T,top:window.scrollY-x}),u=c.clientHeight,r=c.clientWidth,p()):document.documentElement.style.scrollBehavior=i}})}p()}function xt(e){const t=v.get(e),[n,,o]=_e(e,t,L(e));let s=e.parentElement;for(;s&&(getComputedStyle(s).position==="static"||s instanceof HTMLBodyElement);)s=s.parentElement;s||(s=document.body);const a=getComputedStyle(s),i=v.get(s)||L(s),l=Math.round(t.top-i.top)-k(a.borderTopWidth),c=Math.round(t.left-i.left)-k(a.borderLeftWidth);return[l,c,n,o]}function kt(e,t={}){return Z&&M&&(window.matchMedia("(prefers-reduced-motion: reduce)").matches&&!R(t)&&!t.disrespectUserMotionPreference||(W.add(e),getComputedStyle(e).position==="static"&&Object.assign(e.style,{position:"relative"}),xe(e,B,mt,s=>M==null?void 0:M.observe(s)),R(t)?A.set(e,t):A.set(e,{duration:250,easing:"ease-in-out",...t}),Z.observe(e,{childList:!0}),be.add(e))),Object.freeze({parent:e,enable:()=>{W.add(e)},disable:()=>{W.delete(e)},isEnabled:()=>W.has(e)})}const $t={mounted:(e,t)=>{kt(e,t.value||{})},getSSRProps:()=>({})},Ct=$t,St={install(e){e.directive("auto-animate",Ct)}},Et={class:"flex w-full flex-col space-y-4 text-base"},Tt={class:"flex w-full cursor-pointer items-center space-x-2 rounded bg-gray-100 p-1.5"},Vt=["onClick"],Dt={class:"flex flex-col"},It={class:"text-xs text-gray-600"},Bt={class:"flex h-[20rem] flex-col rounded border px-4 py-2 shadow"},Mt={class:"mt-2 flex items-center justify-between"},Ot={__name:"HelpDialog",props:{modelValue:Boolean},emits:["update:modelValue"],setup(e,{emit:t}){const n=e,o=t,s=ee({get:()=>n.modelValue,set:T=>o("update:modelValue",T)}),a=V(""),i=V(!1),l={title:"Contact the Team",size:"2xl"},c=V(0),u=[{label:"Question",description:"How do I...",iconName:"help-circle",placeholder:"I am not sure how to..."},{label:"Feedback",description:"What if there was...",iconName:"rss",placeholder:"I think it would be great if..."},{label:"Bug Report",description:"When I try to...",iconName:"alert-triangle",placeholder:"I found a bug, when I try to..."}];function r(){s.value=!1,c.value=0,a.value="",i.value=!1}const w=G("$notify"),p=V(!1);async function x(){p.value=!0,await Ne("insights.api.contact_team",{message_type:u[c.value].label,message_content:a.value,is_critical:i.value}),p.value=!1,r(),w({title:"Message Sent",message:"Your message has been sent to the team.",variant:"success"})}return(T,h)=>{const X=b("FeatherIcon"),U=b("Input"),m=b("Button"),ke=b("Dialog");return g(),S(ke,{options:l,modelValue:s.value,"onUpdate:modelValue":h[2]||(h[2]=$=>s.value=$),dismissable:!0,onOnClose:r},{"body-content":y(()=>[d("div",Et,[d("div",Tt,[(g(),O(Q,null,ue(u,($,re)=>d("div",{class:F(["flex h-full flex-1 items-center justify-between bg-transparent px-3 py-1.5 transition-all",[c.value===re?"rounded bg-white shadow":""]]),onClick:eo=>c.value=re},[d("div",Dt,[d("p",null,j($.label),1),d("p",It,j($.description),1)]),f(X,{name:$.iconName,class:"h-5 w-5 text-gray-500"},null,8,["name"])],10,Vt)),64))]),d("div",Bt,[(g(),S(_(Be),{key:c.value,"editor-class":"flex flex-1 prose-sm flex flex-col justify-end",placeholder:u[c.value].placeholder,content:a.value,editable:!0,onChange:h[0]||(h[0]=$=>a.value=$)},null,8,["placeholder","content"]))]),h[3]||(h[3]=d("span",{class:"!mt-2 text-sm text-gray-600"}," You can use markdown syntax to format your message. You can also drag and drop images to upload them. ",-1)),d("div",Mt,[Me(f(U,{label:"I am not able to use the app because of this bug",type:"checkbox",modelValue:i.value,"onUpdate:modelValue":h[1]||(h[1]=$=>i.value=$)},null,8,["modelValue"]),[[Oe,c.value==2]]),f(m,{variant:"solid",loading:p.value,label:c.value===2?"Report Bug":"Send",onClick:x},null,8,["loading","label"])])])]),_:1},8,["modelValue"])}}},Nt={key:0,class:"rg:w-60 flex w-14 flex-shrink-0 flex-col border-r border-gray-300 bg-white"},At={class:"flex flex-grow flex-col overflow-y-auto p-2.5"},Lt={class:"mt-4 flex flex-col"},Wt={class:"flex-1 space-y-1 pb-4 text-base"},jt={class:"w-fit rounded border border-gray-100 bg-gray-800 px-2 py-1 text-xs text-white shadow-xl"},Pt={class:"rg:inline-block hidden"},Rt={class:"mt-auto flex flex-col items-center gap-2 text-base text-gray-600"},Ft={class:"rg:inline ml-2 hidden overflow-hidden text-ellipsis whitespace-nowrap"},Ht={__name:"Sidebar",setup(e){const t=oe();ve().settings;const n=V(!1),o=V(!1),s=V([{path:"/",label:"Home",icon:tt,name:"Home",current:!1},{path:"/dashboard",label:"Dashboards",icon:ot,name:"Dashboard",current:!1},{path:"/query",label:"Query",icon:nt,name:"QueryList",current:!1},{path:"/data-source",label:"Data Sources",icon:Ce,name:"Data Source"},{path:"/notebook",label:"Notebook",icon:Se,name:"Notebook",current:!1},{path:"/settings",label:"Settings",icon:Ee,name:"Settings",current:!1}]),a=te(),i=ee(()=>(s.value.forEach(u=>{u.current=a.path.match(new RegExp(`^${u.path}(/|$)`))}),a.path)),l=u=>window.open(u,"_blank");function c(){t.updateDefaultVersion(t.user.default_version==="v2"?"":t.user.default_version).then(()=>{window.location.href="/insights"})}return(u,r)=>{const w=b("router-link"),p=b("Tooltip"),x=b("Button"),T=b("FeatherIcon"),h=b("Dropdown"),X=b("FormControl"),U=b("Dialog");return g(),O(Q,null,[i.value?(g(),O("div",Nt,[d("div",At,[r[5]||(r[5]=d("div",{class:"rg:flex hidden flex-shrink-0 items-end text-sm text-gray-600"},[d("img",{src:le,class:"h-7"})],-1)),f(w,{to:"/",class:"rg:hidden flex cursor-pointer"},{default:y(()=>r[4]||(r[4]=[d("img",{src:le,class:"rounded"},null,-1)])),_:1}),d("div",Lt,[d("nav",Wt,[(g(!0),O(Q,null,ue(s.value,m=>(g(),S(p,{key:m.path,placement:"right",hoverDelay:.1,class:"w-full"},{body:y(()=>[d("div",jt,j(m.label),1)]),default:y(()=>[f(w,{to:m.path,class:F([m.current?"bg-gray-200/70":"text-gray-700 hover:bg-gray-50 hover:text-gray-800","rg:justify-start group flex w-full items-center justify-center rounded p-2 font-medium"]),"aria-current":"page"},{default:y(()=>[(g(),S(fe(m.icon),{"stroke-width":1.5,class:F([m.current?"text-gray-800":"text-gray-700 group-hover:text-gray-700","rg:mr-3 rg:h-4 rg:w-4 mr-0 h-5 w-5 flex-shrink-0"])},null,8,["class"])),d("span",Pt,j(m.label),1)]),_:2},1032,["to","class"])]),_:2},1024))),128))])]),d("div",Rt,[f(x,{variant:"ghost",onClick:r[0]||(r[0]=m=>l("https://docs.frappeinsights.com"))},{default:y(()=>[f(_(lt),{class:"h-4 text-gray-600"})]),_:1}),f(h,{placement:"left",options:[{label:"Documentation",icon:"help-circle",onClick:()=>l("https://docs.frappeinsights.com")},{label:"Join Telegram Group",icon:"message-circle",onClick:()=>l("https://t.me/frappeinsights")},{label:"Help",icon:"life-buoy",onClick:()=>n.value=!0},_(t).user.is_admin?{label:"Switch to Desk",icon:"grid",onClick:()=>l("/app")}:null,{label:"Switch to Insights v3",icon:"grid",onClick:()=>o.value=!0},{label:"Logout",icon:"log-out",onClick:()=>_(t).logout()}]},{default:y(({open:m})=>[d("button",{class:F(["flex w-full items-center space-x-2 rounded p-1 text-left text-base font-medium",m?"bg-gray-300":"hover:bg-gray-200"])},[f(_(pe),{size:"xl",label:_(t).user.full_name,image:_(t).user.user_image},null,8,["label","image"]),d("span",Ft,j(_(t).user.full_name),1),f(T,{name:"chevron-down",class:"rg:inline hidden h-4 w-4"})],2)]),_:1},8,["options"])])])])):me("",!0),f(Ot,{modelValue:n.value,"onUpdate:modelValue":r[1]||(r[1]=m=>n.value=m)},null,8,["modelValue"]),f(U,{modelValue:o.value,"onUpdate:modelValue":r[3]||(r[3]=m=>o.value=m),options:{title:"Insights v3 âœ¨",actions:[{label:"Continue",variant:"solid",onClick:c}]}},{"body-content":y(()=>[r[6]||(r[6]=d("div",{class:"prose prose-sm mb-4"},[d("p",null," Switch to the newest version of Insights, built from the ground up for a better experience. "),d("p",null,' You can always switch back to this version by clicking the "Switch to Insights v2" button in the new version. ')],-1)),f(X,{type:"checkbox",label:"Set Insights v3 as default",modelValue:_(t).user.default_version==="v3","onUpdate:modelValue":r[2]||(r[2]=m=>_(t).user.default_version=m?"v3":"")},null,8,["modelValue"])]),_:1},8,["modelValue","options"])],64)}}},zt={name:"SuspenseFallback",components:{LoadingIndicator:J},render(){return f("div",{class:"flex h-full w-full flex-col items-center justify-center"},[f(J,{class:"h-10 w-10 text-gray-400"},null)])}},Yt={class:"flex flex-1 overflow-hidden text-base"},Xt={class:"flex flex-1 flex-col overflow-hidden"},Ut={__name:"AppShell",setup(e){const t=oe(),n=te(),o=V(!0);return Ae(n,s=>{o.value=s.meta.hideSidebar||!t.isLoggedIn},{immediate:!0}),Le(()=>t.isLoggedIn&&ve()),(s,a)=>{const i=b("RouterView");return g(),O("div",Yt,[o.value?me("",!0):(g(),S(Ht,{key:0})),f(i,null,{default:y(({Component:l})=>[(g(),S(he,null,{fallback:y(()=>[f(_(zt))]),default:y(()=>[d("div",Xt,[(g(),S(fe(l),{key:s.$route.fullPath}))])]),_:2},1024))]),_:1})])}}},qt={class:"flex h-screen w-screen bg-white antialiased"},Gt={__name:"App",setup(e){const t=te(),n=ee(()=>t.meta.isGuestView);if(!n.value){const o=G("$socket"),s=G("$notify"),a=oe();o.on("insights_notification",i=>{i.user==a.user.email&&s({title:i.title||i.message,message:i.title?i.message:"",variant:i.type})}),We(()=>{o.off("insights_notification")})}return(o,s)=>{const a=b("RouterView");return g(),O("div",qt,[n.value?(g(),S(a,{key:0})):(g(),S(he,{key:1},{default:y(()=>[f(Ut)]),_:1})),f(_(Te),{"visible-toasts":2,position:"bottom-right"})])}}};function Qt(){let e=window.socketio_port||9e3,t=window.location.hostname,n=window.site_name,o=window.location.port?`:${e}`:"",a=`${o?"http":"https"}://${t}${o}/${n}`;return je(a,{withCredentials:!0,reconnectionAttempts:5})}function Jt(e){e.component("Input",Pe),e.component("Badge",Re),e.component("Button",Fe),e.component("Dialog",He),e.component("Avatar",pe),e.component("Popover",at),e.component("Tooltip",ze),e.component("Checkbox",st),e.component("Dropdown",Ye),e.component("FormControl",Xe),e.component("LoadingIndicator",J),e.component("Autocomplete",it),e.component("ErrorMessage",Ue),e.component("FeatherIcon",qe),e.directive("on-outside-click",Ge)}function Kt(e){e.provide("$utils",rt),e.provide("$dayjs",Qe),e.provide("$notify",ge)}const E=Je(Gt),Zt=Ve();E.use(Zt);Ke("resourceFetcher",e=>Ze({...e,onError(t){t.messages&&t.messages[0]&&ge({title:"Error",variant:"error",message:t.messages[0]})}}));E.use(et);E.use(St);E.component("grid-layout",De);E.component("grid-item",Ie);E.provide("$socket",Qt());Jt(E);Kt(E);E.mount("#app");
//# sourceMappingURL=insights_v2-22a5d661.js.map
