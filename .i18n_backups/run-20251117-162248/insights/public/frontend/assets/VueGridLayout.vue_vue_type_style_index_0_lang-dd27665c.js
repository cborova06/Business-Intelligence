import{x as $,E as I,u as b,an as G,j as O,I as J,r as k,o as r,d as h,c as f,h as x,K as y,f as _,w,e as V,F as T,s as M,g as j,t as P,M as S,L as H,T as K,i as X,ac as W,y as Z,m as R,z as ee}from"./frappe-ui-d69b39da.js";import{b as B,w as te,i as N,d as le,e as oe}from"./dashboard-37329027.js";import{_ as z}from"./ChartRenderer.vue_vue_type_script_setup_true_lang-564d1b03.js";import{w as ae,h as L,i as U,F as D}from"./main-d2d228fc.js";import{c as ne}from"./index-77f7bd6f.js";import{M as re}from"./maximize-3d779b9b.js";import{_ as se}from"./Popover-5414f173.js";import{k as ie,b as ue}from"./DrillDown.vue_vue_type_script_setup_true_lang-3700404a.js";import{_ as de}from"./Autocomplete-e91e4d1c.js";import{_ as me}from"./ColumnFilterValueSelector.vue_vue_type_script_setup_true_lang-88f0bec7.js";import{_ as Q}from"./DatePickerControl.vue_vue_type_script_setup_true_lang-6baff6f5.js";/**
 * @license lucide-vue-next v0.484.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const pe=ne("triangle-alert",[["path",{d:"m21.73 18-8-14a2 2 0 0 0-3.48 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3",key:"wmoenq"}],["path",{d:"M12 9v4",key:"juzpu7"}],["path",{d:"M12 17h.01",key:"p32p05"}]]),ce={key:1,class:"flex h-full flex-1 flex-col items-center justify-center rounded border"},ve={key:2,class:"absolute top-1.5 right-1.5 p-2 opacity-0 transition-opacity group-hover:opacity-100"},fe={class:"h-[75vh] w-full"},_e=$({__name:"DashboardChart",props:{item:{}},setup(v){const t=v,a=I("dashboard"),e=b(()=>t.item.chart?B(t.item.chart):null);t.item.chart&&(G("chartName",t.item.chart),ae(()=>{var o;return!!((o=e.value)!=null&&o.isloaded)}).then(()=>{var o;(o=e.value)!=null&&o.dataQuery.result.executedSQL||a.refreshChart(t.item.chart),L(()=>{var d;return(d=e.value)==null?void 0:d.doc.config.order_by},()=>a.refreshChart(t.item.chart),{deep:!0,debounce:500})}));const u=O(!1),l=J(),s=I(te,null);return L(()=>a.isEditingItem(t.item),o=>{s&&o&&l.push(`/workbook/${s.doc.name}/chart/${t.item.chart}`)}),(o,d)=>{const p=k("Button"),i=k("Dialog");return r(),h(T,null,[e.value?(r(),f(z,{key:0,chart:e.value},null,8,["chart"])):(r(),h("div",ce,[x(y(pe),{class:"h-8 w-8 text-gray-500","stroke-width":"1"}),d[2]||(d[2]=_("p",{class:"text-p-base text-gray-500"},"Chart not found",-1))])),e.value&&e.value.doc.chart_type!=="Number"?(r(),h("div",ve,[x(p,{variant:"ghost",class:"!h-7 !w-7",onClick:d[0]||(d[0]=m=>u.value=!0)},{default:w(()=>[x(y(re),{class:"h-3.5 w-3.5 text-gray-700","stroke-width":"1.5"})]),_:1})])):V("",!0),e.value?(r(),f(i,{key:3,modelValue:u.value,"onUpdate:modelValue":d[1]||(d[1]=m=>u.value=m),options:{size:"6xl"}},{body:w(()=>[_("div",fe,[e.value?(r(),f(z,{key:0,chart:e.value},null,8,["chart"])):V("",!0)])]),_:1},8,["modelValue"])):V("",!0)],64)}}}),xe={class:"flex flex-col gap-4"},ye={class:"flex gap-4"},he={class:"flex flex-col"},ge={class:"flex-1 truncate text-base"},be={key:0,class:"ml-auto flex-shrink-0"},ke=$({__name:"DashboardFilterEditor",props:{item:{}},setup(v){const t=I("dashboard"),a=v,e=M(U(a.item));e.links||(e.links={});const u=b(()=>t.doc.items.filter(c=>c.type==="chart").map(c=>c.chart).filter(Boolean));b(()=>u.value.map(c=>B(c).getDependentQueries()).flat().filter((c,n,C)=>C.findIndex(F=>F===c)===n).filter(Boolean));const l=b(()=>u.value.map(c=>{const n=B(c),C=n.getDependentQueryColumns().map(F=>({...F,items:p(F.items)}));return{name:n.doc.name,title:n.doc.title,columns:C}})),s=b(()=>Object.keys(e.links));function o(c){s.value.includes(c)?delete e.links[c]:e.links[c]=""}const d={String:D.TEXT,Number:D.NUMBER,Date:D.DATE};function p(c){return c.map(n=>({...n,disabled:!d[e.filter_type].includes(n.data_type)}))}function i(){e.default_operator=void 0,e.default_value=void 0,e.links={}}const m=b(()=>!e.filter_name||!e.filter_type||JSON.stringify(e)===JSON.stringify(a.item));function E(){t.editingItemIndex=null,Object.assign(a.item,e)}return(c,n)=>{const C=k("FormControl"),F=k("Toggle"),Y=de,q=k("Dialog");return r(),f(q,{modelValue:y(t).isEditingItem(a.item),"onUpdate:modelValue":n[2]||(n[2]=g=>g?!0:y(t).editingItemIndex=null),options:{title:"Edit Filter",actions:[{label:"Save",variant:"solid",disabled:m.value,onClick:E},{label:"Cancel",onClick:()=>y(t).editingItemIndex=null}]}},{"body-content":w(()=>[_("div",xe,[_("div",ye,[x(C,{class:"flex-1 flex-shrink-0",label:"Label",modelValue:e.filter_name,"onUpdate:modelValue":n[0]||(n[0]=g=>e.filter_name=g),placeholder:"Enter filter label...",autocomplete:"off"},null,8,["modelValue"]),x(C,{class:"flex-1 flex-shrink-0",modelValue:e.filter_type,"onUpdate:modelValue":[n[1]||(n[1]=g=>e.filter_type=g),i],label:"Type",type:"select",options:Object.keys(d)},null,8,["modelValue","options"])]),_("div",he,[n[3]||(n[3]=_("div",{class:"mb-1 text-p-sm text-gray-700"},"Linked Charts",-1)),(r(!0),h(T,null,j(l.value,g=>(r(),h("div",{key:g.name,class:"flex h-8 w-full items-center gap-2"},[x(F,{size:"sm",modelValue:s.value.includes(g.name),"onUpdate:modelValue":A=>o(g.name)},null,8,["modelValue","onUpdate:modelValue"]),_("p",ge,P(g.title),1),s.value.includes(g.name)?(r(),h("div",be,[x(Y,{class:"min-w-[10rem]",placeholder:"Select a column",options:g.columns,modelValue:e.links[g.name],"onUpdate:modelValue":A=>e.links[g.name]=A.value},null,8,["options","modelValue","onUpdate:modelValue"])])):V("",!0)]))),128))])])]),_:1},8,["modelValue","options"])}}}),Ve={class:"flex gap-2"},Ce=$({__name:"NumberFilterPicker",props:{operator:{},operatorModifiers:{},value:{},valueModifiers:{}},emits:["update:operator","update:value"],setup(v){const t=S(v,"operator"),a=S(v,"value"),e=b({get(){const u=U(a.value);if(Array.isArray(u))return{min:u[0],max:u[1]};if(N(u)){if(t.value==="=")return{min:u,max:u};if(t.value===">=")return{min:u,max:void 0};if(t.value==="<=")return{min:void 0,max:u}}return{min:void 0,max:void 0}},set({min:u,max:l}){const s=N(u),o=N(l),d=s?Number(u):void 0,p=o?Number(l):void 0;s&&o&&d===p?(a.value=d,t.value="="):s&&!o?(a.value=d,t.value=">="):!s&&o?(a.value=p,t.value="<="):s&&o?(a.value=[d,p],t.value="between"):(a.value=void 0,t.value=void 0)}});return(u,l)=>{const s=k("FormControl");return r(),h("div",Ve,[x(s,{type:"number",autocomplete:"off",placeholder:"Min",label:"Min",modelValue:e.value.min,"onUpdate:modelValue":l[0]||(l[0]=o=>e.value={...e.value,min:o})},null,8,["modelValue"]),x(s,{type:"number",autocomplete:"off",placeholder:"Max",label:"Max",modelValue:e.value.max,"onUpdate:modelValue":l[1]||(l[1]=o=>e.value={...e.value,max:o})},null,8,["modelValue"])])}}}),we={class:"flex flex-col gap-2"},$e={id:"operator",class:"!min-w-[200px] flex-1"},Ie={id:"value",class:"!min-w-[200px] flex-1 flex-shrink-0"},Te={class:"flex justify-end gap-2"},Ee=$({__name:"Filter",props:H({filterType:{},valuesProvider:{type:Function}},{operator:{},operatorModifiers:{},value:{type:[String,Number,Boolean,Array]},valueModifiers:{}}),emits:["update:operator","update:value"],setup(v){const t=v,a=S(v,"operator"),e=S(v,"value"),u=b(()=>le(t.filterType)),l=M(U({operator:a.value||u.value[0].value,value:e.value})),s=b(()=>{if(l.operator)return oe(l.operator,t.filterType)});function o(i){const m=s.value;l.operator=i,m!==s.value&&(l.value=void 0)}function d(){a.value=l.operator,e.value=l.value}function p(){a.value=void 0,e.value=void 0}return(i,m)=>{const E=k("FormControl"),c=k("Button");return r(),h("div",we,[i.filterType==="Number"?(r(),f(Ce,{key:0,class:"w-[200px]",operator:l.operator,"onUpdate:operator":m[0]||(m[0]=n=>l.operator=n),value:l.value,"onUpdate:value":m[1]||(m[1]=n=>l.value=n)},null,8,["operator","value"])):(r(),h(T,{key:1},[_("div",$e,[x(E,{type:"select",placeholder:"Operator",modelValue:l.operator,options:u.value,"onUpdate:modelValue":m[2]||(m[2]=n=>o(n))},null,8,["modelValue","options"])]),_("div",Ie,[s.value==="date"?(r(),f(Q,{key:0,range:!1,modelValue:[l.value],"onUpdate:modelValue":m[3]||(m[3]=n=>l.value=n[0])},null,8,["modelValue"])):s.value==="date_range"?(r(),f(Q,{key:1,range:!0,modelValue:l.value,"onUpdate:modelValue":m[4]||(m[4]=n=>l.value=n)},null,8,["modelValue"])):s.value==="relative_date"?(r(),f(ie,{key:2,modelValue:l.value,"onUpdate:modelValue":m[5]||(m[5]=n=>l.value=n)},null,8,["modelValue"])):s.value==="select"?(r(),f(me,{key:3,modelValue:l.value,"onUpdate:modelValue":m[6]||(m[6]=n=>l.value=n),valuesProvider:t.valuesProvider},null,8,["modelValue","valuesProvider"])):s.value==="text"?(r(),f(E,{key:4,modelValue:l.value,"onUpdate:modelValue":m[7]||(m[7]=n=>l.value=n),placeholder:"Value",autocomplete:"off"},null,8,["modelValue"])):V("",!0)])],64)),_("div",Te,[x(c,{icon:"x",onClick:p}),x(c,{icon:"check",variant:"solid",onClick:d})])])}}}),Fe={class:"h-8 w-full [&>div:first-child]:h-full"},Ue={class:"w-full p-2"},De=$({__name:"DashboardFilter",props:{item:{}},setup(v){const t=I("dashboard"),a=v,e=M(U(a.item));K(()=>Object.assign(e,U(a.item))),e.links||(e.links={});const u={String:D.TEXT,Number:D.NUMBER,Date:D.DATE},l=b(()=>{const p=Object.keys(e.links)[0];if(!p)return;const i=e.links[p];return t.getColumnFromFilterLink(i)});function s(p){return l.value?t.getDistinctColumnValues(l.value.query,l.value.column,p):Promise.resolve([])}const o=M(U(t.filterStates[e.filter_name]||{}));L(()=>o,()=>{t.updateFilterState(e.filter_name,o.operator,o.value)},{deep:!0});const d=b(()=>{let p=e.filter_name;if(o.operator&&o.value){const i=Array.isArray(o.value)?o.value.join(", "):o.value;p+=` ${o.operator} ${i}`}return p});return(p,i)=>{const m=k("Button"),E=se;return r(),h(T,null,[_("div",Fe,[x(E,{class:"h-full"},{target:w(({togglePopover:c})=>[x(m,{variant:"outline",class:"flex h-full w-full !justify-start overflow-hidden text-sm shadow-sm [&>span]:truncate",onClick:c},{prefix:w(()=>[e.filter_type?(r(),f(ue,{key:0,"column-type":u[e.filter_type][0],class:"h-4 w-4 flex-shrink-0","stroke-width":"1.5"},null,8,["column-type"])):V("",!0)]),default:w(()=>[X(" "+P(d.value),1)]),_:2},1032,["onClick"])]),"body-main":w(({togglePopover:c,isOpen:n})=>[_("div",Ue,[n?(r(),f(Ee,{key:0,"filter-type":e.filter_type,valuesProvider:s,operator:o.operator,"onUpdate:operator":i[0]||(i[0]=C=>o.operator=C),value:o.value,"onUpdate:value":[i[1]||(i[1]=C=>o.value=C),()=>c()]},null,8,["filter-type","operator","value","onUpdate:value"])):V("",!0)])]),_:1})]),y(t).isEditingItem(a.item)?(r(),f(ke,{key:0,item:a.item},null,8,["item"])):V("",!0)],64)}}}),Me={class:"flex w-fit cursor-pointer rounded bg-gray-800 shadow-sm"},Se=["onClick"],Ne=$({__name:"DashboardItemActions",props:{itemIndex:{}},emits:{edit:()=>!0},setup(v,{emit:t}){const a=v,e=I("dashboard"),u=[{icon:"edit",label:"Edit",onClick:()=>e.editingItemIndex=a.itemIndex},{icon:"trash",label:"Delete",onClick:()=>e.removeItem(a.itemIndex)}];return(l,s)=>{const o=k("FeatherIcon");return r(),h("div",Me,[(r(),h(T,null,j(u,d=>_("div",{key:d.label,class:"rounded p-1.5 hover:bg-gray-700",onClick:p=>d.onClick()},[x(o,{name:d.icon,class:"h-3.5 w-3.5 text-white"},null,8,["name"])],8,Se)),64))])}}}),Be={class:"prose w-full text-gray-700 h-full flex items-center"},Le=["innerHTML"],Oe={class:"space-y-2"},je=$({__name:"DashboardText",props:{item:{}},setup(v){const t=I("dashboard"),a=v,e=O(y(a.item.text));return(u,l)=>{const s=k("Dialog");return r(),h(T,null,[_("div",Be,[_("div",{innerHTML:a.item.text},null,8,Le)]),y(t).isEditingItem(a.item)?(r(),f(s,{key:0,modelValue:y(t).isEditingItem(a.item),"onUpdate:modelValue":l[1]||(l[1]=o=>o?!0:y(t).editingItemIndex=null),options:{title:"Edit Text",actions:[{label:"Save",variant:"solid",disabled:!e.value||e.value.trim()===""||e.value===a.item.text,onClick:()=>{a.item.text=e.value,y(t).editingItemIndex=null}},{label:"Cancel",onClick:()=>y(t).editingItemIndex=null}]}},{"body-content":w(()=>[_("div",Oe,[l[2]||(l[2]=_("span",{class:"block text-sm leading-4 text-gray-700"},"Content",-1)),x(y(W),{ref:"textEditor",editable:!0,content:e.value,"editor-class":"min-h-[8rem] h-auto prose-sm cursor-text bg-gray-100 rounded p-2",onChange:l[0]||(l[0]=o=>e.value=o),placeholder:"Enter your text content here..."},null,8,["content"]),l[3]||(l[3]=_("p",{class:"text-xs text-gray-500"},"Markdown supported",-1))])]),_:1},8,["modelValue","options"])):V("",!0)],64)}}}),Pe={class:"group relative flex h-full w-full p-2"},Ze=$({__name:"DashboardItem",props:{index:{},item:{}},setup(v){const t=v,a=I("dashboard");return(e,u)=>(r(),h("div",Pe,[_("div",{class:Z(["flex h-full w-full items-center justify-center",y(a).editing?"pointer-events-none  [&>div:first-child]:rounded [&>div:first-child]:group-hover:outline [&>div:first-child]:group-hover:outline-gray-400":""])},[t.item.type=="chart"?(r(),f(_e,{key:0,item:t.item},null,8,["item"])):t.item.type==="text"?(r(),f(je,{key:1,item:t.item},null,8,["item"])):t.item.type==="filter"?(r(),f(De,{key:2,item:t.item},null,8,["item"])):V("",!0)],2),y(a).editing?(r(),f(Ne,{key:0,class:"absolute top-0 right-0 opacity-0 group-hover:opacity-100","item-index":e.index},null,8,["item-index"])):V("",!0)]))}}),Ae={class:"h-full w-full rounded bg-white p-4 shadow"},et=$({__name:"VueGridLayout",props:H({cols:{},disabled:{},verticalCompact:{type:Boolean}},{modelValue:{},modelModifiers:{}}),emits:["update:modelValue"],setup(v){const t=S(v,"modelValue"),a=O(!1),e=v,u=M({colNum:e.cols||12,margin:[0,0],rowHeight:52,isDraggable:b(()=>!e.disabled),isResizable:b(()=>!e.disabled),responsive:!0,verticalCompact:b(()=>e.verticalCompact??!0),preventCollision:!1,useCssTransforms:!0,cols:{lg:e.cols||12,md:e.cols||12,sm:e.cols||12,xs:1,xxs:1}});return(l,s)=>{const o=k("grid-item"),d=k("grid-layout");return r(),f(d,R({layout:t.value,"onUpdate:layout":s[0]||(s[0]=p=>t.value=p)},u,{onLayoutReady:s[1]||(s[1]=()=>a.value=!0)}),{default:w(({gridItemProps:p})=>[(r(!0),h(T,null,j(t.value,(i,m)=>(r(),f(o,R({ref_for:!0},p,{key:i.i,i:i.i,x:i.x,y:i.y,w:i.w,h:i.h}),{default:w(()=>[a.value?ee(l.$slots,"item",{key:0,index:m,i:i.i,x:i.x,y:i.y,w:i.w,h:i.h},()=>[_("pre",Ae,"						"+P({i:i.i,x:i.x,y:i.y,w:i.w,h:i.h})+`
					`,1)]):V("",!0)]),_:2},1040,["i","x","y","w","h"]))),128))]),_:3},16,["layout"])}}});export{et as _,Ze as a};
//# sourceMappingURL=VueGridLayout.vue_vue_type_style_index_0_lang-dd27665c.js.map
