import{b5 as Z,s as J,u as D,E as I,j as R,I as ee,r as w,o as u,d as f,h as l,K as a,w as b,f as p,F as N,bu as _e,bv as ve,bw as xe,v as te,bx as we,C as oe,B as ke,z as ne,c as x,J as L,e as q,a5 as Ce,t as W,aC as ae,aG as T,an as H,D as se,i as re,by as le,U as ie,bz as ce,y as de,ad as ue,ae as pe,aM as qe,bA as $e,bB as Ae,_ as Re,g as Ve,A as G,bC as De,bD as Se,af as Ie,ac as Ne}from"./frappe-ui-d69b39da.js";import{u as E,s as Te,_ as me,C as he,d as Me,a as Oe,e as ze,b as Qe}from"./QueryDataSourceSelector-8ecc9714.js";import{P as He}from"./PageBreadcrumbs-2c73064a.js";import{u as Le}from"./useNotebook-d0bc6ec9.js";import{v as je,s as S,h as Be,a as Ue}from"./index-9194c21d.js";import{_ as X}from"./Autocomplete-e91e4d1c.js";import{u as Ee}from"./useDashboards-65106383.js";import"./dayjs-e81f6541.js";import{c as Pe,g as Fe}from"./useChartData-3320721f.js";import{u as P,C as Je}from"./queryStore-e3123969.js";import We from"./InvalidWidget-252e2915.js";import{w as F,T as Ke}from"./widgets-5dfe9af0.js";import{u as Ge}from"./dataSourceStore-ae22034f.js";import{c as V}from"./index-77f7bd6f.js";import{c as Xe}from"./chart-scatter-06f2042d.js";import"./toasts-2937f9d2.js";import"./router-9009eafe.js";import"./TanstackTable-bdba0e34.js";import"./search-34ad51bc.js";import"./chevron-down-7c5e9308.js";import"./chevron-right-abc82e4c.js";import"./colors-18b5c913.js";import"./chevron-left-c299c44c.js";import"./vue-codemirror.esm-d1d2df5a.js";import"./useDataSource-526c5b5a.js";import"./cacheStore-a53900e8.js";import"./useDataSourceTable-37863c71.js";import"./house-94cdb6cd.js";import"./ellipsis-10a30b7b.js";import"./calendar-1687c485.js";import"./clock-73e01da8.js";import"./Popover-5414f173.js";import"./format-a2b0a407.js";import"./list-filter-e596ffc3.js";import"./text-cursor-input-3636b908.js";/**
 * @license lucide-vue-next v0.484.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ye=V("code",[["polyline",{points:"16 18 22 12 16 6",key:"z7tu5w"}],["polyline",{points:"8 6 2 12 8 18",key:"1eg1df"}]]);/**
 * @license lucide-vue-next v0.484.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ze=V("heading-1",[["path",{d:"M4 12h8",key:"17cfdx"}],["path",{d:"M4 18V6",key:"1rz3zl"}],["path",{d:"M12 18V6",key:"zqpxq5"}],["path",{d:"m17 12 3-2v8",key:"1hhhft"}]]);/**
 * @license lucide-vue-next v0.484.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const et=V("heading-2",[["path",{d:"M4 12h8",key:"17cfdx"}],["path",{d:"M4 18V6",key:"1rz3zl"}],["path",{d:"M12 18V6",key:"zqpxq5"}],["path",{d:"M21 18h-4c0-4 4-3 4-6 0-1.5-2-2.5-4-1",key:"9jr5yi"}]]);/**
 * @license lucide-vue-next v0.484.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const tt=V("heading-3",[["path",{d:"M4 12h8",key:"17cfdx"}],["path",{d:"M4 18V6",key:"1rz3zl"}],["path",{d:"M12 18V6",key:"zqpxq5"}],["path",{d:"M17.5 10.5c1.7-1 3.5 0 3.5 1.5a2 2 0 0 1-2 2",key:"68ncm8"}],["path",{d:"M17 17.5c2 1.5 4 .3 4-1.5a2 2 0 0 0-2-2",key:"1ejuhz"}]]);/**
 * @license lucide-vue-next v0.484.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ot=V("minus",[["path",{d:"M5 12h14",key:"1ays0h"}]]);/**
 * @license lucide-vue-next v0.484.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const nt=V("remove-formatting",[["path",{d:"M4 7V4h16v3",key:"9msm58"}],["path",{d:"M5 20h6",key:"1h6pxn"}],["path",{d:"M13 4 8 20",key:"kqq6aj"}],["path",{d:"m15 15 5 5",key:"me55sn"}],["path",{d:"m20 15-5 5",key:"11p7ol"}]]);/**
 * @license lucide-vue-next v0.484.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const at=V("square-chevron-right",[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",key:"afitv7"}],["path",{d:"m10 8 4 4-4 4",key:"1wy4r4"}]]);/**
 * @license lucide-vue-next v0.484.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const st=V("square-parking",[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",key:"afitv7"}],["path",{d:"M9 17V7h4a3 3 0 0 1 0 6H9",key:"1dfk2c"}]]);/**
 * @license lucide-vue-next v0.484.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const rt=V("strikethrough",[["path",{d:"M16 4H9a3 3 0 0 0-2.83 4",key:"43sutm"}],["path",{d:"M14 12a4 4 0 0 1 0 8H6",key:"nlfj13"}],["line",{x1:"4",x2:"20",y1:"12",y2:"12",key:"1e0a9i"}]]);function lt(o){const e=Z({doctype:"Insights Notebook Page",name:o,transform(s){return s.content=S(s.content),s}}),t=J({doc:{},loading:!1});t.reload=async()=>{t.loading=!0,t.doc=await e.get.fetch(),ct(t.doc.content)&&(t.doc.content=dt()),t.loading=!1},t.reload(),t.save=async()=>{t.loading=!0,t.doc.content=it(t.doc.content);const s=JSON.stringify(t.doc.content,null,2);await e.setValue.submit({title:t.doc.title||"Untitled",content:s}),t.loading=!1};const n=D(()=>{if(t.doc.name)return{title:t.doc.title,content:t.doc.content}});return je(n,{saveFn:t.save,interval:1500}),t.delete=async()=>{t.loading=!0,await e.delete.submit(),t.loading=!1},t.addQuery=async(s,d)=>{if(!["query-editor"].includes(s))throw new Error(`Invalid query type: ${s}`);t.loading=!0;const r=S(t.doc.content);r.content.push({type:s,attrs:{query:d}}),t.doc.content=r,await t.save(),await t.reload(),t.loading=!1},t}function it(o){var t,n;if(typeof o=="string"&&(o=S(o)),!((t=o.content)!=null&&t.length))return{};const e=(n=o.content)==null?void 0:n.at(-1);return(e==null?void 0:e.type)!="paragraph"&&o.content.push({type:"paragraph",attrs:{textAlign:"left"}}),o}function ct(o){var e;if(!o||(typeof o=="string"&&(o=S(o)),!o.type)||!((e=o.content)!=null&&e.length))return!0}function dt(){return{type:"doc",content:[{type:"paragraph",attrs:{textAlign:"left"},content:[{type:"text",text:"â“Donâ€™t know where to start? Start by defining your.."}]},{type:"paragraph",attrs:{textAlign:"left"},content:[{type:"text",marks:[{type:"bold"}],text:"ðŸŽ¯ Objective"},{type:"text",text:": "},{type:"text",marks:[{type:"italic"}],text:"We have to find out why so and soâ€¦"}]},{type:"paragraph",attrs:{textAlign:"left"},content:[{type:"text",marks:[{type:"bold"}],text:"ðŸ” Approach:"}]},{type:"bulletList",content:[{type:"listItem",content:[{type:"paragraph",attrs:{textAlign:"left"},content:[{type:"text",marks:[{type:"italic"}],text:"We start with this data"}]}]},{type:"listItem",content:[{type:"paragraph",attrs:{textAlign:"left"},content:[{type:"text",marks:[{type:"italic"}],text:"Combine with that data"}]}]}]},{type:"paragraph",attrs:{textAlign:"left"},content:[{type:"text",text:"âŒ Want to start from scratch? Use the clear button inside the 3-dot menu "}]}]}}const ut={__name:"NotebookPageDropdown",setup(o){const e=I("page"),t=R(!1),n=ee();function s(){const d=e.doc.notebook;e.delete().then(()=>{n.push(`/notebook/${d}`)})}return(d,c)=>{const r=w("Dropdown"),i=w("Dialog");return u(),f(N,null,[l(r,{button:{icon:"more-horizontal",variant:"ghost"},options:[{label:"Clear",icon:"x-square",onClick:()=>a(e).doc.content={}},{label:"Delete",icon:"trash",onClick:()=>t.value=!0}]},null,8,["options"]),l(i,{options:{title:"Delete Page",icon:{name:"trash",variant:"solid",theme:"red"},actions:[{label:"Delete",variant:"solid",theme:"red",loading:a(e).delete.loading,onClick:s}]},modelValue:t.value,"onUpdate:modelValue":c[0]||(c[0]=C=>t.value=C),dismissable:!0},{"body-content":b(()=>c[1]||(c[1]=[p("p",{class:"text-base text-gray-600"},"Are you sure you want to delete this page?",-1)])),_:1},8,["options","modelValue"])],64)}}};function fe(o){const{name:e,component:t,tag:n,...s}=o;return _e.create({name:e,group:s.group||"block",atom:s.atom||!0,addAttributes(){return s.attributes||{}},parseHTML(){return[{tag:n}]},renderHTML({HTMLAttributes:d}){return[n,ve(d)]},addNodeView(){return xe(t)}})}const U={};async function pt(){return te("insights.api.queries.create_chart")}function Y(o){return U[o]||(U[o]=mt(o)),U[o]}function mt(o){const e=ht(o),t=J({query:null,data:[],columns:[],loading:!1,error:null,options:{},autosave:!1,doc:{doctype:"Insights Chart",name:void 0,chart_type:void 0,options:{},is_public:!1}});async function n(){if(t.loading=!0,await e.get.fetch(),t.doc=e.doc,!t.doc.query){t.loading=!1;return}t.doc.query=e.doc.query,s()}n();function s(){t.loading=!0;const h=E(t.doc.query);h.reload(),we(()=>h.results.doc,()=>{if(!h.doc)return;t.columns=h.results.columns;const A=h.results.formattedResults;if(t.data=Pe(A),!t.doc.chart_type){const k=Fe(A);t.doc.chart_type=k==null?void 0:k.type,t.doc.options=k==null?void 0:k.options,t.doc.options.title=h.doc.title}t.doc.options.query=t.doc.query,t.loading=!1})}function d(){e.setValue.submit({chart_type:t.doc.chart_type,options:t.doc.options})}function c(h){t.doc.is_public!==h&&e.setValue.submit({is_public:h}).then(()=>{$notify({title:"Chart access updated",variant:"success"}),t.doc.is_public=h})}function r(h){h&&t.doc.query!==h&&(t.doc.query=h,e.setValue.submit({query:h}).then(()=>{s()}))}r=oe(r,500);let i;function C(){t.autosave=!0,i=ke(()=>t.doc,d,{deep:!0,debounce:500})}function _(){t.autosave=!1,i&&(i(),i=void 0)}async function m(){t.deleting=!0,await e.delete.submit(),t.deleting=!1}async function v(h){!h||!t.doc.name||t.addingToDashboard||(t.addingToDashboard=!0,await te("insights.api.dashboards.add_chart_to_dashboard",{dashboard:h,chart:t.doc.name}),t.addingToDashboard=!1)}function $(){t.doc.chart_type=void 0,t.doc.options={}}return Object.assign(t,{load:n,save:d,togglePublicAccess:c,updateQuery:r,enableAutoSave:C,disableAutoSave:_,addToDashboard:v,resetOptions:$,delete:m})}function ht(o){return Z({doctype:"Insights Chart",name:o,transform:e=>(e.chart_type=e.chart_type,e.options=S(e.options),e.options.query=e.query,e)})}const ft={class:"flex items-center space-x-1.5"},yt={class:"text-sm"},Q={__name:"BlockAction",props:{label:String,icon:String,iconComponent:Object,action:Function,loading:Boolean},setup(o){return(e,t)=>{const n=w("FeatherIcon");return u(),f("div",{class:"flex h-8 cursor-pointer items-center rounded border border-gray-200 bg-white px-2 hover:bg-gray-50 hover:text-gray-800",onClick:t[0]||(t[0]=ae(()=>!o.loading&&o.action&&o.action(),["prevent","stop"]))},[ne(e.$slots,"default",{},()=>[p("div",ft,[o.iconComponent?(u(),x(L(o.iconComponent),{key:0,class:"h-4 w-4 text-gray-500"})):q("",!0),o.loading?(u(),x(a(Ce),{key:1,class:"h-4 w-4 text-gray-500"})):(u(),x(n,{key:2,name:o.icon,class:"h-4 w-4 text-gray-500"},null,8,["name"])),p("span",yt,W(o.label),1)])])])}}},gt={class:"flex w-[10rem] flex-col space-y-1.5 text-sm transition-all"},bt={__name:"BlockActions",props:{blockRef:Object,actions:{type:Array,default:()=>[]}},setup(o){return(e,t)=>o.blockRef?(u(),x(me,{key:0,targetElement:o.blockRef,placement:"right-start",transition:a(Te)},{default:b(()=>[p("div",gt,[ne(e.$slots,"default")])]),_:3},8,["targetElement","transition"])):q("",!0)}},_t={class:"flex h-full w-full flex-col p-3"},vt={class:"relative flex flex-shrink-0 justify-between pb-3 text-base"},xt={key:0,class:"flex w-full flex-1 flex-col gap-4 overflow-y-auto pt-0 !text-base"},wt={__name:"ChartOptions",props:{onClose:Function},setup(o){const e=I("chart"),t=[{label:"Select a chart type",value:void 0}].concat(F.getChartOptions());return(n,s)=>{var r;const d=w("FeatherIcon"),c=w("Input");return u(),f("div",_t,[p("div",vt,[s[3]||(s[3]=p("span",{class:"font-code text-sm uppercase text-gray-600"}," Options ",-1)),l(d,{name:"x",class:"h-4 w-4 cursor-pointer text-gray-500 transition-all hover:text-gray-800",onClick:s[0]||(s[0]=ae(i=>o.onClose&&o.onClose(),["prevent","stop"]))})]),(r=a(e))!=null&&r.doc.chart_type?(u(),f("div",xt,[l(c,{type:"select",label:"Chart Type",class:"w-full",modelValue:a(e).doc.chart_type,"onUpdate:modelValue":s[1]||(s[1]=i=>a(e).doc.chart_type=i),options:a(t)},null,8,["modelValue","options"]),a(e).doc.chart_type?(u(),x(L(a(F).getOptionComponent(a(e).doc.chart_type)),{key:a(e).doc.chart_type,modelValue:a(e).doc.options,"onUpdate:modelValue":s[2]||(s[2]=i=>a(e).doc.options=i),columns:a(e).columns},null,8,["modelValue","columns"])):q("",!0)])):q("",!0)])}}},kt={class:"flex items-center space-x-1.5"},Ct={class:"h-[22rem] w-[15rem] overflow-y-auto rounded bg-white text-base shadow"},qt={__name:"ChartOptionsDropdown",setup(o){const e=R(null);return I("chart"),(t,n)=>{const s=w("FeatherIcon");return u(),f(N,null,[p("div",{ref_key:"targetElement",ref:e,class:"flex h-full w-full items-center px-2"},[p("div",kt,[l(s,{name:"settings",class:"h-3.5 w-3.5 text-gray-500"}),n[0]||(n[0]=p("span",{class:"text-sm"},"Options",-1))])],512),e.value?(u(),x(me,{key:0,targetElement:e.value,placement:"bottom-end"},{default:b(({toggle:d})=>[p("div",Ct,[l(wt,{onClose:()=>d(!1)},null,8,["onClose"])])]),_:1},8,["targetElement"])):q("",!0)],64)}}},$t={class:"relative h-full w-full"},At={key:1,class:"absolute right-0 top-0 flex h-full w-full flex-col items-center justify-center"},Rt={class:"w-[10rem] rounded border border-dashed border-gray-300"},Vt={class:"text-base"},Dt={__name:"ChartBlock",props:{chartName:String},emits:["setChartName","remove"],async setup(o,{emit:e}){let t,n;const s=e,d=o,c=R(null);let r=null;if(d.chartName)r=Y(d.chartName);else{const y=([t,n]=T(()=>pt()),t=await t,n(),t);s("setChartName",y),r=Y(y)}r.enableAutoSave(),H("chart",r);function i(){r.delete().then(()=>s("remove"))}const _=P().list.map(y=>({label:y.title,value:y.name,description:y.name})),m=D(()=>_.find(y=>y.value===r.doc.query)),v=y=>l("div",{class:"relative flex w-full items-center text-gray-800 [&>div]:w-full"},[l(X,{placeholder:"Query",options:_,modelValue:m.value,placement:"bottom","onUpdate:modelValue":g=>r.updateQuery(g.value)},null),l("p",{class:"pointer-events-none absolute right-0 top-0 flex h-full items-center px-2"},[l(w("FeatherIcon"),{name:"chevron-down",class:"h-4 w-4 text-gray-500"},null)])]),$=R(!1),h=Ee();h.reload();const A=R(null),k=R(!1),ye=D(()=>h.list.sort((y,g)=>y.title.toLowerCase()<g.title.toLowerCase()?-1:1).map(y=>({label:y.title,value:y.name}))),ge=I("$notify"),be=async()=>{A.value&&(await r.addToDashboard(A.value.value),$.value=!1,ge({variant:"success",title:"Success",message:"Chart added to dashboard"}))},j=R(null);return se(()=>$.value,y=>{y&&setTimeout(()=>{var g,M,O,z;(M=(g=j.value.input)==null?void 0:g.$el)==null||M.blur(),(z=(O=j.value.input)==null?void 0:O.$el)==null||z.focus()},500)},{immediate:!0}),(y,g)=>{var K;const M=X,O=w("Button"),z=w("Dialog");return u(),f(N,null,[a(r).doc.name?(u(),f("div",{key:0,ref_key:"blockRef",ref:c,class:"group relative my-6 h-[20rem] overflow-hidden rounded border bg-white"},[(K=a(r).doc)!=null&&K.chart_type?(u(),x(L(a(F).getComponent(a(r).doc.chart_type)),{ref:"widget",data:a(r).data,options:a(r).doc.options,key:JSON.stringify([a(r).data,a(r).doc.options])},{placeholder:b(()=>[p("div",$t,[l(We,{class:"absolute",title:"Insufficient options",message:"Please check the options for this chart",icon:"settings","icon-class":"text-gray-500"})])]),_:1},8,["data","options"])):(u(),f("div",At,[g[2]||(g[2]=p("div",{class:"mb-1 w-[10rem] text-gray-500"},"Select a query",-1)),p("div",Rt,[l(v)])]))],512)):q("",!0),l(bt,{blockRef:c.value},{default:b(()=>[l(Q,{class:"!px-0"},{default:b(()=>[l(v)]),_:1}),a(r).doc.query?(u(),x(Q,{key:0,class:"!px-0"},{default:b(()=>[l(qt)]),_:1})):q("",!0),l(Q,{label:"Add to dashboard",icon:"plus",action:()=>$.value=!0},null,8,["action"]),l(Q,{icon:"trash",label:"Delete",action:i,loading:a(r).deleting},null,8,["loading"])]),_:1},8,["blockRef"]),l(z,{options:{title:"Add to Dashboard"},modelValue:$.value,"onUpdate:modelValue":g[1]||(g[1]=B=>$.value=B)},{"body-content":b(()=>[p("div",Vt,[g[3]||(g[3]=p("span",{class:"mb-2 block text-sm leading-4 text-gray-700"},"Dashboard",-1)),l(M,{ref_key:"dashboardInput",ref:j,options:ye.value,modelValue:A.value,"onUpdate:modelValue":g[0]||(g[0]=B=>A.value=B)},null,8,["options","modelValue"])])]),actions:b(()=>[l(O,{variant:"solid",onClick:be,loading:k.value},{default:b(()=>g[4]||(g[4]=[re(" Add ")])),_:1},8,["loading"])]),_:1},8,["modelValue"])],64)}}},St={__name:"Chart",props:le,setup(o){const e=o;return(t,n)=>(u(),x(a(ce),{class:"not-prose text-base"},{default:b(()=>[(u(),x(ie,null,{default:b(()=>[l(Dt,{chartName:e.node.attrs.chart_name,onSetChartName:n[0]||(n[0]=s=>e.updateAttributes({chart_name:s})),onRemove:n[1]||(n[1]=s=>e.deleteNode())},null,8,["chartName"])]),_:1}))]),_:1}))}},It=fe({name:"chart",tag:"chart",component:St,attributes:{chart_name:void 0}}),Nt={__name:"ResizeableInput",props:{modelValue:String|Number,placeholder:String},emits:["update:modelValue"],setup(o,{emit:e}){const t=e,n=o,s=D({get:()=>n.modelValue||"",set:d=>t("update:modelValue",d)});return(d,c)=>(u(),x(he,{modelValue:s.value,"onUpdate:modelValue":c[0]||(c[0]=r=>s.value=r),placeholder:n.placeholder,class:de(["h-7 cursor-pointer px-2.5 leading-7 outline-none ring-0 transition-all focus:outline-none",d.$attrs.class])},null,8,["modelValue","placeholder","class"]))}},Tt={class:"flex items-center justify-between rounded-t-lg p-1 pl-3 text-base"},Mt={class:"flex items-center font-mono text-sm"},Ot={key:0,class:"mr-1"},zt={class:"text-gray-600"},Qt={class:"flex items-center space-x-1"},Ht={class:"relative"},Lt=["innerHTML"],jt={__name:"QueryBlockHeader",setup(o){const e=I("state"),t=oe(m=>e.query.updateTitle(m),1500),n=R(!1),s=D(()=>e.query.doc.sql.replaceAll(`
`,"<br>").replaceAll("      ","&ensp;&ensp;&ensp;&ensp;")),d=I("page"),c=ee();function r(){e.query.duplicate().then(m=>{d!=null&&d.addQuery?d.addQuery("query-editor",m):c.push(`/query/build/${m}`)})}const i=Ge(),C=m=>l("div",{class:"group flex w-full cursor-pointer items-center justify-between rounded-md px-2 py-2 text-sm hover:bg-gray-100",onClick:()=>_(m.name)},[l("span",null,[m.label]),ue(l(w("FeatherIcon"),{name:"check",class:"h-4 w-4 text-gray-600"},null),[[pe,m.active]])]);D(()=>i.list.find(m=>m.name===e.query.doc.data_source)),D(()=>i.list.map(m=>({component:v=>l(C,{name:m.name,label:m.title,active:m.name===e.query.doc.data_source},null)})));function _(m){e.query.changeDataSource(m).then(()=>{$notify({title:"Data source updated",variant:"success"}),e.query.doc.data_source=m})}return(m,v)=>{const $=w("Dropdown"),h=w("Button"),A=w("Dialog");return u(),f(N,null,[p("div",Tt,[p("div",Mt,[a(e).query.doc.is_stored?(u(),f("div",Ot,[l(a(Je),{class:"h-3 w-3 text-gray-600",fill:"currentColor"})])):q("",!0),l(Nt,{modelValue:a(e).query.doc.title,"onUpdate:modelValue":[v[0]||(v[0]=k=>a(e).query.doc.title=k),a(t)],class:"-ml-2 cursor-text"},null,8,["modelValue","onUpdate:modelValue"]),p("p",zt,"("+W(a(e).query.doc.name)+")",1)]),p("div",Qt,[l(Me),l($,{button:{icon:"more-vertical",variant:"outline"},options:[{label:a(e).minimizeResult?"Show Results":"Hide Results",icon:a(e).minimizeResult?"maximize-2":"minimize-2",onClick:()=>a(e).minimizeResult=!a(e).minimizeResult},{label:"Duplicate",icon:"copy",onClick:r,loading:a(e).query.duplicating},{label:"View SQL",icon:"code",onClick:()=>n.value=!0,loading:a(e).query.duplicating},{label:"Delete",icon:"trash",onClick:a(e).removeQuery,loading:a(e).query.deleting}]},null,8,["options"])])]),l(A,{options:{title:"Generated SQL",size:"3xl"},modelValue:n.value,"onUpdate:modelValue":v[2]||(v[2]=k=>n.value=k),dismissable:!0},{"body-content":b(()=>[p("div",Ht,[p("p",{class:"rounded border bg-gray-100 p-2 text-base text-gray-600",style:{"font-family":"'Fira Code'"},innerHTML:s.value},null,8,Lt),l(h,{icon:"copy",variant:"ghost",class:"absolute bottom-2 right-2",onClick:v[1]||(v[1]=k=>a(Be)(a(e).query.doc.sql))})])]),_:1},8,["modelValue"])],64)}}},Bt={key:0,ref:"blockRef",class:"relative my-6 overflow-hidden rounded border bg-white"},Ut={class:"flex min-h-[10rem] w-full flex-1 overflow-hidden border-t"},Et={key:0,class:"group relative flex max-h-80 flex-col overflow-hidden border-t bg-white"},Pt={key:1,class:"flex h-20 w-full flex-col items-center justify-center"},Ft={__name:"QueryBlock",props:{query:String},emits:["setQuery","remove"],async setup(o,{emit:e}){let t,n;const s=e,d=o;let c=null;if(d.query)c=E(d.query),[t,n]=T(()=>c.reload()),await t,n();else{const i=([t,n]=T(()=>P().create()),t=await t,n(),t);s("setQuery",i.name),c=E(i.name),[t,n]=T(()=>c.reload()),await t,n()}[t,n]=T(()=>c.convertToNative()),await t,n(),H("query",c);const r=J({dataSource:"",minimizeResult:!0,minimizeQuery:!1,showQueryActions:!1,query:c});return H("state",r),r.removeQuery=()=>{P().delete(c.doc.name).then(()=>s("remove"))},(i,C)=>{var m,v;const _=w("LoadingIndicator");return a(c).doc.name?(u(),f("div",Bt,[l(jt),l(qe,{name:"fade",mode:"out-in"},{default:b(()=>[ue(p("div",Ut,[l(Oe)],512),[[pe,r.query.doc.name&&!r.minimizeQuery]])]),_:1}),((v=(m=r.query.results)==null?void 0:m.formattedResults)==null?void 0:v.length)>1&&!r.minimizeResult?(u(),f("div",Et,[l(Qe,null,{footer:b(()=>[l(ze)]),_:1})])):q("",!0)],512)):(u(),f("div",Pt,[l(_,{class:"mb-2 w-6 text-gray-300"})]))}}},Jt={__name:"Query",props:le,setup(o){const e=o;return(t,n)=>(u(),x(a(ce),{class:"not-prose text-base"},{default:b(()=>[(u(),x(ie,null,{default:b(()=>[l(Ft,{query:e.node.attrs.query,onSetQuery:n[0]||(n[0]=s=>e.updateAttributes({query:s})),onRemove:n[1]||(n[1]=s=>e.deleteNode())},null,8,["query"])]),_:1}))]),_:1}))}},Wt=fe({name:"query-editor",tag:"query-editor",component:Jt,attributes:{query:void 0}}),Kt=$e.create({name:"slash-commands",addOptions(){return{suggestion:{char:"/",command:({editor:o,range:e,props:t})=>{t.command({editor:o,range:e})}}}},addProseMirrorPlugins(){return[Ae({editor:this.editor,...this.options.suggestion})]}}),Gt={props:{items:{type:Array,required:!0},editor:{type:Object,required:!0},command:{type:Function,required:!0}},components:{Minus:ot},data(){return{selectedIndex:0}},watch:{items(){this.selectedIndex=0}},computed:{enabledItems(){return this.items.filter(o=>o.disabled?!o.disabled(this.editor):!0)}},methods:{onKeyDown({event:o}){return o.key==="ArrowUp"?(this.upHandler(),!0):o.key==="ArrowDown"?(this.downHandler(),!0):o.key==="Enter"?(this.enterHandler(),!0):!1},upHandler(){this.selectedIndex=(this.selectedIndex+this.enabledItems.length-1)%this.enabledItems.length},downHandler(){this.selectedIndex=(this.selectedIndex+1)%this.enabledItems.length},enterHandler(){this.selectItem(this.selectedIndex)},selectItem(o){const e=this.enabledItems[o];e&&this.command(e)}}},Xt={class:"flex w-40 flex-col rounded border bg-white p-1 text-base shadow"},Yt=["onClick","onMouseenter"],Zt={key:1,class:"item"};function eo(o,e,t,n,s,d){return u(),f("div",Xt,[d.enabledItems.length?(u(!0),f(N,{key:0},Ve(d.enabledItems,(c,r)=>(u(),f("button",{class:de(["flex h-8 w-full cursor-pointer items-center rounded px-1 text-base",{"bg-gray-100":r===s.selectedIndex}]),key:r,onClick:i=>d.selectItem(r),onMouseenter:i=>s.selectedIndex=r},[(u(),x(L(c.icon||"Minus"),{class:"mr-2 h-4 w-4 text-gray-600"})),re(" "+W(c.title),1)],42,Yt))),128)):(u(),f("div",Zt,"No result"))])}const to=Re(Gt,[["render",eo]]),oo={items:({query:o})=>[{title:"Paragraph",icon:st,command:({editor:e,range:t})=>{e.chain().focus().deleteRange(t).setNode("paragraph").run()},disabled:e=>e.isActive("table")},{title:"Heading 1",icon:Ze,command:({editor:e,range:t})=>{e.chain().focus().deleteRange(t).setNode("heading",{level:2}).run()},disabled:e=>e.isActive("table")},{title:"Heading 2",icon:et,command:({editor:e,range:t})=>{e.chain().focus().deleteRange(t).setNode("heading",{level:3}).run()},disabled:e=>e.isActive("table")},{title:"Heading 3",icon:tt,command:({editor:e,range:t})=>{e.chain().focus().deleteRange(t).setNode("heading",{level:4}).run()},disabled:e=>e.isActive("table")},{title:"Table",icon:Ke,command:({editor:e,range:t})=>{e.chain().focus().deleteRange(t).insertTable({rows:3,cols:3,withHeaderRow:!0}).run()},disabled:e=>e.isActive("table")},{title:"Add Column",command:({editor:e,range:t})=>{e.chain().focus().deleteRange(t).addColumnAfter().run()},disabled:e=>!e.isActive("table")},{title:"Add Row",command:({editor:e,range:t})=>{e.chain().focus().deleteRange(t).addRowAfter().run()},disabled:e=>!e.isActive("table")},{title:"Delete Column",command:({editor:e,range:t})=>{e.chain().focus().deleteRange(t).deleteColumn().run()},disabled:e=>!e.isActive("table")},{title:"Delete Row",command:({editor:e,range:t})=>{e.chain().focus().deleteRange(t).deleteRow().run()},disabled:e=>!e.isActive("table")},{title:"Delete Table",command:({editor:e,range:t})=>{e.chain().focus().deleteRange(t).deleteTable().run()},disabled:e=>!e.isActive("table")},{title:"Chart",icon:G(Xe),command:({editor:e,range:t})=>{const n="<chart></chart>";e.chain().focus().deleteRange(t).insertContent(n).run()},disabled:e=>!e.isActive("paragraph")||e.isActive("table")},{title:"SQL",icon:G(at),command:({editor:e,range:t})=>{const n="<query-editor></query-editor>";e.chain().focus().deleteRange(t).insertContent(n).run()},disabled:e=>!e.isActive("paragraph")||e.isActive("table")}].filter(e=>e.title.toLowerCase().includes(o.toLowerCase())),render:()=>{let o,e;return{onStart:t=>{o=new De(to,{props:t,editor:t.editor}),t.clientRect&&(e=Se("body",{getReferenceClientRect:t.clientRect,appendTo:()=>document.body,content:o.element,showOnCreate:!0,interactive:!0,trigger:"manual",placement:"bottom-start"}))},onUpdate(t){o.updateProps(t),t.clientRect&&e[0].setProps({getReferenceClientRect:t.clientRect})},onKeyDown(t){var n;return t.event.key==="Escape"?(e[0].hide(),!0):(n=o.ref)==null?void 0:n.onKeyDown(t)},onExit(){e[0].destroy(),o.destroy()}}}};const no={__name:"TipTap",props:["content"],emits:["update:content"],setup(o,{emit:e}){const t=e,n=o,s=R(null),d=()=>{const i=s.value.editor.getJSON();t("update:content",i)};Ie(()=>{const i=S(n.content);s.value.editor.commands.setContent(i)}),se(()=>n.content,i=>{const C=S(i);if(!C)return;const _=s.value.editor.getJSON();JSON.stringify(C)!==JSON.stringify(_)&&s.value.editor.commands.setContent(C)});function c({node:i}){return i.type.name==="heading"?`Heading ${i.attrs.level}`:"Type / to insert a block"}const r=["Bold","Italic",{label:"Strikethrough",icon:rt,action:i=>i.chain().focus().toggleStrike().run(),isActive:i=>i.isActive("strike")},"Blockquote",{label:"Code",icon:Ye,action:i=>i.chain().focus().toggleCode().run(),isActive:i=>i.isActive("code")},"Link",{label:"Remove Formatting",icon:nt,action:i=>i.chain().focus().unsetAllMarks().run(),isActive:()=>!1}];return(i,C)=>(u(),x(a(Ne),{ref_key:"tiptap",ref:s,editorClass:"max-w-full prose-h1:font-semibold prose-h1:mt-5 prose-h1:mb-3 prose-h2:font-semibold prose-h2:mt-4 prose-h2:mb-2 prose-p:!my-0 prose-p:py-1 prose-p:text-[16px] prose-p:leading-6 prose-code:before:content-[''] prose-code:after:content-[''] prose-ul:my-0 prose-ol:my-0 prose-li:my-0 prose-th:py-1 prose-td:py-1 prose-blockquote:my-3",onChange:d,"bubble-menu":r,"bubble-menu-options":{shouldShow:_=>_.from===_.to?!1:!_.editor.isActive("query-editor")&&!_.editor.isActive("chart")},placeholder:c,extensions:[a(Kt).configure({suggestion:a(oo)}),a(Wt),a(It)]},null,8,["bubble-menu-options","extensions"]))}},ao=no,so={class:"sticky top-0 z-10 flex items-center justify-between bg-white px-5 py-2.5"},ro={class:"flex flex-1 overflow-hidden bg-white px-6 py-2"},lo={key:0,class:"h-full w-full overflow-y-auto bg-white pb-96 pt-16 text-base scrollbar-hide"},io={class:"w-full px-[6rem] lg:mx-auto lg:max-w-[62rem]"},co={class:"flex items-center"},Fo={__name:"NotebookPage",props:{notebook:String,name:String},setup(o){const e=o,t=lt(e.name),n=Le(e.notebook);H("page",t);const s=D(()=>{var d,c;return{title:(d=t.doc)==null?void 0:d.title,subtitle:(c=t.doc)==null?void 0:c.notebook}});return Ue(s),(d,c)=>(u(),f(N,null,[p("header",so,[l(He,{class:"h-7",items:[{label:"Notebooks",route:{path:"/notebook"}},{label:a(n).doc.title||a(n).doc.name,route:{path:`/notebook/${a(n).doc.name}`}},{label:a(t).doc.title}]},null,8,["items"])]),p("div",ro,[a(t).doc.name?(u(),f("div",lo,[p("div",io,[p("div",co,[l(he,{class:"flex-1 text-[36px] font-bold",modelValue:a(t).doc.title,"onUpdate:modelValue":c[0]||(c[0]=r=>a(t).doc.title=r),placeholder:"Untitled Analysis"},null,8,["modelValue"]),l(ut)]),l(ao,{class:"my-6",content:a(t).doc.content,"onUpdate:content":c[1]||(c[1]=r=>a(t).doc.content=r)},null,8,["content"])])])):q("",!0)])],64))}};export{Fo as default};
//# sourceMappingURL=NotebookPage-fb8cf308.js.map
