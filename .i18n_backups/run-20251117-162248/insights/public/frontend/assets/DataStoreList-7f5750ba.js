import{s as C,j as m,v as k,aE as M,x as B,M as P,u as S,T as I,D as A,c as N,w,r as b,o as f,f as d,h as n,K as u,d as F,t as K,e as U,B as Q,m as z,F as J,aF as R,aJ as $}from"./frappe-ui-d69b39da.js";import{a as G,g as H}from"./data_source-00c6028c.js";import{b as O,t as W,s as D}from"./main-d2d228fc.js";import{_ as X}from"./Autocomplete-e91e4d1c.js";import{g as Y,a as Z,b as ee}from"./tables-0e8be38f.js";import{P as te}from"./plus-3394075c.js";import{S as ae}from"./search-34ad51bc.js";import"./index-77f7bd6f.js";import"./text-cursor-input-3636b908.js";import"./combine-0dbf7ac7.js";import"./chevron-down-7c5e9308.js";import"./Popover-5414f173.js";import"./index-9194c21d.js";import"./toasts-2937f9d2.js";import"./calendar-1687c485.js";import"./clock-73e01da8.js";const y=m({}),h=m(!1);async function j(i,a,o=100){return h.value=!0,k("insights.api.data_store.get_data_store_tables",{data_source:i,search_term:a,limit:o}).then(e=>e.map(l=>(l.last_synced_from_now=l.last_synced_on?M(l.last_synced_on):"",l))).then(e=>(i?y.value[i]=e:y.value.__all=e,e)).catch(O).finally(()=>{h.value=!1})}const T=m(!1);async function oe(i,a,o){return T.value=!0,k("insights.api.data_store.import_table",{data_source:i,table_name:a,row_limit:o}).then(()=>{j(i)}).catch(O).finally(()=>{T.value=!1})}function E(){return C({tables:y,loading:h,getTables:j,importingTable:T,importTable:oe})}const le={class:"flex w-full flex-col gap-2"},se={class:"flex flex-col gap-4"},ne={key:0},re={class:"mt-1 text-xs text-gray-500"},ie={class:"flex w-full justify-end gap-2 pt-2"},ue=B({__name:"ImportTableDialog",props:{modelValue:{default:!1},modelModifiers:{}},emits:["update:modelValue"],setup(i){const a=P(i,"modelValue"),o={data_source:"",table_name:"",row_limit:1e7,table_row_count:0},e=C({...o}),l=S(()=>e.data_source?Y(e.data_source):[]),_=m("");I(()=>{e.data_source&&Z(e.data_source,_.value)}),A(()=>e.table_name,()=>{if(!e.table_name){e.table_row_count=0;return}ee(e.data_source,e.table_name).then(c=>{e.table_row_count=c})});function p(){Object.assign(e,o),a.value=!1}const s=E(),g=S(()=>!e.table_name);function v(){s.importTable(e.data_source,e.table_name,e.row_limit).then(()=>{a.value=!1})}return(c,r)=>{const V=X,L=b("FormControl"),x=b("Button"),q=b("Dialog");return f(),N(q,{modelValue:a.value,"onUpdate:modelValue":r[4]||(r[4]=t=>a.value=t),options:{title:"Import Table",size:"md"}},{"body-content":w(()=>[d("div",le,[d("div",se,[n(V,{label:"Data Source",placeholder:"Select Data Source",modelValue:e.data_source,"onUpdate:modelValue":r[0]||(r[0]=t=>e.data_source=t==null?void 0:t.value),options:u(G)()},null,8,["modelValue","options"]),n(V,{label:"Table",placeholder:"Select Table",query:_.value,"onUpdate:query":r[1]||(r[1]=t=>_.value=t),disabled:!e.data_source,modelValue:e.table_name,"onUpdate:modelValue":r[2]||(r[2]=t=>e.table_name=t==null?void 0:t.value),options:l.value},null,8,["query","disabled","modelValue","options"]),e.table_name?(f(),F("div",ne,[n(L,{type:"number",label:"No. of rows to import",modelValue:e.row_limit,"onUpdate:modelValue":r[3]||(r[3]=t=>e.row_limit=t)},null,8,["modelValue"]),d("p",re," Selected table has "+K(u(W)(e.table_row_count))+" rows. ",1)])):U("",!0)]),d("div",ie,[n(x,{label:"Cancel",variant:"outline",onClick:p}),n(x,{label:"Import",variant:"solid",disabled:g.value,loading:u(s).importingTable,onClick:v},null,8,["disabled","loading"])])])]),_:1},8,["modelValue"])}}}),me={class:"flex h-12 items-center justify-between border-b py-2.5 pl-5 pr-2"},de={class:"flex items-center gap-2"},ce={class:"mb-4 flex h-full flex-col gap-3 overflow-auto px-5 py-3"},pe={class:"flex gap-2 overflow-visible py-1"},Ie=B({__name:"DataStoreList",setup(i){const a=E(),o=m(""),e=m(a.tables.__all);Q(o,()=>{a.getTables(void 0,o.value).then(p=>{e.value=p})},{debounce:300,immediate:!0});const l=m(!1),_=m({columns:[{label:"Table Name",key:"table_name"},{label:"Data Source",key:"data_source",prefix:p=>{const s=p.row;return H(s.database_type,"sm")}},{label:"Last Synced",key:"last_synced_from_now"}],rows:e,rowKey:"name",options:{showTooltip:!1,emptyState:{title:"No Tables Stored",description:"No tables found in the data store.",button:D.user.is_admin?{label:"Import Table",iconLeft:"plus",variant:"solid",loading:!1,onClick:()=>l.value=!0}:void 0}}});return I(()=>{document.title="Data Store | Insights"}),(p,s)=>{const g=b("Button"),v=b("FormControl");return f(),F(J,null,[d("header",me,[n(u(R),{items:[{label:"Data Store",route:"/data-store"}]}),d("div",de,[u(D).user.is_admin?(f(),N(g,{key:0,label:"Import Table",variant:"solid",onClick:s[0]||(s[0]=c=>l.value=!0)},{prefix:w(()=>[n(u(te),{class:"w-4"})]),_:1})):U("",!0)])]),d("div",ce,[d("div",pe,[n(v,{placeholder:"Search",modelValue:o.value,"onUpdate:modelValue":s[1]||(s[1]=c=>o.value=c),debounce:300},{prefix:w(()=>[n(u(ae),{class:"h-4 w-4 text-gray-500"})]),_:1},8,["modelValue"])]),n(u($),z({class:"h-full"},_.value),null,16)]),n(ue,{modelValue:l.value,"onUpdate:modelValue":s[2]||(s[2]=c=>l.value=c)},null,8,["modelValue"])],64)}}});export{Ie as default};
//# sourceMappingURL=DataStoreList-7f5750ba.js.map
