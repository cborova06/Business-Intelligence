import{u,j as v,r as C,o as m,d as D,f as l,t as S,c as U,w,h as r,i as L,be as $,s as P,P as E,D as M,e as T,K as A,bf as Q,F as R}from"./frappe-ui-d69b39da.js";import{_ as H}from"./Autocomplete-e91e4d1c.js";import{u as j}from"./dataSourceStore-ae22034f.js";import{D as z}from"./vuedraggable.umd-f13fb48a.js";import{_ as O}from"./Form-a11ed169.js";const G={class:"flex flex-col overflow-hidden text-base"},K={class:"mb-2 block text-sm leading-4 text-gray-700"},Z=["accept","disabled"],J={class:"truncate"},W={__name:"Attachment",props:{modelValue:Object|null,placeholder:String,label:String,fileType:String},emits:["update:modelValue"],setup(y,{emit:B}){const F=B,q=y,e=u({get:()=>q.modelValue,set:s=>F("update:modelValue",s)}),o=v(null);function g(){o.value.click()}function i(){o.value.value="",e.value=null}const _=v(!1);async function k(s){var x;const h=(x=s.target.files)==null?void 0:x[0];if(!h)return;_.value=!0,new $().upload(h,{}).then(f=>{e.value=f}).catch(f=>{e.value=null,console.error(f)}).finally(()=>{_.value=!1})}return(s,h)=>{var f;const p=C("FeatherIcon"),x=C("Button");return m(),D("div",G,[l("span",K,S(y.label||"Attach File"),1),l("input",{ref_key:"fileInput",ref:o,id:"attachment",type:"file",accept:y.fileType,class:"hidden",disabled:!!e.value,onInput:k},null,40,Z),(f=e.value)!=null&&f.name?(m(),U(x,{key:1,iconRight:"x",onClick:i},{default:w(()=>[l("span",J,S(e.value.file_name),1)]),_:1})):(m(),U(x,{key:0,onClick:g,loading:_.value},{default:w(()=>[r(p,{name:"upload",class:"mr-1 inline-block h-3 w-3"}),L(" "+S(y.placeholder||"Upload a file"),1)]),_:1},8,["loading"]))])}}},X={class:"mt-4 grid grid-cols-1 gap-4 lg:grid-cols-2"},Y={key:0,class:"mt-4"},ee={key:0,class:"mt-2 flex max-h-[15rem] flex-col overflow-hidden text-base"},te={class:"flex flex-col overflow-y-auto"},le={class:"flex h-10 w-full cursor-pointer items-center space-x-8 text-gray-600"},ae={class:"flex-1 overflow-hidden text-ellipsis whitespace-nowrap text-base font-medium"},ne={key:1,class:"mt-2 flex flex-col items-center justify-center space-y-2 p-12 text-center text-sm"},se={key:2,class:"mt-2 flex flex-col space-y-3 p-12 text-center text-sm text-gray-600"},oe={class:"mt-4 flex justify-between pt-2"},ie={class:"ml-auto flex items-center space-x-2"},ge={__name:"FileSourceForm",emits:["submit"],setup(y,{emit:B}){const F=B,q=["String","Integer","Decimal","Date","Datetime"],e=P({label:"",name:"",data_source:"Query Store",file:null,ifExists:"Overwrite"}),o=v([]),g=E({url:"insights.api.data_sources.get_columns_from_uploaded_file",initialData:[],onSuccess:a=>{o.value=a==null?void 0:a.map(t=>({label:t.label,name:k(t.label),type:t.type||"String"}))}});function i(a){o.value=o.value.filter(t=>t.column!==a)}const _=u(()=>!e.data_source||!e.label||!e.file||o.length===0||p.value);M(()=>e.file,a=>{var t;e.label=a?(t=a.file_name)==null?void 0:t.replace(/\.[^/.]+$/,""):"",e.name=a?k(e.label):"",a?g.submit({filename:a.name}):g.data=[]});function k(a){return a==null?void 0:a.toLocaleLowerCase().replace(/[^a-zA-Z0-9]/g,"_")}const s=E({url:"insights.api.data_sources.import_csv"}),h=j(),p=v(!1);function x(){p.value=!0;const a={table_label:e.label,table_name:e.name,filename:e.file.name,if_exists:e.ifExists,columns:o.value,data_source:e.data_source};s.submit(a).then(()=>{F("submit"),f()}).catch(t=>{p.value=!1,console.error(t)})}function f(){e.label="",e.name="",e.file=null,e.ifExists="Overwrite",e.data_source="",o.value=[],p.value=!1}return(a,t)=>{var b;C("FeatherIcon");const d=C("Input"),I=C("Button"),c=C("LoadingIndicator");return m(),D(R,null,[l("div",null,[T("",!0),l("div",X,[r(Q,{name:"fade"},{default:w(()=>[l("div",null,[t[7]||(t[7]=l("span",{class:"mb-2 block text-sm leading-4 text-gray-700"},"Data Source",-1)),r(H,{placeholder:"Select Data Source",modelValue:e.data_source,"onUpdate:modelValue":t[1]||(t[1]=n=>e.data_source=n==null?void 0:n.value),options:A(h).getDropdownOptions({allow_imports:1})},null,8,["modelValue","options"])]),r(W,{modelValue:e.file,"onUpdate:modelValue":t[2]||(t[2]=n=>e.file=n),label:"File",fileType:".csv",placeholder:"Upload CSV File"},null,8,["modelValue"]),e.file?(m(),U(d,{key:0,label:"New Table Label",type:"text",placeholder:"eg. Sales Data",modelValue:e.label,"onUpdate:modelValue":t[3]||(t[3]=n=>e.label=n)},null,8,["modelValue"])):T("",!0),e.file?(m(),U(d,{key:1,label:"New Table Name",type:"text",placeholder:"eg. sales_data",modelValue:e.name,"onUpdate:modelValue":t[4]||(t[4]=n=>e.name=n)},null,8,["modelValue"])):T("",!0),e.file?(m(),U(d,{key:2,type:"select",label:"Action if exists",modelValue:e.ifExists,"onUpdate:modelValue":t[5]||(t[5]=n=>e.ifExists=n),options:["Fail","Overwrite","Append"]},null,8,["modelValue"])):T("",!0)]),_:1})])]),e.data_source&&e.file?(m(),D("div",Y,[t[11]||(t[11]=l("span",{class:"text-base font-medium leading-6 text-gray-900"}," Columns ",-1)),(b=o.value)!=null&&b.length?(m(),D("div",ee,[t[8]||(t[8]=l("div",{class:"sticky right-0 top-0 z-10 flex h-8 w-full cursor-pointer items-center space-x-8 pr-8 pb-1 text-xs uppercase text-gray-600"},[l("span",{class:"flex-1"}," CSV Column "),l("span",{class:"flex-1"}," Column Name "),l("span",{class:"flex-1"}," Column Type ")],-1)),l("div",te,[r(A(z),{class:"w-full",modelValue:o.value,"onUpdate:modelValue":t[6]||(t[6]=n=>o.value=n),group:"columns","item-key":"column"},{item:w(({element:n})=>[l("div",le,[l("span",ae,S(n.label),1),r(d,{class:"flex-1 !text-sm",type:"text",value:n.name,onChange:V=>n.name=V},null,8,["value","onChange"]),r(d,{class:"flex-1 !text-sm",type:"select",options:q,value:n.type,onChange:V=>n.type=V},null,8,["value","onChange"]),r(I,{class:"!ml-0",icon:"x",variant:"minimal",onClick:V=>i(n.column)},null,8,["onClick"])])]),_:1},8,["modelValue"])])])):A(g).loading?(m(),D("div",ne,[r(c,{class:"h-4 w-4 text-gray-500"}),t[9]||(t[9]=l("p",{class:"text-gray-600"},"Loading columns...",-1))])):(m(),D("div",se,t[10]||(t[10]=[L(" No columns found in the uploaded file."),l("br",null,null,-1),L(" Please upload a different file. ")])))])):T("",!0),l("div",oe,[l("div",ie,[r(I,{variant:"solid",onClick:x,disabled:_.value,loading:p.value},{default:w(()=>t[12]||(t[12]=[L(" Import ")])),_:1},8,["disabled","loading"])])])],64)}}},re={class:"mt-6 flex justify-between pt-2"},ue={class:"ml-auto flex items-center space-x-2"},_e={__name:"MariaDBForm",props:{submitLabel:String},emits:["submit"],setup(y,{emit:B}){const F=y,q=B,e=P({}),o=v(null),g=[{name:"title",label:"Title",type:"text",placeholder:"My Database",required:!0},{label:"Host",name:"host",type:"text",placeholder:"localhost",required:!0,defaultValue:"localhost"},{label:"Port",name:"port",type:"number",placeholder:"3306",required:!0,defaultValue:3306},{label:"Database Name",name:"name",type:"text",placeholder:"DB_1267891",required:!0},{label:"Username",name:"username",type:"text",placeholder:"read_only_user",required:!0},{label:"Password",name:"password",type:"password",placeholder:"**********",required:!0},{label:"Use secure connection (SSL)?",name:"useSSL",type:"checkbox"}],i=j(),_=u(()=>!!g.filter(c=>c.required).every(c=>e[c.name])),k=u(()=>_.value===!1||i.testing),s=v(null),h=u(()=>i.testing?"":s.value===null?"Connect":s.value?"Connected":"Failed, Retry?"),p=u(()=>{if(s.value!==null)return s.value?"check":"alert-circle"}),x=u(()=>_.value===!1||!s.value||i.creating),f=u(()=>i.creating?"":F.submitLabel||"Add Database"),a=v(!1),t=async()=>{e.type="MariaDB",a.value=!0,s.value=await i.testConnection({database:e}),a.value=!1},d=v(!1),I=async()=>{e.type="MariaDB",d.value=!0,await i.create({database:e}),d.value=!1,q("submit")};return(c,b)=>{const n=C("Button");return m(),D(R,null,[r(O,{ref_key:"form",ref:o,class:"flex-1",modelValue:e,"onUpdate:modelValue":b[0]||(b[0]=V=>e=V),meta:{fields:g}},null,8,["modelValue","meta"]),l("div",re,[l("div",ue,[r(n,{variant:"outline",disabled:k.value,onClick:t,loadingText:"Connecting...",loading:a.value,iconLeft:p.value},{default:w(()=>[L(S(h.value),1)]),_:1},8,["disabled","loading","iconLeft"]),r(n,{variant:"solid",disabled:x.value,loadingText:"Adding Database...",loading:d.value,onClick:I},{default:w(()=>[L(S(f.value),1)]),_:1},8,["disabled","loading"])])])],64)}}},ce={class:"mt-6 flex justify-between pt-2"},de={class:"ml-auto flex items-center space-x-2"},xe={__name:"PostgreSQLForm",props:{submitLabel:String},emits:["submit"],setup(y,{emit:B}){const F=y,q=B,e=P({}),o=v(null),g=u(()=>[{name:"title",label:"Title",type:"text",placeholder:"My Database",required:!0},{label:"Host",name:"host",type:"text",placeholder:"localhost",required:!e.connection_string,defaultValue:"localhost"},{label:"Port",name:"port",type:"number",placeholder:"5432",required:!e.connection_string,defaultValue:5432},{label:"Database Name",name:"name",type:"text",placeholder:"DB_1267891",required:!e.connection_string},{label:"Username",name:"username",type:"text",placeholder:"read_only_user",required:!e.connection_string},{label:"Password",name:"password",type:"password",placeholder:"**********",required:!e.connection_string},{label:"Use secure connection (SSL)?",name:"useSSL",type:"checkbox"}]),i=j(),_=u(()=>!!(g.value.filter(c=>c.required).every(c=>e[c.name])||e.title&&e.connection_string)),k=u(()=>_.value===!1||i.testing),s=v(null),h=u(()=>i.testing?"":s.value===null?"Connect":s.value?"Connected":"Failed, Retry?"),p=u(()=>{if(s.value!==null)return s.value?"check":"alert-circle"}),x=u(()=>_.value===!1||!s.value||i.creating),f=u(()=>i.creating?"":F.submitLabel||"Add Database"),a=v(!1),t=async()=>{e.type="PostgreSQL",a.value=!0,i.testConnection({database:e}).then(c=>{s.value=c}).catch(c=>{s.value=!1}).finally(()=>{a.value=!1})},d=v(!1),I=async()=>{e.type="PostgreSQL",d.value=!0,await i.create({database:e}),d.value=!1,q("submit")};return(c,b)=>{const n=C("Input"),V=C("Button");return m(),D(R,null,[r(O,{ref_key:"form",ref:o,class:"flex-1",modelValue:e,"onUpdate:modelValue":b[0]||(b[0]=N=>e=N),meta:{fields:g.value}},null,8,["modelValue","meta"]),b[2]||(b[2]=l("div",{class:"my-4 flex items-center space-x-2 text-sm"},[l("p",{class:"mb-0.5 h-1 flex-1 border-b"}),l("p",null,"OR"),l("p",{class:"mb-0.5 h-1 flex-1 border-b"})],-1)),r(n,{modelValue:e.connection_string,"onUpdate:modelValue":b[1]||(b[1]=N=>e.connection_string=N),label:"Connection String",placeholder:"postgres://user:password@host:port/database"},null,8,["modelValue"]),l("div",ce,[l("div",de,[r(V,{variant:"outline",disabled:k.value,onClick:t,loadingText:"Connecting...",loading:a.value,iconLeft:p.value},{default:w(()=>[L(S(h.value),1)]),_:1},8,["disabled","loading","iconLeft"]),r(V,{variant:"solid",disabled:x.value,loadingText:"Adding Database...",loading:d.value,onClick:I},{default:w(()=>[L(S(f.value),1)]),_:1},8,["disabled","loading"])])])],64)}}};export{_e as _,xe as a,ge as b};
//# sourceMappingURL=PostgreSQLForm-944c0c05.js.map
